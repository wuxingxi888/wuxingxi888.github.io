<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>为什么vue template中不用加.value?</title>
      <link href="/2024/10/02/%E4%B8%BA%E4%BB%80%E4%B9%88vue-template%E4%B8%AD%E4%B8%8D%E7%94%A8%E5%8A%A0-value/"/>
      <url>/2024/10/02/%E4%B8%BA%E4%BB%80%E4%B9%88vue-template%E4%B8%AD%E4%B8%8D%E7%94%A8%E5%8A%A0-value/</url>
      
        <content type="html"><![CDATA[<p>vue3中定义的ref类型变量，在setup中使用这些变量是需要带上.value才可以访问的，但是在template中却可以直接使用。why？你可能会说vue自动进行ref解包了，那具体是如何实现的的？</p><h3 id="proxyRefs"><a href="#proxyRefs" class="headerlink" title="proxyRefs"></a>proxyRefs</h3><p>vue3中有个方法proxyRefs，这属于底层方法，在官方文档中并没有阐述，但是vue里是可以导出这个方法！</p><p>例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&#x27;ts&#x27;&gt;</span><br><span class="line">import &#123; onMounted, ref, proxyRefs &#125; from &#x27;vue&#x27;;</span><br><span class="line"></span><br><span class="line">const user = &#123;</span><br><span class="line">    name: &#x27;James&#x27;,</span><br><span class="line">    age: ref(18),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const _user = proxyRefs(user)</span><br><span class="line"></span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">    console.log(_user.name)</span><br><span class="line">    console.log(_user.age)</span><br><span class="line">    console.log(user.age)</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>上面代码定义了一个普通对象user，其中age属性的值是ref类型。当访问age值当时候，需要通过user.age.value，而使用了proxyRefs，则可以直接通过user.age来访问。</p><p>这也就是template中为什么不用加.value的原因，vue3源码中使用proxyRefs方法将setup返回的对象进行处理。</p>]]></content>
      
      
      <categories>
          
          <category> vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>工程化之.nvmrc 文件使用详解</title>
      <link href="/2024/09/02/%E5%B7%A5%E7%A8%8B%E5%8C%96%E4%B9%8B-nvmrc-%E6%96%87%E4%BB%B6%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3/"/>
      <url>/2024/09/02/%E5%B7%A5%E7%A8%8B%E5%8C%96%E4%B9%8B-nvmrc-%E6%96%87%E4%BB%B6%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<ol><li><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2></li></ol><p>  当开发多个项目时，每个项目运行环境要求的 node 版本不一样，那么我们就需要给每个项目指定 node 版本，也就是通过终端执行 nvm install 和 nvm use 命令去安装并切换版本。</p><p>​但是每次都要在终端手动执行命令就很麻烦，特别是项目越来越多的时候，容易忘记切换版本或切换错版本，会导致项目启动不了或运行中有一些错误。</p><p>​这就需要一个管理 node 版本的方法，自动切换 node 版本，这时 .nvmrc 就该上场了</p><ol start="2"><li><h2 id="nvmrc-是什么"><a href="#nvmrc-是什么" class="headerlink" title=".nvmrc 是什么"></a>.nvmrc 是什么</h2></li></ol><p>  .nvmrc 的作用：便于切换 node 版本，保证多人开发环境的一致性</p><p>​.nvmrc 是一个文件，文件内容非常简单，只有一个 nvm 可识别的 node 版本文本内容，比如: v12.18.2，这个文件应该放在项目根目录下，并且不应被 git 忽略</p><ol start="3"><li><h2 id="创建-nvmrc-文件"><a href="#创建-nvmrc-文件" class="headerlink" title="创建 .nvmrc 文件"></a>创建 .nvmrc 文件</h2></li></ol><p>  打开终端，进入项目根目录执行以下命令，使用 nvm 可识别的版本号格式即可：</p><p>​以下命令会将字符串填入指向的文件中并创建，当文件存在时，则会对文件进行重写</p><pre><code>echo &quot;12.18.2&quot; &gt; .nvmrcecho &quot;v12.18.2&quot; &gt; .nvmrcecho &quot;lts/fermium&quot; &gt; .nvmrc</code></pre><ol start="4"><li><h2 id="使用-nvmrc-文件"><a href="#使用-nvmrc-文件" class="headerlink" title="使用 .nvmrc 文件"></a>使用 .nvmrc 文件</h2></li></ol><p>  在有 .nvmrc 文件的目录执行以下命令，会读取并尝试切换 .nvmrc 中的 node 版本</p><p>​该命令会从当前目录向上遍历目录结构寻找 .nvmrc 文件，在带有 .nvmrc 的目录的任何子目录运行该命令都会起作用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvm use</span><br></pre></td></tr></table></figure><p>​如果 .nvmrc 中的 node 版本已安装，当前终端窗口的 node 将自动切换为该版本</p><img src="/2024/09/02/%E5%B7%A5%E7%A8%8B%E5%8C%96%E4%B9%8B-nvmrc-%E6%96%87%E4%BB%B6%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3/ea59afc78efd454704bb2c086bf1c206.png" class="" title="ea59afc78efd454704bb2c086bf1c206"><p>​如果 .nvmrc 中的 node 版本没有安装，将会出现以下提示</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">N/A: version &quot;v14.15.0&quot; is not yet installed.</span><br><span class="line">You need to run `nvm install` to install and use the node version specified in `.nvmrc`.</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">不适用：版本 v14.15.0 尚未安装</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">您需要运行 nvm install 来安装并使用 .nvmrc 中指定的 node 版本</span></span><br></pre></td></tr></table></figure><p>接下来使用以下命令，nvm install 不带参数时会从 .nvmrc 中读取 node 版本，如果该 node 版本没有安装，将自动进行下载，下载好后会将当前窗口的 node 切换为此版本。如果该版本已经安装，会跳过下载，只将当前窗口的 node 切换</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvm install</span><br></pre></td></tr></table></figure><img src="/2024/09/02/%E5%B7%A5%E7%A8%8B%E5%8C%96%E4%B9%8B-nvmrc-%E6%96%87%E4%BB%B6%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3/98c9dc94fd9be69fdb08fa08c43bfc68.png" class="" title="98c9dc94fd9be69fdb08fa08c43bfc68"><ol start="5"><li><h2 id="终端自动切换版本"><a href="#终端自动切换版本" class="headerlink" title="终端自动切换版本"></a>终端自动切换版本</h2></li></ol><p>  当使用 nvm use 切换版本仍然觉得麻烦，想要打开终端自动切换 node 版本，也可以实现</p><p>​zsh 终端根据 .nvmrc 文件自动切换 node 版本：</p><p>​在 $HOME&#x2F;.zshrc 中添加以下代码后，每次进入一个包含 .nvmrc 文件的目录时自动调用 nvm use</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># 温馨提示: 将其放在 nvm 初始化之后</span><br><span class="line"></span><br><span class="line"># nvm 根据 .nvmrc 自动切换 node 版本</span><br><span class="line"></span><br><span class="line">autoload -U add-zsh-hook</span><br><span class="line">load-nvmrc() &#123;</span><br><span class="line">local nvmrc_path=&quot;$(nvm_find_nvmrc)&quot;</span><br><span class="line">if [ -n &quot;$nvmrc_path&quot; ]; then</span><br><span class="line">local nvmrc_node_version=$(nvm version &quot;$(cat &quot;$&#123;nvmrc_path&#125;&quot;)&quot;)</span><br><span class="line">if [ &quot;$nvmrc_node_version&quot; = &quot;N/A&quot; ]; then</span><br><span class="line">nvm install</span><br><span class="line">elif [ &quot;$nvmrc_node_version&quot; != &quot;$(nvm version)&quot; ]; then</span><br><span class="line">nvm use</span><br><span class="line">fi</span><br><span class="line">elif [ -n &quot;$(PWD=$OLDPWD nvm_find_nvmrc)&quot; ] &amp;&amp; [ &quot;$(nvm version)&quot; != &quot;$(nvm version default)&quot; ]; then</span><br><span class="line">echo &quot;Reverting to nvm default version&quot;</span><br><span class="line">nvm use default</span><br><span class="line">fi</span><br><span class="line">&#125;</span><br><span class="line">add-zsh-hook chpwd load-nvmrc</span><br><span class="line">load-nvmrc</span><br></pre></td></tr></table></figure><p>​编辑好 .zshrc 文件后，执行以下命令使其立即生效</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source ~/.zshrc</span><br></pre></td></tr></table></figure><p>​效果如下所示，进入一个含有 .nvmrc 文件的目录会自动切换当前窗口的 node 版本，退出目录时自动切换为默认 node 版本</p><img src="/2024/09/02/%E5%B7%A5%E7%A8%8B%E5%8C%96%E4%B9%8B-nvmrc-%E6%96%87%E4%BB%B6%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3/2c411990a35fbb885bafe0b5c8c6019b.png" class="" title="2c411990a35fbb885bafe0b5c8c6019b">]]></content>
      
      
      <categories>
          
          <category> nvm nodeJs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nvm nodeJs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mac电脑安装nvm(node包版本管理工具)</title>
      <link href="/2024/08/20/Mac%E7%94%B5%E8%84%91%E5%AE%89%E8%A3%85nvm-node%E5%8C%85%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7/"/>
      <url>/2024/08/20/Mac%E7%94%B5%E8%84%91%E5%AE%89%E8%A3%85nvm-node%E5%8C%85%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7/</url>
      
        <content type="html"><![CDATA[<h2 id="方法一：通过Homebrew安装（推荐）"><a href="#方法一：通过Homebrew安装（推荐）" class="headerlink" title="方法一：通过Homebrew安装（推荐）"></a>方法一：通过Homebrew安装（推荐）</h2><ol><li><h3 id="安装-Homebrew：-如果您还没有安装Homebrew，首先需要安装它。打开终端（Terminal-app）并运行以下命令：（官网地址：https-brew-sh-zh-cn-）"><a href="#安装-Homebrew：-如果您还没有安装Homebrew，首先需要安装它。打开终端（Terminal-app）并运行以下命令：（官网地址：https-brew-sh-zh-cn-）" class="headerlink" title="安装 Homebrew： 如果您还没有安装Homebrew，首先需要安装它。打开终端（Terminal.app）并运行以下命令：（官网地址：https://brew.sh/zh-cn/）"></a>安装 Homebrew： 如果您还没有安装Homebrew，首先需要安装它。打开终端（Terminal.app）并运行以下命令：（官网地址：<a href="https://brew.sh/zh-cn/%EF%BC%89">https://brew.sh/zh-cn/）</a></h3></li></ol>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.官网提供的链接（没有vpn的话执行不成功）</span><br><span class="line">/bin/bash -c &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)&quot;</span><br><span class="line">2.国内下载地址</span><br><span class="line">/bin/zsh -c &quot;$(curl -fsSL https://gitee.com/cunkai/HomebrewCN/raw/master/Homebrew.sh)&quot;</span><br></pre></td></tr></table></figure><p>​按照步骤安装完成就可以了.</p><ol start="2"><li><h4 id="使用Homebrew安装-NVM：-安装完-Homebrew-后，接着使用以下命令来安装-NVM："><a href="#使用Homebrew安装-NVM：-安装完-Homebrew-后，接着使用以下命令来安装-NVM：" class="headerlink" title="使用Homebrew安装 NVM： 安装完 Homebrew 后，接着使用以下命令来安装 NVM："></a>使用Homebrew安装 NVM： 安装完 Homebrew 后，接着使用以下命令来安装 NVM：</h4></li></ol><p>  打开终端zsh，执行：</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install nvm  # 执行完成就代表nvm已经安装了，但是还需要配置环境变量</span><br></pre></td></tr></table></figure><ol start="3"><li><h4 id="配置环境变量："><a href="#配置环境变量：" class="headerlink" title="配置环境变量："></a>配置环境变量：</h4></li></ol><p>  Homebrew 在安装 NVM 时通常会自动处理环境变量的设置，但为了确保 NVM 可以在新的 shell 会话中正常使用，您可能需要手动添加 NVM 的初始化脚本到您的 shell 配置文件中。对于大多数现代 Mac 系统使用的 zsh，编辑或创建 ~&#x2F;.zshrc 文件。</p><h4 id="配置-NVM-的环境变量通常涉及以下步骤："><a href="#配置-NVM-的环境变量通常涉及以下步骤：" class="headerlink" title="配置 NVM 的环境变量通常涉及以下步骤："></a>配置 NVM 的环境变量通常涉及以下步骤：</h4><ol><li>先使用Homebrew检查nvm的安装位置：</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew list nvm</span><br></pre></td></tr></table></figure><p>我这里显示</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ys@bogon ~ % brew list nvm</span><br><span class="line"></span><br><span class="line">/opt/homebrew/Cellar/nvm/0.39.7/etc/bash_completion.d/nvm</span><br><span class="line"></span><br><span class="line">/opt/homebrew/Cellar/nvm/0.39.7/libexec/ (2 files)</span><br><span class="line"></span><br><span class="line">/opt/homebrew/Cellar/nvm/0.39.7/nvm-exec</span><br><span class="line"></span><br><span class="line">/opt/homebrew/Cellar/nvm/0.39.7/nvm.sh</span><br></pre></td></tr></table></figure><ol start="2"><li>打开或创建 shell 配置文件： 对于 macOS Mojave 及以后版本（使用 zsh 作为默认 shell）的用户，您需要编辑或创建 ~&#x2F;.zshrc 文件<br>如果文件不存在的话，则需要先创建（文件存在的话就可以忽略这一步）：</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch ~/.zshrc</span><br></pre></td></tr></table></figure><p>如果文件已经存在，则输入命令进行编辑：</p><p>打开或创建 shell 配置文件： 对于 macOS Mojave 及以后版本（使用 zsh 作为默认 shell）的用户，您需要编辑或创建 ~&#x2F;.zshrc 文件<br>如果文件不存在的话，则需要先创建（文件存在的话就可以忽略这一步）：<br>touch ~&#x2F;.zshrc</p><p>如果文件已经存在，则输入命令进行编辑：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano ~/.zshrc</span><br></pre></td></tr></table></figure><ol start="3"><li>添加如下内容到文件末尾以加载 NVM：</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export NVM_DIR=&quot;$HOME/.nvm&quot; </span><br><span class="line">[ -s &quot;/opt/homebrew/opt/nvm/nvm.sh&quot; ] &amp;&amp; \. &quot;/opt/homebrew/opt/nvm/nvm.sh&quot; </span><br><span class="line">[ -s &quot;/opt/homebrew/opt/nvm/etc/bash_completion.d/nvm&quot; ] &amp;&amp; \. &quot;/opt/homebrew/opt/nvm/etc/bash_completion.d/nvm&quot;</span><br></pre></td></tr></table></figure><p>注意：这里的路径可能需要根据您实际的 Homebrew 安装位置进行调整，确保指向正确的 nvm.sh 和 bash_completion.d&#x2F;nvm 文件。</p><ol start="4"><li>保存并关闭文件：<br>我这里使用的是 nano 编辑器，所以：</li></ol><ul><li>按 Ctrl+O 来保存（“O” 代表 “Write Out”)。</li><li>按回车键确认当前文件名和路径。</li><li>按 Ctrl+X 来退出（“X” 代表 “eXit”)。</li><li>重新加载 ~&#x2F;.zshrc 文件来应用更改：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source ~/.zshrc</span><br></pre></td></tr></table></figure><p>执行完这一句不报错，说明已经配置成功。</p><ol start="5"><li>检查 NVM 是否已经成功加载</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ys@bogon ~ % command -v nvm</span><br><span class="line"></span><br><span class="line">nvm</span><br><span class="line"></span><br><span class="line">ys@bogon ~ % nvm -v</span><br><span class="line"></span><br><span class="line">0.39.7</span><br></pre></td></tr></table></figure><p>证明已经安装成功且环境变量也已经配置成功了。</p><ol start="6"><li>nvm使用：<br> 此时还没有使用过nvm安装过node,所以打出 nvm list时,显示：</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ys@bogon ~ % nvm list</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash">system</span></span><br><span class="line"></span><br><span class="line">iojs -&gt; N/A (default)</span><br><span class="line"></span><br><span class="line">node -&gt; stable (-&gt; N/A) (default)</span><br><span class="line"></span><br><span class="line">unstable -&gt; N/A (default)</span><br></pre></td></tr></table></figure><p>使用 nvm install node 安装最新版本的node，安装完成后，显示：</p><p>说明已经成功使用 NVM 安装了 Node.js v21.7.1 版本。根据 nvm list 的输出结果：</p><p>现在默认版本 (-&gt; v21.7.1) 已经设置为最新安装的 Node.js v21.7.1。<br>您还可以看到其他可用的 LTS（长期支持）版本，但它们当前并未安装。<br>此外，系统级别的 Node.js 仍然存在，并且被标记为 system。</p><h2 id="方法二：手动从-GitHub-克隆安装"><a href="#方法二：手动从-GitHub-克隆安装" class="headerlink" title="方法二：手动从 GitHub 克隆安装"></a>方法二：手动从 GitHub 克隆安装</h2><ol><li>打开终端并克隆 NVM Git 仓库：</li></ol>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/nvm-sh/nvm.git ~/.nvm</span><br></pre></td></tr></table></figure><ol start="2"><li>进入 NVM 目录并运行安装脚本：</li></ol>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/.nvm</span><br><span class="line">./install.sh</span><br></pre></td></tr></table></figure><ol start="3"><li>接下来的步骤与通过 Homebrew 安装类似，即需要配置环境变量并在新的 shell 会话中激活 NVM。<br>无论哪种方法安装完成后，都可以使用 nvm 命令来安装、切换不同的 Node.js 版本。例如，要设置一个特定版本为默认版本：</li></ol>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvm alias default &lt;version&gt;</span><br></pre></td></tr></table></figure><p>其中 <version> 是您想要设为默认的 Node.js 版本号。</p><h3 id="使用nvm控制node版本的常用命令"><a href="#使用nvm控制node版本的常用命令" class="headerlink" title="使用nvm控制node版本的常用命令"></a>使用nvm控制node版本的常用命令</h3><ol><li>安装指定版本的 Node.js：</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvm install &lt;version&gt; # 安装特定版本，例如 nvm install v14.17.0</span><br></pre></td></tr></table></figure><ol start="2"><li>列出所有可安装的 Node.js 版本</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvm ls-remote # 列出远程服务器上的所有可用版本</span><br></pre></td></tr></table></figure><ol start="3"><li>列出已安装的 Node.js 版本：</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvm list # 显示已安装的 Node.js 版本和当前使用的版本</span><br></pre></td></tr></table></figure><p>4 .切换到已安装的某个版本：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvm use &lt;version&gt; # 切换到指定版本，例如 nvm use v12.22.11</span><br></pre></td></tr></table></figure><ol start="5"><li>设置默认版本：</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvm alias default &lt;version&gt; # 设置默认启动的 Node.js 版本</span><br></pre></td></tr></table></figure><ol start="6"><li>卸载指定版本的 Node.js：</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvm uninstall &lt;version&gt; # 卸载特定版本</span><br></pre></td></tr></table></figure><ol start="7"><li>查看当前正在使用的 Node.js 版本：</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvm current # 显示当前激活的 Node.js 版本</span><br></pre></td></tr></table></figure><ol start="8"><li>检查 Node.js 的版本信息：</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node -v # 在已通过nvm切换版本后，直接使用node命令查看当前版本</span><br></pre></td></tr></table></figure><ol start="9"><li>管理 LTS 版本：</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nvm install --lts # 安装最新长期支持版（LTS）</span><br><span class="line">nvm install lts/argon # 安装特定 LTS 系列（如argon为旧版LTS代号）</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> nvm nodeJs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nvm nodeJs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Monorepo与pnpm</title>
      <link href="/2024/08/11/Monorepo%E4%B8%8Epnpm/"/>
      <url>/2024/08/11/Monorepo%E4%B8%8Epnpm/</url>
      
        <content type="html"><![CDATA[<h2 id="一、什么是pnpm"><a href="#一、什么是pnpm" class="headerlink" title="一、什么是pnpm"></a>一、什么是<a href="https://zhida.zhihu.com/search?q=pnpm&zhida_source=entity&is_preview=1">pnpm</a></h2><p>pnpm又称 performant npm，翻译过来就是高性能的npm。</p><h2 id="1-节省磁盘空间提高安装效率"><a href="#1-节省磁盘空间提高安装效率" class="headerlink" title="1.节省磁盘空间提高安装效率"></a>1.节省磁盘空间提高安装效率</h2><p>pnpm通过使用<strong>硬链接</strong>和<strong>符号链接</strong>（又称<a href="https://zhida.zhihu.com/search?q=%E8%BD%AF%E9%93%BE%E6%8E%A5&zhida_source=entity&is_preview=1">软链接</a>）的方式来避免重复安装以及提高安装效率。 **<a href="https://zhida.zhihu.com/search?q=%E7%A1%AC%E9%93%BE%E6%8E%A5&zhida_source=entity&is_preview=1">硬链接</a>**：和原文件共用一个磁盘地址，相当于别名的作用，如果更改其中一个内容，另一个也会跟着改变 <strong>符号链接（软链接）</strong>：是一个新的文件，指向原文件路径地址，类似于快捷方式 官网原话：</p><blockquote><p>当使用 npm 时，如果你有 100 个项目，并且所有项目都有一个相同的<a href="https://zhida.zhihu.com/search?q=%E4%BE%9D%E8%B5%96%E5%8C%85&zhida_source=entity&is_preview=1">依赖包</a>，那么，你在硬盘上就需要保存 100 份该相同依赖包的副本。然而，如果是使用 pnpm，依赖包将被存放在一个统一的位置，因此： 1.如果你对同一依赖包需要使用不同的版本，则仅有 版本之间不同的文件会被存储起来。例如，如果某个依赖包包含 100 个文件，其发布了一个新 版本，并且新版本中只有一个文件有修改，则pnpm update 只需要添加一个新文件到存储中，而不会因为一个文件的修改而保存依赖包的所有文件。 2.所有文件都保存在硬盘上的统一的位置。当安装<a href="https://zhida.zhihu.com/search?q=%E8%BD%AF%E4%BB%B6%E5%8C%85&zhida_source=entity&is_preview=1">软件包</a>时，其包含的所有文件都会硬链接自此位置，而不会占用额外的硬盘空间。这让你可以在项目之间方便地共享相同版本的依赖包。 最终结果就是以项目和依赖包的比例来看，你节省了大量的硬盘空间，并且安装速度也大大提高了！</p></blockquote><h2 id="2-创建非扁平的node-modules目录结构"><a href="#2-创建非扁平的node-modules目录结构" class="headerlink" title="2.创建非扁平的node_modules目录结构"></a>2.创建非扁平的node_modules目录结构</h2><p><img src="https://pic2.zhimg.com/80/v2-62826b8e02448ccb75dac3fda8b545b3_720w.webp" alt="img"></p><h2 id="3-Monorepo-简介及其与包管理工具（npm、yarn、pnpm）之间的关系"><a href="#3-Monorepo-简介及其与包管理工具（npm、yarn、pnpm）之间的关系" class="headerlink" title="3.Monorepo 简介及其与包管理工具（npm、yarn、pnpm）之间的关系"></a>3.Monorepo 简介及其与包<a href="https://zhida.zhihu.com/search?q=%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7&zhida_source=entity&is_preview=1">管理工具</a>（npm、yarn、pnpm）之间的关系</h2><h2 id="Monorepo模式："><a href="#Monorepo模式：" class="headerlink" title="Monorepo模式："></a>Monorepo模式：</h2><p><strong>Monorepo</strong> 是一种项目开发与管理的<a href="https://zhida.zhihu.com/search?q=%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F&zhida_source=entity&is_preview=1">策略模式</a>，它代表”<a href="https://zhida.zhihu.com/search?q=%E5%8D%95%E4%B8%80%E4%BB%A3%E7%A0%81%E4%BB%93%E5%BA%93&zhida_source=entity&is_preview=1">单一代码仓库</a>“（Monolithic Repository）。在 <strong>Monorepo</strong> 模式中，所有相关的项目和组件都被存储在一个统一的代码仓库中，而不是分散在多个独立的代码仓库中，这些项目之间还可能会有依赖关系。</p><h2 id="包管理工具："><a href="#包管理工具：" class="headerlink" title="包管理工具："></a>包管理工具：</h2><p><strong>npm、yarn、pnpm</strong> 等是用来管理项目依赖、发布包、安装依赖的工具，它们都提供了对工作区（workspace）的支持，允许在单个代码库中管理多个项目或包。这种工作区支持在单个代码库中同时开发、测试和管理多个相关的项目，而无需使用多个独立的代码仓库。</p><h2 id="关系："><a href="#关系：" class="headerlink" title="关系："></a>关系：</h2><p>这些包管理工具与 monorepo 的关系在于它们可以为 monorepo 提供依赖安装与依赖管理的支持，借助自身对 workspace 的支持，允许在 monorepo 中的不同子项目之间共享依赖项，并提供一种管理这些<a href="https://zhida.zhihu.com/search?q=%E5%85%B1%E4%BA%AB%E4%BE%9D%E8%B5%96%E9%A1%B9&zhida_source=entity&is_preview=1">共享依赖项</a>的方式，这可以简化依赖项管理和构建过程，并提高开发效率。</p><h2 id="4-Monorepo-（单仓多模块）开发模式"><a href="#4-Monorepo-（单仓多模块）开发模式" class="headerlink" title="4.Monorepo （单仓多模块）开发模式"></a>4.Monorepo （单仓多模块）开发模式</h2><ul><li><a href="https://zhida.zhihu.com/search?q=%E5%9B%9E%E5%BD%92%E5%8D%95%E4%BD%93%E7%AE%A1%E7%90%86&zhida_source=entity&is_preview=1">回归单体管理</a>：Monorepo 是一种试图回归单体管理优势的方法，但保留了多仓库开发的某些优点。它允许在一个代码库中管理多个项目、组件或服务，提供更好的<a href="https://zhida.zhihu.com/search?q=%E4%BB%A3%E7%A0%81%E5%85%B1%E4%BA%AB&zhida_source=entity&is_preview=1">代码共享</a>和重用性。</li><li>现代工具支持：现代的版本控制系统和工具链使得 Monorepo 开发模式更为可行，例如像 Pnpm、Yarn 、Lerna 和 Turborepo 等工具，它们提供了更好的管理、构建和部署多个项目的能力。</li><li>优点： 保留 <a href="https://zhida.zhihu.com/search?q=multirepo&zhida_source=entity&is_preview=1">multirepo</a> 的主要优势 代码复用 模块独立管理 分工明确，业务场景独立 代码耦合度降低 管理所有项目的版本控制更加容易和一致，降低了不同项目之间的版本冲突。 可以统一项目的构建和部署流程，降低了配置和维护多个项目所需的工作量。</li><li>缺点： Monorepo 可能随着时间推移变得庞大和复杂，导致构建时间增长和管理困难，<a href="https://zhida.zhihu.com/search?q=git+clone&zhida_source=entity&is_preview=1">git clone</a>、pull 的成本增加。 权限管理问题：项目粒度的权限管理较为困难，容易产生非owner管理者的改动风险。</li></ul><h2 id="5-如何解决monorepo无法进行细粒度权限管理的缺点"><a href="#5-如何解决monorepo无法进行细粒度权限管理的缺点" class="headerlink" title="5.如何解决monorepo无法进行细粒度权限管理的缺点"></a>5.如何解决monorepo无法进行细粒度权限管理的缺点</h2><p><strong>1. 使用<a href="https://zhida.zhihu.com/search?q=%E4%BB%A3%E7%A0%81%E6%89%80%E6%9C%89%E6%9D%83%E6%96%87%E4%BB%B6&zhida_source=entity&is_preview=1">代码所有权文件</a></strong> 使用如 CODEOWNERS 文件（GitHub 等平台支持）来指定某个目录或文件的所有者。当这些文件或目录被修改时，只有指定的所有者才能批准更改。这种方法能够实现对项目或模块级别的权限粒度控制。<br><strong>2. 利用<a href="https://zhida.zhihu.com/search?q=CI/CD%E6%B5%81%E7%A8%8B&zhida_source=entity&is_preview=1">CI&#x2F;CD流程</a></strong> 在持续集成&#x2F;持续部署（CI&#x2F;CD）流程中设置权限和访问控制。例如，可以配置流程，只允许具有特定权限的用户触发构建或部署到生产环境。这种方式可以在流程层面上控制谁可以对代码库进行重要操作。<br><strong>3. 分支策略</strong> 通过严格的分支管理策略，如Git Flow，控制不同级别的开发人员可以访问和修改的分支。比如只允许项目负责人合并代码到主分支，而其他开发人员只能在特定的功能分支上工作。<br><strong>4. 使用Git钩子</strong> 配置Git钩子（Hooks），在代码提交或合并前执行脚本来检查提交者的权限。例如，可以设定pre-commit钩子，确保提交的代码符合访问权限要求。<br><strong>5. 利用子模块</strong> 虽然这种做法在传统Monorepo中较少使用，但通过Git子模块（submodules）可以实现对特定部分的仓库独立控制，从而在需要时提供更细粒度的权限管理。<br><strong>6. 第三方工具和扩展</strong> 考虑使用一些第三方工具和扩展来管理权限。例如，GitLab和Bitbucket等平台提供了更细粒度的权限控制设置，允许在项目或组织级别进行详细的访问控制。</p><h2 id="6-为什么组件库项目会选用-Monorepo-模式"><a href="#6-为什么组件库项目会选用-Monorepo-模式" class="headerlink" title="6.为什么组件库项目会选用 Monorepo 模式"></a>6.为什么<a href="https://zhida.zhihu.com/search?q=%E7%BB%84%E4%BB%B6%E5%BA%93&zhida_source=entity&is_preview=1">组件库</a>项目会选用 Monorepo 模式</h2><p>对于组件库项目，很自然的会涉及到划分以下模块</p><ul><li>components 包，作为组件库的主要代码，实现各个 UI 组件的核心逻辑。</li><li>shared 包，主要存放各种杂七杂八的工具方法。</li><li>theme 包，实现组件库的主题样式定制方案。</li><li><a href="https://zhida.zhihu.com/search?q=cli&zhida_source=entity&is_preview=1">cli</a> 包，实现组件库模板脚手架的命令行工具。</li><li>docs 包，组件库的示例 demo 与使用文档。</li><li>playground 包，组件库的在线编辑、演示应用。</li></ul><p><a href="https://zhida.zhihu.com/search?q=%E7%BB%86%E5%8C%96%E6%8B%86%E5%88%86&zhida_source=entity&is_preview=1">细化拆分</a>不同模块的好处非常明显，一句话总结就是：模块划分的越清晰，复用时的灵活性、可操作性就越强，每个独立模块产物的体积也会越轻量。</p>]]></content>
      
      
      <categories>
          
          <category> pnpm Monorepo 架构 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pnpm Monorepo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用sequelize-cli管理数据库</title>
      <link href="/2024/05/28/%E4%BD%BF%E7%94%A8sequelize-cli%E7%AE%A1%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
      <url>/2024/05/28/%E4%BD%BF%E7%94%A8sequelize-cli%E7%AE%A1%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93/</url>
      
        <content type="html"><![CDATA[<ol><li><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3></li></ol><p>  sequelize-cli 的依赖是 sequelize  sequelize的依赖是mysql2 需要自己手动安装</p>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm i sequelize-cli --save-dev</span><br><span class="line">npm i sequelize</span><br><span class="line">npm i mysql2</span><br></pre></td></tr></table></figure><p>  查看版本</p>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npx sequelize-cli --version</span><br><span class="line">npx sequelize --version</span><br></pre></td></tr></table></figure><p>  查看所有命令</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx sequelize --help</span><br></pre></td></tr></table></figure>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Sequelize</span> <span class="variable constant_">CLI</span> [<span class="title class_">Node</span>: <span class="number">10.21</span><span class="number">.0</span>, <span class="attr">CLI</span>: <span class="number">6.0</span><span class="number">.0</span>, <span class="attr">ORM</span>: <span class="number">6.1</span><span class="number">.0</span>]</span><br><span class="line"></span><br><span class="line">sequelize &lt;指令&gt;</span><br><span class="line"></span><br><span class="line">指令：</span><br><span class="line">  带db的都是操作数据库的指令</span><br><span class="line">  sequelize <span class="attr">db</span>:migrate                        运行待处理的迁移</span><br><span class="line">  sequelize <span class="attr">db</span>:<span class="attr">migrate</span>:<span class="attr">schema</span>:<span class="attr">timestamps</span>:add  更新迁移表以包含时间戳</span><br><span class="line">  sequelize <span class="attr">db</span>:<span class="attr">migrate</span>:status                 显示所有迁移的状态</span><br><span class="line">  sequelize <span class="attr">db</span>:<span class="attr">migrate</span>:undo                   撤销一个迁移</span><br><span class="line">  sequelize <span class="attr">db</span>:<span class="attr">migrate</span>:<span class="attr">undo</span>:all               撤销所有执行过的迁移</span><br><span class="line">  sequelize <span class="attr">db</span>:seed                           执行指定的种子器</span><br><span class="line">  sequelize <span class="attr">db</span>:<span class="attr">seed</span>:undo                      从数据库删除数据</span><br><span class="line">  sequelize <span class="attr">db</span>:<span class="attr">seed</span>:all                       运行所有种子器</span><br><span class="line">  sequelize <span class="attr">db</span>:<span class="attr">seed</span>:<span class="attr">undo</span>:all                  从数据库删除数据</span><br><span class="line">  sequelize <span class="attr">db</span>:create                         创建配置指定的数据库</span><br><span class="line">  sequelize <span class="attr">db</span>:drop                           删除配置指定的数据库</span><br><span class="line">  带init的都是初始化操作</span><br><span class="line">  sequelize init                              初始化项目</span><br><span class="line">  sequelize <span class="attr">init</span>:config                       初始化配置</span><br><span class="line">  sequelize <span class="attr">init</span>:migrations                   初始化迁移</span><br><span class="line">  sequelize <span class="attr">init</span>:models                       初始化模型</span><br><span class="line">  sequelize <span class="attr">init</span>:seeders                      初始化种子器</span><br><span class="line">  后面三种属于生成 创建模型·迁移文件·种子文件的</span><br><span class="line">  sequelize <span class="attr">migration</span>:generate                生成新的迁移文件            [别名：<span class="attr">migration</span>:create]</span><br><span class="line">  sequelize <span class="attr">model</span>:generate                    生成模型及其迁移             [别名：<span class="attr">model</span>:create]</span><br><span class="line">  sequelize <span class="attr">seed</span>:generate                     生成新的种子文件              [别名：<span class="attr">seed</span>:create]</span><br><span class="line"></span><br><span class="line">选项：</span><br><span class="line">  --version  显示版本号                                                       [布尔值]</span><br><span class="line">  --help     显示帮助信息                                                     [布尔值]</span><br><span class="line"></span><br><span class="line">请输入一个指令</span><br></pre></td></tr></table></figure><ol start="2"><li><h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sequelize init</span><br></pre></td></tr></table></figure><p>初始化sequelize项目，该命令将创建如下目录：             </p><ul><li>config：包含配置文件，它告诉CLI如何连接数据库             </li><li>models：包含您的项目的所有模型           </li><li>migrations：包含所有迁移文件 （数据表结构）           </li><li>seeders：包含所有种子文件 （具体数据）</li></ul><p>config目录下的config.json数据库配置文件</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;development&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;username&quot;</span>: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>: <span class="string">&quot;123456&quot;</span>,</span><br><span class="line">    <span class="string">&quot;database&quot;</span>: <span class="string">&quot;list&quot;</span>,</span><br><span class="line">    <span class="string">&quot;host&quot;</span>: <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;dialect&quot;</span>: <span class="string">&quot;mysql&quot;</span>,</span><br><span class="line">    <span class="string">&quot;operatorsAliases&quot;</span>: <span class="literal">false</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;test&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;username&quot;</span>: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="string">&quot;database&quot;</span>: <span class="string">&quot;database_test&quot;</span>,</span><br><span class="line">    <span class="string">&quot;host&quot;</span>: <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;dialect&quot;</span>: <span class="string">&quot;mysql&quot;</span>,</span><br><span class="line">    <span class="string">&quot;operatorsAliases&quot;</span>: <span class="literal">false</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;production&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;username&quot;</span>: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="string">&quot;database&quot;</span>: <span class="string">&quot;database_production&quot;</span>,</span><br><span class="line">    <span class="string">&quot;host&quot;</span>: <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;dialect&quot;</span>: <span class="string">&quot;mysql&quot;</span>,</span><br><span class="line">    <span class="string">&quot;operatorsAliases&quot;</span>: <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>配置在不同环境下数据库连接和密码 dialect 是你要操作的数据库类型，当前我使用的是mysql 也就是说sequelize支持什么数据库他就支持啥数据库, 默认当前环境为开发环境.</p><ol start="3"><li><h3 id="创建数据库和删除数据库"><a href="#创建数据库和删除数据库" class="headerlink" title="创建数据库和删除数据库"></a>创建数据库和删除数据库</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx sequelize db:create</span><br></pre></td></tr></table></figure><p>执行命令会根据config.json 中添加的数据名称创建数据库</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx sequelize db:drop list</span><br></pre></td></tr></table></figure><p>执行命令会删除数据库</p></li><li><h3 id="创建模型文件-model"><a href="#创建模型文件-model" class="headerlink" title="创建模型文件 model"></a>创建模型文件 model</h3><p> model:generate &#x2F; model:create        </p><p>创建一个模型文件        </p><p>– name：模型名称，必须        </p><p>– attributes：字段列表，必须    </p><p>新建一个表名为user 字段有username 和sex的表模型，运行以下命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx sequelize model:generate --name user --attributes username:string,sex:string</span><br></pre></td></tr></table></figure><p>- 在 models 文件夹中创建了一个 user 模型文件（供程序使用）        </p><p>- 在 migrations 文件夹中创建了一个名字像 xxxxxxxx-create-user.js 的迁移文件（供迁移使用）</p><p>models&#x2F;user.js文件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">sequelize, DataTypes</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> user = sequelize.<span class="title function_">define</span>(<span class="string">&#x27;user&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">username</span>: <span class="title class_">DataTypes</span>.<span class="property">STRING</span>,</span><br><span class="line">    <span class="attr">sex</span>: <span class="title class_">DataTypes</span>.<span class="property">STRING</span></span><br><span class="line">  &#125;, &#123;&#125;);</span><br><span class="line">  user.<span class="property">associate</span> = <span class="keyword">function</span>(<span class="params">models</span>) &#123;</span><br><span class="line">    <span class="comment">// associations can be defined here</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> user;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>migrations&#x2F; xxxxxxxx-create-user.js迁移文件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">up</span>: <span class="function">(<span class="params">queryInterface, Sequelize</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> queryInterface.<span class="title function_">createTable</span>(<span class="string">&#x27;users&#x27;</span>, &#123;</span><br><span class="line">      <span class="attr">id</span>: &#123;</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">autoIncrement</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">primaryKey</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">Sequelize</span>.<span class="property">INTEGER</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">username</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">Sequelize</span>.<span class="property">STRING</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">sex</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">Sequelize</span>.<span class="property">STRING</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">createdAt</span>: &#123;</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">Sequelize</span>.<span class="property">DATE</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">updatedAt</span>: &#123;</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">Sequelize</span>.<span class="property">DATE</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">down</span>: <span class="function">(<span class="params">queryInterface, Sequelize</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> queryInterface.<span class="title function_">dropTable</span>(<span class="string">&#x27;users&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>文件虽然建完了，但是数据库里却啥也没有，需要执行以下命令才能写入数据库，也就是我们核心要做的执行迁移。</p></li><li><h3 id="执行迁移"><a href="#执行迁移" class="headerlink" title="执行迁移"></a>执行迁移</h3><p>所谓迁移，就是对数据库进行结构的创建，升级（修改）等操作         </p><p>db:migrate      </p><ul><li>会在数据库中创建一个 SequelizeMeta 表，用于记录每次的迁移记录             </li><li>执行 migrations 文件下的满足条件（SequelizeMeta表）的脚本</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx sequelize db:migrate</span><br></pre></td></tr></table></figure><p>数据库会生成如下user表：</p><img src="/2024/05/28/%E4%BD%BF%E7%94%A8sequelize-cli%E7%AE%A1%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93/user_table.png" class="" title="user_table"></li></ol><p>而且还多了一个SequelizeMeta的表记录迁移记录</p><img src="/2024/05/28/%E4%BD%BF%E7%94%A8sequelize-cli%E7%AE%A1%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93/SequelizeMeta.png" class="" title="SequelizeMeta"><p>如果再次执行迁移文件是不会对数据库造成更改的。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx sequelize db:migrate:status  // 查看当前状态</span><br></pre></td></tr></table></figure><ol start="6"><li><h3 id="回退迁移操作"><a href="#回退迁移操作" class="headerlink" title="回退迁移操作"></a>回退迁移操作</h3></li></ol><p>撤销迁移         </p><ul><li><p>db:migrate:undo                  - 撤销上一次的迁移操作         </p></li><li><p>db:migrate:undo:all            - 撤销所有的迁移操作         </p></li><li><p>db:migrate:undo –name   - 具体迁移脚本</p></li></ul><p>测试一下：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx sequelize db:migrate:undo</span><br></pre></td></tr></table></figure><img src="/2024/05/28/%E4%BD%BF%E7%94%A8sequelize-cli%E7%AE%A1%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93/undo.png" class="" title="undo"><p>查看此时数据库的状态</p><img src="/2024/05/28/%E4%BD%BF%E7%94%A8sequelize-cli%E7%AE%A1%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93/db-status.png" class="" title="db-status"><p><em><strong>*重要：这就说明了，如果当前文件未被执行过，状态为down 执行过则为 up*</strong></em></p><p>当你执行迁移时执行的是迁移js文件中的，up函数。反之则是down函数 （这里可以仔细看一下migrations文件夹下的文件具体函数）</p><p>迁移文件和种子文件都是有工具初始化，自己编写</p><p>queryInterface文档：  <a href="https://sequelize.org/api/v6/class/src/dialects/abstract/query-interface.js~queryinterface">https://sequelize.org/api/v6/class/src/dialects/abstract/query-interface.js~queryinterface</a></p><p>包括增加字段，删除字段，还有种子文件要用到增加数据等</p><p>举例说明</p><p>先执行了刚才的迁移文件</p><p>这是当前users表里的结构</p><img src="/2024/05/28/%E4%BD%BF%E7%94%A8sequelize-cli%E7%AE%A1%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93/user_table.png" class="" title="user_table"><p>我们现在要添加一个字段 lastname</p><p>新建一个迁移文件 （会在migrations目录生成 xxxxxxxx-addLastname.js迁移文件）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx sequelize migration:create --name addLastname</span><br></pre></td></tr></table></figure><p>打开生成的这个js文件 改写：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">up</span>: <span class="function">(<span class="params">queryInterface, Sequelize</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">      Add altering commands here.</span></span><br><span class="line"><span class="comment">      Return a promise to correctly handle asynchronicity.</span></span><br><span class="line"><span class="comment">      Example:</span></span><br><span class="line"><span class="comment">      return queryInterface.createTable(&#x27;users&#x27;, &#123; id: Sequelize.INTEGER &#125;);</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="keyword">return</span> queryInterface.<span class="title function_">addColumn</span>(<span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;lastname&#x27;</span>, <span class="title class_">Sequelize</span>.<span class="property">STRING</span>);</span><br><span class="line">  &#125;,</span><br><span class="line"> </span><br><span class="line">  <span class="attr">down</span>: <span class="function">(<span class="params">queryInterface, Sequelize</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">      Add reverting commands here.</span></span><br><span class="line"><span class="comment">      Return a promise to correctly handle asynchronicity.</span></span><br><span class="line"><span class="comment">      Example:</span></span><br><span class="line"><span class="comment">      return queryInterface.dropTable(&#x27;users&#x27;);</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="keyword">return</span> queryInterface.<span class="title function_">removeColumn</span>(<span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;lastname&#x27;</span>, <span class="title class_">Sequelize</span>.<span class="property">STRING</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>执行迁移操作并查看数据库user表会发现新增了lastname字段。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx sequelize db:migrate</span><br></pre></td></tr></table></figure><img src="/2024/05/28/%E4%BD%BF%E7%94%A8sequelize-cli%E7%AE%A1%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93/add-name.png" class="" title="add-name"><ol start="7"><li><h3 id="种子文件"><a href="#种子文件" class="headerlink" title="种子文件"></a>种子文件</h3><p>种子文件         </p><p>迁移文件是用来构建数据库以及表结构的，种子文件是用来构建数据的         </p><p>seed:generate –name demo-user （自定义的名字）        </p><p>种子文件脚本与迁移脚本类似，由up于down函数组成，传入的参数也是一致的</p><p>先生成种子文件 name 后边接的是自定义的名字：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx sequelize seed:generate --name userseed</span><br></pre></td></tr></table></figure><p>打开seeders&#x2F;xxxx-userseed.js 并添加测试数据:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">up</span>: <span class="function">(<span class="params">queryInterface, Sequelize</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> queryInterface.<span class="title function_">bulkInsert</span>(<span class="string">&#x27;users&#x27;</span>, [&#123;</span><br><span class="line">      <span class="attr">username</span>: <span class="string">&#x27;John Doe&#x27;</span>,</span><br><span class="line">      <span class="attr">sex</span>: <span class="string">&#x27;man&#x27;</span>,</span><br><span class="line">      <span class="attr">lastname</span>: <span class="string">&#x27;hello&#x27;</span>,</span><br><span class="line">      <span class="attr">createdAt</span>: <span class="string">&#x27;2020-06-09 11:56:21&#x27;</span>,</span><br><span class="line">      <span class="attr">updatedAt</span>: <span class="string">&#x27;2020-06-09 11:56:21&#x27;</span></span><br><span class="line">    &#125;], &#123;&#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"> </span><br><span class="line">  <span class="attr">down</span>: <span class="function">(<span class="params">queryInterface, Sequelize</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> queryInterface.<span class="title function_">bulkDelete</span>(<span class="string">&#x27;users&#x27;</span>, <span class="literal">null</span>, &#123;&#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p> 执行种子文件：</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db:seed        运行指定种子文件         </span><br><span class="line">db:seed:all    运行所有种子文件</span><br><span class="line">npx sequelize db:seed:all</span><br></pre></td></tr></table></figure><p> <img src="/Users/tomcat/Desktop/TomCat/wuxingxi_blog_code/wuxingxi_blog/source/_posts/%E4%BD%BF%E7%94%A8sequelize-cli%E7%AE%A1%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93/seed-table.png" alt="seed-table"></p></li><li><h3 id="撤销种子执行"><a href="#撤销种子执行" class="headerlink" title="撤销种子执行"></a>撤销种子执行</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npx sequelize db:seed:undo --seed   撤销指定种子文件         </span><br><span class="line"></span><br><span class="line">npx sequelize db:seed:undo:all     撤销所有种子文件</span><br></pre></td></tr></table></figure></li><li><h3 id="种子存储记录"><a href="#种子存储记录" class="headerlink" title="种子存储记录"></a>种子存储记录</h3><p>存储记录         </p><p>默认情况下seed不记录过程，如果需要记录则需要单独设置，在配置文件config.json中增加 seederStorage             </p><p>存储引擎：none、json、mongodb、sequelize         </p><p>seederStoragePath             存储路径（json有效）         </p><p>seederStorageTableName             存储表名，mongodb和sequelize有效</p><p>比如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;development&quot;: &#123;</span><br><span class="line">    &quot;username&quot;: &quot;root&quot;,</span><br><span class="line">    &quot;password&quot;: &quot;123456&quot;,</span><br><span class="line">    &quot;database&quot;: &quot;list&quot;,</span><br><span class="line">    &quot;host&quot;: &quot;127.0.0.1&quot;,</span><br><span class="line">    &quot;dialect&quot;: &quot;mysql&quot;,</span><br><span class="line">    &quot;seederStorage&quot;: &quot;json&quot;,</span><br><span class="line">    &quot;seederStoragePath&quot;: &quot;./seeder.json&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;test&quot;: &#123;</span><br><span class="line">    &quot;username&quot;: &quot;root&quot;,</span><br><span class="line">    &quot;password&quot;: null,</span><br><span class="line">    &quot;database&quot;: &quot;database_test&quot;,</span><br><span class="line">    &quot;host&quot;: &quot;127.0.0.1&quot;,</span><br><span class="line">    &quot;dialect&quot;: &quot;mysql&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;production&quot;: &#123;</span><br><span class="line">    &quot;username&quot;: &quot;root&quot;,</span><br><span class="line">    &quot;password&quot;: null,</span><br><span class="line">    &quot;database&quot;: &quot;database_production&quot;,</span><br><span class="line">    &quot;host&quot;: &quot;127.0.0.1&quot;,</span><br><span class="line">    &quot;dialect&quot;: &quot;mysql&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><h3 id="文档查看"><a href="#文档查看" class="headerlink" title="文档查看"></a>文档查看</h3></li></ol>]]></content>
      
      
      <categories>
          
          <category> sequelize sequelize-cli </category>
          
      </categories>
      
      
        <tags>
            
            <tag> sequelize sequelize-cli </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 Docker 运行 MySQL</title>
      <link href="/2024/05/27/%E4%BD%BF%E7%94%A8-Docker-%E8%BF%90%E8%A1%8C-MySQL/"/>
      <url>/2024/05/27/%E4%BD%BF%E7%94%A8-Docker-%E8%BF%90%E8%A1%8C-MySQL/</url>
      
        <content type="html"><![CDATA[<h2 id="使用-Docker-Mysql"><a href="#使用-Docker-Mysql" class="headerlink" title="使用 Docker +Mysql"></a><em>使用 Docker</em> +Mysql</h2><p>使用<code>Docker</code>来运行<code>MySQL</code>。这样在 Windows 与 macOS 上，甚至在 Linux 服务器上，它们的运行环境都是一致的。</p><p>1.进入<code>Docker</code>官网后，<a href="https://www.docker.com/get-started/%EF%BC%8C%E7%9B%B4%E6%8E%A5%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85%E3%80%82">https://www.docker.com/get-started/，直接下载安装。</a></p><p>2.配置中国镜像</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;registry-mirrors&quot;: [</span><br><span class="line">  &quot;https://xelrug2w.mirror.aliyuncs.com&quot;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><img src="/2024/05/27/%E4%BD%BF%E7%94%A8-Docker-%E8%BF%90%E8%A1%8C-MySQL/demo.png" class="" title="demo"><p>3.<em>使用 docker compose</em></p><p>​接着进入项目根目录中，新建一个文件，叫做<code>docker-compose.yml</code>。千万要注意，一定要在项目根目录中，放在其他地方会找不到的。然后将下面的配置复制进去，这就是<code>MySQL</code>的一个简单配置了。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">services:</span><br><span class="line">  mysql:</span><br><span class="line">    image: mysql:8.3.0</span><br><span class="line">    command:</span><br><span class="line">      --default-authentication-plugin=mysql_native_password</span><br><span class="line">      --character-set-server=utf8mb4</span><br><span class="line">      --collation-server=utf8mb4_general_ci</span><br><span class="line">    environment:</span><br><span class="line">      - MYSQL_ROOT_PASSWORD=clwy1234</span><br><span class="line">      - MYSQL_LOWER_CASE_TABLE_NAMES=0</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;3306:3306&quot;</span><br><span class="line">    volumes:</span><br><span class="line">      - ./data/mysql:/var/lib/mysql</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>然后我们开启另一个命令行窗口，一定要确保命令行所在路径，是在当前项目里的。如果不在当前项目里，就自己先通过<code>cd</code>命令进入项目，然后再运行。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure><p>这样，<code>MySQL</code>就会自动下载好，并启动起来了。</p>]]></content>
      
      
      <categories>
          
          <category> dorker mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dorker mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在抖音小程序中实现类似 Pinia 的全局响应式数据状态管理</title>
      <link href="/2024/03/20/%E5%9C%A8%E6%8A%96%E9%9F%B3%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%B8%AD%E5%AE%9E%E7%8E%B0%E7%B1%BB%E4%BC%BC-Pinia-%E7%9A%84%E5%85%A8%E5%B1%80%E5%93%8D%E5%BA%94%E5%BC%8F%E6%95%B0%E6%8D%AE%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/"/>
      <url>/2024/03/20/%E5%9C%A8%E6%8A%96%E9%9F%B3%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%B8%AD%E5%AE%9E%E7%8E%B0%E7%B1%BB%E4%BC%BC-Pinia-%E7%9A%84%E5%85%A8%E5%B1%80%E5%93%8D%E5%BA%94%E5%BC%8F%E6%95%B0%E6%8D%AE%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h2 id="在微信小程序中实现类似-Pinia-的全局响应式数据状态管理"><a href="#在微信小程序中实现类似-Pinia-的全局响应式数据状态管理" class="headerlink" title="在微信小程序中实现类似 Pinia 的全局响应式数据状态管理"></a>在微信小程序中实现类似 Pinia 的全局响应式数据状态管理</h2><p>抖音小程序作为一种轻量级的应用程序开发框架，具有自身的特点和限制。其中，全局状态管理是开发者常常需要面对的问题之一。在这篇博客中，我们将介绍如何在抖音小程序中实现类似 Vue.js 生态系统中的 Pinia 的全局响应式数据状态管理。</p><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Pinia 是一个为 Vue.js 设计的全新状态管理库，通过利用 Vue 3 提供的响应式 API，提供了简洁而强大的全局状态管理解决方案。虽然抖音小程序并不直接支持 Vue.js，但我们可以借鉴 Pinia 的设计思想，在抖音小程序中实现类似的全局状态管理系统。</p><h2 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h2><h3 id="1-创建全局状态管理器"><a href="#1-创建全局状态管理器" class="headerlink" title="1. 创建全局状态管理器"></a>1. 创建全局状态管理器</h3><p>首先，我们创建一个 <code>store</code> 文件夹，新建<code> index.js</code>文件，  定义一个名为 <code>Store</code> 的类作为全局状态管理器。在该类中，我们可以定义状态、mutations、actions 等相关方法。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Store</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 从本地存储中获取之前保存的状态，如果没有则使用默认值</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123;&#125;;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">getters</span> = &#123;&#125;;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_mutations</span> = &#123;&#125;;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_actions</span> = &#123;&#125;;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_subscribers</span> = [];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 注册 mutation</span></span><br><span class="line">  <span class="title function_">registerMutation</span>(<span class="params">name, handler</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_mutations</span>[name] = handler;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 注册 action</span></span><br><span class="line">  <span class="title function_">registerAction</span>(<span class="params">name, handler</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_actions</span>[name] = handler.<span class="title function_">bind</span>(<span class="variable language_">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 提交 mutation</span></span><br><span class="line">  <span class="title function_">commit</span>(<span class="params">name, payload</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_mutations</span>[name]) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">_mutations</span>[name](<span class="variable language_">this</span>.<span class="property">state</span>, payload);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">_notifySubscribers</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 触发 action</span></span><br><span class="line">  <span class="title function_">dispatch</span>(<span class="params">name, payload</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_actions</span>[name]) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_actions</span>[name](payload);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 订阅状态变化</span></span><br><span class="line">  <span class="title function_">subscribe</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_subscribers</span>.<span class="title function_">push</span>(callback);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 通知所有订阅者状态变化</span></span><br><span class="line">  <span class="title function_">_notifySubscribers</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_subscribers</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">callback</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">callback</span>(<span class="variable language_">this</span>.<span class="property">state</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个全局唯一的状态管理器实例</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Store</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-注册状态、mutations-和-actions"><a href="#2-注册状态、mutations-和-actions" class="headerlink" title="2. 注册状态、mutations 和 actions"></a>2. 注册状态、mutations 和 actions</h3><p>在 <code>store</code> 文件夹中新建modules文件夹并且创建<code>app.js</code>，我们注册全局状态、mutations 和 actions，以便在整个小程序中使用。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;../index.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册状态</span></span><br><span class="line">store.<span class="property">state</span> = &#123;</span><br><span class="line">  <span class="attr">count</span>: <span class="number">0</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册 mutation</span></span><br><span class="line">store.<span class="title function_">registerMutation</span>(<span class="string">&#x27;increment&#x27;</span>, <span class="function">(<span class="params">state, payload</span>) =&gt;</span> &#123;</span><br><span class="line">  state.<span class="property">count</span> += payload;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册 action</span></span><br><span class="line">store.<span class="title function_">registerAction</span>(<span class="string">&#x27;incrementAsync&#x27;</span>, <span class="keyword">async</span> (payload) =&gt; &#123;</span><br><span class="line">  <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(resolve, <span class="number">1000</span>));</span><br><span class="line">  store.<span class="title function_">commit</span>(<span class="string">&#x27;increment&#x27;</span>, payload);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-页面中使用全局状态管理器"><a href="#3-页面中使用全局状态管理器" class="headerlink" title="3. 页面中使用全局状态管理器"></a>3. 页面中使用全局状态管理器</h3><p>在需要使用全局状态的页面中，我们可以导入全局状态管理器，并订阅状态变化，以实现页面的响应式更新。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">import store from &#x27;../store/moudles/app.js&#x27;;</span><br><span class="line"></span><br><span class="line">Page(&#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    count: 0,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  onLoad() &#123;</span><br><span class="line">    // 页面加载时订阅状态变化</span><br><span class="line">    store.subscribe(this.handleStateChange.bind(this));</span><br><span class="line">    // 初始化页面数据</span><br><span class="line">    this.setData(&#123;</span><br><span class="line">      count: store.state.count,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  // 处理状态变化的回调函数</span><br><span class="line">  handleStateChange(state) &#123;</span><br><span class="line">    this.setData(&#123;</span><br><span class="line">      count: state.count,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  // 响应用户点击事件，触发 mutation</span><br><span class="line">  handleClick() &#123;</span><br><span class="line">    store.commit(&#x27;increment&#x27;, 1);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  // 响应用户点击事件，触发 action</span><br><span class="line">  handleAsyncClick() &#123;</span><br><span class="line">    store.dispatch(&#x27;incrementAsync&#x27;, 1);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="结合本地存储"><a href="#结合本地存储" class="headerlink" title="结合本地存储"></a>结合本地存储</h2><p>为了在小程序关闭后能够保存状态，并在重新打开时恢复状态，我们可以结合抖音小程序的本地存储功能。在全局状态管理器中，每次状态变化后将状态保存到本地存储中，在小程序启动时从本地存储中恢复状态(修改文章第二步代码，如下：)。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import store from &#x27;../index.js&#x27;;</span><br><span class="line"></span><br><span class="line">// 注册状态</span><br><span class="line">store.state = &#123;</span><br><span class="line">  count: tt.getStorageSync(&#x27;count&#x27;),</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// 注册 mutation</span><br><span class="line">store.registerMutation(&#x27;increment&#x27;, (state, payload) =&gt; &#123;</span><br><span class="line">  state.count += payload;</span><br><span class="line">  tt.setStorageSync(&quot;count&quot;, state.count);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 注册 action</span><br><span class="line">store.registerAction(&#x27;incrementAsync&#x27;, async (payload) =&gt; &#123;</span><br><span class="line">  await new Promise(resolve =&gt; setTimeout(resolve, 1000));</span><br><span class="line">  store.commit(&#x27;increment&#x27;, payload);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">export default store;</span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>通过以上步骤，我们成功实现了一个简单而强大的全局响应式数据状态管理系统，在抖音小程序中实现了类似 Pinia 的功能。这样的状态管理系统不仅提供了方便的状态管理解决方案，还能够增强小程序的可维护性和可扩展性，为小程序开发带来更好的开发体验。</p><p>在实际项目中，你可以根据具体需求进一步扩展和优化这个状态管理系统，例如添加更多的状态、封装更多的 mutations 和 actions，以满足项目的需求。</p><p>希望本文能够对你理解抖音小程序中的全局状态管理以及类似 Pinia 的设计思想有所帮助，也欢迎大家在实际项目中尝试并探索更多的可能性。</p>]]></content>
      
      
      <categories>
          
          <category> 小程序 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 抖音 小程序 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vite性能优化之CDN加速</title>
      <link href="/2024/02/02/vite%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E4%B9%8BCDN%E5%8A%A0%E9%80%9F/"/>
      <url>/2024/02/02/vite%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E4%B9%8BCDN%E5%8A%A0%E9%80%9F/</url>
      
        <content type="html"><![CDATA[<h3 id="CDN-加速"><a href="#CDN-加速" class="headerlink" title="CDN 加速"></a>CDN 加速</h3><p>内容分发网络（Content Delivery Network，简称 CDN）就是让用户从最近的服务器请求资源，提升网络请求的响应速度。同时减少应用打包出来的包体积，利用浏览器缓存，不会变动的文件长期缓存。(不建议使用第三方cdn，这里做学习讨论使用)</p><h3 id="采用CDN引入的弊端："><a href="#采用CDN引入的弊端：" class="headerlink" title="采用CDN引入的弊端："></a>采用CDN引入的弊端：</h3><p>1、可靠性：使用CDN引入外部模块意味着依赖于第三方服务商的可用性和稳定性。如果CDN服务商发生故障或者网络问题，可能会导致外部模块无法加载，影响网站的正常运行</p><p>2、安全性：使用CDN引入外部模块需要信任第三方服务商，因为模块实际上是从服务商的服务器上加载的。如果服务商被黑客攻击或者恶意篡改了模块的内容，可能会导致安全问题</p><p>3、性能：CDN服务通常会根据用户的地理位置选择最近的节点进行内容分发，这样可以减少网络延迟和提高访问速度。但是如果用户所在地区的CDN节点发生故障或者网络拥堵，可能会导致加载速度变慢甚至加载失败</p><p>4、版本控制：使用CDN引入外部模块可能会导致版本控制的问题。如果模块的版本发生变化，CDN服务商可能会立即更新节点上的内容，这样可能会导致网站出现兼容性问题或者功能异常</p><h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><h4 id="安装插件"><a href="#安装插件" class="headerlink" title="安装插件"></a>安装插件</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">install rollup-plugin-external-globals -D</span><br></pre></td></tr></table></figure><h4 id="vite-config-ts里面配置"><a href="#vite-config-ts里面配置" class="headerlink" title="vite.config.ts里面配置"></a>vite.config.ts里面配置</h4><ol><li>允许设置延迟加载</li><li>rollupOptions需要设置external</li><li>具体的CDN链接根据自己需要去官网或是CDN网站查询，<strong>cdn网站：<a href="https://cdnjs.com/">cdnjs.com&#x2F;</a></strong></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">import externalGlobals from &#x27;rollup-plugin-external-globals&#x27;</span><br><span class="line"></span><br><span class="line">const externalGlobalsObj = &#123;</span><br><span class="line">&#x27;vue&#x27;: &#x27;Vue&#x27;,</span><br><span class="line">&#x27;vue-demi&#x27;: &#x27;VueDemi&#x27;,</span><br><span class="line">&#x27;vue-router&#x27;: &#x27;VueRouter&#x27;,</span><br><span class="line">&#x27;pinia&#x27;: &#x27;Pinia&#x27;,</span><br><span class="line">&#x27;vant&#x27;: &#x27;vant&#x27;,</span><br><span class="line">&#x27;axios&#x27;: &#x27;axios&#x27;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default defineConfig(&#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    vue(),</span><br><span class="line">    &#123;</span><br><span class="line">      ...externalGlobals(externalGlobalsObj),</span><br><span class="line">      enforce: &#x27;post&#x27;,</span><br><span class="line">      apply: &#x27;build&#x27;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">  build: &#123;</span><br><span class="line">    outDir: &#x27;dist&#x27;, // 指定输出路径</span><br><span class="line">    rollupOptions: &#123;</span><br><span class="line">      external: Object.keys(externalGlobalsObj),</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="手动在打包后的index添加CDN"><a href="#手动在打包后的index添加CDN" class="headerlink" title="手动在打包后的index添加CDN"></a>手动在打包后的index添加CDN</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">type</span>=<span class="string">&quot;image/svg+xml&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/vite.svg&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Vite + Vue + TS<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vant@4.8.3/lib/index.min.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;preload&quot;</span> <span class="attr">as</span>=<span class="string">&quot;style&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@3.4.15/dist/vue.global.prod.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vant@4.8.3/lib/vant.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue-router@4.2.5/dist/vue-router.global.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue-demi@0.14.6/lib/index.iife.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/pinia@2.1.7/dist/pinia.iife.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/axios@0.21.1/dist/axios.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span> <span class="attr">crossorigin</span> <span class="attr">src</span>=<span class="string">&quot;/assets/index-c24c670c.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/assets/index-f757e912.css&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="不想手动添加的同学可以配置自动添加"><a href="#不想手动添加的同学可以配置自动添加" class="headerlink" title="不想手动添加的同学可以配置自动添加"></a>不想手动添加的同学可以配置自动添加</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> externalGlobals <span class="keyword">from</span> <span class="string">&#x27;rollup-plugin-external-globals&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> cdn = &#123;</span><br><span class="line">    <span class="attr">css</span>: [<span class="string">&quot;https://cdn.jsdelivr.net/npm/vant@4.8.3/lib/index.min.css&quot;</span>],</span><br><span class="line">    <span class="attr">js</span>: [</span><br><span class="line">        <span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@3.4.15/dist/vue.global.prod.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;https://cdn.jsdelivr.net/npm/vant@4.8.3/lib/vant.min.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;https://cdn.jsdelivr.net/npm/vue-router@4.2.5/dist/vue-router.global.min.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;https://cdn.jsdelivr.net/npm/vue-demi@0.14.6/lib/index.iife.min.js&quot;</span>,</span><br><span class="line">        <span class="string">&#x27;https://cdn.jsdelivr.net/npm/pinia@2.1.7/dist/pinia.iife.min.js&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;https://cdn.jsdelivr.net/npm/axios@0.21.1/dist/axios.min.js&quot;</span>,</span><br><span class="line">    ],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> externalGlobalsObj = &#123;</span><br><span class="line"><span class="string">&#x27;vue&#x27;</span>: <span class="string">&#x27;Vue&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;vue-demi&#x27;</span>: <span class="string">&#x27;VueDemi&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;vue-router&#x27;</span>: <span class="string">&#x27;VueRouter&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;pinia&#x27;</span>: <span class="string">&#x27;Pinia&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;vant&#x27;</span>: <span class="string">&#x27;vant&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;axios&#x27;</span>: <span class="string">&#x27;axios&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// https://vitejs.dev/config/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(<span class="function">(<span class="params">&#123; mode &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> isProduction = mode === <span class="string">&#x27;production&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">      <span class="title function_">vue</span>(),</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&#x27;custom-html-transform&#x27;</span>,</span><br><span class="line">          <span class="title function_">transformIndexHtml</span>(<span class="params">html</span>) &#123;</span><br><span class="line">              <span class="comment">// 获取配置中的 CDN 资源</span></span><br><span class="line">              <span class="keyword">const</span> cdnCss = cdn &amp;&amp; cdn.<span class="property">css</span> || [];</span><br><span class="line">              <span class="keyword">const</span> cdnJs = cdn &amp;&amp; cdn.<span class="property">js</span> || [];</span><br><span class="line"></span><br><span class="line">              <span class="comment">// 生成 CSS 预加载和链接标签</span></span><br><span class="line">              <span class="keyword">const</span> cssTags = cdnCss.<span class="title function_">map</span>(<span class="function"><span class="params">url</span> =&gt;</span> <span class="string">`&lt;link href=&quot;<span class="subst">$&#123;url&#125;</span>&quot; rel=&quot;preload&quot; as=&quot;style&quot; /&gt;</span></span><br><span class="line"><span class="string">                                                &lt;link href=&quot;<span class="subst">$&#123;url&#125;</span>&quot; rel=&quot;stylesheet&quot; /&gt;`</span>).<span class="title function_">join</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line"></span><br><span class="line">              <span class="comment">// 生成 JS 脚本标签</span></span><br><span class="line">              <span class="keyword">const</span> jsTags = cdnJs.<span class="title function_">map</span>(<span class="function"><span class="params">url</span> =&gt;</span> <span class="string">`&lt;script src=&quot;<span class="subst">$&#123;url&#125;</span>&quot; defer&gt;&lt;/script&gt;`</span>).<span class="title function_">join</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line"></span><br><span class="line">              <span class="comment">// 替换原始 HTML 中的占位符</span></span><br><span class="line">              html = html.<span class="title function_">replace</span>(<span class="string">&#x27;&lt;!--CDN_CSS--&gt;&#x27;</span>, cssTags);</span><br><span class="line">              html = html.<span class="title function_">replace</span>(<span class="string">&#x27;&lt;!--CDN_JS--&gt;&#x27;</span>, jsTags);</span><br><span class="line"></span><br><span class="line">              <span class="keyword">return</span> html;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        ...<span class="title function_">externalGlobals</span>(externalGlobalsObj),</span><br><span class="line">        <span class="attr">enforce</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">        <span class="attr">apply</span>: <span class="string">&#x27;build&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">build</span>: &#123;</span><br><span class="line">      <span class="attr">outDir</span>: <span class="string">&#x27;dist&#x27;</span>, <span class="comment">// 指定输出路径</span></span><br><span class="line">      <span class="comment">// minify: &#x27;terser&#x27;, // 混淆器，terser 构建后文件体积更小，&#x27;terser&#x27; | &#x27;esbuild&#x27; ,默认为esbuild</span></span><br><span class="line">      <span class="attr">rollupOptions</span>: &#123;</span><br><span class="line">        <span class="attr">external</span>: <span class="title class_">Object</span>.<span class="title function_">keys</span>(externalGlobalsObj),</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="修改你的-index-html-文件，添加占位符："><a href="#修改你的-index-html-文件，添加占位符：" class="headerlink" title="修改你的 index.html 文件，添加占位符："></a>修改你的 index.html 文件，添加占位符：</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--CDN_CSS--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--CDN_JS--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>需要注意使用CDN未必会加快速度，只能减小打包体积，因为对应js和css需要从远程地址读取，如果CDN的资源出现错误，那么所引入的项目也会出现错误，建议把资源都Down到本地，然后在引入本地的链接，保证不会被所引入资源报错影响<br>开发环境不走CDN，只有构建后走！！！</p>]]></content>
      
      
      <categories>
          
          <category> vite vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vite vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue-cli4之手撸webpack骨架屏插件</title>
      <link href="/2024/01/19/vue-cli4%E4%B9%8B%E6%89%8B%E6%92%B8webpack%E9%AA%A8%E6%9E%B6%E5%B1%8F%E6%8F%92%E4%BB%B6/"/>
      <url>/2024/01/19/vue-cli4%E4%B9%8B%E6%89%8B%E6%92%B8webpack%E9%AA%A8%E6%9E%B6%E5%B1%8F%E6%8F%92%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<h3 id="一、实现webpack骨架屏"><a href="#一、实现webpack骨架屏" class="headerlink" title="一、实现webpack骨架屏"></a>一、实现webpack骨架屏</h3><p>​书接上文，由于在vue-cli4里面直接使用 vue-skeleton-webpack-plugin插件失败 （插件基于vue2开发），而项目是vue3开发，这就导致了不兼容，于是乎就开始了手撸…</p><h3 id="二、骨架屏的由来："><a href="#二、骨架屏的由来：" class="headerlink" title="二、骨架屏的由来："></a>二、骨架屏的由来：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">单页面应用在现在的前端页面开发是越来越常见了。</span><br><span class="line">它的好处很多，坏处也很明显：就是首屏加载往往很慢，呈现一片空白的页面，这给用户的体验感是很差的。</span><br><span class="line">可资源的加载我们除了尽量地优化，也没有其他很好的办法了。为了解决这个体验感的问题，骨架屏应运而生。</span><br></pre></td></tr></table></figure><h3 id="三、骨架屏原理："><a href="#三、骨架屏原理：" class="headerlink" title="三、骨架屏原理："></a>三、骨架屏原理：</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>单页面应用其实就是一个html文件，html结构里面有一个div#app，当js加载完毕并且执行完成后，id为app的div会被整个替换掉。所以由此我们可以想到，我们在div#app里面写一些动画之类的html结构，在js没有加载完成的时候，让用户看到的不是一片空白，而是预先写好的骨架页面。这样的体验感是不是会好一点呢。</p><h3 id="四、webpack插件的编写："><a href="#四、webpack插件的编写：" class="headerlink" title="四、webpack插件的编写："></a>四、webpack插件的编写：</h3><h4 id="（1）webpack插件介绍"><a href="#（1）webpack插件介绍" class="headerlink" title="（1）webpack插件介绍"></a>（1）webpack插件介绍</h4><p>首先得构建一个简单的webpack项目（这个过程不详细说了）。在根目录下新建一个skeleton.js文件。由于我们需要在每次打包的时候都重新生成新的骨架屏的index.html文件，所以这里需要用到html-webpack-plugin插件。我们在skeleton.js插件注入html-webpack-plugin插件的监听器，在html-webpack-plugin插件生成index.html之前做骨架屏代码的插入。</p><h4 id="（2）但插件的具体实现"><a href="#（2）但插件的具体实现" class="headerlink" title="（2）但插件的具体实现"></a>（2）但插件的具体实现</h4><p>首先在index.html同级目录下新建文件skeleton.html，用于编写骨架屏的dom结构 (具体样式可自行修改调整)。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span> <span class="attr">class</span>=<span class="string">&quot;loader&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;loading-text&quot;</span>&gt;</span>loading...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;loading&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.loader</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">100vw</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">height</span>: <span class="number">100vh</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">overflow</span>: hidden;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">flex-direction</span>: column;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.loading-text</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">color</span>: <span class="number">#002</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">font-size</span>: <span class="number">22px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">animation</span>: bit <span class="number">0.6s</span> alternate infinite;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.loading</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">70%</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">height</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">margin-top</span>: <span class="number">30px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background</span>: lightgrey;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">position</span>: relative;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.loading</span><span class="selector-pseudo">::after</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">content</span>: <span class="string">&quot;&quot;</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">top</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">left</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">height</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background</span>: <span class="number">#002</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">z-index</span>: <span class="number">1</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">animation</span>: loading <span class="number">0.6s</span> alternate infinite;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="keyword">@keyframes</span> bit &#123;</span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">from</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">opacity</span>: <span class="number">0.3</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">to</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">opacity</span>: <span class="number">1</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="keyword">@keyframes</span> loading &#123;</span></span><br><span class="line"><span class="language-css">        <span class="number">0%</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">left</span>: <span class="number">25%</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="number">100%</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">left</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="number">0%</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">left</span>: <span class="number">0%</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>由此可以知道，我们的骨架屏插件要有一个apply的方法，在安装插件时，会被webpack compiler 调用一次。 该apply方法传入compiler参数，该参数暴露了webpack生命周期钩子函数供开发者使用，我们可以使用它来访问 webpack 的主环境。使用方法为：compiler.hooks.钩子函数名称.tap(…)。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SkeletonPlugin</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">options</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">template</span> = options.<span class="property">template</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">apply</span>(<span class="params">compiler</span>) &#123;</span><br><span class="line">    <span class="comment">//我们这里监听compilation钩子函数，目的是编译创建之后，执行我们的SkeletonPlugin插件的主要代码</span></span><br><span class="line">    compiler.<span class="property">hooks</span>.<span class="property">compilation</span>.<span class="title function_">tap</span>(<span class="string">&quot;SkeletonPlugin&quot;</span>, <span class="function">(<span class="params">compilation</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//在html-webpack-plugin插件生成资源到output目录之前，我们完成对骨架屏代码的插入</span></span><br><span class="line">      <span class="title class_">HtmlWebpackPlugin</span>.<span class="title function_">getHooks</span>(compilation).<span class="property">beforeEmit</span>.<span class="title function_">tapAsync</span>(</span><br><span class="line">        <span class="string">&quot;SkeletonPlugin&quot;</span>,</span><br><span class="line">        <span class="function">(<span class="params">htmlData, callback</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> that = <span class="variable language_">this</span>;</span><br><span class="line">          fs.<span class="title function_">readFile</span>(<span class="variable language_">this</span>.<span class="property">template</span>, <span class="string">&quot;utf-8&quot;</span>, <span class="keyword">function</span> (<span class="params">error, data</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (error) &#123;</span><br><span class="line">              <span class="title function_">callback</span>(<span class="literal">null</span>, htmlData);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              htmlData.<span class="property">html</span> = htmlData.<span class="property">html</span>.<span class="title function_">replace</span>(</span><br><span class="line">                <span class="string">&#x27;&lt;div id=&quot;app&quot;&gt;&lt;/div&gt;&#x27;</span>,</span><br><span class="line">                data</span><br><span class="line">              );</span><br><span class="line">              <span class="title function_">callback</span>(<span class="literal">null</span>, htmlData);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      );</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//导出SkeletonPlugin插件</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">SkeletonPlugin</span>;</span><br></pre></td></tr></table></figure><h4 id="（3）插件的使用"><a href="#（3）插件的使用" class="headerlink" title="（3）插件的使用"></a>（3）插件的使用</h4><p>最后在vue-cli的配置文件vue.config.js里写上以下代码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">// 加载path模块</span><br><span class="line">const path = require(&quot;path&quot;);</span><br><span class="line"></span><br><span class="line">// 定义resolve方法，把相对路径转换成绝对路径</span><br><span class="line">const resolve = (dir) =&gt; path.join(__dirname, dir);</span><br><span class="line"></span><br><span class="line">const HtmlWebpackPlugin = require(&quot;html-webpack-plugin&quot;);</span><br><span class="line"></span><br><span class="line">const SkeletonPlugin = require(&quot;./src/plugins/skeleton&quot;);</span><br><span class="line"></span><br><span class="line">configureWebpack: (config) =&gt; &#123;</span><br><span class="line">  const plugins = [];</span><br><span class="line"></span><br><span class="line">  plugins.push(</span><br><span class="line">    new HtmlWebpackPlugin(&#123;</span><br><span class="line">      template: resolve(&quot;public/index.html&quot;),</span><br><span class="line">      inject: &quot;body&quot;,</span><br><span class="line">      cdn: isOpenCDN ? CDN : &#123;&#125;, // 指定cdn链接加载 （备注：这里会碰到一个问题，如果使用了CDN链接动态加载第三方包，需要在这里指定加载）</span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  // 骨架屏</span><br><span class="line">  plugins.push(</span><br><span class="line">    new SkeletonPlugin(&#123;</span><br><span class="line">      template: resolve(&quot;public/skeleton.html&quot;), // 骨架路径</span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  config.plugins = [...config.plugins, ...plugins];</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>打包完成后 运行，将浏览器的节流模式打开，高速3G模式就可以很直观的看到效果，如下：</p><p><img src="https://s2.loli.net/2024/01/19/VfG7PsjT32iLdaQ.png" alt="image.png"></p><h3 id="四、结束语："><a href="#四、结束语：" class="headerlink" title="四、结束语："></a>四、结束语：</h3><p>到这里简单的骨架屏插件就完成了。但这个插件只会在首次加载页面的时候有骨架屏效果。对于其他页面是没有效果的。</p>]]></content>
      
      
      <categories>
          
          <category> vue vue-cli4 webpack skeleton </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue vue-cli4 webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>温故，重新记录一次vue-cli4打包优化</title>
      <link href="/2024/01/17/%E6%B8%A9%E6%95%85%EF%BC%8C%E9%87%8D%E6%96%B0%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1vue-cli4%E6%89%93%E5%8C%85%E4%BC%98%E5%8C%96/"/>
      <url>/2024/01/17/%E6%B8%A9%E6%95%85%EF%BC%8C%E9%87%8D%E6%96%B0%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1vue-cli4%E6%89%93%E5%8C%85%E4%BC%98%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h4 id="vue-cli4打包优化"><a href="#vue-cli4打包优化" class="headerlink" title="vue-cli4打包优化"></a>vue-cli4打包优化</h4><h5 id="一、-配置-proxy-跨域"><a href="#一、-配置-proxy-跨域" class="headerlink" title="一、 配置 proxy 跨域"></a>一、 配置 proxy 跨域</h5><p>使用vue-cli发开项目，在本地开发环境中，如果遇到跨域的问题。可以通过配置proxy的方式，解决跨域问题：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">   <span class="attr">open</span>: <span class="literal">false</span>, <span class="comment">// 自动启动浏览器</span></span><br><span class="line">   <span class="attr">host</span>: <span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="comment">// localhost</span></span><br><span class="line">   <span class="attr">port</span>: <span class="number">6060</span>, <span class="comment">// 端口号</span></span><br><span class="line">   <span class="attr">hotOnly</span>: <span class="literal">false</span>, <span class="comment">// 热更新</span></span><br><span class="line"></span><br><span class="line">   <span class="attr">overlay</span>: &#123;</span><br><span class="line">      <span class="comment">//  当出现编译器错误或警告时，在浏览器中显示全屏覆盖层</span></span><br><span class="line">      <span class="attr">warnings</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">errors</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">proxy</span>: &#123;</span><br><span class="line">      <span class="comment">//配置跨域</span></span><br><span class="line">      <span class="string">&#x27;/api&#x27;</span>: &#123;</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&#x27;https://www.test.com&#x27;</span>, <span class="comment">// 接口的域名</span></span><br><span class="line">        <span class="comment">// ws: true, // 是否启用websockets</span></span><br><span class="line">        <span class="attr">changOrigin</span>: <span class="literal">true</span>, <span class="comment">// 开启代理，在本地创建一个虚拟服务端</span></span><br><span class="line">        <span class="attr">pathRewrite</span>: &#123;</span><br><span class="line">          <span class="string">&#x27;^/api&#x27;</span>: <span class="string">&#x27;/&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>配置完成后，当我们在去请求<a href="https://www.test.com/v1/api/userinfo%E6%8E%A5%E5%8F%A3%E6%97%B6%EF%BC%8C%E5%B0%B1%E5%8F%AF%E4%BB%A5%E8%BF%99%E4%B9%88%E5%86%99">https://www.test.com/v1/api/userinfo接口时，就可以这么写</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="title function_">axios</span>(&#123;</span><br><span class="line"><span class="attr">url</span>:<span class="string">&#x27;/api/v1/api/userinfo&#x27;</span>,</span><br><span class="line"><span class="attr">method</span>:<span class="string">&#x27;get&#x27;</span></span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line"><span class="comment">//......</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h5 id="二、配置-alias-别名"><a href="#二、配置-alias-别名" class="headerlink" title="二、配置 alias 别名"></a>二、配置 alias 别名</h5><p>使用vue-cli开发项目，最大特色是组件化。组件中频繁引用其他组件或插件。我们可以把一些常用的路径定义成简短的名字。方便开发中使用。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//加载path模块</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="comment">//定义resolve方法，把相对路径转换成绝对路径</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">resolve</span> = dir =&gt; path.<span class="title function_">join</span>(__dirname, dir)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">chainWebpack</span>: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 添加别名</span></span><br><span class="line">    config.<span class="property">resolve</span>.<span class="property">alias</span></span><br><span class="line">      .<span class="title function_">set</span>(<span class="string">&#x27;@&#x27;</span>, <span class="title function_">resolve</span>(<span class="string">&#x27;src&#x27;</span>))</span><br><span class="line">      .<span class="title function_">set</span>(<span class="string">&#x27;assets&#x27;</span>, <span class="title function_">resolve</span>(<span class="string">&#x27;src/assets&#x27;</span>))</span><br><span class="line">      .<span class="title function_">set</span>(<span class="string">&#x27;api&#x27;</span>, <span class="title function_">resolve</span>(<span class="string">&#x27;src/api&#x27;</span>))</span><br><span class="line">      .<span class="title function_">set</span>(<span class="string">&#x27;views&#x27;</span>, <span class="title function_">resolve</span>(<span class="string">&#x27;src/views&#x27;</span>))</span><br><span class="line">      .<span class="title function_">set</span>(<span class="string">&#x27;components&#x27;</span>, <span class="title function_">resolve</span>(<span class="string">&#x27;src/components&#x27;</span>))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>配置完成后，我们在项目中可以这样写路径</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//之前这么写</span><br><span class="line">import Home from &#x27;../views/Home.vue&#x27;</span><br><span class="line">//配置alias别名后</span><br><span class="line">import Home from &#x27;views/Home.vue&#x27;</span><br><span class="line">//也可以这么写</span><br><span class="line">import Home from &#x27;@/views/Home.vue&#x27;</span><br></pre></td></tr></table></figure><p>项目结束后打包前webpack配置<br>目的：</p><p>提高打包速度<br>减小项目体积、提高首屏加载速度<br>提高用户体验（骨架屏）<br>打包前必做<br>项目开发完成后，运行npm run build进行打包操作。打包前对webpack配置。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">publicPath</span>: <span class="string">&#x27;./&#x27;</span>, <span class="comment">// 静态资源路径（默认/，打包后会白屏）</span></span><br><span class="line">  <span class="attr">outputDir</span>: <span class="string">&#x27;dist&#x27;</span>, <span class="comment">// 打包后文件的目录 （默认为dist）</span></span><br><span class="line">  <span class="attr">assetsDir</span>: <span class="string">&#x27;static&#x27;</span>, <span class="comment">//  outputDir的静态资源(js、css、img、fonts)目录  默认为‘’没有单独目录js/css/img在根目录中。</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h6 id="一、去除生产环境sourceMap"><a href="#一、去除生产环境sourceMap" class="headerlink" title="一、去除生产环境sourceMap"></a>一、去除生产环境sourceMap</h6><p>问题： vue项目打包之后js文件夹中，会自动生成一些map文件，占用相当一部分空间</p><p>sourceMap资源映射文件，存的是打包前后的代码位置，方便开发使用，这个占用相当一部分空间。</p><p>map文件的作用在于：项目打包后，代码都是经过压缩加密的，如果运行时报错，输出的错误信息无法准确得知是哪里的代码报错，有了map就可以像未加密的代码一样，准确的输出是哪一行哪一列有错。</p><p>生产环境是不需要sourceMap的，如下配置可以去除</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">//去除生产环境的productionSourceMap</span></span><br><span class="line">  <span class="attr">productionSourceMap</span>: <span class="literal">false</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>去除sourceMap前后对比，减少了很大体积。</p><p>前：dist大小为7M</p><p>后：dist大小为3M</p><h6 id="二、去除console-log打印以及注释"><a href="#二、去除console-log打印以及注释" class="headerlink" title="二、去除console.log打印以及注释"></a>二、去除console.log打印以及注释</h6><p>下载插件</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install uglifyjs-webpack-plugin --save-dev</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">UglifyJsPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;uglifyjs-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> isProduction = process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;production&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attr">configureWebpack</span>: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> plugins = [];</span><br><span class="line">    <span class="keyword">if</span> (isProduction) &#123;</span><br><span class="line">      plugins.<span class="title function_">push</span>(</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">UglifyJsPlugin</span>(&#123;</span><br><span class="line">          <span class="attr">uglifyOptions</span>: &#123;</span><br><span class="line">            <span class="attr">output</span>: &#123;</span><br><span class="line">              <span class="attr">comments</span>: <span class="literal">false</span>, <span class="comment">// 去掉注释</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">warnings</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">compress</span>: &#123;</span><br><span class="line">              <span class="attr">drop_console</span>: <span class="literal">true</span>,</span><br><span class="line">              <span class="attr">drop_debugger</span>: <span class="literal">false</span>,</span><br><span class="line">              <span class="attr">pure_funcs</span>: [<span class="string">&#x27;console.log&#x27;</span>]<span class="comment">//移除console</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure><p>结论：重新打包，dist体积减少并不大。因为congsole.log()以及注释并不会占用太多体积（也就10-30kb）</p><h6 id="三、使用CDN-加速优化"><a href="#三、使用CDN-加速优化" class="headerlink" title="三、使用CDN 加速优化"></a>三、使用CDN 加速优化</h6><p>cdn优化是指把第三方库比如（vue，vue-router，axios）通过cdn的方式引入项目中，这样vendor.js会显著减少，并且大大提升项目的首页加载速度，下面是具体操作：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isProduction = process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;production&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// externals</span></span><br><span class="line"><span class="keyword">const</span> externals = &#123;</span><br><span class="line">  <span class="attr">vue</span>: <span class="string">&#x27;Vue&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;vue-router&#x27;</span>: <span class="string">&#x27;VueRouter&#x27;</span>,</span><br><span class="line">  <span class="attr">vuex</span>: <span class="string">&#x27;Vuex&#x27;</span>,</span><br><span class="line">  <span class="attr">vant</span>: <span class="string">&#x27;vant&#x27;</span>,</span><br><span class="line">  <span class="attr">axios</span>: <span class="string">&#x27;axios&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// CDN外链，会插入到index.html中</span></span><br><span class="line"><span class="keyword">const</span> cdn = &#123;</span><br><span class="line">  <span class="comment">// 开发环境</span></span><br><span class="line">  <span class="attr">dev</span>: &#123;</span><br><span class="line">    <span class="attr">css</span>: [],</span><br><span class="line">    <span class="attr">js</span>: []</span><br><span class="line">  &#125;,</span><br><span class="line"> <span class="comment">// 生产环境</span></span><br><span class="line">  <span class="attr">build</span>: &#123;</span><br><span class="line">    <span class="attr">css</span>: [<span class="string">&#x27;https://cdn.jsdelivr.net/npm/vant@2.12/lib/index.css&#x27;</span>],</span><br><span class="line">    <span class="attr">js</span>: [</span><br><span class="line">      <span class="string">&#x27;https://cdn.jsdelivr.net/npm/vue@2.6.11/dist/vue.min.js&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;https://cdn.jsdelivr.net/npm/vue-router@3.1.5/dist/vue-router.min.js&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;https://cdn.jsdelivr.net/npm/axios@0.19.2/dist/axios.min.js&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;https://cdn.jsdelivr.net/npm/vuex@3.1.2/dist/vuex.min.js&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;https://cdn.jsdelivr.net/npm/vant@2.12/lib/vant.min.js&#x27;</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">configureWebpack</span>: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 为生产环境修改配置...</span></span><br><span class="line">    <span class="keyword">if</span> (isProduction) &#123;</span><br><span class="line">      <span class="comment">// externals</span></span><br><span class="line">      config.<span class="property">externals</span> = externals</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">chainWebpack</span>: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加CDN参数到htmlWebpackPlugin配置中</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    config.<span class="title function_">plugin</span>(<span class="string">&#x27;html&#x27;</span>).<span class="title function_">tap</span>(<span class="function"><span class="params">args</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (isProduction) &#123;</span><br><span class="line">        args[<span class="number">0</span>].<span class="property">cdn</span> = cdn.<span class="property">build</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        args[<span class="number">0</span>].<span class="property">cdn</span> = cdn.<span class="property">dev</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> args</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在 public&#x2F;index.html 中添加</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用CDN的CSS文件 --&gt;</span></span><br><span class="line">&lt;% for (var i in</span><br><span class="line">  htmlWebpackPlugin.options.cdn&amp;&amp;htmlWebpackPlugin.options.cdn.css) &#123; %&gt;</span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;&lt;%= htmlWebpackPlugin.options.cdn.css[i] %&gt;&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;preload&quot;</span> <span class="attr">as</span>=<span class="string">&quot;style&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;&lt;%= htmlWebpackPlugin.options.cdn.css[i] %&gt;&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> /&gt;</span></span><br><span class="line">&lt;% &#125; %&gt;</span><br><span class="line"> <span class="comment">&lt;!-- 使用CDN加速的JS文件，配置在vue.config.js下 --&gt;</span></span><br><span class="line">&lt;% for (var i in</span><br><span class="line">  htmlWebpackPlugin.options.cdn&amp;&amp;htmlWebpackPlugin.options.cdn.js) &#123; %&gt;</span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&lt;%= htmlWebpackPlugin.options.cdn.js[i] %&gt;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure><p>总结：配置了cdn引入，1.1M体积较少到660kb。效果很明显。</p><h6 id="四、对资源文件进行压缩"><a href="#四、对资源文件进行压缩" class="headerlink" title="四、对资源文件进行压缩"></a>四、对资源文件进行压缩</h6><p>需要下载 compression-webpack-plugin</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm i compression-webpack-plugin -D</span><br></pre></td></tr></table></figure><p>vue.config.js 中按照如下方式进行配置：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">CompressionWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;compression-webpack-plugin&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// 根据你的实际情况更改这里</span></span><br><span class="line">  publicPath,</span><br><span class="line">  <span class="attr">assetsDir</span>: <span class="string">&#x27;assets&#x27;</span>,</span><br><span class="line">  <span class="attr">lintOnSave</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">configureWebpack</span>: &#123;</span><br><span class="line">    <span class="attr">plugins</span>:[</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">CompressionWebpackPlugin</span>(&#123;</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;[path].gz[query]&#x27;</span>,</span><br><span class="line">        <span class="attr">algorithm</span>: <span class="string">&#x27;gzip&#x27;</span>,</span><br><span class="line">        <span class="comment">// test: /\.js$|\.html$|\.json$|\.css/,</span></span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.js$|\.json$|\.css/</span>,</span><br><span class="line">        <span class="attr">threshold</span>: <span class="number">10240</span>, <span class="comment">// 只有大小大于该值的资源会被处理</span></span><br><span class="line">        <span class="attr">minRatio</span>: <span class="number">0.8</span>, <span class="comment">// 只有压缩率小于这个值的资源才会被处理</span></span><br><span class="line">        <span class="comment">// deleteOriginalAssets: true // 删除原文件</span></span><br><span class="line">      &#125;)</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>压缩后也会节省一部分空间，单后端要对nginx修改，配合前端</p><p>nginx配置示例：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">location ~ .*\.(js|json|css)$ &#123;</span><br><span class="line">    gzip on;</span><br><span class="line">    gzip_static on; # gzip_static是nginx对于静态文件的处理模块，该模块可以读取预先压缩的gz文件，这样可以减少每次请求进行gzip压缩的<span class="variable constant_">CPU</span>资源消耗。</span><br><span class="line">    gzip_min_length 1k;</span><br><span class="line">    gzip_http_version <span class="number">1.1</span>;</span><br><span class="line">    gzip_comp_level <span class="number">9</span>;</span><br><span class="line">    gzip_types  text/css application/javascript application/json;</span><br><span class="line">    root /dist;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>压缩前后大小大致如下：</p><p><img src="https://img-blog.csdnimg.cn/20210116175735462.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzYzODk2OA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p> 可以看到相应头中存在 Content-Encoding:gzip 表示已经配置成功</p><p><img src="https://img-blog.csdnimg.cn/20210116175431533.png" alt="20210116175431533"></p><h6 id="五、图片压缩"><a href="#五、图片压缩" class="headerlink" title="五、图片压缩"></a>五、图片压缩</h6><p>一张图片压缩前后对比：</p><p><img src="https://img-blog.csdnimg.cn/2021011614592414.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzYzODk2OA==,size_16,color_FFFFFF,t_70"></p><p>需要下载 image-webpack-loader</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install image-webpack-loader --save-dev</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// 根据你的实际情况更改这里</span></span><br><span class="line">  publicPath,</span><br><span class="line">  <span class="attr">assetsDir</span>: <span class="string">&#x27;assets&#x27;</span>,</span><br><span class="line">  <span class="attr">lintOnSave</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// image 压缩 定义在chainWebpack中</span></span><br><span class="line"> <span class="attr">chainWebpack</span>: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">   config.<span class="property">module</span></span><br><span class="line">      .<span class="title function_">rule</span>(<span class="string">&#x27;images&#x27;</span>)</span><br><span class="line">      .<span class="title function_">use</span>(<span class="string">&#x27;image-webpack-loader&#x27;</span>)</span><br><span class="line">      .<span class="title function_">loader</span>(<span class="string">&#x27;image-webpack-loader&#x27;</span>)</span><br><span class="line">      .<span class="title function_">options</span>(&#123;</span><br><span class="line">        <span class="attr">bypassOnDebug</span>: <span class="literal">true</span></span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">end</span>()&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1、此插件容易下载失败，导致运行报错</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">若安装过 image-webpack-loader 先卸载</span><br><span class="line"><span class="comment">//npm 安装的npm 则npm 移除</span></span><br><span class="line">npm uninstall image-webpack-loader</span><br><span class="line"><span class="comment">//如果yarn安装的，则yarn 移除</span></span><br><span class="line">yarn remove image-webpack-loader </span><br></pre></td></tr></table></figure><p>2、使用 cnpm , 这一步意思就是安装 cnpm 然后将全局的 registry 设置成阿里的镜像，国内阿里比较快</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install cnpm -g --registry=<span class="attr">https</span>:<span class="comment">//registry.npm.taobao.org</span></span><br></pre></td></tr></table></figure><p>3、使用 cnpm 安装 image-webpack-loader 会发现很快就安装好了，【手动滑稽】</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install --save-dev image-webpack-loader</span><br></pre></td></tr></table></figure><h6 id="六、只打包改变的文件"><a href="#六、只打包改变的文件" class="headerlink" title="六、只打包改变的文件"></a>六、只打包改变的文件</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">HashedModuleIdsPlugin</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>);</span><br><span class="line"><span class="attr">configureWebpack</span>: <span class="function"><span class="params">config</span> =&gt;</span> &#123;    </span><br><span class="line">    <span class="keyword">const</span> plugins = [];</span><br><span class="line">    plugins.<span class="title function_">push</span>(</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">HashedModuleIdsPlugin</span>()</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="七、公共代码抽离"><a href="#七、公共代码抽离" class="headerlink" title="七、公共代码抽离"></a>七、公共代码抽离</h6><p>如何提取公共代码？</p><p>从webpack4开始官方移除了commonchunk插件，改用了optimization属性进行更加灵活的配置，这也应该是从V3升级到V4的代码修改过程中最为复杂的一部分</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">splitChunks</span>: &#123;</span><br><span class="line">    <span class="attr">chunks</span>: <span class="string">&quot;async”,//默认作用于异步chunk，值为all/initial/async/function(chunk),值为function时第一个参数为遍历所有入口chunk时的chunk模块，chunk._modules为chunk所有依赖的模块，通过chunk的名字和所有依赖模块的resource可以自由配置,会抽取所有满足条件chunk的公有模块，以及模块的所有依赖模块，包括css</span></span><br><span class="line"><span class="string">    minSize: 30000,  //表示在压缩前的最小模块大小,默认值是30kb</span></span><br><span class="line"><span class="string">    minChunks: 1,  // 表示被引用次数，默认为1；</span></span><br><span class="line"><span class="string">    maxAsyncRequests: 5,  //所有异步请求不得超过5个</span></span><br><span class="line"><span class="string">    maxInitialRequests: 3,  //初始话并行请求不得超过3个</span></span><br><span class="line"><span class="string">   automaticNameDelimiter:&#x27;~&#x27;,//名称分隔符，默认是~</span></span><br><span class="line"><span class="string">    name: true,  //打包后的名称，默认是chunk的名字通过分隔符（默认是～）分隔</span></span><br><span class="line"><span class="string">    cacheGroups: &#123; //设置缓存组用来抽取满足不同规则的chunk,下面以生成common为例</span></span><br><span class="line"><span class="string">       common: &#123;</span></span><br><span class="line"><span class="string">         name: &#x27;common&#x27;,  //抽取的chunk的名字</span></span><br><span class="line"><span class="string">         chunks(chunk) &#123; //同外层的参数配置，覆盖外层的chunks，以chunk为维度进行抽取</span></span><br><span class="line"><span class="string">         &#125;,</span></span><br><span class="line"><span class="string">         test(module, chunks) &#123;  //可以为字符串，正则表达式，函数，以module为维度进行抽取，只要是满足条件的module都会被抽取到该common的chunk中，为函数时第一个参数是遍历到的每一个模块，第二个参数是每一个引用到该模块的chunks数组。自己尝试过程中发现不能提取出css，待进一步验证。</span></span><br><span class="line"><span class="string">         &#125;,</span></span><br><span class="line"><span class="string">        priority: 10,  //优先级，一个chunk很可能满足多个缓存组，会被抽取到优先级高的缓存组中</span></span><br><span class="line"><span class="string">       minChunks: 2,  //最少被几个chunk引用</span></span><br><span class="line"><span class="string">       reuseExistingChunk: true，//  如果该chunk中引用了已经被抽取的chunk，直接引用该chunk，不会重复打包代码</span></span><br><span class="line"><span class="string">       enforce: true  // 如果cacheGroup中没有设置minSize，则据此判断是否使用上层的minSize，true：则使用0，false：使用上层minSize</span></span><br><span class="line"><span class="string">       &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><p>公共模块抽离<br>举例：</p><p>项目中分别有a.js, b.js, page1.js, page2.js这四个JS文件， page1.js 和<br>page2.js中同时都引用了a.js, b.js， 这时候想把a.js, b.js抽离出来合并成一个公共的js，然后在page1,page2中自动引入这个公共的js，怎么配置呢？</p><p>第三方模块抽离</p><p>页面中有时会引入第三方模块，比如import $ from ‘jquery’;<br>page1中需要引用，page2中也需要引用，这时候就可以用vendor把jquery抽离出来，</p><p>如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 公共代码抽离</span></span><br><span class="line"><span class="attr">configureWebpack</span>: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line"><span class="comment">//....</span></span><br><span class="line"><span class="comment">//优化项配置</span></span><br><span class="line"></span><br><span class="line">config.<span class="property">optimization</span> = &#123;</span><br><span class="line">    <span class="attr">splitChunks</span>: &#123; <span class="comment">// 分割代码块</span></span><br><span class="line">        <span class="attr">cacheGroups</span>: &#123;</span><br><span class="line">            <span class="attr">vendor</span>: &#123;<span class="comment">//第三方库抽离</span></span><br><span class="line">                <span class="attr">chunks</span>: <span class="string">&#x27;all&#x27;</span>,</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;vendor&#x27;</span>,</span><br><span class="line">                <span class="attr">minChunks</span>: <span class="number">1</span>,<span class="comment">//在分割之前，这个代码块最小应该被引用的次数</span></span><br><span class="line">                <span class="attr">maxInitialRequests</span>: <span class="number">5</span>,</span><br><span class="line">                <span class="attr">minSize</span>: <span class="number">0</span>,<span class="comment">//大于0个字节</span></span><br><span class="line">                <span class="attr">priority</span>: <span class="number">100</span><span class="comment">//权重</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">common</span>: &#123;  <span class="comment">//公用模块抽离</span></span><br><span class="line">                <span class="attr">chunks</span>: <span class="string">&#x27;all&#x27;</span>,</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/[\\/]src[\\/]js[\\/]/</span>,</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;common&#x27;</span>,</span><br><span class="line">                <span class="attr">minChunks</span>: <span class="number">2</span>,在分割之前，这个代码块最小应该被引用的次数</span><br><span class="line">                <span class="attr">maxInitialRequests</span>: <span class="number">5</span>,</span><br><span class="line">                <span class="attr">minSize</span>: <span class="number">0</span>,<span class="comment">//大于0个字节</span></span><br><span class="line">                <span class="attr">priority</span>: <span class="number">60</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">styles</span>: &#123; <span class="comment">//样式抽离</span></span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;styles&#x27;</span>,</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.(sa|sc|c)ss$/</span>,</span><br><span class="line">                <span class="attr">chunks</span>: <span class="string">&#x27;all&#x27;</span>,</span><br><span class="line">                <span class="attr">enforce</span>: <span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">runtimeChunk</span>: &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;manifest&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="八、配置-打包分析"><a href="#八、配置-打包分析" class="headerlink" title="八、配置 打包分析"></a>八、配置 打包分析</h6><p>安装</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm i webpack-bundle-analyzer -D</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">BundleAnalyzerPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;webpack-bundle-analyzer&#x27;</span>).<span class="property">BundleAnalyzerPlugin</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">chainWebpack</span>: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 打包分析</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable constant_">IS_PROD</span>) &#123;</span><br><span class="line">      config.<span class="title function_">plugin</span>(<span class="string">&#x27;webpack-report&#x27;</span>).<span class="title function_">use</span>(<span class="title class_">BundleAnalyzerPlugin</span>, [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">analyzerMode</span>: <span class="string">&#x27;static&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">      ])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="九、骨架屏"><a href="#九、骨架屏" class="headerlink" title="九、骨架屏"></a>九、骨架屏</h6><p>安装插件 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install vue-skeleton-webpack-plugin</span><br></pre></td></tr></table></figure><p>在src下新建Skeleton文件夹，其中新建index.js以及index.vue，在其中写入以下内容，其中，骨架屏的index.vue页面样式请自行编辑</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">index.js</span><br><span class="line"></span><br><span class="line">import Vue from &#x27;vue&#x27;</span><br><span class="line">import home from &#x27;./index.vue&#x27;</span><br><span class="line">import list from &#x27;./list.vue&#x27;</span><br><span class="line">export default new Vue(&#123;</span><br><span class="line">  components: &#123;</span><br><span class="line">    home,</span><br><span class="line">    list</span><br><span class="line">  &#125;,</span><br><span class="line">  template: `</span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">home</span> <span class="attr">id</span>=<span class="string">&quot;home&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display:none&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">list</span> <span class="attr">id</span>=<span class="string">&quot;list&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display:none&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> `</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>index.vue(骨架屏页面) list.vue同理</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;skeleton-wrapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">header</span> <span class="attr">class</span>=<span class="string">&quot;skeleton-header&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;skeleton-block&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2aWV3Qm94PSIwIDAgMTA4MCAyNjEiPjxkZWZzPjxwYXRoIGlkPSJiIiBkPSJNMCAwaDEwODB2MjYwSDB6Ii8+PGZpbHRlciBpZD0iYSIgd2lkdGg9IjIwMCUiIGhlaWdodD0iMjAwJSIgeD0iLTUwJSIgeT0iLTUwJSIgZmlsdGVyVW5pdHM9Im9iamVjdEJvdW5kaW5nQm94Ij48ZmVPZmZzZXQgZHk9Ii0xIiBpbj0iU291cmNlQWxwaGEiIHJlc3VsdD0ic2hhZG93T2Zmc2V0T3V0ZXIxIi8+PGZlQ29sb3JNYXRyaXggaW49InNoYWRvd09mZnNldE91dGVyMSIgdmFsdWVzPSIwIDAgMCAwIDAuOTMzMzMzMzMzIDAgMCAwIDAgMC45MzMzMzMzMzMgMCAwIDAgMCAwLjkzMzMzMzMzMyAwIDAgMCAxIDAiLz48L2ZpbHRlcj48L2RlZnM+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwIDEpIj48dXNlIGZpbGw9IiMwMDAiIGZpbHRlcj0idXJsKCNhKSIgeGxpbms6aHJlZj0iI2IiLz48dXNlIGZpbGw9IiNGRkYiIHhsaW5rOmhyZWY9IiNiIi8+PHBhdGggZmlsbD0iI0Y2RjZGNiIgZD0iTTIzMCA0NGg1MzN2NDZIMjMweiIvPjxyZWN0IHdpZHRoPSIxNzIiIGhlaWdodD0iMTcyIiB4PSIzMCIgeT0iNDQiIGZpbGw9IiNGNkY2RjYiIHJ4PSI0Ii8+PHBhdGggZmlsbD0iI0Y2RjZGNiIgZD0iTTIzMCAxMThoMzY5djMwSDIzMHpNMjMwIDE4MmgzMjN2MzBIMjMwek04MTIgMTE1aDIzOHYzOUg4MTJ6TTgwOCAxODRoMjQydjMwSDgwOHpNOTE3IDQ4aDEzM3YzN0g5MTd6Ii8+PC9nPjwvc3ZnPg==&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2aWV3Qm94PSIwIDAgMTA4MCAyNjEiPjxkZWZzPjxwYXRoIGlkPSJiIiBkPSJNMCAwaDEwODB2MjYwSDB6Ii8+PGZpbHRlciBpZD0iYSIgd2lkdGg9IjIwMCUiIGhlaWdodD0iMjAwJSIgeD0iLTUwJSIgeT0iLTUwJSIgZmlsdGVyVW5pdHM9Im9iamVjdEJvdW5kaW5nQm94Ij48ZmVPZmZzZXQgZHk9Ii0xIiBpbj0iU291cmNlQWxwaGEiIHJlc3VsdD0ic2hhZG93T2Zmc2V0T3V0ZXIxIi8+PGZlQ29sb3JNYXRyaXggaW49InNoYWRvd09mZnNldE91dGVyMSIgdmFsdWVzPSIwIDAgMCAwIDAuOTMzMzMzMzMzIDAgMCAwIDAgMC45MzMzMzMzMzMgMCAwIDAgMCAwLjkzMzMzMzMzMyAwIDAgMCAxIDAiLz48L2ZpbHRlcj48L2RlZnM+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwIDEpIj48dXNlIGZpbGw9IiMwMDAiIGZpbHRlcj0idXJsKCNhKSIgeGxpbms6aHJlZj0iI2IiLz48dXNlIGZpbGw9IiNGRkYiIHhsaW5rOmhyZWY9IiNiIi8+PHBhdGggZmlsbD0iI0Y2RjZGNiIgZD0iTTIzMCA0NGg1MzN2NDZIMjMweiIvPjxyZWN0IHdpZHRoPSIxNzIiIGhlaWdodD0iMTcyIiB4PSIzMCIgeT0iNDQiIGZpbGw9IiNGNkY2RjYiIHJ4PSI0Ii8+PHBhdGggZmlsbD0iI0Y2RjZGNiIgZD0iTTIzMCAxMThoMzY5djMwSDIzMHpNMjMwIDE4MmgzMjN2MzBIMjMwek04MTIgMTE1aDIzOHYzOUg4MTJ6TTgwOCAxODRoMjQydjMwSDgwOHpNOTE3IDQ4aDEzM3YzN0g5MTd6Ii8+PC9nPjwvc3ZnPg==&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">name</span>: <span class="string">&#x27;skeleton&#x27;</span></span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.skeleton-header</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">40px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background</span>: <span class="number">#1976d2</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">padding</span>:<span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.skeleton-block</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">flex-direction</span>: column;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">padding-top</span>: <span class="number">8px</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"> </span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>vue.config.js 配置</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//骨架屏渲染</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">SkeletonWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;vue-skeleton-webpack-plugin&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//path引入</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//configureWebpack模块中写入内容</span></span><br><span class="line"><span class="comment">// 骨架屏渲染</span></span><br><span class="line">config.<span class="property">plugins</span>.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">SkeletonWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">webpackConfig</span>: &#123;</span><br><span class="line">        <span class="attr">entry</span>: &#123;</span><br><span class="line">          <span class="attr">app</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;./src/Skeleton/index.js&#x27;</span>),</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">minimize</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">quiet</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="comment">// 如果不设置那么所有的路由都会共享这个骨架屏组件</span></span><br><span class="line">      <span class="attr">router</span>: &#123;</span><br><span class="line">        <span class="attr">mode</span>: <span class="string">&#x27;hash&#x27;</span>,</span><br><span class="line">        <span class="comment">// 给对应的路由设置对应的骨架屏组件，skeletonId的值根据组件设置的id</span></span><br><span class="line">        <span class="attr">routes</span>: [</span><br><span class="line">          &#123; <span class="attr">path</span>: <span class="string">&#x27;/home&#x27;</span>, <span class="attr">skeletonId</span>: <span class="string">&#x27;home&#x27;</span> &#125;,</span><br><span class="line">          &#123; <span class="attr">path</span>: <span class="string">&#x27;/list&#x27;</span>, <span class="attr">skeletonId</span>: <span class="string">&#x27;list&#x27;</span> &#125;,</span><br><span class="line">        ]</span><br><span class="line">    &#125;))</span><br></pre></td></tr></table></figure><h5 id="三、完整配置"><a href="#三、完整配置" class="headerlink" title="三、完整配置"></a>三、完整配置</h5><p>vue.config.js完整配置</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">UglifyJsPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;uglifyjs-webpack-plugin&#x27;</span>) <span class="comment">// 去掉注释</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CompressionWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;compression-webpack-plugin&#x27;</span>); <span class="comment">// 开启压缩</span></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">HashedModuleIdsPlugin</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">resolve</span>(<span class="params">dir</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> path.<span class="title function_">join</span>(__dirname, dir)</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> isProduction = process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;production&#x27;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// cdn预加载使用</span></span><br><span class="line"><span class="keyword">const</span> externals = &#123;</span><br><span class="line">    <span class="string">&#x27;vue&#x27;</span>: <span class="string">&#x27;Vue&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;vue-router&#x27;</span>: <span class="string">&#x27;VueRouter&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;vuex&#x27;</span>: <span class="string">&#x27;Vuex&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;axios&#x27;</span>: <span class="string">&#x27;axios&#x27;</span>,</span><br><span class="line">    <span class="string">&quot;element-ui&quot;</span>: <span class="string">&quot;ELEMENT&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> cdn = &#123;</span><br><span class="line">    <span class="comment">// 开发环境</span></span><br><span class="line">    <span class="attr">dev</span>: &#123;</span><br><span class="line">        <span class="attr">css</span>: [</span><br><span class="line">            <span class="string">&#x27;https://unpkg.com/element-ui/lib/theme-chalk/index.css&#x27;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">js</span>: []</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 生产环境</span></span><br><span class="line">    <span class="attr">build</span>: &#123;</span><br><span class="line">        <span class="attr">css</span>: [</span><br><span class="line">            <span class="string">&#x27;https://unpkg.com/element-ui/lib/theme-chalk/index.css&#x27;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">js</span>: [</span><br><span class="line">            <span class="string">&#x27;https://cdn.jsdelivr.net/npm/vue@2.5.17/dist/vue.min.js&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;https://cdn.jsdelivr.net/npm/vue-router@3.0.1/dist/vue-router.min.js&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;https://cdn.jsdelivr.net/npm/vuex@3.0.1/dist/vuex.min.js&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;https://cdn.jsdelivr.net/npm/axios@0.18.0/dist/axios.min.js&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;https://unpkg.com/element-ui/lib/index.js&#x27;</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="attr">lintOnSave</span>: <span class="literal">false</span>, <span class="comment">// 关闭eslint</span></span><br><span class="line">    <span class="attr">productionSourceMap</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">publicPath</span>: <span class="string">&#x27;./&#x27;</span>, </span><br><span class="line">    <span class="attr">outputDir</span>: process.<span class="property">env</span>.<span class="property">outputDir</span>, <span class="comment">// 生成文件的目录名称</span></span><br><span class="line">    <span class="attr">chainWebpack</span>: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line"> </span><br><span class="line">        config.<span class="property">resolve</span>.<span class="property">alias</span></span><br><span class="line">            .<span class="title function_">set</span>(<span class="string">&#x27;@&#x27;</span>, <span class="title function_">resolve</span>(<span class="string">&#x27;src&#x27;</span>))</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 压缩图片</span></span><br><span class="line">        config.<span class="property">module</span></span><br><span class="line">            .<span class="title function_">rule</span>(<span class="string">&#x27;images&#x27;</span>)</span><br><span class="line">            .<span class="title function_">test</span>(<span class="regexp">/\.(png|jpe?g|gif|svg)(\?.*)?$/</span>)</span><br><span class="line">            .<span class="title function_">use</span>(<span class="string">&#x27;image-webpack-loader&#x27;</span>)</span><br><span class="line">            .<span class="title function_">loader</span>(<span class="string">&#x27;image-webpack-loader&#x27;</span>)</span><br><span class="line">            .<span class="title function_">options</span>(&#123; <span class="attr">bypassOnDebug</span>: <span class="literal">true</span> &#125;)</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// webpack 会默认给commonChunk打进chunk-vendors，所以需要对webpack的配置进行delete</span></span><br><span class="line">        config.<span class="property">optimization</span>.<span class="title function_">delete</span>(<span class="string">&#x27;splitChunks&#x27;</span>)</span><br><span class="line"> </span><br><span class="line">        config.<span class="title function_">plugin</span>(<span class="string">&#x27;html&#x27;</span>).<span class="title function_">tap</span>(<span class="function"><span class="params">args</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">                args[<span class="number">0</span>].<span class="property">cdn</span> = cdn.<span class="property">build</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;development&#x27;</span>) &#123;</span><br><span class="line">                args[<span class="number">0</span>].<span class="property">cdn</span> = cdn.<span class="property">dev</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> args</span><br><span class="line">        &#125;)</span><br><span class="line"> </span><br><span class="line">        config</span><br><span class="line">            .<span class="title function_">plugin</span>(<span class="string">&#x27;webpack-bundle-analyzer&#x27;</span>)</span><br><span class="line">            .<span class="title function_">use</span>(<span class="built_in">require</span>(<span class="string">&#x27;webpack-bundle-analyzer&#x27;</span>).<span class="property">BundleAnalyzerPlugin</span>)</span><br><span class="line">    &#125;,</span><br><span class="line"> </span><br><span class="line">    <span class="attr">configureWebpack</span>: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> plugins = [];</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (isProduction) &#123;</span><br><span class="line">            plugins.<span class="title function_">push</span>(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">UglifyJsPlugin</span>(&#123;</span><br><span class="line">                    <span class="attr">uglifyOptions</span>: &#123;</span><br><span class="line">                        <span class="attr">output</span>: &#123;</span><br><span class="line">                            <span class="attr">comments</span>: <span class="literal">false</span>, <span class="comment">// 去掉注释</span></span><br><span class="line">                        &#125;,</span><br><span class="line">                        <span class="attr">warnings</span>: <span class="literal">false</span>,</span><br><span class="line">                        <span class="attr">compress</span>: &#123;</span><br><span class="line">                            <span class="attr">drop_console</span>: <span class="literal">true</span>,</span><br><span class="line">                            <span class="attr">drop_debugger</span>: <span class="literal">false</span>,</span><br><span class="line">                            <span class="attr">pure_funcs</span>: [<span class="string">&#x27;console.log&#x27;</span>]<span class="comment">//移除console</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            )</span><br><span class="line">            <span class="comment">// 服务器也要相应开启gzip</span></span><br><span class="line">            plugins.<span class="title function_">push</span>(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">CompressionWebpackPlugin</span>(&#123;</span><br><span class="line">                    <span class="attr">algorithm</span>: <span class="string">&#x27;gzip&#x27;</span>,</span><br><span class="line">                    <span class="attr">test</span>: <span class="regexp">/\.(js|css)$/</span>,<span class="comment">// 匹配文件名</span></span><br><span class="line">                    <span class="attr">threshold</span>: <span class="number">10000</span>, <span class="comment">// 对超过10k的数据压缩</span></span><br><span class="line">                    <span class="attr">deleteOriginalAssets</span>: <span class="literal">false</span>, <span class="comment">// 不删除源文件</span></span><br><span class="line">                    <span class="attr">minRatio</span>: <span class="number">0.8</span> <span class="comment">// 压缩比</span></span><br><span class="line">                &#125;)</span><br><span class="line">            )</span><br><span class="line"> </span><br><span class="line">            <span class="comment">// 用于根据模块的相对路径生成 hash 作为模块 id, 一般用于生产环境</span></span><br><span class="line">            plugins.<span class="title function_">push</span>(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">HashedModuleIdsPlugin</span>()</span><br><span class="line">            )</span><br><span class="line"> </span><br><span class="line">            <span class="comment">// 开启分离js</span></span><br><span class="line">            config.<span class="property">optimization</span> = &#123;</span><br><span class="line">                <span class="attr">runtimeChunk</span>: <span class="string">&#x27;single&#x27;</span>,</span><br><span class="line">                <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">                    <span class="attr">chunks</span>: <span class="string">&#x27;all&#x27;</span>,</span><br><span class="line">                    <span class="attr">maxInitialRequests</span>: <span class="title class_">Infinity</span>,</span><br><span class="line">                    <span class="attr">minSize</span>: <span class="number">1000</span> * <span class="number">60</span>,</span><br><span class="line">                    <span class="attr">cacheGroups</span>: &#123;</span><br><span class="line">                        <span class="attr">vendor</span>: &#123;</span><br><span class="line">                            <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">                            <span class="title function_">name</span>(<span class="params"><span class="variable language_">module</span></span>) &#123;</span><br><span class="line">                                <span class="comment">// 排除node_modules 然后吧 @ 替换为空 ,考虑到服务器的兼容</span></span><br><span class="line">                                <span class="keyword">const</span> packageName = <span class="variable language_">module</span>.<span class="property">context</span>.<span class="title function_">match</span>(<span class="regexp">/[\\/]node_modules[\\/](.*?)([\\/]|$)/</span>)[<span class="number">1</span>]</span><br><span class="line">                                <span class="keyword">return</span> <span class="string">`npm.<span class="subst">$&#123;packageName.replace(<span class="string">&#x27;@&#x27;</span>, <span class="string">&#x27;&#x27;</span>)&#125;</span>`</span></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line"> </span><br><span class="line">            <span class="comment">// 取消webpack警告的性能提示</span></span><br><span class="line">            config.<span class="property">performance</span> = &#123;</span><br><span class="line">                <span class="attr">hints</span>: <span class="string">&#x27;warning&#x27;</span>,</span><br><span class="line">                <span class="comment">//入口起点的最大体积</span></span><br><span class="line">                <span class="attr">maxEntrypointSize</span>: <span class="number">1000</span> * <span class="number">500</span>,</span><br><span class="line">                <span class="comment">//生成文件的最大体积</span></span><br><span class="line">                <span class="attr">maxAssetSize</span>: <span class="number">1000</span> * <span class="number">1000</span>,</span><br><span class="line">                <span class="comment">//只给出 js 文件的性能提示</span></span><br><span class="line">                <span class="attr">assetFilter</span>: <span class="keyword">function</span> (<span class="params">assetFilename</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> assetFilename.<span class="title function_">endsWith</span>(<span class="string">&#x27;.js&#x27;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            <span class="comment">// 打包时npm包转CDN</span></span><br><span class="line">            config.<span class="property">externals</span> = externals;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> &#123; plugins &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"> </span><br><span class="line">    <span class="attr">pluginOptions</span>: &#123;</span><br><span class="line">        <span class="comment">// 配置全局less</span></span><br><span class="line">        <span class="string">&#x27;style-resources-loader&#x27;</span>: &#123;</span><br><span class="line">            <span class="attr">preProcessor</span>: <span class="string">&#x27;less&#x27;</span>,</span><br><span class="line">            <span class="attr">patterns</span>: [<span class="title function_">resolve</span>(<span class="string">&#x27;./src/style/theme.less&#x27;</span>)]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">devServer</span>: &#123;</span><br><span class="line">        <span class="attr">open</span>: <span class="literal">false</span>, <span class="comment">// 自动启动浏览器</span></span><br><span class="line">        <span class="attr">host</span>: <span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="comment">// localhost</span></span><br><span class="line">        <span class="attr">port</span>: <span class="number">6060</span>, <span class="comment">// 端口号</span></span><br><span class="line">        <span class="attr">https</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">hotOnly</span>: <span class="literal">false</span>, <span class="comment">// 热更新</span></span><br><span class="line">        <span class="attr">proxy</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;^/sso&#x27;</span>: &#123;</span><br><span class="line">                <span class="attr">target</span>: process.<span class="property">env</span>.<span class="property">VUE_APP_SSO</span>, <span class="comment">// 重写路径</span></span><br><span class="line">                <span class="attr">ws</span>: <span class="literal">true</span>,   <span class="comment">//开启WebSocket</span></span><br><span class="line">                <span class="attr">secure</span>: <span class="literal">false</span>,      <span class="comment">// 如果是https接口，需要配置这个参数</span></span><br><span class="line">                <span class="attr">changeOrigin</span>: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> vue vue-cli4 webpack </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue vue-cli4 webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web部署成功，通知用户刷新界面 实践</title>
      <link href="/2024/01/16/web%E9%83%A8%E7%BD%B2%E6%88%90%E5%8A%9F%EF%BC%8C%E9%80%9A%E7%9F%A5%E7%94%A8%E6%88%B7%E5%88%B7%E6%96%B0%E7%95%8C%E9%9D%A2-%E5%AE%9E%E8%B7%B5/"/>
      <url>/2024/01/16/web%E9%83%A8%E7%BD%B2%E6%88%90%E5%8A%9F%EF%BC%8C%E9%80%9A%E7%9F%A5%E7%94%A8%E6%88%B7%E5%88%B7%E6%96%B0%E7%95%8C%E9%9D%A2-%E5%AE%9E%E8%B7%B5/</url>
      
        <content type="html"><![CDATA[<h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><p>​当我们成功部署web应用之后，由于页面没有及时刷新，导致数据存在差异  无法体验到最新的功能等问题。</p><h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">interface <span class="title class_">Options</span> &#123;</span><br><span class="line">timer?: number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Updater</span> &#123;</span><br><span class="line"><span class="attr">oldScript</span>: string[] <span class="comment">// 存储第一次值也就是script 的hash 信息</span></span><br><span class="line"><span class="attr">newScript</span>: string[] <span class="comment">// 获取新的值 也就是新的script 的hash信息</span></span><br><span class="line"><span class="attr">dispatch</span>: <span class="title class_">Record</span>&lt;string, <span class="title class_">Array</span>&lt;<span class="function">() =&gt;</span> <span class="keyword">void</span>&gt;&gt; <span class="comment">// 小型发布订阅通知用户更新了</span></span><br><span class="line"><span class="attr">timer</span>: <span class="title class_">NodeJS</span>.<span class="property">Timeout</span> | <span class="literal">null</span> = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">constructor</span>(<span class="params">options: Options</span>) &#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">oldScript</span> = []</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">newScript</span> = []</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">dispatch</span> = &#123;&#125;</span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">init</span>() <span class="comment">// 初始化</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">timing</span>(options?.<span class="property">timer</span>) <span class="comment">// 轮询</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">init</span>(): <span class="title class_">Promise</span>&lt;<span class="keyword">void</span>&gt; &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">html</span>: string = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">getHtml</span>()</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">oldScript</span> = <span class="variable language_">this</span>.<span class="title function_">parseScript</span>(html)</span><br><span class="line">&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error initializing Updater:&#x27;</span>, error)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">getHtml</span>(): <span class="title class_">Promise</span>&lt;string&gt; &#123;</span><br><span class="line"><span class="keyword">const</span> html = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;/&#x27;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> res.<span class="title function_">text</span>()) <span class="comment">// 读取index html</span></span><br><span class="line"><span class="keyword">return</span> html</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">parseScript</span>(<span class="attr">html</span>: string): string[] &#123;</span><br><span class="line"><span class="keyword">const</span> reg = <span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="regexp">/&lt;script(?:\s+[^&gt;]*)?&gt;(.*?)&lt;\/script\s*&gt;/gi</span>) <span class="comment">// script正则</span></span><br><span class="line"><span class="keyword">return</span> html.<span class="title function_">match</span>(reg) <span class="keyword">as</span> string[] <span class="comment">// 匹配script标签</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发布订阅通知</span></span><br><span class="line"><span class="title function_">on</span>(<span class="attr">key</span>: <span class="string">&#x27;no-update&#x27;</span> | <span class="string">&#x27;update&#x27;</span>, <span class="attr">fn</span>: <span class="function">() =&gt;</span> <span class="keyword">void</span>): <span class="variable language_">this</span> &#123;</span><br><span class="line">;(<span class="variable language_">this</span>.<span class="property">dispatch</span>[key] || (<span class="variable language_">this</span>.<span class="property">dispatch</span>[key] = [])).<span class="title function_">push</span>(fn)</span><br><span class="line"><span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">compare</span>(<span class="attr">oldArr</span>: string[], <span class="attr">newArr</span>: string[]): <span class="keyword">void</span> &#123;</span><br><span class="line"><span class="keyword">const</span> base = oldArr.<span class="property">length</span></span><br><span class="line"><span class="keyword">const</span> arr = <span class="title class_">Array</span>.<span class="title function_">from</span>(<span class="keyword">new</span> <span class="title class_">Set</span>(oldArr.<span class="title function_">concat</span>(newArr)))</span><br><span class="line"><span class="comment">// 如果新旧length一样无更新</span></span><br><span class="line"><span class="keyword">if</span> (arr.<span class="property">length</span> === base) &#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">dispatch</span>[<span class="string">&#x27;no-update&#x27;</span>]?.<span class="title function_">forEach</span>(<span class="function">(<span class="params">fn</span>) =&gt;</span> <span class="title function_">fn</span>())</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">// 否则通知更新</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">dispatch</span>[<span class="string">&#x27;update&#x27;</span>]?.<span class="title function_">forEach</span>(<span class="function">(<span class="params">fn</span>) =&gt;</span> <span class="title function_">fn</span>())</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">timing</span>(time = <span class="number">10000</span>): <span class="keyword">void</span> &#123;</span><br><span class="line"><span class="comment">// 轮询</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">timer</span> = <span class="built_in">setInterval</span>(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">const</span> newHtml = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">getHtml</span>()</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">newScript</span> = <span class="variable language_">this</span>.<span class="title function_">parseScript</span>(newHtml)</span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">compare</span>(<span class="variable language_">this</span>.<span class="property">oldScript</span>, <span class="variable language_">this</span>.<span class="property">newScript</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error during polling:&#x27;</span>, error)</span><br><span class="line">&#125;</span><br><span class="line">&#125;, time)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 取消轮询</span></span><br><span class="line"><span class="title function_">stopTiming</span>(): <span class="keyword">void</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">timer</span>) &#123;</span><br><span class="line"><span class="built_in">clearInterval</span>(<span class="variable language_">this</span>.<span class="property">timer</span>)</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">timer</span> = <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//实例化该类</span><br><span class="line">const up = new Updater(&#123;</span><br><span class="line">    timer:2000</span><br><span class="line">&#125;)</span><br><span class="line">//未更新通知</span><br><span class="line">up.on(&#x27;no-update&#x27;,()=&gt;&#123;</span><br><span class="line">   console.log(&#x27;未更新&#x27;)</span><br><span class="line">&#125;)</span><br><span class="line">//更新通知</span><br><span class="line">up.on(&#x27;update&#x27;,()=&gt;&#123;</span><br><span class="line">    console.log(&#x27;更新了&#x27;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="代码思路解析"><a href="#代码思路解析" class="headerlink" title="代码思路解析"></a>代码思路解析</h3><ol><li>通过 <code>fetch</code> 获取网页 HTML 内容。</li><li>使用正则表达式匹配 HTML 中的 <code>&lt;script&gt;</code> 标签，提取脚本内容的哈希信息。</li><li>将获取到的哈希信息存储到 <code>oldScript</code> 数组中。</li><li>设置定时器，定期获取最新的 HTML 内容，提取脚本哈希信息，并与之前的哈希信息进行比较。</li><li>如果哈希信息有变化，触发更新通知；否则，触发无更新通知。</li><li>原文链接：<a href="https://juejin.cn/post/7185451392994115645">https://juejin.cn/post/7185451392994115645</a></li></ol><h3 id="推荐插件（plugin-web-update-notification）"><a href="#推荐插件（plugin-web-update-notification）" class="headerlink" title="推荐插件（plugin-web-update-notification）"></a>推荐插件（plugin-web-update-notification）</h3><blockquote><p>监听网页更新，并通知用户刷新页面的插件，支持 <code>Vite</code>、<code>Webpack</code>、<code>umi</code></p></blockquote><p>没错，最佳实践就是这个插件，如果觉得有用就点个 <code>star</code> 收藏下吧。</p><p><a href="https://link.juejin.cn/?target=https://github.com/GreatAuk/plugin-web-update-notification">github</a> | <a href="https://link.juejin.cn/?target=https://www.npmjs.com/package/@plugin-web-update-notification/core">npm </a>| <a href="https://link.juejin.cn/?target=https://github.com/GreatAuk/plugin-web-update-notification/blob/master/README.zh-CN.md">文档</a></p><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>以 <code>git commit hash</code> (也支持 <code>svn revision number</code>、<code>package.json version</code>、<code>build timestamp</code>、<code>custom</code>) 为版本号，打包时将版本号写入一个 <code>json</code> 文件，同时注入客户端运行的代码。客户端轮询服务器上的版本号（浏览器窗口的<code>visibilitychange</code>、<code>focus</code> 事件辅助），和本地作比较，如果不相同则通知用户刷新页面。</p><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ol><li><p>接入简单，安装插件，修改配置文件即可，不用修改业务代码（如果不自定义行为）。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">javascript</span><br><span class="line">复制代码<span class="comment">// 以 vite 为例</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; webUpdateNotice &#125; <span class="keyword">from</span> <span class="string">&#x27;@plugin-web-update-notification/vite&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// https://vitejs.dev/config/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="title function_">vue</span>(),</span><br><span class="line">    <span class="title function_">webUpdateNotice</span>(&#123;</span><br><span class="line">      <span class="attr">logVersion</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>支持多种版本号类型：</p><ul><li><code>git commit hash</code>（git 仓库默认）。</li><li><code>svn revision number</code> (svn 仓库默认)</li><li><code>package.json</code> 中的 <code>version</code> 字段。（建议搭配 <a href="https://link.juejin.cn/?target=https://github.com/antfu/bumpp">bumpp</a> 食用最佳）</li><li><code>build timestamp</code>，运行打包命令时的时间戳。</li><li><code>custom</code>，用户自定义版本号。</li></ul></li><li><p>预置了一个简约的更新 <code>Notification</code>，可以自定义文案、样式、位置。当然也可以取消默认的 <code>Notification</code>，监听到更新事件后自定义行为。</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7ce7fcc785a140ac8519dfc9ed98aa95~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20230311125900307"></p></li><li><p>预置的 <code>Notification</code> 文案支持国际化。</p></li><li><p>支持手动控制检测。</p></li><li><p>tiny, 注入的 <code>js</code> 和 <code>css</code> 文件压缩后不到 2kb。</p></li><li><p>完善的 <code>ts</code> 类型提示。</p></li><li><p><code>issue</code> 响应急时…</p></li></ol><h3 id="什么时候会检测更新"><a href="#什么时候会检测更新" class="headerlink" title="什么时候会检测更新"></a>什么时候会检测更新</h3><blockquote><p>检测：通过 <code>fetch</code> 加载服务器上的 <code>version.json</code> 文件（会忽略本地缓存）。</p></blockquote><ol><li>首次加载页面。</li><li>轮询（default: 10 * 60 * 1000 ms）。</li><li>js 脚本资源加载失败 (404 ?)。</li><li>标签页 <code>visibilitychange</code>、<code>focus</code> 事件为 <code>true</code> 时。(按目前公司的项目来看，大多数更新是这个时候命中的，轮询反而少些)</li></ol><h3 id="关于时效性"><a href="#关于时效性" class="headerlink" title="关于时效性"></a>关于时效性</h3><p>有人说轮询如果频率太慢了，时效性会比较差。</p><p>我觉得影响不大。用户一般不会长时间保持这个标签页在前台，很有可能会切换到其他标签页或直接切出浏览器做其他操作，这时如果你回到当前标签页，会触发 <code>visibilitychange</code> 事件，立刻检测更新。所以大多数更新应该是在<code>visibilitychange</code>、<code>focus</code> 事件中命中的，轮询反而是一个辅助兜底的手段。</p><h3 id="轮询对服务器的压力？"><a href="#轮询对服务器的压力？" class="headerlink" title="轮询对服务器的压力？"></a>轮询对服务器的压力？</h3><p>感觉应该问题不大，只是轮询服务器上的一个 <code>json</code> 文件。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">json</span><br><span class="line">复制代码<span class="comment">// version.json</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;f29e8de&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>而且如果用户离开（不关闭）当前标签页时，插件会暂时停止轮询的行为。重新回到页面后，会立刻检查一次并开启轮询。</p><p>你也可以设置 <code>checkInterval: 0</code> 来关闭轮询，只通过 <code>visibilitychange</code>、<code>focus</code> 事件来触发检测。</p><h3 id="是否单独起一个-web-worker-跑检测更新任务"><a href="#是否单独起一个-web-worker-跑检测更新任务" class="headerlink" title="是否单独起一个 web worker 跑检测更新任务"></a>是否单独起一个 <code>web worker</code> 跑检测更新任务</h3><p>看到有类似功能的插件会单独起一个 <code>worker</code> 来运行检测更新任务，为了不影响主线程。</p><p>个人觉得没有太大必要，因为检测更新任务只是简单的 <code>fetch json</code> 文件，然后做下本地与远程的版本对比，应该可以说是毫无压力。反而运行一个 <code>web worker</code> 会占用内存和 <code>cpu</code>。</p><h3 id="插件对打包内容做了哪些变动"><a href="#插件对打包内容做了哪些变动" class="headerlink" title="插件对打包内容做了哪些变动"></a>插件对打包内容做了哪些变动</h3><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5a1a9dabe52143209fe88d10589e5141~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image.png"></p><h3 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h3><p>monorepo 形式组织代码，原理简单，代码也比较简单。</p><p><a href="https://link.juejin.cn/?target=https://github.com/GreatAuk/plugin-web-update-notification/blob/master/packages/core/src/index.ts">core</a>: 主要是如何获取版本号。</p><p><a href="https://link.juejin.cn/?target=https://github.com/GreatAuk/plugin-web-update-notification/blob/master/packages/core/src/injectScript.ts">injectScript</a>: 注入到客户端运行的代码。</p><p><a href="https://link.juejin.cn/?target=https://github.com/GreatAuk/plugin-web-update-notification/blob/master/packages/core/public/webUpdateNoticeInjectStyle.css">injectStyle</a>: 预置的 <code>Notification</code> <code>css</code> 样式。</p><p><a href="https://link.juejin.cn/?target=https://github.com/GreatAuk/plugin-web-update-notification/blob/master/packages/vite-plugin/src/index.ts">vite plugin</a>: vite 插件的实现。</p><p><a href="https://link.juejin.cn/?target=https://github.com/GreatAuk/plugin-web-update-notification/blob/master/packages/webpack-plugin/src/index.ts">webpack plugin</a>: webpack 插件的实现。</p><p><a href="https://link.juejin.cn/?target=https://github.com/GreatAuk/plugin-web-update-notification/blob/master/packages/umi-plugin/src/index.ts">umi plugin</a>: umi 插件的实现。</p><p><a href="https://link.juejin.cn/?target=https://github.com/GreatAuk/plugin-web-update-notification/blob/master/example/vue-vite/tests/e2e/plugin.spec.ts">e2e test</a>: <code>vite</code> 插件的基于 <code>playwright</code> 的 <code>e2e</code> 测试。</p><p>你可以看看一个标准的 <code>js</code> 库是如何通过 <code>tsup</code> 打包，如何配置 <code>pkg</code> 的。</p><p>一个通过 <code>tag</code> 触发，打包 -&gt; release -&gt; 发布 npm 包的 <code>github action</code> workflow 配置。</p><p>一个简单的 <code>vite</code>、<code>webpack</code>、<code>umi</code> 插件怎么能写的。</p><h2 id="为什么不使用-方案"><a href="#为什么不使用-方案" class="headerlink" title="为什么不使用 ** 方案?"></a>为什么不使用 ** 方案?</h2><p><strong>websocket</strong></p><p>需要一个 <code>websocket</code> 服务, 还需要后端配合。</p><p><strong>service worker（pwa）</strong></p><p><em>印像中老版本的 <code>vue-router</code> 文档就是基于 <code>service worker</code> 做的更新通知。</em></p><p>接入 <code>service worker</code> 需要成本，本地运行一个 <code>worker</code> 也会占用内存和 <code>cpu</code> 资源。</p><p>国内并不流行 <code>pwa</code>。</p><p>最主要是的它具有拦截并处理网络请求的能力，如果你不熟悉，很有可能造成强缓存，手动强制刷新页面都无法更新。参考<a href="https://juejin.cn/post/6844903792522035208">谨慎处理 Service Worker 的更新</a>。</p><p>如果非要使用的话， 建议使用 <a href="https://link.juejin.cn/?target=https://github.com/vite-pwa/vite-plugin-pwa">vite-plugin-pwa</a>，插件已经内置了更新提示功能，开发也不用关心如何更新 <code>sw.js</code>。</p><p><strong>对比 <code>html</code> 文件里引入的 <code>js</code> 文件 <code>hash</code> 值</strong></p><p>不支持监听静态资源的更新。</p><p>轮询加载 version.json 应该比加载 index.html 对服务器的压力小些吧。</p><p>如 <code>webpack</code> 打包时给文件路径加 <code>hash</code> 的功能是可以被关闭的。</p><p><strong>检查 index.html <code>Response head</code> 的 <code>Etag</code>、<code>Last-Modified</code> 值</strong></p><p>需要服务端开启缓存。另外, 一些代理服务和负载均衡设备也可能在转发 <code>HTTP</code> 请求和响应时在 <code>Etag</code> 和 <code>Last-Modified</code> 之前去除这些头信息，以减少网络负载和提高性能。</p><p>不支持监听静态资源的更新。</p>]]></content>
      
      
      <categories>
          
          <category> web javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>禁止打开开发者工具</title>
      <link href="/2024/01/11/%E7%A6%81%E6%AD%A2%E6%89%93%E5%BC%80%E5%BC%80%E5%8F%91%E8%80%85%E5%B7%A5%E5%85%B7/"/>
      <url>/2024/01/11/%E7%A6%81%E6%AD%A2%E6%89%93%E5%BC%80%E5%BC%80%E5%8F%91%E8%80%85%E5%B7%A5%E5%85%B7/</url>
      
        <content type="html"><![CDATA[<h2 id="禁用开发者工具的尝试与思考"><a href="#禁用开发者工具的尝试与思考" class="headerlink" title="禁用开发者工具的尝试与思考"></a>禁用开发者工具的尝试与思考</h2><p>​在如今web盛行的时代，确保网页安全是一个至关重要的主题，涉及到用户隐私、数据保护、防范攻击等方面,  我们时常会遇到需要保护代码免受未经授权访问和复制的情况。一些开发者可能尝试通过禁用浏览器开发者工具来实现这一目标。在这篇文章中，我们将介绍一种使用 <code>disable-devtool</code> 库的尝试，并讨论相关的思考。</p><h3 id="为什么要禁用开发者工具？"><a href="#为什么要禁用开发者工具？" class="headerlink" title="为什么要禁用开发者工具？"></a>为什么要禁用开发者工具？</h3><ol><li><strong>代码安全性：</strong> 一些开发者希望通过禁用开发者工具来增强其代码的安全性，防止被未授权的用户查看、修改或复制。</li><li><strong>防止调试：</strong> 有时，开发者可能希望防止用户对其网站进行调试，以保护敏感信息或增加一些控制。</li></ol><h2 id="功能介绍"><a href="#功能介绍" class="headerlink" title="功能介绍"></a><strong>功能介绍</strong></h2><p>npm库名称：<code>disable-devtool</code>，</p><p>github地址：<code>github.com/theajack/disable-devtool</code>。从f12按钮，右键单击和浏览器菜单都可以禁用Web开发工具。</p><blockquote><p>一行代码搞定禁用web开发者工具</p></blockquote><p>该库有以下特性:</p><ul><li>支持可配置是否禁用右键菜单</li><li>禁用 f12 和 ctrl+shift+i 等快捷键</li><li>支持识别从浏览器菜单栏打开开发者工具并关闭当前页面</li><li>开发者可以绕过禁用 (url参数使用tk配合md5加密)</li><li>多种监测模式，支持几乎所有浏览器（IE,360,qq浏览器,FireFox,Chrome,Edge…）</li><li>高度可配置、使用极简、体积小巧</li><li>支持npm引用和script标签引用(属性配置)</li><li>识别真移动端与浏览器开发者工具设置插件伪造的移动端，为移动端节省性能</li><li>支持识别开发者工具关闭事件</li><li>支持可配置是否禁用选择、复制、剪切、粘贴功能</li><li>支持识别 eruda 和 vconsole 调试工具</li><li>支持挂起和恢复探测器工作</li><li>支持配置ignore属性，用以自定义控制是否启用探测器</li><li>支持配置iframe中所有父页面的开发者工具禁用</li></ul><h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a><strong>使用方法</strong></h2><p>使用该库非常简单，只需按照以下步骤进行操作：</p><h3 id="1-1-npm-引用"><a href="#1-1-npm-引用" class="headerlink" title="1.1 npm 引用"></a><strong>1.1 npm 引用</strong></h3><p>推荐使用这种方式安装使用，使用script脚本可以被代理单独拦截掉从而无法执行。</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npm i disable-devtool</span><br><span class="line"></span><br><span class="line">import DisableDevtool from &#x27;disable-devtool&#x27;;</span><br><span class="line"></span><br><span class="line">DisableDevtool(options);</span><br></pre></td></tr></table></figure><h3 id="1-2-script方式使用"><a href="#1-2-script方式使用" class="headerlink" title="1.2 script方式使用"></a><strong>1.2 script方式使用</strong></h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script disable-devtool-auto src=&#x27;https://cdn.jsdelivr.net/npm/disable-devtool&#x27;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>或者通过版本引用:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--使用指定版本--&gt;</span><br><span class="line">&lt;script disable-devtool-auto src=&#x27;https://cdn.jsdelivr.net/npm/disable-devtool@x.x.x&#x27;&gt;&lt;/script&gt;</span><br><span class="line">&lt;!--使用最新版本--&gt;</span><br><span class="line">&lt;script disable-devtool-auto src=&#x27;https://cdn.jsdelivr.net/npm/disable-devtool@latest&#x27;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="1-3-npm-方式-options参数说明"><a href="#1-3-npm-方式-options参数说明" class="headerlink" title="1.3 npm 方式 options参数说明"></a><strong>1.3 npm 方式 options参数说明</strong></h3><p>options中的参数与说明如下，各方面的配置相当完善。</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">interface IConfig &#123;</span><br><span class="line">    md5?: string; // 绕过禁用的md5值，默认不启用绕过禁用</span><br><span class="line">    url?: string; // 关闭页面失败时的跳转页面，默认值为localhost</span><br><span class="line">    tkName?: string; // 绕过禁用时的url参数名称，默认为 ddtk</span><br><span class="line">    ondevtoolopen?(type: DetectorType, next: Function): void; // 开发者面板打开的回调，启用时url参数无效，type 为监测模式， next函数是关闭当前窗口</span><br><span class="line">    ondevtoolclose?(): void; // 开发者面板关闭的回调</span><br><span class="line">    interval?: number; // 定时器的时间间隔 默认200ms</span><br><span class="line">    disableMenu?: boolean; // 是否禁用右键菜单 默认为true</span><br><span class="line">    stopIntervalTime?: number; // 在移动端时取消监视的等待时长</span><br><span class="line">    clearIntervalWhenDevOpenTrigger?: boolean; // 是否在触发之后停止监控 默认为false， 在使用ondevtoolclose时该参数无效</span><br><span class="line">    detectors?: Array&lt;DetectorType&gt;; // 启用的检测器 检测器详情</span><br><span class="line">    clearLog?: boolean; // 是否每次都清除log</span><br><span class="line">    disableSelect?: boolean; // 是否禁用选择文本 默认为false</span><br><span class="line">    disableCopy?: boolean; // 是否禁用复制 默认为false</span><br><span class="line">    disableCut?: boolean; // 是否禁用剪切 默认为false</span><br><span class="line">    disablePaste: boolean; // 是否禁用粘贴 默认为false</span><br><span class="line">    ignore?: (string|RegExp)[] | null | (()=&gt;boolean); // 某些情况忽略禁用</span><br><span class="line">    disableIframeParents?: boolean; // iframe中是否禁用所有父窗口</span><br><span class="line">    timeOutUrl?: // 关闭页面超时跳转的url;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">enum DetectorType &#123;</span><br><span class="line">  Unknown = -1,</span><br><span class="line">  RegToString = 0, // 根据正则检测</span><br><span class="line">  DefineId, // 根据dom id检测</span><br><span class="line">  Size, // 根据窗口尺寸检测</span><br><span class="line">  DateToString, // 根据Date.toString 检测</span><br><span class="line">  FuncToString, // 根据Function.toString 检测</span><br><span class="line">  Debugger, // 根据断点检测，仅在ios chrome 真机情况下有效</span><br><span class="line">  Performance, // 根据log大数据性能检测</span><br><span class="line">  DebugLib, // 检测第三方调试工具 eruda 和 vconsole   </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="1-4-script-方式使用属性配置"><a href="#1-4-script-方式使用属性配置" class="headerlink" title="1.4 script 方式使用属性配置"></a><strong>1.4 script 方式使用属性配置</strong></h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;script </span><br><span class="line">    disable-devtool-auto</span><br><span class="line">    src=&#x27;https://cdn.jsdelivr.net/npm/disable-devtool&#x27;</span><br><span class="line">    md5=&#x27;xxx&#x27;</span><br><span class="line">    url=&#x27;xxx&#x27;</span><br><span class="line">    tk-name=&#x27;xxx&#x27;</span><br><span class="line">    interval=&#x27;xxx&#x27;</span><br><span class="line">    disable-menu=&#x27;xxx&#x27;</span><br><span class="line">    detectors=&#x27;xxx&#x27;</span><br><span class="line">    clear-log=&#x27;true&#x27;</span><br><span class="line">    disable-select=&#x27;true&#x27;</span><br><span class="line">    disable-copy=&#x27;true&#x27;</span><br><span class="line">    disable-cut=&#x27;true&#x27;</span><br><span class="line">    disable-paste=&#x27;true&#x27;</span><br><span class="line">&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="1-5-事件监听"><a href="#1-5-事件监听" class="headerlink" title="1.5 事件监听"></a><strong>1.5 事件监听</strong></h3><p>ondevtoolopen 事件的回调参数就是被触发的监测模式。可以在 ondevtoolopen 里执行业务逻辑，比如做数据上报、用户行为分析等。</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">DisableDevtool(&#123;</span><br><span class="line">    ondevtoolopen(type, next)&#123;</span><br><span class="line">        alert(&#x27;Devtool opened with type:&#x27; + type);</span><br><span class="line">        next();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="1-6-md5-与-tk-绕过禁用"><a href="#1-6-md5-与-tk-绕过禁用" class="headerlink" title="1.6 md5 与 tk 绕过禁用"></a><strong>1.6 md5 与 tk 绕过禁用</strong></h3><p>该库中使用 key 与 md5 配合的方式使得开发者可以在线上绕过禁用。</p><p>流程如下：</p><p>先指定一个 key a（该值不要记录在代码中），使用 md5 加密得到一个值 b，将b作为 md5 参数传入，开发者在访问 url 的时候只需要带上url参数 ddtk&#x3D;a，便可以绕过禁用。</p><p>disableDevtool对象暴露了 md5 方法，可供开发者加密时使用：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DisableDevtool.md5(&#x27;xxx&#x27;);</span><br></pre></td></tr></table></figure><p>更多细节可查阅官方文档，中文文档地址：<code>https://github.com/theajack/disable-devtool/blob/master/README.cn.md</code></p><h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a><strong>最后</strong></h2><p>尽管该库可以有效地禁用浏览器的开发者工具面板，但仍然需要注意以下几点：</p><ul><li>该库只能禁用开发者工具的面板，无法阻止用户通过其他途径访问网页源码。因此，建议结合其他安全措施来保护网站。</li><li>禁用开发者工具可能会对网站的调试和维护造成一定的困扰。需要调试线上代码的时候可以使用上述1.6绕过禁用进行调试。</li><li>该库仅适用于现代浏览器，对于一些较旧的浏览器可能存在兼容性问题。在使用前请确保测试过兼容性。</li></ul><p>为了进一步加强网页源码的安全性，我们可以采取以下额外措施：</p><ul><li><strong>加密敏感代码</strong>，使用加密算法对关键代码进行加密，以防止非授权访问和修改。</li><li><strong>使用服务器端渲染</strong>，将网页的渲染过程放在服务器端，只返回最终渲染结果给客户端，隐藏源代码和逻辑。</li><li><strong>定期更新代码</strong>，定期更新代码库以充分利用新的安全特性和修复已知漏洞。</li></ul><p>保护网页源码的安全性对于Web开发至关重要。通过使用npm库<code>disable-devtool</code>，并结合其他安全措施，我们可以有效地降低用户访问和修改源代码的风险。但是绝对的安全是不存在的，因此定期更新和加强安全性措施也是必要的。</p>]]></content>
      
      
      <categories>
          
          <category> javascript vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web html </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>基于vite ts 封装 axios</title>
      <link href="/2022/12/05/%E5%9F%BA%E4%BA%8Evite-ts-%E5%B0%81%E8%A3%85-axios/"/>
      <url>/2022/12/05/%E5%9F%BA%E4%BA%8Evite-ts-%E5%B0%81%E8%A3%85-axios/</url>
      
        <content type="html"><![CDATA[<h2 id="封装request和config请求信息抽离处理"><a href="#封装request和config请求信息抽离处理" class="headerlink" title="封装request和config请求信息抽离处理"></a>封装request和config请求信息抽离处理</h2><ol><li>先安装axios，毕竟请求是基于axios的。</li></ol><p><code>npm</code>: npm install axios</p><p><code>yarn</code>: yarn add axios</p><img src="/2022/12/05/%E5%9F%BA%E4%BA%8Evite-ts-%E5%B0%81%E8%A3%85-axios/c7000378213249ee9d17a9806d50f8cb~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp" class="" title="image"><ol start="2"><li>在src的同级目录下，创建shims-axios.d.ts。用于做axios的ts声明</li></ol><img src="/2022/12/05/%E5%9F%BA%E4%BA%8Evite-ts-%E5%B0%81%E8%A3%85-axios/88a8c090b2034f6880c215958179d32d~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp" class="" title="image"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">import &#123; AxiosInstance, AxiosRequestConfig, AxiosPromise &#125; from &quot;axios&quot;</span><br><span class="line"></span><br><span class="line">declare module &quot;axios&quot; &#123;</span><br><span class="line">  export interface AxiosRequestConfig &#123;</span><br><span class="line">    /**</span><br><span class="line">     * @description 设置为true，则会在请求过程中显示loading动画，直到请求结束才消失</span><br><span class="line">     */</span><br><span class="line">    loading?: boolean</span><br><span class="line">    isDialog?: boolean</span><br><span class="line">  &#125;</span><br><span class="line">  export interface AxiosInstance &#123;</span><br><span class="line">    &lt;T = any&gt;(config: AxiosRequestConfig): Promise&lt;T&gt;</span><br><span class="line">    request&lt;T = any&gt;(config: AxiosRequestConfig): Promise&lt;T&gt;</span><br><span class="line">    get&lt;T = any&gt;(url: string, config?: AxiosRequestConfig): Promise&lt;T&gt;</span><br><span class="line">    delete&lt;T = any&gt;(url: string, config?: AxiosRequestConfig): Promise&lt;T&gt;</span><br><span class="line">    head&lt;T = any&gt;(url: string, config?: AxiosRequestConfig): Promise&lt;T&gt;</span><br><span class="line">    post&lt;T = any&gt;(</span><br><span class="line">      url: string,</span><br><span class="line">      data?: any,</span><br><span class="line">      config?: AxiosRequestConfig</span><br><span class="line">    ): Promise&lt;T&gt;</span><br><span class="line">    put&lt;T = any&gt;(</span><br><span class="line">      url: string,</span><br><span class="line">      data?: any,</span><br><span class="line">      config?: AxiosRequestConfig</span><br><span class="line">    ): Promise&lt;T&gt;</span><br><span class="line">    patch&lt;T = any&gt;(</span><br><span class="line">      url: string,</span><br><span class="line">      data?: any,</span><br><span class="line">      config?: AxiosRequestConfig</span><br><span class="line">    ): Promise&lt;T&gt;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li><p>在<code>src文件夹</code>下，创建<code>utils文件夹</code>，放封装文件<code>request.js</code></p><p>&#96;&#96;</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @description [ axios 请求封装]</span><br><span class="line"> */</span><br><span class="line">// import store from &quot;@/store&quot;;</span><br><span class="line">import axios, &#123; AxiosResponse, AxiosRequestConfig &#125; from &quot;axios&quot;;</span><br><span class="line">// import &#123; Message, Modal &#125; from &#x27;view-design&#x27; // UI组件库</span><br><span class="line">import &#123; Dialog, Toast &#125; from &quot;vant&quot;;</span><br><span class="line">import router from &quot;@/router&quot;;</span><br><span class="line">// 根据环境不同引入不同api地址</span><br><span class="line">import &#123; config &#125; from &quot;@/config&quot;;</span><br><span class="line">const service = axios.create(&#123;</span><br><span class="line">  baseURL: config.baseApi + &quot;/api&quot;, // url = base url + request url</span><br><span class="line">  timeout: 5000,</span><br><span class="line">  withCredentials: false // send cookies when cross-domain requests</span><br><span class="line">  // headers: &#123;</span><br><span class="line">  //    // clear cors</span><br><span class="line">  //    &#x27;Cache-Control&#x27;: &#x27;no-cache&#x27;,</span><br><span class="line">  //    Pragma: &#x27;no-cache&#x27;</span><br><span class="line">  // &#125;</span><br><span class="line">&#125;)</span><br><span class="line">// Request interceptors</span><br><span class="line">service.interceptors.request.use(</span><br><span class="line">  (config: AxiosRequestConfig) =&gt; &#123;</span><br><span class="line">    // 加载动画</span><br><span class="line">    if (config.loading) &#123;</span><br><span class="line">      Toast.loading(&#123;</span><br><span class="line">        message: &quot;加载中...&quot;,</span><br><span class="line">        forbidClick: true</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    // 在此处添加请求头等，如添加 token</span><br><span class="line">    // if (store.state.token) &#123;</span><br><span class="line">    // config.headers[&#x27;Authorization&#x27;] = `Bearer $&#123;store.state.token&#125;`</span><br><span class="line">    // &#125;</span><br><span class="line">    return config;</span><br><span class="line">  &#125;,</span><br><span class="line">  (error: any) =&gt; &#123;</span><br><span class="line">    Promise.reject(error);</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line">// Response interceptors</span><br><span class="line">service.interceptors.response.use(</span><br><span class="line">  async (response: AxiosResponse) =&gt; &#123;</span><br><span class="line">    // await new Promise(resovle =&gt; setTimeout(resovle, 3000))</span><br><span class="line">    Toast.clear();</span><br><span class="line">    const res = response.data;</span><br><span class="line">    if (res.code !== 0) &#123;</span><br><span class="line">      // token 过期</span><br><span class="line">      if (res.code === 401)</span><br><span class="line">        // 警告提示窗</span><br><span class="line">        return;</span><br><span class="line">      if (res.code == 403) &#123;</span><br><span class="line">        Dialog.alert(&#123;</span><br><span class="line">          title: &quot;警告&quot;,</span><br><span class="line">          message: res.msg</span><br><span class="line">        &#125;).then(() =&gt; &#123;&#125;)</span><br><span class="line">        return</span><br><span class="line">      &#125;</span><br><span class="line">      // 若后台返回错误值，此处返回对应错误对象，下面 error 就会接收</span><br><span class="line">      return Promise.reject(new Error(res.msg || &quot;Error&quot;))</span><br><span class="line">    &#125;</span><br><span class="line">    // 注意返回值</span><br><span class="line">    else return response.data</span><br><span class="line">  &#125;,</span><br><span class="line">  (error: any) =&gt; &#123;</span><br><span class="line">    Toast.clear();</span><br><span class="line">    if (error &amp;&amp; error.response) &#123;</span><br><span class="line">      switch (error.response.status) &#123;</span><br><span class="line">        case 400:</span><br><span class="line">          error.message = &quot;请求错误(400)&quot;</span><br><span class="line">          break</span><br><span class="line">        case 401:</span><br><span class="line">          error.message = &quot;未授权,请登录(401)&quot;</span><br><span class="line">          break</span><br><span class="line">        case 403:</span><br><span class="line">          error.message = &quot;拒绝访问(403)&quot;</span><br><span class="line">          break</span><br><span class="line">        case 404:</span><br><span class="line">          error.message = `请求地址出错: $&#123;error.response.config.url&#125;`</span><br><span class="line">          break</span><br><span class="line">        case 405:</span><br><span class="line">          error.message = &quot;请求方法未允许(405)&quot;</span><br><span class="line">          break</span><br><span class="line">        case 408:</span><br><span class="line">          error.message = &quot;请求超时(408)&quot;</span><br><span class="line">          break</span><br><span class="line">        case 500:</span><br><span class="line">          error.message = &quot;服务器内部错误(500)&quot;</span><br><span class="line">          break</span><br><span class="line">        case 501:</span><br><span class="line">          error.message = &quot;服务未实现(501)&quot;</span><br><span class="line">          break</span><br><span class="line">        case 502:</span><br><span class="line">          error.message = &quot;网络错误(502)&quot;</span><br><span class="line">          break</span><br><span class="line">        case 503:</span><br><span class="line">          error.message = &quot;服务不可用(503)&quot;</span><br><span class="line">          break</span><br><span class="line">        case 504:</span><br><span class="line">          error.message = &quot;网络超时(504)&quot;</span><br><span class="line">          break</span><br><span class="line">        case 505:</span><br><span class="line">          error.message = &quot;HTTP版本不受支持(505)&quot;</span><br><span class="line">          break</span><br><span class="line">        default:</span><br><span class="line">          error.message = `连接错误: $&#123;error.message&#125;`</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      if (error.message == &quot;Network Error&quot;) error.message == &quot;网络异常，请检查后重试！&quot;</span><br><span class="line">      error.message = &quot;连接到服务器失败，请联系管理员&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    Toast(error.message)</span><br><span class="line">    return Promise.reject(error)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line">export default service</span><br></pre></td></tr></table></figure><ol><li>在<code>src文件夹</code>下面，创建<code>config文件夹</code>，放<code>index.ts</code></li></ol><p>&#96;&#96;</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">export interface IConfig &#123;</span><br><span class="line">    env: string // 开发环境</span><br><span class="line">    mock?: boolean // mock数据</span><br><span class="line">    title: string // 项目title</span><br><span class="line">    baseUrl?: string // 项目地址</span><br><span class="line">    baseApi?: string // api请求地址</span><br><span class="line">    APPID?: string // 公众号appId  一般放在服务器端</span><br><span class="line">    APPSECRET?: string // 公众号appScript 一般放在服务器端</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const dev: IConfig = &#123;</span><br><span class="line">    env: &quot;development&quot;,</span><br><span class="line">    mock: false,</span><br><span class="line">    title: &quot;开发&quot;,</span><br><span class="line">    baseUrl: &quot;http://localhost:8001&quot;, // 项目地址</span><br><span class="line">    baseApi: &quot;https://baidu.com/api&quot;, // 本地api请求地址,注意：如果你使用了代理，请设置成&#x27;/&#x27;</span><br><span class="line">    APPID: &quot;wx123456778890&quot;,</span><br><span class="line">    APPSECRET: &quot;xxx&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const prod: IConfig = &#123;</span><br><span class="line">    env: &quot;production&quot;,</span><br><span class="line">    mock: false,</span><br><span class="line">    title: &quot;生产&quot;,</span><br><span class="line">    baseUrl: &quot;https://www.xxx.com/&quot;, // 正式项目地址</span><br><span class="line">    baseApi: &quot;https://www.baidu.com/api&quot;, // 正式api请求地址</span><br><span class="line">    APPID: &quot;wx1234567890&quot;,</span><br><span class="line">    APPSECRET: &quot;xxx&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export const config: IConfig = import.meta.env.MODE == &#x27;development&#x27; ? dev : prod</span><br></pre></td></tr></table></figure><ol><li>配置<code>.env.development</code>和<code>.env.production</code>文件</li></ol><p>在根目录下，创建<code>.env.development</code>和<code>.env.production</code>文件</p><h3 id="env-development"><a href="#env-development" class="headerlink" title=".env.development"></a>.env.development</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">NODE_ENV=&#x27;development&#x27;</span><br><span class="line"># must start with VUE_APP_ </span><br><span class="line"></span><br><span class="line">VUE_APP_ENV = &#x27;development&#x27;</span><br><span class="line"></span><br><span class="line">OUTPUT_DIR = &#x27;test&#x27;</span><br></pre></td></tr></table></figure><h3 id="env-production"><a href="#env-production" class="headerlink" title=".env.production"></a>.env.production</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">NODE_ENV=&#x27;production&#x27;</span><br><span class="line"># must start with VUE_APP_</span><br><span class="line"></span><br><span class="line">VUE_APP_ENV = &#x27;production&#x27;</span><br><span class="line"></span><br><span class="line">OUTPUT_DIR = &#x27;dist&#x27;</span><br></pre></td></tr></table></figure><ol><li>配置<code>package.json</code>文件</li></ol><p>在scripts里面，修改成…</p><p>根据不一样的命令，走不同的config接口</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;dev&quot;: &quot;vite&quot;,</span><br><span class="line">    &quot;build&quot;: &quot;vue-tsc --noEmit &amp;&amp; vite build&quot;,</span><br><span class="line">    &quot;prod&quot;: &quot;cross-env NODE_ENV=dev vue-cli-service serve --mode production&quot;,</span><br><span class="line">    &quot;lint&quot;: &quot;vue-cli-service lint --mode development&quot;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><blockquote><p>至此 request的封装和config请求信息抽离已经完成</p><p>dev环境和prod环境也已经处理完成</p></blockquote><h2 id="封装storage文件"><a href="#封装storage文件" class="headerlink" title="封装storage文件"></a>封装storage文件</h2><p>在<code>utils</code>里面创建<code>storage.ts文件</code>, 放置storage文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 封装操作localstorage本地存储的方法</span><br><span class="line"> */</span><br><span class="line">export const storage = &#123;</span><br><span class="line">  //存储</span><br><span class="line">  set(key: string, value: any) &#123;</span><br><span class="line">    localStorage.setItem(key, JSON.stringify(value))</span><br><span class="line">  &#125;,</span><br><span class="line">  //取出数据</span><br><span class="line">  get&lt;T&gt;(key: string) &#123;</span><br><span class="line">    const value = localStorage.getItem(key)</span><br><span class="line">    if (value &amp;&amp; value != &quot;undefined&quot; &amp;&amp; value != &quot;null&quot;) &#123;</span><br><span class="line">      return &lt;T&gt;JSON.parse(value)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  // 删除数据</span><br><span class="line">  remove(key: string) &#123;</span><br><span class="line">    localStorage.removeItem(key)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">/**</span><br><span class="line"> * 封装操作sessionStorage本地存储的方法</span><br><span class="line"> */</span><br><span class="line">export const sessionStorage = &#123;</span><br><span class="line">  //存储</span><br><span class="line">  set(key: string, value: any) &#123;</span><br><span class="line">    window.sessionStorage.setItem(key, JSON.stringify(value))</span><br><span class="line">  &#125;,</span><br><span class="line">  //取出数据</span><br><span class="line">  get&lt;T&gt;(key: string) &#123;</span><br><span class="line">    const value = window.sessionStorage.getItem(key)</span><br><span class="line">    if (value &amp;&amp; value != &quot;undefined&quot; &amp;&amp; value != &quot;null&quot;) &#123;</span><br><span class="line">      return JSON.parse(value)</span><br><span class="line">    &#125;</span><br><span class="line">    return null</span><br><span class="line">  &#125;,</span><br><span class="line">  // 删除数据</span><br><span class="line">  remove(key: string) &#123;</span><br><span class="line">    window.sessionStorage.removeItem(key)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> axios 网络请求 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vite typescript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>10分钟教你如何拥有属于自己的马赛克萌妹</title>
      <link href="/2022/10/11/10%E5%88%86%E9%92%9F%E6%95%99%E4%BD%A0%E5%A6%82%E4%BD%95%E6%8B%A5%E6%9C%89%E5%B1%9E%E4%BA%8E%E8%87%AA%E5%B7%B1%E7%9A%84%E9%A9%AC%E8%B5%9B%E5%85%8B%E8%90%8C%E5%A6%B9/"/>
      <url>/2022/10/11/10%E5%88%86%E9%92%9F%E6%95%99%E4%BD%A0%E5%A6%82%E4%BD%95%E6%8B%A5%E6%9C%89%E5%B1%9E%E4%BA%8E%E8%87%AA%E5%B7%B1%E7%9A%84%E9%A9%AC%E8%B5%9B%E5%85%8B%E8%90%8C%E5%A6%B9/</url>
      
        <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>这么可爱的萌妹子不想拥有一个吗。学起来，自定义一个抱回家</p><h1 id="一、前期准备"><a href="#一、前期准备" class="headerlink" title="一、前期准备"></a>一、前期准备</h1><p>初始化HTML，利用通配符 <code>*</code> 去除默认样式</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;divport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    *,*<span class="selector-pseudo">::before</span>,*<span class="selector-pseudo">::after</span>&#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">box-sizing</span>: border-box;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> &gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="二、正文开始"><a href="#二、正文开始" class="headerlink" title="二、正文开始"></a>二、正文开始</h1><p>先讲一下实现思路：</p><ol><li>通过图片上传获取到图片文件，并生成图片地址</li><li>通过监听图片加载完成事件，将图片画在 <code>canvas1</code> 上</li><li>获取 canvas1 上的像素点数据，通过压缩，计算灰度，定位等操作，在 <code>canvas2</code> 上画出对应的点</li></ol><h2 id="2-1-图片上传"><a href="#2-1-图片上传" class="headerlink" title="2.1 图片上传"></a>2.1 图片上传</h2><ol><li>我们使用 <code>input</code> 来上传图片，通过 <code>onchange</code> 获取到图片的 file 文件。</li><li>使用 <code>createObjectURL</code> 生成图片地址</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;divport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    *,*<span class="selector-pseudo">::before</span>,*<span class="selector-pseudo">::after</span>&#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">box-sizing</span>: border-box;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span>  <span class="attr">accept</span>=<span class="string">&quot;image/*&quot;</span> <span class="attr">onChange</span>=<span class="string">&quot;uploadImage(this)&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;image&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> &gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> image = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;image&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 图片上传事件</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">function</span> <span class="title function_">uploadImage</span>(<span class="params">obj</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 转换格式</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> newSrc = <span class="title function_">getObjectURL</span>(obj.<span class="property">files</span>[<span class="number">0</span>]);</span></span><br><span class="line"><span class="language-javascript">    testImage.<span class="property">src</span> = newSrc;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 生成file文件的临时路径</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">function</span> <span class="title function_">getObjectURL</span>(<span class="params">file</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> url = <span class="literal">null</span> ;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 下面函数执行的效果是一样的，只是需要针对不同的浏览器执行不同的 js 函数而已</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">createObjectURL</span>!=<span class="literal">undefined</span>) &#123; <span class="comment">// basic</span></span></span><br><span class="line"><span class="language-javascript">        url = <span class="variable language_">window</span>.<span class="title function_">createObjectURL</span>(file) ;</span></span><br><span class="line"><span class="language-javascript">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">URL</span>!=<span class="literal">undefined</span>) &#123; <span class="comment">// mozilla(firefox)</span></span></span><br><span class="line"><span class="language-javascript">        url = <span class="variable language_">window</span>.<span class="property">URL</span>.<span class="title function_">createObjectURL</span>(file) ;</span></span><br><span class="line"><span class="language-javascript">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">webkitURL</span>!=<span class="literal">undefined</span>) &#123; <span class="comment">// webkit or chrome</span></span></span><br><span class="line"><span class="language-javascript">        url = <span class="variable language_">window</span>.<span class="property">webkitURL</span>.<span class="title function_">createObjectURL</span>(file) ;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> url ;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="2-2-画-canvas1"><a href="#2-2-画-canvas1" class="headerlink" title="2.2 画 canvas1"></a>2.2 画 canvas1</h2><ol><li>监听图片的 <code>onload</code> 事件</li><li>使用 <code>canvas</code>  的 <code>drawImage</code>方法将图片画在 <code>canvas1</code> 上</li><li>通过 <code>canvas</code>  的 <code>getImageData</code>方法获取 <code>canvas1</code> 的像素点数据</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;divport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    *,*<span class="selector-pseudo">::before</span>,*<span class="selector-pseudo">::after</span>&#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">box-sizing</span>: border-box;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span>  <span class="attr">accept</span>=<span class="string">&quot;image/*&quot;</span> <span class="attr">onChange</span>=<span class="string">&quot;uploadImage(this)&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;image&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">&quot;canvas1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> &gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> image = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;image&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> canvas1 = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas1&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">  </span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// ...  上一步操作的代码与当前步骤无关，先隐藏</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 监听图片加载完成事件</span></span></span><br><span class="line"><span class="language-javascript">  image.<span class="property">onload</span> = <span class="function">()=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> ctx1 = canvas1.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> &#123; width, height &#125; = image</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    canvas1.<span class="property">width</span> = width</span></span><br><span class="line"><span class="language-javascript">    canvas1.<span class="property">height</span> = height</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 1. 将图片画在画布 1 中</span></span></span><br><span class="line"><span class="language-javascript">    ctx1.<span class="title function_">drawImage</span>(image,<span class="number">0</span>, <span class="number">0</span>, width,height )</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 2. 获取canvas1的图片像素点数据</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> imageData = ctx1.<span class="title function_">getImageData</span>( <span class="number">0</span>, <span class="number">0</span>, width, height).<span class="property">data</span></span></span><br><span class="line"><span class="language-javascript">     </span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="2-3-画-canvas2"><a href="#2-3-画-canvas2" class="headerlink" title="2.3 画 canvas2"></a>2.3 画 canvas2</h2><p>在获取到 <code>canvas1</code> 的像素点数据后，通过压缩，计算灰度，定位，再画在 <code>canvas2</code> 上。先上代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// html</span></span><br><span class="line"> &lt;div id=<span class="string">&quot;app&quot;</span>&gt;</span><br><span class="line">   <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span>  <span class="attr">accept</span>=<span class="string">&quot;image/*&quot;</span> <span class="attr">onChange</span>=<span class="string">&quot;uploadImage(this)&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">   <span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;image&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">   <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">&quot;canvas1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">   <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">&quot;canvas2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// js</span></span><br><span class="line"> <span class="keyword">const</span> image = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;image&#x27;</span>)</span><br><span class="line"> <span class="keyword">const</span> canvas1 = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas1&#x27;</span>)</span><br><span class="line"> <span class="keyword">const</span> canvas2 = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 监听图片加载完成事件</span></span><br><span class="line">  image.<span class="property">onload</span> = <span class="function">()=&gt;</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> ctx1 = canvas1.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> ctx2 = canvas2.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 计算尺寸</span></span><br><span class="line">    <span class="keyword">const</span> &#123; width, height &#125; = image</span><br><span class="line"></span><br><span class="line">    canvas1.<span class="property">width</span> = width</span><br><span class="line">    canvas1.<span class="property">height</span> = height</span><br><span class="line"></span><br><span class="line">    canvas2.<span class="property">width</span> = width</span><br><span class="line">    canvas2.<span class="property">height</span> = height</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 将图片画在画布 1 中</span></span><br><span class="line">    ctx1.<span class="title function_">drawImage</span>(image, <span class="number">0</span>, <span class="number">0</span>, width, height)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 获取canvas1的图片像素点数据</span></span><br><span class="line">    <span class="keyword">const</span> imageData = ctx1.<span class="title function_">getImageData</span>( <span class="number">0</span>, <span class="number">0</span>, width, height).<span class="property">data</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 根据 canvas1 的像素数据  在 canvas2 上画点</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; imageData.<span class="property">length</span>; i += <span class="number">4</span>)&#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 计算当前像素点的 x,y（第 x 列 ，第 y 行 ）</span></span><br><span class="line">      <span class="keyword">const</span> x = <span class="built_in">parseInt</span>(i % (width * <span class="number">4</span>) / <span class="number">4</span>)</span><br><span class="line">      <span class="keyword">const</span> y = <span class="built_in">parseInt</span>(i / (width * <span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 像素点压缩倍数</span></span><br><span class="line">      <span class="keyword">const</span> bl = <span class="number">6</span> </span><br><span class="line"></span><br><span class="line">      <span class="comment">//  压缩像素点  =&gt; 判断当前 x, y 与 压缩倍数的余数是否都为 0 </span></span><br><span class="line">      <span class="keyword">if</span>(x % bl === <span class="number">0</span> &amp;&amp; y % bl === <span class="number">0</span> )&#123;</span><br><span class="line">      </span><br><span class="line">        <span class="comment">// 计算灰度</span></span><br><span class="line">        <span class="keyword">const</span> [r, g, b, a] = [imageData[i], imageData[i + <span class="number">1</span>], imageData[i + <span class="number">2</span>], imageData[i + <span class="number">3</span>]]</span><br><span class="line">        <span class="keyword">const</span> gray = (r + g + b) / <span class="number">3</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 填充文字</span></span><br><span class="line">        ctx2.<span class="property">font</span> = <span class="string">&#x27;12px&#x27;</span></span><br><span class="line">        ctx2.<span class="property">fillStyle</span> = <span class="string">`rgba(<span class="subst">$&#123;gray&#125;</span>,<span class="subst">$&#123;gray&#125;</span>,<span class="subst">$&#123;gray&#125;</span>,<span class="subst">$&#123;a&#125;</span>)`</span></span><br><span class="line">        ctx2.<span class="title function_">fillText</span>(<span class="string">&#x27;a&#x27;</span>, x, y)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h3 id="2-3-1-压缩"><a href="#2-3-1-压缩" class="headerlink" title="2.3.1 压缩"></a>2.3.1 压缩</h3><ol><li>为啥要压缩？ <img src="/2022/10/11/10%E5%88%86%E9%92%9F%E6%95%99%E4%BD%A0%E5%A6%82%E4%BD%95%E6%8B%A5%E6%9C%89%E5%B1%9E%E4%BA%8E%E8%87%AA%E5%B7%B1%E7%9A%84%E9%A9%AC%E8%B5%9B%E5%85%8B%E8%90%8C%E5%A6%B9/02ad8469eeff4a949944fa6b5b6d1b1e~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" class="" title="Snipaste_2022-10-09_11-48-12.png"> 如图所示，右边是我们要现实的最终效果，是可以清晰看出图片是由深浅不一的字母 a 组成的（如果觉得不够直观，图片右击，在新标签页中打开图片）。不进行压缩的话，即每个像素点都使用 a 来展示的话，字母 a 会因为太小而无法直观看出，如图左边部分效果。</li><li>如何压缩？ <img src="/2022/10/11/10%E5%88%86%E9%92%9F%E6%95%99%E4%BD%A0%E5%A6%82%E4%BD%95%E6%8B%A5%E6%9C%89%E5%B1%9E%E4%BA%8E%E8%87%AA%E5%B7%B1%E7%9A%84%E9%A9%AC%E8%B5%9B%E5%85%8B%E8%90%8C%E5%A6%B9/ec7d7615163b4e40a9e29c48aaa3bfa7~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" class="" title="Snipaste_2022-10-09_13-30-17.png"> 如图所示，假设红色框为一整张图片，每一个小灰格子为一个像素点，蓝色格子为四个像素点组成的。我们将蓝色格子的左上角的像素点的颜色作为这个蓝色格子颜色，这样我们就把四个像素点压缩成一个。</li></ol><h3 id="2-3-2-计算灰度"><a href="#2-3-2-计算灰度" class="headerlink" title="2.3.2 计算灰度"></a>2.3.2 计算灰度</h3><ol><li>计算灰度前，我们先认识一下通过 <code>canvas</code> 的 <code>getImageData</code> 获取到的像素点数据。</li></ol><img src="/2022/10/11/10%E5%88%86%E9%92%9F%E6%95%99%E4%BD%A0%E5%A6%82%E4%BD%95%E6%8B%A5%E6%9C%89%E5%B1%9E%E4%BA%8E%E8%87%AA%E5%B7%B1%E7%9A%84%E9%A9%AC%E8%B5%9B%E5%85%8B%E8%90%8C%E5%A6%B9/c844086825c742c8a6222c506ad2dc1e~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" class="" title="Snipaste_2022-10-09_13-48-21.png"> `imageData` 为像素点颜色的RGBA色值数组构成，即[R,G,B,A,R,G,B,A,R,G,B,A]。数组每四个值代表一个像素点的颜色。<p> \2. 计算灰度<br> 一个像素点的灰度值即为 <code>gray=(R+G+B)/3</code>。该像素点的灰度色值即为<code>rgba(gray,gray,gray,A)</code></p><h3 id="2-3-3-定位"><a href="#2-3-3-定位" class="headerlink" title="2.3.3 定位"></a>2.3.3 定位</h3><p>在认识像素点数据的构成后，我们得知所有像素点的色值都放在同一个数据里，这样无法判断像素点在图片上的位置，因此需要通过计算来定位。</p><ol><li>计算每个像素点的位置 (x , y)<br> <code>width</code> 为一整行的像素点的个数。因为一个像素点由四个色值组成，所以一整行所占的数组长度为<code>width*4</code>。</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 其中 width, height 为 canvas1 的宽高</span></span><br><span class="line"><span class="keyword">const</span> imageData = ctx1.<span class="title function_">getImageData</span>( <span class="number">0</span>, <span class="number">0</span>, width, height).<span class="property">data</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 计算当前像素点的 x,y（第 x 列 ，第 y 行 ）</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; imageData.<span class="property">length</span>; i += <span class="number">4</span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> x = <span class="built_in">parseInt</span>(i % (width * <span class="number">4</span>) / <span class="number">4</span>)</span><br><span class="line">  <span class="keyword">const</span> y = <span class="built_in">parseInt</span>(i / (width * <span class="number">4</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>根据前面压缩的算法，以左上角第一个像素点的颜色计算压缩后的颜色和位置</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 其中 width, height 为 canvas1 的宽高</span></span><br><span class="line"><span class="keyword">const</span> imageData = ctx1.<span class="title function_">getImageData</span>( <span class="number">0</span>, <span class="number">0</span>, width, height).<span class="property">data</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 像素点压缩倍数</span></span><br><span class="line"><span class="keyword">const</span> bl = <span class="number">6</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">// 计算当前像素点的 x,y（第 x 列 ，第 y 行 ）</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; imageData.<span class="property">length</span>; i += <span class="number">4</span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> x = <span class="built_in">parseInt</span>(i % (width * <span class="number">4</span>) / <span class="number">4</span>)</span><br><span class="line">  <span class="keyword">const</span> y = <span class="built_in">parseInt</span>(i / (width * <span class="number">4</span>))</span><br><span class="line">  </span><br><span class="line">     <span class="keyword">if</span>(x % bl === <span class="number">0</span> &amp;&amp; y % bl === <span class="number">0</span> )&#123;</span><br><span class="line">       <span class="comment">// 此时，当前像素点即为压缩后左上角的像素点</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-3-4-在canvas2上画点"><a href="#2-3-4-在canvas2上画点" class="headerlink" title="2.3.4 在canvas2上画点"></a>2.3.4 在canvas2上画点</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 填充文字</span></span><br><span class="line">  ctx2.<span class="property">font</span> = <span class="string">&#x27;12px&#x27;</span></span><br><span class="line">  ctx2.<span class="property">fillStyle</span> = <span class="string">`rgba(<span class="subst">$&#123;gray&#125;</span>,<span class="subst">$&#123;gray&#125;</span>,<span class="subst">$&#123;gray&#125;</span>,<span class="subst">$&#123;a&#125;</span>)`</span> <span class="comment">// gray为计算出来的灰度值，a为像素点的透明度</span></span><br><span class="line">  ctx2.<span class="title function_">fillText</span>(<span class="string">&#x27;a&#x27;</span>, x, y) <span class="comment">// x,y为计算出来的定位。‘a’为填充的字母，可为任意值</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h1 id="三、完整代码"><a href="#三、完整代码" class="headerlink" title="三、完整代码"></a>三、完整代码</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;divport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    *,*<span class="selector-pseudo">::before</span>,*<span class="selector-pseudo">::after</span>&#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">box-sizing</span>: border-box;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span>  <span class="attr">accept</span>=<span class="string">&quot;image/*&quot;</span> <span class="attr">onChange</span>=<span class="string">&quot;uploadImage(this)&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;image&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">&quot;canvas1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">&quot;canvas2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> &gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> image = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;image&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> canvas1 = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas1&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> canvas2 = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas2&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 点击上传图片</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">function</span> <span class="title function_">uploadImage</span>(<span class="params">obj</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 转换格式</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> newSrc = <span class="title function_">getObjectURL</span>(obj.<span class="property">files</span>[<span class="number">0</span>]);</span></span><br><span class="line"><span class="language-javascript">    image.<span class="property">src</span> = newSrc;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 生成file文件的临时路径</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">function</span> <span class="title function_">getObjectURL</span>(<span class="params">file</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> url = <span class="literal">null</span> ;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 下面函数执行的效果是一样的，只是需要针对不同的浏览器执行不同的 js 函数而已</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">createObjectURL</span>!=<span class="literal">undefined</span>) &#123; <span class="comment">// basic</span></span></span><br><span class="line"><span class="language-javascript">        url = <span class="variable language_">window</span>.<span class="title function_">createObjectURL</span>(file) ;</span></span><br><span class="line"><span class="language-javascript">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">URL</span>!=<span class="literal">undefined</span>) &#123; <span class="comment">// mozilla(firefox)</span></span></span><br><span class="line"><span class="language-javascript">        url = <span class="variable language_">window</span>.<span class="property">URL</span>.<span class="title function_">createObjectURL</span>(file) ;</span></span><br><span class="line"><span class="language-javascript">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">webkitURL</span>!=<span class="literal">undefined</span>) &#123; <span class="comment">// webkit or chrome</span></span></span><br><span class="line"><span class="language-javascript">        url = <span class="variable language_">window</span>.<span class="property">webkitURL</span>.<span class="title function_">createObjectURL</span>(file) ;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> url ;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 计算尺寸</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">function</span> <span class="title function_">computedSize</span>(<span class="params">size</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> maxWidth = <span class="number">600</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> &#123; width, height &#125; = size</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    width &gt; maxWidth &amp;&amp;  (height = height * maxWidth / width) </span></span><br><span class="line"><span class="language-javascript">    width &gt; maxWidth &amp;&amp;  (width = maxWidth) </span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123; width, height &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 监听图片加载完成事件</span></span></span><br><span class="line"><span class="language-javascript">  image.<span class="property">onload</span> = <span class="function">()=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> ctx1 = canvas1.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> ctx2 = canvas2.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 计算尺寸</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> &#123; width, height &#125; = <span class="title function_">computedSize</span>(image)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    canvas1.<span class="property">width</span> = width</span></span><br><span class="line"><span class="language-javascript">    canvas1.<span class="property">height</span> = height</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    canvas2.<span class="property">width</span> = width</span></span><br><span class="line"><span class="language-javascript">    canvas2.<span class="property">height</span> = height</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 1. 将图片画在画布 1 中</span></span></span><br><span class="line"><span class="language-javascript">    ctx1.<span class="title function_">drawImage</span>(image, <span class="number">0</span>, <span class="number">0</span>, width, height)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 2. 获取canvas1的图片像素点数据</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> imageData = ctx1.<span class="title function_">getImageData</span>( <span class="number">0</span>, <span class="number">0</span>, width, height).<span class="property">data</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 3. 根据 canvas1 的像素数据  在 canvas2 上画点</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; imageData.<span class="property">length</span>; i += <span class="number">4</span>)&#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 计算当前像素点的 x,y（第 x 列 ，第 y 行 ）</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> x = <span class="built_in">parseInt</span>(i % (width * <span class="number">4</span>) / <span class="number">4</span>)</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> y = <span class="built_in">parseInt</span>(i / (width * <span class="number">4</span>))</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 像素点压缩倍数</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> bl = <span class="number">6</span> </span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">//  压缩像素点  =&gt; 判断当前 x, y 与 压缩倍数的余数是否都为 0 </span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span>(x % bl === <span class="number">0</span> &amp;&amp; y % bl === <span class="number">0</span> )&#123;</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 计算灰度</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> [r, g, b, a] = [imageData[i], imageData[i + <span class="number">1</span>], imageData[i + <span class="number">2</span>], imageData[i + <span class="number">3</span>]]</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> gray = (r + g + b) / <span class="number">3</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 填充文字</span></span></span><br><span class="line"><span class="language-javascript">        ctx2.<span class="property">font</span> = <span class="string">&#x27;12px&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        ctx2.<span class="property">fillStyle</span> = <span class="string">`rgba(<span class="subst">$&#123;gray&#125;</span>,<span class="subst">$&#123;gray&#125;</span>,<span class="subst">$&#123;gray&#125;</span>,<span class="subst">$&#123;a&#125;</span>)`</span></span></span><br><span class="line"><span class="language-javascript">        ctx2.<span class="title function_">fillText</span>(<span class="string">&#x27;a&#x27;</span>, x, y)</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="四、升级版"><a href="#四、升级版" class="headerlink" title="四、升级版"></a>四、升级版</h1><p>​通过文字 ，图片，视频 生成图像 </p><ol><li><p>[文字效果]: <a href="http://wuxingxi.top/text-image/demo1.html">http://wuxingxi.top/text-image/demo1.html</a>“ “</p></li><li></li><li></li><li></li></ol><p>视频效果大致思路：将<code>img</code>标签换成<code>video</code>标签，播放视频时，利用 <code>requestAnimationFrame</code> 循环将视频的每一帧通过 <code>ctx1.drawImage(video,0, 0, width,height)</code>画在 <code>canvas</code> 上</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>javascript 事件循环</title>
      <link href="/2022/10/09/javascript-%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF/"/>
      <url>/2022/10/09/javascript-%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF/</url>
      
        <content type="html"><![CDATA[<h2 id="事件循环"><a href="#事件循环" class="headerlink" title="事件循环"></a>事件循环</h2><blockquote><p>学习事件循环 首先就要了解一下浏览器的进程模型</p></blockquote><h3 id="浏览器的进程模型"><a href="#浏览器的进程模型" class="headerlink" title="浏览器的进程模型"></a>浏览器的进程模型</h3><h4 id="何为进程"><a href="#何为进程" class="headerlink" title="何为进程?"></a>何为进程?</h4><ul><li>如果要运行一个程序 就要属于他自己的<code>内存空间</code> 可以把这块内存空间简单理解为进程</li><li>什么<code>对象,函数啥啥啥的</code> 都是放在内存里面的 所以就需要开辟一块内存空间让这个程序自己去使用</li><li>总结 : <code>进程 == 开辟出的这块内存空间</code></li></ul><blockquote><p>每一个应用 至少也要有一个进程 <code>进程之间相互独立</code> 即使要通讯 也需要双方同意才行<br>比如qq进程崩溃了 肯定是不会影响到微信的 所以每一个进程是完全独立的</p></blockquote><h4 id="何为线程"><a href="#何为线程" class="headerlink" title="何为线程?"></a>何为线程?</h4><ul><li>有了进程后 就可以运行程序的代码了</li><li>运行代码的<code>人</code>称之为<code>线程</code></li></ul><blockquote><p>一个<code>进程</code>至少有一个<code>线程 </code>所以在进程开启后会<code>自动创建一个线程</code>来运行代码 该线程称之为<code>主线程</code></p><p>如果程序需要同时执行多块代码 主线程就会启动更多的 线程来执行代码 所以<code>一个进程中可以包含多个线程</code></p></blockquote><h3 id="浏览器有哪些进程和线程"><a href="#浏览器有哪些进程和线程" class="headerlink" title="浏览器有哪些进程和线程"></a>浏览器有哪些进程和线程</h3><h4 id="浏览器是一个多进程多线程的应用程序"><a href="#浏览器是一个多进程多线程的应用程序" class="headerlink" title="浏览器是一个多进程多线程的应用程序"></a>浏览器是一个多进程多线程的应用程序</h4><ul><li>浏览器内部工作极其复杂</li><li>为了避免相互影响 为了减少连环崩溃的几率 <code>当浏览器启动后 它会开启多个进程</code></li></ul><blockquote><p>可以在浏览器的任务管理器中查看当前的所有进程</p></blockquote><h5 id="其中最主要的进程有"><a href="#其中最主要的进程有" class="headerlink" title="其中最主要的进程有"></a>其中最主要的进程有</h5><ul><li>浏览器进程 : 主要负责页面的显示 用户交互 子进程管理等 浏览器进程内部会启动多个线程处理不同的任务</li><li>网络进程 : 负责加载网络资源 网络进程内部会启动多个线程来处理不同的网络任务</li><li>渲染进程(重点) : 渲染进程启动后 会开启一个<code>渲染主线程</code> , 主线程负责执行<code>HTML,CSS,JS代码</code></li></ul><blockquote><p>默认情况下浏览器会为为每个标签页开启一个新的渲染进程 以保证不同的标签页之间不相互影响</p></blockquote><h3 id="渲染主线程是如何工作的"><a href="#渲染主线程是如何工作的" class="headerlink" title="渲染主线程是如何工作的?"></a>渲染主线程是如何工作的?</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps: 事件循环就在主线程中执行</span><br></pre></td></tr></table></figure><ul><li>渲染主线程是浏览器中最繁忙的线程 需要他处理的任务非常多</li><li><code>解析html,css,js,计算样式,布局,处理图层,每秒把页面画60次.....</code></li></ul><blockquote><p>要处理这么多的任务 主线程如何去调度指挥任务呢?</p></blockquote><p>比如:</p><ul><li>我正在执行一个js函数,执行到一半的时候用户点击了按钮, 我该立即去执行点击事件的处理函数吗?</li><li>我正在执行一个js函数,执行到一半额时候某个计时器到达了时间,我改立即去实现它的回调函数吗?</li><li>浏览器进程通知我<code>用户点击了按钮</code> ,与此同时,某个计时器也到达了时间,我应该处理哪一个呢?</li></ul><h3 id="渲染主线程指挥调度核心的方法-排队"><a href="#渲染主线程指挥调度核心的方法-排队" class="headerlink" title="渲染主线程指挥调度核心的方法 排队"></a>渲染主线程指挥调度核心的方法 <code>排队</code></h3><blockquote><p>以下的整个过程,被称之为事件循环 也可以说消息循环</p></blockquote><ul><li>在最开始的时候 渲染主线程会进入一个无限的循环</li><li>每一次循环会检查事件队列中是否有任务存在,<code>如果有,就取出第一个任务执行,执行完后进入下一次循环</code>,如果没有就休息</li><li>其他所有线程 (包括其他进行的线程<code>比如网络线程,监听用户交互的线程等等..</code>) ,可以随时向事件队列里添加任务,<code>新任务会加到事件队列的末尾</code>,在添加新任务的时候,如果主线程是休眠状态,则会唤醒以继续循环拿去任务</li></ul><h2 id="事件循环的细节"><a href="#事件循环的细节" class="headerlink" title="事件循环的细节"></a>事件循环的细节</h2><h3 id="异步是什么"><a href="#异步是什么" class="headerlink" title="异步是什么?"></a>异步是什么?</h3><blockquote><p>在代码执行过程中, 会遇到一些无法<code>立即处理</code>的任务</p></blockquote><ul><li>计时完成后需要执行的任务—<code>setTimeOut,setInterval</code></li><li>网络通信后需要执行的任务—<code>XHR,Fetch</code></li><li>用户操作后需要执行的任务—<code>addEventListener</code></li></ul><blockquote><p>执行这些任务 都是需要<code>未知的时间的</code> ,不能立即去执行</p><p>如果让渲染主线程等待这类型任务的时机达到,就会导致主线程长期处于<code>阻塞</code>的状态 从而导致浏览器<code>卡死!!!</code></p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setTimeOut</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">&#125;,<span class="number">3000</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>);</span><br><span class="line"><span class="comment">// 如果先等待3秒后打印1  然后再打印2  这就是同步</span></span><br><span class="line"><span class="comment">// 显然 这样是不可行的 因为一个定时器所有的任务都被阻塞了 </span></span><br><span class="line"><span class="comment">// 那渲染主线程怎么执行绘制页面任务?怎么执行事件交互任务?  直接废了!</span></span><br></pre></td></tr></table></figure><blockquote><p>渲染主线程承担着极其重要的工作,无论如何都不能阻塞!!!</p><p>因此浏览器选择用<code>异步</code>来解决这个问题</p></blockquote><ul><li>比如主线程在事件队列中遇到一个<code>定时器</code></li><li>主线程会派一个计时线程去开始执行定时 <code>主线程是不会自己计时的, 他要干别的活</code>,此时,在主线程眼里,定时器这个的任务已经执行了</li><li>主线程然后继续去执行后面的任务</li><li>突然<code>定时器时间到了!</code>, 定时器会把需要执行的回调函数继续<code>放在事件队列里的末端</code> 当成一个普通的任务去执行</li><li><code>此时,主线程也不会知道 这个任务就是当时定时器里的回调函数</code> 依旧进行循环的执行任务</li></ul><h4 id="这样使用异步的方式-渲染主线程永不阻塞"><a href="#这样使用异步的方式-渲染主线程永不阻塞" class="headerlink" title="这样使用异步的方式: 渲染主线程永不阻塞!!!"></a>这样使用异步的方式: 渲染主线程永不阻塞!!!</h4><blockquote><p>之前遇到过一个面试题 , 如何理解js的异步?</p><p>学到这里后 , 我现在会选择这样去回答</p></blockquote><ul><li>js是一个<code>单线程</code>的语言 , 这是因为js只能运行在浏览器的<code>渲染主线程</code>中,而渲染主线程只有一个 , 而渲染主线程承担着非常的多的事情 ,<code> 渲染页面 , 执行js啥啥的</code> 都在里面执行</li><li>如果使用<code>同步</code>的方式 , 就极可能导致<code>主线程阻塞</code> , 从而导致消息队列中的很多其他任务无法得到执行 , 这样一来 , 繁忙的主线程白白浪费时间等待 , 导致页面也会无法更新 , 给用户造成卡死的状态</li><li>所以浏览器选择用<code>异步</code>方式来避免 , 具体做法就是当某些任务发生时 , <code>比如计时器 , 网络 , 事件监听 , </code>主线程将任务会交给其他线程去处理 , 自身立刻结束任务的执行 , 转而执行后面的任务 , 当其他线程完成时 , 把那个回调函数<code>包装</code>成任务 , <code>加入到事件队列的末端排队</code> , 等待主线程调度</li><li>这样的一个模式 就是异步 可以保证浏览器不阻塞</li></ul><h3 id="js为何阻塞渲染"><a href="#js为何阻塞渲染" class="headerlink" title="js为何阻塞渲染?"></a>js为何阻塞渲染?</h3><ul><li>因为js和渲染都处于一个线程上面</li><li>假如点击按钮修改文字 点击完按钮后 文字已经修改了 但是还没绘制在页面上 要等<code>渲染任务</code>执行后才会绘制</li></ul><h3 id="任务有优先级吗"><a href="#任务有优先级吗" class="headerlink" title="任务有优先级吗?"></a>任务有优先级吗?</h3><blockquote><p>任务没有优先级</p></blockquote><blockquote><p><em>但是消息队列 有优先级</em></p></blockquote><h3 id="根据w3c的最新解释"><a href="#根据w3c的最新解释" class="headerlink" title="根据w3c的最新解释"></a>根据w3c的最新解释</h3><ul><li>每个任务都有一个任务类型 , 同一个类型的任务必须在一个队列<code>也就是一共有多个队列</code> , 不同类型的任务可以分属不同的队列,在一个次事件循环中,浏览器可以根据实际情况从不同的队列中区出任务执行</li><li>浏览器必须准备好一个微队列 , 微队列中的任务优先所有其他任务执行<code>他里面的东西 所有都要给我等 连绘制任务 都要等 就是最高优先级了</code></li></ul><blockquote><p>随着浏览器的复杂度急剧提升 W3C不再使用宏队列的说法</p></blockquote><p>在目前chrome的实现中 至少包含了下面的队列</p><ul><li>延时队列 : 用于存放计时器到达后的回调任务 , <code>优先级中</code></li><li>交互队列 : 用于存放用户操作后产生的事件处理任务 , <code>优先级高</code></li><li>微队列 : 用户存放需要最快执行的任务 <code>优先级最高</code></li></ul><blockquote><p>添加任务到微队列的主要方式是使用<code>promise,....</code><br>列如</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 立刻把一个函数添加到微队列 最高执行</span></span><br><span class="line">  promise.<span class="title function_">resolve</span>().<span class="title function_">then</span>(函数)</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setTimeOut</span>(<span class="function">()=&gt;</span>&#123; <span class="comment">// 第三步执行延时队列中的任务</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;,<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">  promise.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">()=&gt;</span>&#123; <span class="comment">// 第二步执行微队列中的任务</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>);</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>); <span class="comment">// 第一步先执行全局js</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3 2 1</span></span><br></pre></td></tr></table></figure><p>面试题 : 阐述一下js的事件循环</p><ul><li>事件循环又叫消息循环<code>官方叫event loop 浏览器实现叫message loop</code> , 是浏览器选择主线程的工作方式 , 在chrome中就是开启了一个不会结束的for循环, 每次循环从消息队列中取出第一个任务执行,而其他线程只需要在合适的时候将任务加入到队列末尾即可</li><li>过去吧消息队列简单分为宏队列和微队列,这种说法目前无法满足复杂的浏览器环境,取而代之的是一种更加灵活多变的处理方式</li><li>根据w3c官方的解释, 每个任务有不同的类型,同类型的任务必须在同一个队列,不同的任务可以属于不同的队列.不同的任务队列有不同的优先级,在一次事件循环中,由浏览器自行决定取那个队列的任务,但浏览器必须有一个微队列,微队列的任务一定具有最高的优先级,必须有限调度执行</li></ul><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><h5 id="单线程是异步产生的原因，事件循环是异步实现的方式"><a href="#单线程是异步产生的原因，事件循环是异步实现的方式" class="headerlink" title="单线程是异步产生的原因，事件循环是异步实现的方式"></a>单线程是异步产生的原因，事件循环是异步实现的方式</h5>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>构建发布一个npm</title>
      <link href="/2022/09/29/%E6%9E%84%E5%BB%BA%E5%8F%91%E5%B8%83%E4%B8%80%E4%B8%AAnpm/"/>
      <url>/2022/09/29/%E6%9E%84%E5%BB%BA%E5%8F%91%E5%B8%83%E4%B8%80%E4%B8%AAnpm/</url>
      
        <content type="html"><![CDATA[<h3 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h3><ul><li><p>下载 Node.js 和 NPM。</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node -v </span><br><span class="line">npm -v </span><br></pre></td></tr></table></figure></li><li><p>选一个好的包名。包名必须是 pascal-case 并且全部小写。因为 NPM 上有 700k+ 的包，所以你需要在构建之前先去 <a href="https://link.juejin.cn/?target=https://www.npmjs.com/">www.npmjs.com/</a> 查询你的包名有没有被使用。在本文中，我取了 irene-awesome-gretter。</p></li></ul><h3 id="基本构建"><a href="#基本构建" class="headerlink" title="基本构建"></a>基本构建</h3><ul><li><p>选择一个合适的名字创建包文件夹。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> irene-awesome-greeter &amp;&amp; <span class="built_in">cd</span> irene-awesome-greeter</span><br></pre></td></tr></table></figure></li><li><p>新建 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.gitignore</span><br></pre></td></tr></table></figure><p> 文件并写入 node_modules，新建 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">README</span><br></pre></td></tr></table></figure><p> 文件。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;node_modules&quot;</span> &gt;&gt; .gitignore</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;# Irene Awesome Greeter&quot;</span> &gt;&gt; README.md</span><br></pre></td></tr></table></figure></li><li><p>Git 初始化包并关联远程仓库。下面 Git Repository Url 是远程仓库的 Url。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git <span class="keyword">init</span></span><br><span class="line">git <span class="keyword">add</span> . &amp;&amp; git commit -m <span class="string">&quot;Initial commit&quot;</span></span><br><span class="line">git remote <span class="keyword">add</span> origin &lt;Git Repository Url&gt;</span><br><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure></li><li><p>NPM 初始化包，后续我们会修改生成的 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">package.json</span><br></pre></td></tr></table></figure><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="keyword">init</span> -y</span><br></pre></td></tr></table></figure><p>至此，生成的目录结构如下：</p><img src="/2022/09/29/%E6%9E%84%E5%BB%BA%E5%8F%91%E5%B8%83%E4%B8%80%E4%B8%AAnpm/16bd0e9c77701685~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0-20220929172958163.awebp" class="" title="img"></li></ul><h3 id="添加-TypeScript-as-devDependencies"><a href="#添加-TypeScript-as-devDependencies" class="headerlink" title="添加 TypeScript as devDependencies"></a>添加 TypeScript as devDependencies</h3><ul><li><p>下载 TypeScript。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="selector-tag">i</span> -D typescript</span><br></pre></td></tr></table></figure><p>下载完后，在根目录下多了 <code>node_modules</code> 文件夹和 <code>package-lock.json</code> 文件。</p></li><li><p>为了编译 <code>TypeScript</code>，我们需要一个配置文件，在根目录下新建 <code>tsconfig.json</code>，内容如下。⚠️注意我（译者）在原文配置的基础上添加了 lib，指定了 es6，原因见 - <a href="https://juejin.cn/post/6844903892094812173">详情</a>。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;target&quot;</span><span class="punctuation">:</span> <span class="string">&quot;es5&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;module&quot;</span><span class="punctuation">:</span> <span class="string">&quot;commonjs&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;declaration&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;outDir&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./lib&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;strict&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span>，</span><br><span class="line">    <span class="attr">&quot;lib&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;es6&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;include&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;src&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;exclude&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;node_modules&quot;</span><span class="punctuation">,</span> <span class="string">&quot;**/__tests__/*&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><img src="/2022/09/29/%E6%9E%84%E5%BB%BA%E5%8F%91%E5%B8%83%E4%B8%80%E4%B8%AAnpm/16c031a2e687a8f1~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0-20220929172958205.awebp" class="" title="img"><p>下面解释下配置文件字段：注意 ES6 &#x3D; ES2015</p><ul><li><p>target：编译之后生成的 <code>JavaScript</code> 文件需要遵循的标准，可选值：<code>&quot;ES3&quot;（默认），&quot;ES5&quot;，&quot;ES6&quot;/&quot;ES2015&quot;，&quot;ES2016&quot;，&quot;ES2017&quot;或&quot;ESNext&quot;</code>。我们选择了 <code>es5</code> 为了使包具有更好的浏览器兼容性。</p></li><li><p>module：指定生成哪个模块系统代码，默认值：<code>target === &quot;ES3&quot; or &quot;ES5&quot; ? &quot;CommonJS&quot; : &quot;ES6&quot;</code>。</p></li><li><p>declaration：是否生成对应的声明文件，默认值：false。在构建包时，应该设置为 true，这样 <code>TypeScript</code> 会将生成的声明文件和对应编译后的 <code>JavaScript</code> 代码一起导出，以便包可以在 <code>TypeScript</code> 和 <code>JavaScript</code> 项目中同时使用。本项目中生成的声明文件是 &#x2F;lib&#x2F;index.d.ts。</p></li><li><p>outDir：指定输出目录。编译后的 <code>JavaScript</code> 代码会在与 <code>tsconfig.json</code> 同级的 lib 文件夹中。</p></li><li><p>strict：是否启用所有严格类型检查选项，默认值：false。</p></li><li><p>lib：编译需要的库文件，例如你指定的 target 是 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ES5</span><br></pre></td></tr></table></figure><p>，但是在代码中使用了 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ES6</span><br></pre></td></tr></table></figure><p> 特性，就需要在 lib 中加上 ES6。默认值：如果 lib 没有指定默认注入的库的列表，默认注入的库为：</p><ul><li>target ES5：DOM，ES5，ScriptHost。</li><li>target ES6：DOM，ES6，DOM.Iterable，ScriptHost。</li></ul></li><li><p>include：指定要编译的目录。</p></li><li><p>exclude：指定不编译的目录。<code>node_modules</code> 和 <code>__tests__</code> 只是在开发阶段使用，构建阶段无需编译。</p></li></ul><p>更多的编译选项可参考 <a href="https://link.juejin.cn/?target=https://www.typescriptlang.org/docs/handbook/compiler-options.html">www.typescriptlang.org/docs/handbo…</a></p></li><li><p>创建 <code>src</code> 文件夹，在其下新建一个 index.ts，内容如下：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">Greeter</span> = (<span class="params">name: <span class="built_in">string</span></span>) =&gt; <span class="string">`Hello <span class="subst">$&#123;name&#125;</span>`</span>;</span><br></pre></td></tr></table></figure></li><li><p>在 <code>package.json</code> 中添加 build script。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tsc&quot;</span></span><br></pre></td></tr></table></figure><img src="/2022/09/29/%E6%9E%84%E5%BB%BA%E5%8F%91%E5%B8%83%E4%B8%80%E4%B8%AAnpm/16bd0f6d2313891a~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0-20220929172958184.awebp" class="" title="img"><p>在控制台运行 npm run build，你会看到生成了一个新的 lib 文件夹，里面是编译后的 js 代码和声明文件。</p><img src="/2022/09/29/%E6%9E%84%E5%BB%BA%E5%8F%91%E5%B8%83%E4%B8%80%E4%B8%AAnpm/16bd1051feaf3fd8~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0-20220929172958145.awebp" class="" title="img"></li><li><p>除了 <code>package-lock.json</code> 以外， 我们一般都不希望提交自动生成的文件到 Git 上去，因为只要改变了源文件，每次 build 的时候它们都不同，就会造成很多冲突，所以我们把 lib 文件夹放到 <code>.gitignore</code> 中。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">node_modules</span><br><span class="line">/lib</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure></li></ul><h3 id="Formatting-Linting"><a href="#Formatting-Linting" class="headerlink" title="Formatting &amp; Linting"></a>Formatting &amp; Linting</h3><ul><li><p>下载 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">prettier tslint tslint-config-prettier</span><br></pre></td></tr></table></figure><p>和 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TypeScript</span><br></pre></td></tr></table></figure><p> 一样，它们只是在包开发阶段所需的工具，所以是 devDependencies。</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -D prettier tslint tslint-config-prettier</span><br></pre></td></tr></table></figure><p>一个好的包应该包括严格的代码规范，尤其是有其他协作者共同开发时。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tslint-config-prettier</span><br></pre></td></tr></table></figure><p> 能防止 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TSLint</span><br></pre></td></tr></table></figure><p> 和 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Prettier</span><br></pre></td></tr></table></figure><p> 格式化规则的冲突。</p></li><li><p>在根目录下，新建 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tslint.json</span><br></pre></td></tr></table></figure><p>，添加如下内容：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;extends&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;tslint:recommended&quot;</span><span class="punctuation">,</span> <span class="string">&quot;tslint-config-prettier&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li><li><p>在根目录下，新建 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.prettierrc</span><br></pre></td></tr></table></figure><p>，添加如下内容：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;printWidth&quot;</span><span class="punctuation">:</span> <span class="number">120</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;trailingComma&quot;</span><span class="punctuation">:</span> <span class="string">&quot;all&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;singleQuote&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li><li><p>最后，在 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">package.json</span><br></pre></td></tr></table></figure><p> 中添加 lint 和 format script。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;format&quot;: &quot;prettier --write \&quot;src<span class="comment">/**/</span><span class="operator">*</span>.ts\&quot; \&quot;src<span class="comment">/**/</span><span class="operator">*</span>.js\&quot;&quot;,</span><br><span class="line">&quot;lint&quot;: &quot;tslint -p tsconfig.json&quot;</span><br></pre></td></tr></table></figure><p>现在，你的 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">package.json</span><br></pre></td></tr></table></figure><p> 应该长这样：</p><img src="/2022/09/29/%E6%9E%84%E5%BB%BA%E5%8F%91%E5%B8%83%E4%B8%80%E4%B8%AAnpm/16bd1130fdbf4f3d~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0-20220929172958250.awebp" class="" title="img"><p>在控制台运行 npm run lint &#x2F; npm run format</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm run lint</span><br><span class="line">npm run format</span><br></pre></td></tr></table></figure><img src="/2022/09/29/%E6%9E%84%E5%BB%BA%E5%8F%91%E5%B8%83%E4%B8%80%E4%B8%AAnpm/16bd1163c00e6149~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0-20220929172958183.awebp" class="" title="img"></li></ul><h3 id="移除不必要文件"><a href="#移除不必要文件" class="headerlink" title="移除不必要文件"></a>移除不必要文件</h3><p>在 <code>.gitignore</code> 中，我们添加 &#x2F;lib 是因为不想 Git 远程仓库中有编译后的文件，但对于要发布的包则恰恰相反，我们不要源代码，只需要编译后的文件！有两种方式可以实现：</p><ul><li><p>黑名单：新建一个 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.npmignore</span><br></pre></td></tr></table></figure><p> 文件，在其中添加不要的文件（夹）。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">src</span></span><br><span class="line">tsconfig<span class="selector-class">.json</span></span><br><span class="line">tslint<span class="selector-class">.json</span></span><br><span class="line"><span class="selector-class">.prettierrc</span></span><br></pre></td></tr></table></figure><p>但是，这并不是一个好的实践，因为根目录下每次新增加一个文件（夹）都需要添加到 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.npmignore</span><br></pre></td></tr></table></figure><p> 中，于是有了下面这种方式。</p></li><li><p>白名单：在 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">package.json</span><br></pre></td></tr></table></figure><p> 中设置一个要发布的文件（夹）白名单</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;files&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;lib/**/*&quot;</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><p>就是这么的简单！只有 lib 文件夹会出现在发布的包里（README.md 和 package.json 会被默认添加）。更多关于黑名单 VS 白名单的内容可以参考 </p><p>blog.npmjs.org&#x2F;post&#x2F;165769…</p></li></ul><h3 id="Jest-Testing"><a href="#Jest-Testing" class="headerlink" title="Jest Testing"></a>Jest Testing</h3><p>一个好的包应该要包括单元测试。接下来，我们添加 Jest —— Facebook 开发的一个非常棒的测试框架。</p><ul><li><p>因为我们是针对 ts 源文件编写测试用例，所以除了 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jest</span><br></pre></td></tr></table></figure><p> 还需要 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ts-jest @types/jest</span><br></pre></td></tr></table></figure><p>，它们只是在开发阶段需要，所以添加到 devDependencies。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="selector-tag">i</span> -D jest ts-jest <span class="keyword">@types</span>/jest</span><br></pre></td></tr></table></figure></li><li><p>配置 Jest。有两种方式，在 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">package.json</span><br></pre></td></tr></table></figure><p> 添加 “jest” 字段 或者 新建一个单独的配置文件。我们选择后者，因为前者配置内容会被添加到发布的包中而后者不会。新建 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jestconfig.json</span><br></pre></td></tr></table></figure><p>，添加如下内容：</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;transform&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;^.+<span class="subst">\\</span>.(t|j)sx?$&quot;</span>: <span class="string">&quot;ts-jest&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;testRegex&quot;</span>: <span class="string">&quot;(/__tests__/.*|(<span class="subst">\\</span>.|/)(test|spec))<span class="subst">\\</span>.(jsx?|tsx?)$&quot;</span>,</span><br><span class="line">  <span class="string">&quot;moduleFileExtensions&quot;</span>: [<span class="string">&quot;ts&quot;</span>, <span class="string">&quot;tsx&quot;</span>, <span class="string">&quot;js&quot;</span>, <span class="string">&quot;jsx&quot;</span>, <span class="string">&quot;json&quot;</span>, <span class="string">&quot;node&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>移除 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">package.json</span><br></pre></td></tr></table></figure><p> 中的 “test” script，添加一个新的 test script。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jest --config jestconfig.json&quot;</span></span><br></pre></td></tr></table></figure><p>现在，你的 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">package.json</span><br></pre></td></tr></table></figure><p> 长下面这样：</p><img src="/2022/09/29/%E6%9E%84%E5%BB%BA%E5%8F%91%E5%B8%83%E4%B8%80%E4%B8%AAnpm/16bd124dc61317c5~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0-20220929172958190.awebp" class="" title="img"></li></ul><h3 id="写一个测试用例"><a href="#写一个测试用例" class="headerlink" title="写一个测试用例"></a>写一个测试用例</h3><p>是时候写一个测试用例了。在 <code>src</code> 目录下，新建一个 <code>__tests__</code> 文件夹，在其中新建一个测试文件，文件名必须以 <code>test.ts</code> 结尾，例如：Greeter.test.ts。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Greeter</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../index&#x27;</span>;</span><br><span class="line"><span class="title function_">test</span>(<span class="string">&#x27;My Greeter&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">expect</span>(<span class="title class_">Greeter</span>(<span class="string">&#x27;Carl&#x27;</span>)).<span class="title function_">toBe</span>(<span class="string">&#x27;Hello Carl&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>这个测试用例验证了当输入 ‘Carl’ 的时候，Greeter 方法是否返回 ‘Hello Carl’。 接下来我们运行一下</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run test</span><br></pre></td></tr></table></figure><img src="/2022/09/29/%E6%9E%84%E5%BB%BA%E5%8F%91%E5%B8%83%E4%B8%80%E4%B8%AAnpm/16bd129c42ad01ee~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0-20220929172958211.awebp" class="" title="img"><p>运行成功！可以看到测试用例通过了。</p><h3 id="scripts-in-NPM"><a href="#scripts-in-NPM" class="headerlink" title="scripts in NPM"></a>scripts in NPM</h3><p>一个好的包应该尽可能自动化。接下来，我们来看看 NPM 中其他的 scripts：<code>prepare，prepublishOnly，perversion，version，postversion</code>。</p><ul><li><p>prepare：会在打包和发布包之前以及本地 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br></pre></td></tr></table></figure><p> （不带任何参数）时运行。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;prepare&quot;</span><span class="punctuation">:</span> <span class="string">&quot;npm run build&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>prepublishOnly：在 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">prepare</span><br></pre></td></tr></table></figure><p> script 之前运行，并且仅在 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm publish</span><br></pre></td></tr></table></figure><p> 运行。在这里，我们可以运行 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run test &amp; npm run lint</span><br></pre></td></tr></table></figure><p> 以确保我们不会发布错误的不规范的代码。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;prepublishOnly&quot;</span><span class="punctuation">:</span> <span class="string">&quot;npm run test &amp;&amp; npm run lint&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>preversion：在发布新版本包之前运行，为了更加确保新版本包的代码规范，我们可以在此运行 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run lint</span><br></pre></td></tr></table></figure><p>。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;preversion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;npm run lint&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>version：在发布新版本包之后运行。如果您的包有关联远程 Git 仓库，像我们的情况一样，每次发布新版本时都会生成一个提交和一个新的版本标记，那么就可以在此添加规范代码的命令。又因为 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">version</span><br></pre></td></tr></table></figure><p> script 在  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit</span><br></pre></td></tr></table></figure><p> 之前运行，所以还可以在此添加 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git add</span><br></pre></td></tr></table></figure><p>。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;npm run format &amp;&amp; git add -A src&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>postversion：在发布新版本包之后运行，在 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit</span><br></pre></td></tr></table></figure><p>之后运行，所以非常适合推送。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;postversion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;git push &amp;&amp; git push --tags&quot;</span></span><br></pre></td></tr></table></figure></li></ul><p>截至目前，我们的 NPM scripts 长下面这样：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">  &quot;test&quot;: &quot;jest --config jestconfig.json&quot;,</span><br><span class="line">  &quot;build&quot;: &quot;tsc&quot;,</span><br><span class="line">  &quot;format&quot;: &quot;prettier --write \&quot;src<span class="comment">/**/</span><span class="operator">*</span>.ts\&quot; \&quot;src<span class="comment">/**/</span><span class="operator">*</span>.js\&quot;&quot;,</span><br><span class="line">  &quot;lint&quot;: &quot;tslint -p tsconfig.json&quot;,</span><br><span class="line">  &quot;prepare&quot;: &quot;npm run build&quot;,</span><br><span class="line">  &quot;prepublishOnly&quot;: &quot;npm run test &amp;&amp; npm run lint&quot;,</span><br><span class="line">  &quot;preversion&quot;: &quot;npm run lint&quot;,</span><br><span class="line">  &quot;version&quot;: &quot;npm run format &amp;&amp; git add -A src&quot;,</span><br><span class="line">  &quot;postversion&quot;: &quot;git push &amp;&amp; git push --tags&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="终极版-package-json"><a href="#终极版-package-json" class="headerlink" title="终极版 package.json"></a>终极版 package.json</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;irene-awesome-greeter&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;description&quot;</span>: <span class="string">&quot;A nice greeter&quot;</span>, <span class="comment">// </span></span><br><span class="line">  <span class="string">&quot;main&quot;</span>: <span class="string">&quot;lib/index.js&quot;</span>, <span class="comment">// </span></span><br><span class="line">  <span class="string">&quot;types&quot;</span>: <span class="string">&quot;lib/index.d.ts&quot;</span>, <span class="comment">// </span></span><br><span class="line">  <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;test&quot;</span>: <span class="string">&quot;jest --config jestconfig.json&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build&quot;</span>: <span class="string">&quot;tsc&quot;</span>,</span><br><span class="line">    <span class="string">&quot;format&quot;</span>: <span class="string">&quot;prettier --write <span class="subst">\&quot;</span>src/**/*.ts<span class="subst">\&quot;</span> <span class="subst">\&quot;</span>src/**/*.js<span class="subst">\&quot;</span>&quot;</span>,</span><br><span class="line">    <span class="string">&quot;lint&quot;</span>: <span class="string">&quot;tslint -p tsconfig.json&quot;</span>,</span><br><span class="line">    <span class="string">&quot;prepare&quot;</span>: <span class="string">&quot;npm run build&quot;</span>,</span><br><span class="line">    <span class="string">&quot;prepublishOnly&quot;</span>: <span class="string">&quot;npm run test &amp;&amp; npm run lint&quot;</span>,</span><br><span class="line">    <span class="string">&quot;preversion&quot;</span>: <span class="string">&quot;npm run lint&quot;</span>,</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;npm run format &amp;&amp; git add -A src&quot;</span>,</span><br><span class="line">    <span class="string">&quot;postversion&quot;</span>: <span class="string">&quot;git push &amp;&amp; git push --tags&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;repository&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;git&quot;</span>,</span><br><span class="line">    <span class="string">&quot;url&quot;</span>: <span class="string">&quot;git+https://github.com/irenetang1993/irene-awesome-greeter.git&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;keywords&quot;</span>: [<span class="string">&quot;Hello&quot;</span>, <span class="string">&quot;Greeter&quot;</span>], <span class="comment">// </span></span><br><span class="line">  <span class="string">&quot;author&quot;</span>: <span class="string">&quot;Irene Tang&quot;</span>, <span class="comment">// </span></span><br><span class="line">  <span class="string">&quot;license&quot;</span>: <span class="string">&quot;ISC&quot;</span>,</span><br><span class="line">  <span class="string">&quot;bugs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://github.com/irenetang1993/irene-awesome-greeter/issues&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;homepage&quot;</span>: <span class="string">&quot;https://github.com/irenetang1993/irene-awesome-greeter#readme&quot;</span>,</span><br><span class="line">  <span class="string">&quot;devDependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;@types/jest&quot;</span>: <span class="string">&quot;^24.0.15&quot;</span>,</span><br><span class="line">    <span class="string">&quot;jest&quot;</span>: <span class="string">&quot;^24.8.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;prettier&quot;</span>: <span class="string">&quot;^1.18.2&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ts-jest&quot;</span>: <span class="string">&quot;^24.0.2&quot;</span>,</span><br><span class="line">    <span class="string">&quot;tslint&quot;</span>: <span class="string">&quot;^5.18.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;tslint-config-prettier&quot;</span>: <span class="string">&quot;^1.18.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;typescript&quot;</span>: <span class="string">&quot;^3.5.2&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;files&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;lib/**/*&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们完善了 description，author，keywords 信息，修改了 <code>main</code>，新增了 <code>types</code>。 <code>main</code> 字段非常重要，因为指明了模块的入口。<code>types</code> 字段指明了声明文件的入口。</p><h3 id="提交并推送到-Git"><a href="#提交并推送到-Git" class="headerlink" title="提交并推送到 Git"></a>提交并推送到 Git</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git <span class="keyword">add</span> <span class="operator">-</span>A <span class="operator">&amp;&amp;</span> git <span class="keyword">commit</span> <span class="operator">-</span>m &quot;Setup Package&quot;</span><br><span class="line">git push</span><br></pre></td></tr></table></figure><h3 id="发布"><a href="#发布" class="headerlink" title="发布"></a>发布</h3><p>在发布之前，如果你没有 NPM 账号的话，必须先注册一个。你可以在 <a href="https://link.juejin.cn/?target=https://www.npmjs.com/signup">www.npmjs.com/signup</a> 上注册或者通过运行 <code>npm adduser</code> 注册。如果你已经有账号了，运行 <code>npm login</code> 登陆你的 NPM 账号。</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm whoami</span><br></pre></td></tr></table></figure><p>显示出了自己的用户名就算登录成功了</p><img src="/2022/09/29/%E6%9E%84%E5%BB%BA%E5%8F%91%E5%B8%83%E4%B8%80%E4%B8%AAnpm/16bd48603feb5863~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0-20220929172958179.awebp" class="" title="img"><p>好了！现在你可以发布了。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm publish</span><br></pre></td></tr></table></figure><p>可以看到，先运行 <code>prepare</code> script，在其中运行了 <code>npm run build</code>，然后运行 <code>prepublishOnly</code> script，在其中运行了 <code>npm run test &amp;&amp; npm run lint</code>。</p><img src="/2022/09/29/%E6%9E%84%E5%BB%BA%E5%8F%91%E5%B8%83%E4%B8%80%E4%B8%AAnpm/16c03c9f870ef3ad~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0-20220929172958263.awebp" class="" title="img"><h3 id="查看你的发布"><a href="#查看你的发布" class="headerlink" title="查看你的发布"></a>查看你的发布</h3><p>现在，你可以去 NPM 上查看你刚刚发布的包。URL 是 <code>https://npmjs.com/package/&lt;your-package-name&gt;</code>，我发布的包就是 <a href="https://link.juejin.cn/?target=https://npmjs.com/package/irene-awesome-greeter">npmjs.com&#x2F;package&#x2F;ire…</a></p><img src="/2022/09/29/%E6%9E%84%E5%BB%BA%E5%8F%91%E5%B8%83%E4%B8%80%E4%B8%AAnpm/16c03cae58477c7d~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0-20220929172958229.awebp" class="" title="img"><h3 id="创建一个新版本"><a href="#创建一个新版本" class="headerlink" title="创建一个新版本"></a>创建一个新版本</h3><p>执行如下命令会创建一个新版本， <code>preversion，version，postversion</code> scripts 会被执行：创建一个新的 tag 并且推送到我们的远程仓库。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm version patch</span><br></pre></td></tr></table></figure><img src="/2022/09/29/%E6%9E%84%E5%BB%BA%E5%8F%91%E5%B8%83%E4%B8%80%E4%B8%AAnpm/16c04ba74f78a738~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0-20220929172958247.awebp" class="" title="img"><p>我们再发布一次：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm publish</span><br></pre></td></tr></table></figure><p>现在，我们的包就有了一个 1.0.1 的版本：</p><img src="/2022/09/29/%E6%9E%84%E5%BB%BA%E5%8F%91%E5%B8%83%E4%B8%80%E4%B8%AAnpm/16c04bc7ad4b2bbe~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0-20220929172958238.awebp" class="" title="img"><h3 id="如何撤销发布的包"><a href="#如何撤销发布的包" class="headerlink" title="如何撤销发布的包"></a>如何撤销发布的包</h3><p>终端执行 npm unpublish 例如：</p><p> 1、npm unpublish <your-package-name>@1.0.0 删除某个版本 </p><p> 2、npm unpublish <your-package-name> –force 删除整个npm市场的包</p><p>不过撤包推荐用法： npm unpublish的推荐替代命令：npm deprecate [@] 使用这个命令，并不会在社区里撤销你已有的包，但会在任何人尝试安装这个包的时候得到警告 例如：npm deprecate z-tool ‘这个包我已经不再维护了哟～’</p><p>【注意】如果报权限方面的错，加上–force</p><h3 id="发布错误集锦"><a href="#发布错误集锦" class="headerlink" title="发布错误集锦"></a>发布错误集锦</h3><p>1、需要提高版本号</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#1、发包 npm publish 失败</span><br><span class="line">sh-neverleave:z-tool neverleave$ npm publish</span><br><span class="line">npm ERR! publish Failed PUT 400</span><br><span class="line">npm ERR! code E400</span><br><span class="line">npm ERR! deprecations must be strings : z-tool</span><br><span class="line"></span><br><span class="line">npm ERR! A complete log of this run can be found in:</span><br><span class="line">npm ERR!     /Users/neverleave/.npm/_logs/2018-11-23T10_52_01_742Z-debug.log</span><br><span class="line">sh-neverleave:z-tool neverleave$ npm publish</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#2、发包 npm publish 失败</span><br><span class="line">sh-neverleave:z-tool neverleave$ npm publish</span><br><span class="line">npm ERR! publish Failed PUT 403</span><br><span class="line">npm ERR! code E403</span><br><span class="line">npm ERR! You cannot publish over the previously published versions: 1.0.3. : z-tool</span><br><span class="line"></span><br><span class="line">npm ERR! A complete log of this run can be found in:</span><br><span class="line">npm ERR!     /Users/neverleave/.npm/_logs/2018-11-23T11_24_57_662Z-debug.log</span><br><span class="line">sh-neverleave:z-tool neverleave$</span><br></pre></td></tr></table></figure><p>2、发包 npm publish 失败 解决方案：终端执行： npm publish –access public</p><p>参考：<a href="https://link.zhihu.com/?target=https://stackoverflow.com/questions/53420758/npm-publish-gives-unscoped-packages-cannot-be-private">https://stackoverflow.com/questions/53420758/npm-publish-gives-unscoped-packages-cannot-be-private</a></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#1、发包 npm publish 失败</span><br><span class="line">sh-neverleave:npm neverleave$ npm publish</span><br><span class="line">npm ERR! publish Failed PUT 400</span><br><span class="line">npm ERR! code E400</span><br><span class="line">npm ERR! unscoped packages cannot be private : z-tool</span><br><span class="line"></span><br><span class="line">npm ERR! A complete log of this run can be found in:</span><br><span class="line">npm ERR!     /Users/neverleave/.npm/_logs/2018-11-23T08_44_21_310Z-debug.log</span><br><span class="line">sh-neverleave:npm neverleave$ </span><br><span class="line"></span><br><span class="line">#解决方案：终端执行： npm publish --access public</span><br><span class="line">sh-neverleave:npm neverleave$ npm publish --access public</span><br><span class="line">+ z-tool@1.0.0</span><br><span class="line">sh-neverleave:npm neverleave$</span><br></pre></td></tr></table></figure><p>3、确保登录的用户账号正确</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">sh-neverleave:npm neverleave$ npm publish</span><br><span class="line">npm ERR! publish Failed PUT 404</span><br><span class="line">npm ERR! code E404</span><br><span class="line">npm ERR! 404 User not found : z-tool</span><br><span class="line">npm ERR! 404 </span><br><span class="line">npm ERR! 404  &#x27;z-tool&#x27; is not in the npm registry.</span><br><span class="line">npm ERR! 404 You should bug the author to publish it (or use the name yourself!)</span><br><span class="line">npm ERR! 404 </span><br><span class="line">npm ERR! 404 Note that you can also install from a</span><br><span class="line">npm ERR! 404 tarball, folder, http url, or git url.</span><br><span class="line"></span><br><span class="line">npm ERR! A complete log of this run can be found in:</span><br><span class="line">npm ERR!     /Users/neverleave/.npm/_logs/2018-11-23T07_32_28_518Z-debug.log</span><br></pre></td></tr></table></figure><p>4、登录时需要在username 前加‘~’，具体大家可以验证</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sh-neverleave:npm neverleave$ npm login</span><br><span class="line">Username: (~neverleave) neverleave</span><br><span class="line">Password: (&lt;default hidden&gt;) </span><br><span class="line">Email: (this IS public) (1063588359@qq.com) </span><br><span class="line">npm ERR! code EAUTHIP</span><br><span class="line">npm ERR! Unable to authenticate, need: Basic</span><br><span class="line"></span><br><span class="line">npm ERR! A complete log of this run can be found in:</span><br><span class="line">npm ERR!     /Users/neverleave/.npm/_logs/2018-11-23T07_27_50_877Z-debug.log</span><br><span class="line">sh-neverleave:npm neverleave$</span><br></pre></td></tr></table></figure><p>5、无权限删除线上的包（撤包有时间限制，24小时） 解决方案：加上 –force</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sh-neverleave:z-tool neverleave$ npm unpublish z-tool</span><br><span class="line">npm ERR! Refusing to delete entire project.</span><br><span class="line">npm ERR! Run with --force to do this.</span><br><span class="line">npm ERR! npm unpublish [&lt;@scope&gt;/]&lt;pkg&gt;[@&lt;version&gt;]</span><br><span class="line">sh-neverleave:z-tool neverleave$ </span><br><span class="line"></span><br><span class="line">#解决方案（内部有被鄙视的话，  I sure hope you know what you are doing.）</span><br><span class="line">sh-neverleave:z-tool neverleave$ npm unpublish z-tool --force</span><br><span class="line">npm WARN using --force I sure hope you know what you are doing.</span><br><span class="line">- z-tool</span><br><span class="line">sh-neverleave:z-tool neverleave$</span><br></pre></td></tr></table></figure><p>6、删除npm市场的包同名的24小时后才能重新发布</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sh-neverleave:z-tool neverleave$ npm publish</span><br><span class="line">npm ERR! publish Failed PUT 403</span><br><span class="line">npm ERR! code E403</span><br><span class="line">npm ERR! z-tool cannot be republished until 24 hours have passed. : z-tool</span><br><span class="line"></span><br><span class="line">npm ERR! A complete log of this run can be found in:</span><br><span class="line">npm ERR!     /Users/neverleave/.npm/_logs/2018-11-23T11_41_24_086Z-debug.log</span><br><span class="line">sh-neverleave:z-tool neverleave$</span><br></pre></td></tr></table></figure><p>完结…. </p>]]></content>
      
      
      <categories>
          
          <category> typescript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> npm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue3.0 + ts 生成带二维码的海报</title>
      <link href="/2021/12/11/vue3-0-ts-%E7%94%9F%E6%88%90%E5%B8%A6%E4%BA%8C%E7%BB%B4%E7%A0%81%E7%9A%84%E6%B5%B7%E6%8A%A5/"/>
      <url>/2021/12/11/vue3-0-ts-%E7%94%9F%E6%88%90%E5%B8%A6%E4%BA%8C%E7%BB%B4%E7%A0%81%E7%9A%84%E6%B5%B7%E6%8A%A5/</url>
      
        <content type="html"><![CDATA[<h3 id="生成带有二维码的海报"><a href="#生成带有二维码的海报" class="headerlink" title="生成带有二维码的海报"></a>生成带有二维码的海报</h3><p>​背景需求：生成一个带二维码的海报，可实现分享助力。</p><h3 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h3><ul><li>qrcodejs2 或者 qrcode.vue （生成二维码）</li><li>html2canvas （生成海报图）</li></ul><h3 id="安装使用"><a href="#安装使用" class="headerlink" title="安装使用"></a>安装使用</h3><ul><li><p>qrcodejs2</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// 安装插件 </span><br><span class="line">npm install --save qrcodejs2</span><br><span class="line">// 页面引入</span><br><span class="line">import QRCode from &quot;qrcodejs2&quot;;</span><br><span class="line">// 方法调用</span><br><span class="line"> &lt;div id=&quot;qrcode&quot; ref=&quot;qrcode&quot;&gt;&lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">const createQrCode = (dom: any, width: number, height: number， qtext: string) =&gt; &#123;</span><br><span class="line">      return new QRCode(dom, &#123;</span><br><span class="line">        width: width,</span><br><span class="line">        height: height,</span><br><span class="line">        text: qtext,</span><br><span class="line">        colorDark: &quot;#000&quot;,</span><br><span class="line">        colorLight: &quot;#fff&quot;,</span><br><span class="line">      &#125;);</span><br><span class="line">   &#125;;</span><br></pre></td></tr></table></figure></li><li><p>qrcode.vue </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;qrcode-vue :value=&quot;value&quot; :size=&quot;size&quot; level=&quot;H&quot; /&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  import QrcodeVue from &#x27;qrcode.vue&#x27;</span><br><span class="line"></span><br><span class="line">  export default &#123;</span><br><span class="line">    data() &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        value: &#x27;https://example.com&#x27;,</span><br><span class="line">        size: 300,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    components: &#123;</span><br><span class="line">      QrcodeVue,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></li><li><p>html2canvas</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// 安装插件</span><br><span class="line">npm install --save html2canvas</span><br><span class="line">// 页面引入    </span><br><span class="line">const createPoster = (dom: any) =&gt; &#123;</span><br><span class="line">      html2canvas(dom, &#123;</span><br><span class="line">        useCORS: true, //开启跨域配置</span><br><span class="line">        allowTaint: true,  //允许跨域（图片跨域相关）</span><br><span class="line">        logging: true,</span><br><span class="line">        taintTest: false,</span><br><span class="line">      &#125;).then((canvas: any) =&gt; &#123;</span><br><span class="line">        state.packageInfo.shareImage[0].imageUrl =</span><br><span class="line">          canvas.toDataURL(&quot;image/jpeg&quot;);</span><br><span class="line">        state.posterWrap = false;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure></li><li><p>问题总结：刚开始使用阿里os图片的时候 生成海报都是白色背景 没有相应的图片 可以把图片统一转换base64格式</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">const urlToBase64 = (url: string) =&gt; &#123;</span><br><span class="line">     return new Promise&lt;string&gt;((resolve, reject) =&gt; &#123;</span><br><span class="line">       const Img = new Image();</span><br><span class="line">       Img.setAttribute(&quot;crossOrigin&quot;, &quot;Anonymous&quot;);</span><br><span class="line">       Img.onload = function () &#123;</span><br><span class="line">         const canvas = document.createElement(&quot;canvas&quot;);</span><br><span class="line">         canvas.width = Img.width;</span><br><span class="line">         canvas.height = Img.height;</span><br><span class="line">         const ctx = canvas.getContext(&quot;2d&quot;) as CanvasRenderingContext2D;</span><br><span class="line">         ctx.drawImage(Img, 0, 0, Img.width, Img.height);</span><br><span class="line">         const base64 = canvas.toDataURL(&quot;image/jpeg&quot;);</span><br><span class="line">         resolve(base64);</span><br><span class="line">       &#125;;</span><br><span class="line">       Img.onerror = function (e) &#123;</span><br><span class="line">         console.log(&quot;图片加载失败：&quot;);</span><br><span class="line">         reject(new Error(&quot;图片加载失败：&quot; + e));</span><br><span class="line">       &#125;;</span><br><span class="line">       Img.src = url;</span><br><span class="line">     &#125;);</span><br><span class="line">   &#125;;</span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">     urlToBase64(&quot;xxoo&quot;)</span><br><span class="line">       .then(async (res) =&gt; &#123;</span><br><span class="line">         state.canvasUrl = res;</span><br><span class="line">         await createPoster();</span><br><span class="line">       &#125;)</span><br><span class="line">       .catch((err) =&gt; &#123;</span><br><span class="line">         console.log(err);</span><br><span class="line">         // do....</span><br><span class="line">       &#125;);</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> vue typescript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue typescript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue路由传参的几种方式</title>
      <link href="/2021/11/15/vue%E8%B7%AF%E7%94%B1%E4%BC%A0%E5%8F%82%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F/"/>
      <url>/2021/11/15/vue%E8%B7%AF%E7%94%B1%E4%BC%A0%E5%8F%82%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h3 id="路由跳转的两种方式"><a href="#路由跳转的两种方式" class="headerlink" title="路由跳转的两种方式"></a>路由跳转的两种方式</h3><h4 id="1-声明式导航"><a href="#1-声明式导航" class="headerlink" title="1. 声明式导航"></a>1. 声明式导航</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1. 使用router-link的to属性进行路由跳转 to的值是要跳转到的那个路由</span><br><span class="line"></span><br><span class="line">// 1.1 to后直接跟路由</span><br><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/home&quot;</span>&gt;</span>to home<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span> </span><br><span class="line">// 1.2 to后跟一个配置对象path属性是要跳转到的那个路由</span><br><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">:to</span>=<span class="string">&quot;&#123; path: &#x27;/home&#x27; &#125;&quot;</span>&gt;</span>to home<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span> </span><br><span class="line">// 1.3 to后跟一个配置对象，使用命名路由的name进行跳转</span><br><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">:to</span>=<span class="string">&quot;&#123; name: &#x27;homeIndex&#x27; &#125;&quot;</span>&gt;</span>to home<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line"></span><br><span class="line">2. 查询字符串形式 路由传参  to的值是一个配置对象 以查询字符串形式携带 url?id=123</span><br><span class="line">// 2.1 以 url?id=123&amp;name=zs的形式携带</span><br><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">:to</span>=<span class="string">&quot;&#123; path: &#x27;/home?id=123&#x27; &#125;&quot;</span>&gt;</span>to home?id=123<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">// 2.2 以query属性进行传参</span><br><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">:to</span>=<span class="string">&quot;&#123; path: &#x27;/home&#x27;, query: &#123; id: 123 &#125; &#125;&quot;</span>&gt;</span>to home 以query携带<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">// 2.3 以params进行传参 需要命名路由name</span><br><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">:to</span>=<span class="string">&quot;&#123; name: &#x27;userIndex&#x27;, params: &#123; id: 123 &#125; &#125;&quot;</span>&gt;</span>to user 以params携带<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-编程式导航"><a href="#2-编程式导航" class="headerlink" title="2. 编程式导航"></a>2. 编程式导航</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1. 使用this.$router进行跳转 $router可以访问到路由的实例</span><br><span class="line"></span><br><span class="line">this.$router.push(&#x27;/home&#x27;)</span><br><span class="line">this.$router.push(&#x27;/home?id=123&#x27;)</span><br><span class="line">this.$router.push(&#123; path: &#x27;/home&#x27;, query: &#123; id: 123 &#125; &#125;)</span><br><span class="line">this.$router.push(&#123; name: &#x27;homeIndex&#x27;, params: &#123; id: 123 &#125; &#125;)</span><br><span class="line"></span><br><span class="line">2. $router实例的跳转方法</span><br><span class="line">push() 跳转到指定的路由，向history历史中添加记录，点击返回，返回到来之前的路由。</span><br><span class="line">go(n) 向前前进 n 或 后退 n个路由 n可为负数</span><br><span class="line">replace() 跳转到指定的路由，但是不会在history中添加记录，点击返回，会跳转到上上一个路由。</span><br><span class="line">back() 后退</span><br><span class="line">forward() 前进</span><br></pre></td></tr></table></figure><h4 id="3-参数的接收"><a href="#3-参数的接收" class="headerlink" title="3. 参数的接收"></a>3. 参数的接收</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 1. 查询字符串   url?id123    query</span><br><span class="line">this.$route.query</span><br><span class="line"></span><br><span class="line">// 2. params</span><br><span class="line">this.$route.params</span><br></pre></td></tr></table></figure><p><strong>注意:</strong><br> 以查询字符串 query进行传递的参数，刷新页面，数据依然存在。<br> 以params传递的参数，刷新页面就会丢失。<br> 跳转用$router<br> 获取参数用$route</p>]]></content>
      
      
      <categories>
          
          <category> vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>前端面试分享</title>
      <link href="/2021/11/11/%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95%E5%88%86%E4%BA%AB/"/>
      <url>/2021/11/11/%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95%E5%88%86%E4%BA%AB/</url>
      
        <content type="html"><![CDATA[<hr><ol><li><h4 id="盒子模型"><a href="#盒子模型" class="headerlink" title="盒子模型"></a>盒子模型</h4><p>包括<strong>内容区域</strong>、<strong>内边距区域</strong>、<strong>边框区域</strong>和<strong>外边距区域</strong>。</p><img src="/2021/11/11/%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95%E5%88%86%E4%BA%AB/box.png" class="" title="box"><p><code>box-sizing: content-box</code>（W3C盒子模型）：元素的宽高大小表现为<strong>内容</strong>的大小。 </p><p><code>box-sizing: border-box</code>（IE盒子模型）：元素的宽高表现为<strong>内容 + 内边距 + 边框</strong>的大小。背景会延伸到边框的外沿。</p><p>IE5.x和IE6在怪异模式中使用非标准的盒子模型，这些浏览器的<code>width</code>属性不是<strong>内容</strong>的宽度，而是<strong>内容</strong>、<strong>内边距</strong>和<strong>边框</strong>的宽度的总和。</p></li><li><h4 id="如何实现左侧宽度固定，右侧宽度自适应的布局"><a href="#如何实现左侧宽度固定，右侧宽度自适应的布局" class="headerlink" title="如何实现左侧宽度固定，右侧宽度自适应的布局"></a>如何实现左侧宽度固定，右侧宽度自适应的布局</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;box&quot;&gt;</span><br><span class="line">  &lt;div class=&quot;box-left&quot;&gt;&lt;/div&gt;</span><br><span class="line">  &lt;div class=&quot;box-right&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">.box &#123;</span><br><span class="line"> height: 200px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.box &gt; div &#123;</span><br><span class="line">  height: 100%;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">1.利用float + margin实现</span><br><span class="line">.box-left &#123;</span><br><span class="line">  width: 200px;</span><br><span class="line">  float: left;</span><br><span class="line">  background-color: blue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.box-right &#123;</span><br><span class="line">  margin-left: 200px;</span><br><span class="line">  background-color: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.利用calc计算宽度</span><br><span class="line">.box-left &#123;</span><br><span class="line">  width: 200px;</span><br><span class="line">  float: left;</span><br><span class="line">  background-color: blue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.box-right &#123;</span><br><span class="line">  width: calc(100% - 200px);</span><br><span class="line">  float: right;</span><br><span class="line">  background-color: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">3.利用float + overflow实现</span><br><span class="line">.box-left &#123;</span><br><span class="line">  width: 200px;</span><br><span class="line">  float: left;</span><br><span class="line">  background-color: blue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.box-right &#123;</span><br><span class="line">  overflow: hidden;</span><br><span class="line">  background-color: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">4.利用flex实现</span><br><span class="line">.box-left &#123;</span><br><span class="line">  width: 200px;</span><br><span class="line">  background-color: blue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.box-right &#123;</span><br><span class="line">  flex: 1; // 设置flex-grow属性为1，默认为0</span><br><span class="line">  overflow: hidden;</span><br><span class="line">  background-color: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> 前端面试题 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 前端面试题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>什么是BFC</title>
      <link href="/2021/11/11/%E4%BB%80%E4%B9%88%E6%98%AFBFC/"/>
      <url>/2021/11/11/%E4%BB%80%E4%B9%88%E6%98%AFBFC/</url>
      
        <content type="html"><![CDATA[<h4 id="什么是BFC"><a href="#什么是BFC" class="headerlink" title="什么是BFC"></a>什么是BFC</h4><p>​BFC 全称为块级格式化上下文 (Block Formatting Context) 。BFC是 W3C CSS 2.1 规范中的一个概念，它决定了元素如何对其内容进行定位以及与其他元素的关系和相互作用，当涉及到可视化布局的时候，Block Formatting Context提供了一个环境，HTML元素在这个环境中按照一定规则进行布局。一个环境中的元素不会影响到其它环境中的布局。比如浮动元素会形成BFC，浮动元素内部子元素的主要受该浮动元素影响，两个浮动元素之间是互不影响的。这里有点类似一个BFC就是一个独立的行政单位的意思。可以说BFC就是一个作用范围，把它理解成是一个独立的容器，并且这个容器里box的布局与这个容器外的box毫不相干。</p><h4 id="触发BFC的条件"><a href="#触发BFC的条件" class="headerlink" title="触发BFC的条件"></a>触发BFC的条件</h4><ul><li>根元素或其它包含它的元素</li><li>浮动元素 (元素的 <code>float</code> 不是 <code>none</code>)</li><li>绝对定位元素 (元素具有 <code>position</code> 为 <code>absolute</code> 或 <code>fixed</code>)</li><li>内联块 (元素具有 <code>display: inline-block</code>)</li><li>表格单元格 (元素具有 <code>display: table-cell</code>，HTML表格单元格默认属性)</li><li>表格标题 (元素具有 <code>display: table-caption</code>, HTML表格标题默认属性)</li><li>具有<code>overflow</code> 且值不是 <code>visible</code> 的块元素</li><li>弹性盒（<code>flex</code>或<code>inline-flex</code>）</li><li><code>display: flow-root</code></li><li><code>column-span: all</code></li></ul><h4 id="BFC的约束规则"><a href="#BFC的约束规则" class="headerlink" title="BFC的约束规则"></a>BFC的约束规则</h4><ul><li>内部的盒会在垂直方向一个接一个排列（可以看作BFC中有一个的常规流）</li><li>处于同一个BFC中的元素相互影响，可能会发生外边距重叠</li><li>每个元素的margin box的左边，与容器块border box的左边相接触(对于从左往右的格式化，否则相反)，即使存在浮动也是如此</li><li>BFC就是页面上的一个隔离的独立容器，容器里面的子元素不会影响到外面的元素，反之亦然</li><li>计算BFC的高度时，考虑BFC所包含的所有元素，连浮动元素也参与计算</li><li>浮动盒区域不叠加到BFC上</li></ul><h4 id="BFC可以解决的问题"><a href="#BFC可以解决的问题" class="headerlink" title="BFC可以解决的问题"></a>BFC可以解决的问题</h4><ul><li>垂直外边距重叠问题</li><li>去除浮动</li><li>自适用两列布局（<code>float</code> + <code>overflow</code>）</li></ul><h3 id="BFC的作用"><a href="#BFC的作用" class="headerlink" title="BFC的作用"></a>BFC的作用</h3><h6 id="1-利用BFC避免margin重叠。"><a href="#1-利用BFC避免margin重叠。" class="headerlink" title="1.利用BFC避免margin重叠。"></a>1.利用BFC避免margin重叠。</h6><p>一起来看一个例子：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;</span><br><span class="line">    &lt;title&gt;防止margin重叠&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">    *&#123;</span><br><span class="line">        margin: 0;</span><br><span class="line">        padding: 0;</span><br><span class="line">    &#125;</span><br><span class="line">    p &#123;</span><br><span class="line">        color: #f55;</span><br><span class="line">        background: yellow;</span><br><span class="line">        width: 200px;</span><br><span class="line">        line-height: 100px;</span><br><span class="line">        text-align:center;</span><br><span class="line">        margin: 30px;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;p&gt;看看我的 margin是多少&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;看看我的 margin是多少&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>页面生成的效果就是这样的：</p><img src="/2021/11/11/%E4%BB%80%E4%B9%88%E6%98%AFBFC/margin.png" class="" title="margin"><p>根据第二条，属于同一个BFC的两个相邻的Box会发生margin重叠，所以我们可以设置，两个不同的BFC，也就是我们可以让把第二个p用div包起来，然后激活它使其成为一个BFC</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;</span><br><span class="line">    &lt;title&gt;防止margin重叠&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">    *&#123;</span><br><span class="line">        margin: 0;</span><br><span class="line">        padding: 0;</span><br><span class="line">    &#125;</span><br><span class="line">    p &#123;</span><br><span class="line">        color: #f55;</span><br><span class="line">        background: yellow;</span><br><span class="line">        width: 200px;</span><br><span class="line">        line-height: 100px;</span><br><span class="line">        text-align:center;</span><br><span class="line">        margin: 30px;</span><br><span class="line">    &#125;</span><br><span class="line">    div&#123;</span><br><span class="line">        overflow: hidden;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;p&gt;看看我的 margin是多少&lt;/p&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;p&gt;看看我的 margin是多少&lt;/p&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><img src="/2021/11/11/%E4%BB%80%E4%B9%88%E6%98%AFBFC/margin_r.png" class="" title="margin_r"><h6 id="2-自适应两栏布局"><a href="#2-自适应两栏布局" class="headerlink" title="2.自适应两栏布局"></a>2.自适应两栏布局</h6><p>根据：</p><ul><li>每个盒子的margin box的左边，与包含块border box的左边相接触(对于从左往右的格式化，否则相反)。即使存在浮动也是如此。</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">    *&#123;</span><br><span class="line">        margin: 0;</span><br><span class="line">        padding: 0;</span><br><span class="line">    &#125;</span><br><span class="line">    body &#123;</span><br><span class="line">        width: 100%;</span><br><span class="line">        position: relative;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    .left &#123;</span><br><span class="line">        width: 100px;</span><br><span class="line">        height: 150px;</span><br><span class="line">        float: left;</span><br><span class="line">        background: rgb(139, 214, 78);</span><br><span class="line">        text-align: center;</span><br><span class="line">        line-height: 150px;</span><br><span class="line">        font-size: 20px;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    .right &#123;</span><br><span class="line">        height: 300px;</span><br><span class="line">        background: rgb(170, 54, 236);</span><br><span class="line">        text-align: center;</span><br><span class="line">        line-height: 300px;</span><br><span class="line">        font-size: 40px;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div class=&quot;left&quot;&gt;LEFT&lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;right&quot;&gt;RIGHT&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><img src="/2021/11/11/%E4%BB%80%E4%B9%88%E6%98%AFBFC/2019032316073845.png" class="" width="2019032316073845"><p>又因为：</p><ul><li>BFC的区域不会与float box重叠。</li></ul><p>所以我们让right单独成为一个BFC</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">    *&#123;</span><br><span class="line">        margin: 0;</span><br><span class="line">        padding: 0;</span><br><span class="line">    &#125;</span><br><span class="line">    body &#123;</span><br><span class="line">        width: 100%;</span><br><span class="line">        position: relative;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    .left &#123;</span><br><span class="line">        width: 100px;</span><br><span class="line">        height: 150px;</span><br><span class="line">        float: left;</span><br><span class="line">        background: rgb(139, 214, 78);</span><br><span class="line">        text-align: center;</span><br><span class="line">        line-height: 150px;</span><br><span class="line">        font-size: 20px;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    .right &#123;</span><br><span class="line">        overflow: hidden;</span><br><span class="line">        height: 300px;</span><br><span class="line">        background: rgb(170, 54, 236);</span><br><span class="line">        text-align: center;</span><br><span class="line">        line-height: 300px;</span><br><span class="line">        font-size: 40px;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div class=&quot;left&quot;&gt;LEFT&lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;right&quot;&gt;RIGHT&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><img src="/2021/11/11/%E4%BB%80%E4%B9%88%E6%98%AFBFC/20190323161159873.png" class="" width="20190323161159873"><p>right会自动的适应宽度，这时候就形成了一个两栏自适应的布局。</p><h6 id="3-清楚浮动。"><a href="#3-清楚浮动。" class="headerlink" title="3.清楚浮动。"></a>3.清楚浮动。</h6><p>当我们不给父节点设置高度，子节点设置浮动的时候，会发生高度塌陷，这个时候我们就要清楚浮动。</p><p>比如这样：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;</span><br><span class="line">    &lt;title&gt;清除浮动&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">    .par &#123;</span><br><span class="line">        border: 5px solid rgb(91, 243, 30);</span><br><span class="line">        width: 300px;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .child &#123;</span><br><span class="line">        border: 5px solid rgb(233, 250, 84);</span><br><span class="line">        width:100px;</span><br><span class="line">        height: 100px;</span><br><span class="line">        float: left;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div class=&quot;par&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;child&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;child&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><img src="/2021/11/11/%E4%BB%80%E4%B9%88%E6%98%AFBFC/20190323161720931.png" class="" width="20190323161720931"><p>这个时候我们根据最后一条：</p><ul><li>计算BFC的高度时，浮动元素也参与计算。</li></ul><p>给父节点激活BFC</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;</span><br><span class="line">    &lt;title&gt;清除浮动&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">    .par &#123;</span><br><span class="line">        border: 5px solid rgb(91, 243, 30);</span><br><span class="line">        width: 300px;</span><br><span class="line">        overflow: hidden;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .child &#123;</span><br><span class="line">        border: 5px solid rgb(233, 250, 84);</span><br><span class="line">        width:100px;</span><br><span class="line">        height: 100px;</span><br><span class="line">        float: left;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div class=&quot;par&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;child&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;child&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><img src="/2021/11/11/%E4%BB%80%E4%B9%88%E6%98%AFBFC/20190323161945489.png" class="" width="20190323161945489"><p>总结<br>以上例子都体现了：</p><p>BFC就是页面上的一个隔离的独立容器，容器里面的子元素不会影响到外面的元素。反之也如此。</p><p>因为BFC内部的元素和外部的元素绝对不会互相影响，因此， 当BFC外部存在浮动时，它不应该影响BFC内部Box的布局，BFC会通过变窄，而不与浮动有重叠。同样的，当BFC内部有浮动时，为了不影响外部元素的布局，BFC计算高度时会包括浮动的高度。避免margin重叠也是这样的一个道理。<br>————————————————<br>版权声明：本文为CSDN博主「Leon_94」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a href="https://blog.csdn.net/sinat_36422236/article/details/88763187">https://blog.csdn.net/sinat_36422236/article/details/88763187</a></p>]]></content>
      
      
      <categories>
          
          <category> CSS HTML </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS HTML </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue-cli 3/4兼容Android低版本白屏问题</title>
      <link href="/2021/10/29/vue-cli-3-4%E5%85%BC%E5%AE%B9Android%E4%BD%8E%E7%89%88%E6%9C%AC%E7%99%BD%E5%B1%8F%E9%97%AE%E9%A2%98/"/>
      <url>/2021/10/29/vue-cli-3-4%E5%85%BC%E5%AE%B9Android%E4%BD%8E%E7%89%88%E6%9C%AC%E7%99%BD%E5%B1%8F%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h4 id="问题描述："><a href="#问题描述：" class="headerlink" title="问题描述："></a>问题描述：</h4><p>​运行很久的H5页面，突然大量用户反馈打开页面白屏，根据多方问题排查 最终确定是Android版本导致的 目前已知Android6.0运行是OK的 Android5.0环境允许白屏 ，具体原因是低版本安卓系统内置的 webview 不支持 ES6 语法等一些新特性，所以报错。</p><ol><li><p>根目录下新建 .babelrc 文件</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;presets&quot;</span>: [<span class="string">&quot;@babel/preset-env&quot;</span>],</span><br><span class="line">  <span class="string">&quot;plugins&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;@babel/plugin-transform-runtime&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>修改 babel.config.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line"><span class="attr">presets</span>: [</span><br><span class="line">[</span><br><span class="line"><span class="string">&#x27;@vue/app&#x27;</span>,</span><br><span class="line">&#123;</span><br><span class="line"><span class="attr">useBuiltIns</span>: <span class="string">&#x27;entry&#x27;</span>,</span><br><span class="line"><span class="attr">polyfills</span>: [</span><br><span class="line"><span class="string">&#x27;es6.promise&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;es6.symbol&#x27;</span></span><br><span class="line">]</span><br><span class="line">&#125;</span><br><span class="line">]</span><br><span class="line">]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>修改 main.js 文件，导入依赖</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;@babel/polyfill&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Es6Promise</span> <span class="keyword">from</span> <span class="string">&#x27;es6-promise&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;es6-promise&#x27;</span>).<span class="title function_">polyfill</span>()</span><br><span class="line"><span class="title class_">Es6Promise</span>.<span class="title function_">polyfill</span>()</span><br></pre></td></tr></table></figure></li><li><p>配置vue.config.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">resolve</span>(<span class="params">dir</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;.&#x27;</span>, dir);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  ...  <span class="comment">// 其他配置</span></span><br><span class="line">    </span><br><span class="line">  <span class="comment">// 默认情况下 babel-loader 会忽略所有 node_modules 中的文件。</span></span><br><span class="line">  <span class="comment">// 如果你想要通过 Babel 显式转译一个依赖，可以在这个选项中列出来</span></span><br><span class="line">  <span class="comment">// 重要</span></span><br><span class="line">  <span class="attr">transpileDependencies</span>: [<span class="string">&#x27;node_modules/webpack-dev-server/client&#x27;</span>],</span><br><span class="line">  <span class="attr">chainWebpack</span>: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//重要</span></span><br><span class="line">    config.<span class="property">entry</span>.<span class="property">app</span> = [<span class="string">&#x27;@babel/polyfill&#x27;</span>, <span class="string">&#x27;./src/main.js&#x27;</span>]</span><br><span class="line">      </span><br><span class="line">    <span class="comment">//重要：通过add方法，配置babel需要另外转换的文件</span></span><br><span class="line">    config.<span class="property">module</span>.<span class="title function_">rule</span>(<span class="string">&#x27;compile&#x27;</span>)</span><br><span class="line">      .<span class="title function_">test</span>(<span class="regexp">/\.js$/</span>)</span><br><span class="line">      .<span class="property">include</span></span><br><span class="line">      .<span class="title function_">add</span>(<span class="title function_">resolve</span>(<span class="string">&#x27;src&#x27;</span>))</span><br><span class="line">      .<span class="title function_">add</span>(<span class="title function_">resolve</span>(<span class="string">&#x27;test&#x27;</span>))</span><br><span class="line">      .<span class="title function_">add</span>(<span class="title function_">resolve</span>(<span class="string">&#x27;static&#x27;</span>))</span><br><span class="line">      .<span class="title function_">add</span>(<span class="title function_">resolve</span>(<span class="string">&#x27;node_modules/webpack-dev-server/client&#x27;</span>))</span><br><span class="line">      .<span class="title function_">add</span>(<span class="title function_">resolve</span>(<span class="string">&#x27;node_modules&#x27;</span>))</span><br><span class="line">      .<span class="title function_">end</span>()</span><br><span class="line">      .<span class="title function_">use</span>(<span class="string">&#x27;babel&#x27;</span>)</span><br><span class="line">      .<span class="title function_">loader</span>(<span class="string">&#x27;babel-loader&#x27;</span>)</span><br><span class="line">      .<span class="title function_">options</span>(&#123;</span><br><span class="line">        <span class="attr">presets</span>: [</span><br><span class="line">          [<span class="string">&#x27;@babel/preset-env&#x27;</span>, &#123;</span><br><span class="line">            <span class="attr">modules</span>: <span class="literal">false</span></span><br><span class="line">          &#125;]</span><br><span class="line">        ]</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>安装的依赖</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev @babel/core @babel/plugin-transform-runtime @babel/preset-env es6-promise @babel/polyfill babel-plugin-transform-remove-<span class="variable language_">console</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>注意：如果发布到测试环境和线上环境时，发现没有生效，主要问题在第5步安装依赖，npm时使用–save-dev只会将依赖保存到package.json的devDependencies中，只有开发环境才有效，其他环境无效；故将命令修改为以下命令：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 如果知道依赖的确切版本，可以直接配置到package.<span class="property">json</span>的dependencies中</span><br><span class="line">npm install --save @babel/core @babel/plugin-transform-runtime @babel/preset-env es6-promise @babel/polyfill </span><br><span class="line"></span><br><span class="line">#  <span class="title class_">To</span> install it, you can <span class="attr">run</span>: npm install --save -- </span><br><span class="line">#  @babel/runtime/helpers/createForOfIteratorHelper </span><br><span class="line">#  如果上一步没有报缺少该依赖，可以不要</span><br><span class="line">npm install –save @babel/runtime </span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p><strong>–save-dev说明：</strong></p></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">--save || -S <span class="comment">// 运行依赖（发布）</span></span><br><span class="line">–save-dev || -D <span class="comment">//开发依赖（辅助）</span></span><br><span class="line"></span><br><span class="line">区别是它们会把依赖包添加到package.<span class="property">json</span> 文件</span><br><span class="line"></span><br><span class="line">–save ： dependencies 键下，发布后还需要依赖的模块，譬如像jQuery库或者<span class="title class_">Angular</span>框架类似的，我们在开发完后后肯定还要依赖它们，否则就运行不了。</span><br><span class="line">(<span class="number">1</span>)尽量还是使用此命令，因为一般情况下，我们线上也需要同样的依赖</span><br><span class="line">(<span class="number">2</span>)使用此命令安装后，会在package.<span class="property">json</span>中dependencies新增依赖项，如果我们知道依赖项确切版本，也可以直接到json文件添加，以后在打包时，直接npm install即可</span><br><span class="line"></span><br><span class="line">–save-dev ： devDependencies 键下，开发时的依赖比如安装 js的压缩包gulp-uglify 因为我们在发布后用不到它，而只是在我们开发才用到它。</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> vue android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSS八种让人眼前一亮的HOVER效果</title>
      <link href="/2021/10/25/CSS%E5%85%AB%E7%A7%8D%E8%AE%A9%E4%BA%BA%E7%9C%BC%E5%89%8D%E4%B8%80%E4%BA%AE%E7%9A%84HOVER%E6%95%88%E6%9E%9C/"/>
      <url>/2021/10/25/CSS%E5%85%AB%E7%A7%8D%E8%AE%A9%E4%BA%BA%E7%9C%BC%E5%89%8D%E4%B8%80%E4%BA%AE%E7%9A%84HOVER%E6%95%88%E6%9E%9C/</url>
      
        <content type="html"><![CDATA[<h1 id="CSS八种让人眼前一亮的HOVER效果"><a href="#CSS八种让人眼前一亮的HOVER效果" class="headerlink" title="CSS八种让人眼前一亮的HOVER效果"></a>CSS八种让人眼前一亮的HOVER效果</h1><p>本文不是原创，原文链接请戳文末链接。</p><h3 id="一-发送效果"><a href="#一-发送效果" class="headerlink" title="一.发送效果"></a>一.发送效果</h3><h4 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;send-btn&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span>&gt;</span></span><br><span class="line">    // 这里是一个svg的占位</span><br><span class="line">    Send</span><br><span class="line">  <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h4 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#send-btn</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100vh</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">button</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#5f55af</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">30px</span> <span class="number">10px</span> <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">  <span class="attribute">text-transform</span>: uppercase;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">button</span> svg &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">  <span class="attribute">padding-right</span>: <span class="number">5px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">button</span><span class="selector-pseudo">:hover</span> svg &#123;</span><br><span class="line">  <span class="attribute">animation</span>: fly <span class="number">2s</span> ease <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@keyframes</span> fly &#123;</span><br><span class="line">  <span class="number">0%</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translateX</span>(<span class="number">0%</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">50%</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translateX</span>(<span class="number">300%</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">100%</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translateX</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h4 id="GIF图"><a href="#GIF图" class="headerlink" title="GIF图"></a>GIF图</h4><img src="/2021/10/25/CSS%E5%85%AB%E7%A7%8D%E8%AE%A9%E4%BA%BA%E7%9C%BC%E5%89%8D%E4%B8%80%E4%BA%AE%E7%9A%84HOVER%E6%95%88%E6%9E%9C/ba88b49b984a48b2adc72db1b62049c7~tplv-k3u1fbpfcp-watermark.awebp" class="" title="hover_effect_send"><h3 id="二-霓虹效果"><a href="#二-霓虹效果" class="headerlink" title="二.霓虹效果"></a>二.霓虹效果</h3><h4 id="HTML-1"><a href="#HTML-1" class="headerlink" title="HTML"></a>HTML</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;neon-btn&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn one&quot;</span>&gt;</span>Hover me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span>  <span class="attr">class</span>=<span class="string">&quot;btn two&quot;</span>&gt;</span>Hover me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span>  <span class="attr">class</span>=<span class="string">&quot;btn three&quot;</span>&gt;</span>Hover me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h4 id="CSS-1"><a href="#CSS-1" class="headerlink" title="CSS"></a>CSS</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#neon-btn</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-around;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100vh</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#031628</span>; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.btn</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid;</span><br><span class="line">  <span class="attribute">background-color</span>: transparent;</span><br><span class="line">  <span class="attribute">text-transform</span>: uppercase;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">300</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.one</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#4cc9f0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.two</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#f038ff</span>; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.three</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#b9e769</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.btn</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.one</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#4cc9f0</span>;</span><br><span class="line">  -webkit-<span class="attribute">box-shadow</span>: <span class="number">10px</span> <span class="number">10px</span> <span class="number">99px</span> <span class="number">6px</span> <span class="built_in">rgba</span>(<span class="number">76</span>,<span class="number">201</span>,<span class="number">240</span>,<span class="number">1</span>);</span><br><span class="line">  -moz-<span class="attribute">box-shadow</span>: <span class="number">10px</span> <span class="number">10px</span> <span class="number">99px</span> <span class="number">6px</span> <span class="built_in">rgba</span>(<span class="number">76</span>,<span class="number">201</span>,<span class="number">240</span>,<span class="number">1</span>);</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">10px</span> <span class="number">10px</span> <span class="number">99px</span> <span class="number">6px</span> <span class="built_in">rgba</span>(<span class="number">76</span>,<span class="number">201</span>,<span class="number">240</span>,<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.two</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#f038ff</span>;</span><br><span class="line">  -webkit-<span class="attribute">box-shadow</span>: <span class="number">10px</span> <span class="number">10px</span> <span class="number">99px</span> <span class="number">6px</span> <span class="built_in">rgba</span>(<span class="number">240</span>, <span class="number">56</span>, <span class="number">255</span>, <span class="number">1</span>);</span><br><span class="line">  -moz-<span class="attribute">box-shadow</span>: <span class="number">10px</span> <span class="number">10px</span> <span class="number">99px</span> <span class="number">6px</span> <span class="built_in">rgba</span>(<span class="number">240</span>, <span class="number">56</span>, <span class="number">255</span>, <span class="number">1</span>);</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">10px</span> <span class="number">10px</span> <span class="number">99px</span> <span class="number">6px</span> <span class="built_in">rgba</span>(<span class="number">240</span>, <span class="number">56</span>, <span class="number">255</span>, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.three</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#b9e769</span>;</span><br><span class="line">  -webkit-<span class="attribute">box-shadow</span>: <span class="number">10px</span> <span class="number">10px</span> <span class="number">99px</span> <span class="number">6px</span> <span class="built_in">rgba</span>(<span class="number">185</span>, <span class="number">231</span>, <span class="number">105</span>, <span class="number">1</span>);</span><br><span class="line">  -moz-<span class="attribute">box-shadow</span>: <span class="number">10px</span> <span class="number">10px</span> <span class="number">99px</span> <span class="number">6px</span> <span class="built_in">rgba</span>(<span class="number">185</span>, <span class="number">231</span>, <span class="number">105</span>, <span class="number">1</span>);</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">10px</span> <span class="number">10px</span> <span class="number">99px</span> <span class="number">6px</span> <span class="built_in">rgba</span>(<span class="number">185</span>, <span class="number">231</span>, <span class="number">105</span>, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h4 id="GIF图-1"><a href="#GIF图-1" class="headerlink" title="GIF图"></a>GIF图</h4><img src="/2021/10/25/CSS%E5%85%AB%E7%A7%8D%E8%AE%A9%E4%BA%BA%E7%9C%BC%E5%89%8D%E4%B8%80%E4%BA%AE%E7%9A%84HOVER%E6%95%88%E6%9E%9C/63bd83b42ff94b6a8d645a6d564c3ca8~tplv-k3u1fbpfcp-watermark.awebp" class="" title="hover_effect_neon"><h3 id="三-边框效果"><a href="#三-边框效果" class="headerlink" title="三.边框效果"></a>三.边框效果</h3><h4 id="HTML-2"><a href="#HTML-2" class="headerlink" title="HTML"></a>HTML</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;draw-border&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span>&gt;</span>Hover me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h4 id="CSS-2"><a href="#CSS-2" class="headerlink" title="CSS"></a>CSS</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#draw-border</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100vh</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">button</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">background</span>: none;</span><br><span class="line">  <span class="attribute">text-transform</span>: uppercase;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#4361ee</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">outline</span>: none;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">button</span><span class="selector-pseudo">::before</span>, <span class="selector-tag">button</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">  <span class="attribute">box-sizing</span>: inherit;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">2px</span> solid transparent;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">button</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">button</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">button</span><span class="selector-pseudo">:hover</span><span class="selector-pseudo">::before</span>, <span class="selector-tag">button</span><span class="selector-pseudo">:hover</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">button</span><span class="selector-pseudo">:hover</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">border-top-color</span>: <span class="number">#4361ee</span>;</span><br><span class="line">  <span class="attribute">border-right-color</span>: <span class="number">#4361ee</span>;</span><br><span class="line">  <span class="attribute">transition</span>: width <span class="number">0.3s</span> ease-out, height <span class="number">0.3s</span> ease-out <span class="number">0.3s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">button</span><span class="selector-pseudo">:hover</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">  <span class="attribute">border-bottom-color</span>: <span class="number">#4361ee</span>;</span><br><span class="line">  <span class="attribute">border-left-color</span>: <span class="number">#4361ee</span>;</span><br><span class="line">  <span class="attribute">transition</span>: border-color <span class="number">0s</span> ease-out <span class="number">0.6s</span>, width <span class="number">0.3s</span> ease-out <span class="number">0.6s</span>, height <span class="number">0.3s</span> ease-out <span class="number">1s</span>;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h4 id="GIF效果"><a href="#GIF效果" class="headerlink" title="GIF效果"></a>GIF效果</h4><img src="/2021/10/25/CSS%E5%85%AB%E7%A7%8D%E8%AE%A9%E4%BA%BA%E7%9C%BC%E5%89%8D%E4%B8%80%E4%BA%AE%E7%9A%84HOVER%E6%95%88%E6%9E%9C/295e3b962d9b4b08b34226604343d256~tplv-k3u1fbpfcp-watermark.awebp" class="" title="hover_effect_draw"><h3 id="四-圆形效果"><a href="#四-圆形效果" class="headerlink" title="四.圆形效果"></a>四.圆形效果</h3><h4 id="HTML-3"><a href="#HTML-3" class="headerlink" title="HTML"></a>HTML</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;circle-btn&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;btn-container&quot;</span>&gt;</span></span><br><span class="line">    // 这里有一个svg元素</span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span>&gt;</span>Hover me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h4 id="CSS-3"><a href="#CSS-3" class="headerlink" title="CSS"></a>CSS</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#circle-btn</span> &#123; </span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100vh</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.btn-container</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">button</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#5f55af</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">15px</span> <span class="number">20px</span> <span class="number">16px</span> <span class="number">60px</span>;</span><br><span class="line">  <span class="attribute">text-transform</span>: uppercase;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(to right, <span class="number">#f72585</span> <span class="number">50%</span>, <span class="number">#5f55af</span> <span class="number">50%</span>);</span><br><span class="line">  <span class="attribute">background-size</span>: <span class="number">200%</span> <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">background-position</span>: right bottom;</span><br><span class="line">  <span class="attribute">transition</span>:all <span class="number">2s</span> ease;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">svg &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#f72585</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">8px</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">button</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">   <span class="attribute">background-position</span>: left bottom;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h4 id="GIF图-2"><a href="#GIF图-2" class="headerlink" title="GIF图"></a>GIF图</h4><img src="/2021/10/25/CSS%E5%85%AB%E7%A7%8D%E8%AE%A9%E4%BA%BA%E7%9C%BC%E5%89%8D%E4%B8%80%E4%BA%AE%E7%9A%84HOVER%E6%95%88%E6%9E%9C/4719262123064ff683dfdff17555efde~tplv-k3u1fbpfcp-watermark.awebp" class="" title="hover_effect_circle"><h3 id="五-圆角效果"><a href="#五-圆角效果" class="headerlink" title="五.圆角效果"></a>五.圆角效果</h3><h4 id="HTML-4"><a href="#HTML-4" class="headerlink" title="HTML"></a>HTML</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;border-btn&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span>&gt;</span>Hover me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h4 id="CSS-4"><a href="#CSS-4" class="headerlink" title="CSS"></a>CSS</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#border-btn</span> &#123; </span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100vh</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">button</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#2ec4b6</span>;</span><br><span class="line">  <span class="attribute">text-transform</span>: uppercase;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">15px</span> <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">outline</span>: none;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">transition</span>: border-radius <span class="number">3s</span>;</span><br><span class="line">  -webkit-<span class="attribute">transition</span>: border-radius <span class="number">3s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">button</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">   <span class="attribute">border-bottom-right-radius</span>: <span class="number">50px</span>;</span><br><span class="line">   <span class="attribute">border-top-left-radius</span>: <span class="number">50px</span>;</span><br><span class="line">   <span class="attribute">border-bottom-left-radius</span>: <span class="number">10px</span>;</span><br><span class="line">   <span class="attribute">border-top-right-radius</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h4 id="GIF图-3"><a href="#GIF图-3" class="headerlink" title="GIF图"></a>GIF图</h4><img src="/2021/10/25/CSS%E5%85%AB%E7%A7%8D%E8%AE%A9%E4%BA%BA%E7%9C%BC%E5%89%8D%E4%B8%80%E4%BA%AE%E7%9A%84HOVER%E6%95%88%E6%9E%9C/514387debb8643a19bf3311bb1b735c1~tplv-k3u1fbpfcp-watermark.awebp" class="" title="hover_effect_radius"><h3 id="六-冰冻效果"><a href="#六-冰冻效果" class="headerlink" title="六.冰冻效果"></a>六.冰冻效果</h3><h4 id="HTML-5"><a href="#HTML-5" class="headerlink" title="HTML"></a>HTML</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;frozen-btn&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;green&quot;</span>&gt;</span>Hover me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;purple&quot;</span>&gt;</span>Hover me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h4 id="CSS-5"><a href="#CSS-5" class="headerlink" title="CSS"></a>CSS</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#frozen-btn</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100vh</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">button</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">text-transform</span>: uppercase;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">15px</span> <span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">  <span class="attribute">outline</span>: none;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">button</span><span class="selector-pseudo">:before</span>&#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(to left, <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>) <span class="number">50%</span>, <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.4</span>) <span class="number">50%</span>);</span><br><span class="line">  <span class="attribute">background-size</span>: <span class="number">210%</span> <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">background-position</span>: right bottom;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">bottom</span>:<span class="number">0</span>;</span><br><span class="line">  <span class="attribute">right</span>:<span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">transition</span>: all <span class="number">1s</span>;</span><br><span class="line">  -webkit-<span class="attribute">transition</span>: all <span class="number">1s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.green</span> &#123;</span><br><span class="line">   <span class="attribute">background-image</span>: <span class="built_in">linear-gradient</span>(to right, <span class="number">#25aae1</span>, <span class="number">#40e495</span>);</span><br><span class="line">   <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">4px</span> <span class="number">15px</span> <span class="number">0</span> <span class="built_in">rgba</span>(<span class="number">49</span>, <span class="number">196</span>, <span class="number">190</span>, <span class="number">0.75</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.purple</span> &#123;</span><br><span class="line">   <span class="attribute">background-image</span>: <span class="built_in">linear-gradient</span>(to right, <span class="number">#6253e1</span>, <span class="number">#852D91</span>);</span><br><span class="line">   <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">4px</span> <span class="number">15px</span> <span class="number">0</span> <span class="built_in">rgba</span>(<span class="number">236</span>, <span class="number">116</span>, <span class="number">149</span>, <span class="number">0.75</span>);</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="selector-class">.purple</span><span class="selector-pseudo">:hover</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">background-position</span>: left bottom;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.green</span><span class="selector-pseudo">:hover</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">background-position</span>: left bottom;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h4 id="GIF图-4"><a href="#GIF图-4" class="headerlink" title="GIF图"></a>GIF图</h4><img src="/2021/10/25/CSS%E5%85%AB%E7%A7%8D%E8%AE%A9%E4%BA%BA%E7%9C%BC%E5%89%8D%E4%B8%80%E4%BA%AE%E7%9A%84HOVER%E6%95%88%E6%9E%9C/b8572b77cd25496d85655d4d6fb12a7d~tplv-k3u1fbpfcp-watermark.awebp" class="" title="hover_effect_frozen"><h3 id="七-闪亮效果"><a href="#七-闪亮效果" class="headerlink" title="七.闪亮效果"></a>七.闪亮效果</h3><h4 id="HTML-6"><a href="#HTML-6" class="headerlink" title="HTML"></a>HTML</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;shiny-shadow&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>Hover me<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h4 id="CSS-6"><a href="#CSS-6" class="headerlink" title="CSS"></a>CSS</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#shiny-shadow</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100vh</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#1c2541</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">button</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">2px</span> solid white;</span><br><span class="line">  <span class="attribute">background</span>: transparent;</span><br><span class="line">  <span class="attribute">text-transform</span>: uppercase;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">15px</span> <span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">outline</span>: none;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">span</span> &#123;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">20</span>;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">button</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">top</span>: -<span class="number">36px</span>;</span><br><span class="line">    <span class="attribute">left</span>: -<span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">background</span>: white;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">50px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">125px</span>;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">20%</span>;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(-<span class="number">45deg</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">button</span><span class="selector-pseudo">:hover</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">120%</span>;</span><br><span class="line">  <span class="attribute">transition</span>: all <span class="number">600ms</span> <span class="built_in">cubic-bezier</span>(<span class="number">0.3</span>, <span class="number">1</span>, <span class="number">0.2</span>, <span class="number">1</span>);</span><br><span class="line">   -webkit-<span class="attribute">transition</span>: all <span class="number">600ms</span> <span class="built_in">cubic-bezier</span>(<span class="number">0.3</span>, <span class="number">1</span>, <span class="number">0.2</span>, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h4 id="GIF图-5"><a href="#GIF图-5" class="headerlink" title="GIF图"></a>GIF图</h4><img src="/2021/10/25/CSS%E5%85%AB%E7%A7%8D%E8%AE%A9%E4%BA%BA%E7%9C%BC%E5%89%8D%E4%B8%80%E4%BA%AE%E7%9A%84HOVER%E6%95%88%E6%9E%9C/e6e909e04d0a4b878ef48889fe147765~tplv-k3u1fbpfcp-watermark.awebp" class="" title="hover_effect_shiny"><h3 id="八-加载效果"><a href="#八-加载效果" class="headerlink" title="八.加载效果"></a>八.加载效果</h3><h4 id="HTML-7"><a href="#HTML-7" class="headerlink" title="HTML"></a>HTML</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;loading-btn&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>Hover me<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h4 id="CSS-7"><a href="#CSS-7" class="headerlink" title="CSS"></a>CSS</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#loading-btn</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100vh</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">button</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: transparent;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">text-transform</span>: uppercase;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">15px</span> <span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">button</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">transition</span>: all <span class="number">0.8s</span> <span class="built_in">cubic-bezier</span>(<span class="number">0.7</span>, -<span class="number">0.5</span>, <span class="number">0.2</span>, <span class="number">2</span>);</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">1%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#ff5964</span>;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">button</span> <span class="selector-tag">span</span> &#123;</span><br><span class="line">  <span class="attribute">mix-blend-mode</span>: darken;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">button</span><span class="selector-pseudo">:hover</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#ff5964</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h4 id="GIF图-6"><a href="#GIF图-6" class="headerlink" title="GIF图"></a>GIF图</h4><img src="/2021/10/25/CSS%E5%85%AB%E7%A7%8D%E8%AE%A9%E4%BA%BA%E7%9C%BC%E5%89%8D%E4%B8%80%E4%BA%AE%E7%9A%84HOVER%E6%95%88%E6%9E%9C/eee9698995b9441ba3fa622780e5cba8~tplv-k3u1fbpfcp-watermark.awebp" class="" title="hover_effect_load"><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>巧用伪元素<code>:before</code>、<code>:after</code>等，让你的页面按钮眼前一亮。原文链接：<a href="https://link.juejin.cn/?target=https://www.blog.duomly.com/html-button-hover-effects/">8 amazing HTML button hover effects, that will make your website memorable</a>。更多内容：<a href="https://link.juejin.cn/?target=https://github.com/reng99/blogs">github.com&#x2F;reng99&#x2F;blog…</a></p>]]></content>
      
      
      <categories>
          
          <category> css </category>
          
      </categories>
      
      
        <tags>
            
            <tag> css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>es6实用小技巧</title>
      <link href="/2021/10/18/es6%E5%AE%9E%E7%94%A8%E5%B0%8F%E6%8A%80%E5%B7%A7/"/>
      <url>/2021/10/18/es6%E5%AE%9E%E7%94%A8%E5%B0%8F%E6%8A%80%E5%B7%A7/</url>
      
        <content type="html"><![CDATA[<h4 id="元素交换（利用数组结构）"><a href="#元素交换（利用数组结构）" class="headerlink" title="元素交换（利用数组结构）"></a>元素交换（利用数组结构）</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="string">&#x27;world&#x27;</span>, b = <span class="string">&#x27;hello&#x27;</span></span><br><span class="line">[a, b] = [b, a]</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a) <span class="comment">// -&gt; hello</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b) <span class="comment">// -&gt; world</span></span><br></pre></td></tr></table></figure><h4 id="单条语句"><a href="#单条语句" class="headerlink" title="单条语句"></a>单条语句</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 寻找数组中的最大值</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">max</span> = (<span class="params">arr</span>) =&gt; <span class="title class_">Math</span>.<span class="title function_">max</span>(...arr);</span><br><span class="line"><span class="title function_">max</span>([<span class="number">123</span>, <span class="number">321</span>, <span class="number">32</span>]) <span class="comment">// outputs: 321</span></span><br><span class="line"><span class="comment">// 计算数组的总和</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">sum</span> = (<span class="params">arr</span>) =&gt; arr.<span class="title function_">reduce</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> (a + b), <span class="number">0</span>)</span><br><span class="line"><span class="title function_">sum</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]) <span class="comment">// output: 10</span></span><br></pre></td></tr></table></figure><h4 id="数组拼接"><a href="#数组拼接" class="headerlink" title="数组拼接"></a>数组拼接</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> one = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]</span><br><span class="line"><span class="keyword">const</span> two = [<span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>]</span><br><span class="line"><span class="keyword">const</span> three = [<span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;i&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> result = [...one, ...two, ...three] <span class="comment">// 数组合并</span></span><br><span class="line"><span class="keyword">const</span> result = [...<span class="keyword">new</span> <span class="title class_">Set</span>([...one, ...two, ...three])]; <span class="comment">// 合并去重</span></span><br></pre></td></tr></table></figure><h4 id="参数命名（使用解构让函数声明和调用更加可读）"><a href="#参数命名（使用解构让函数声明和调用更加可读）" class="headerlink" title="参数命名（使用解构让函数声明和调用更加可读）"></a>参数命名（使用解构让函数声明和调用更加可读）</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 我们尝尝使用的写法</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getStuffNotBad</span> = (<span class="params">id, force, verbose</span>) =&gt; &#123;</span><br><span class="line">  ...<span class="keyword">do</span> </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 当我们调用函数时， 明天再看，尼玛 150是啥，true是啥</span></span><br><span class="line"><span class="title function_">getStuffNotBad</span>(<span class="number">150</span>, <span class="literal">true</span>, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 看完本文你啥都可以忘记, 希望够记住下面的就可以了</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getStuffAwesome</span> = (<span class="params">&#123;id, name, force, verbose&#125;</span>) =&gt; &#123;</span><br><span class="line">  ...<span class="keyword">do</span> </span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// 完美</span></span><br><span class="line"><span class="title function_">getStuffAwesome</span>(&#123; <span class="attr">id</span>: <span class="number">150</span>, <span class="attr">force</span>: <span class="literal">true</span>, <span class="attr">verbose</span>: <span class="literal">true</span> &#125;)</span><br></pre></td></tr></table></figure><h4 id="Async-Await结合数组解构"><a href="#Async-Await结合数组解构" class="headerlink" title="Async&#x2F;Await结合数组解构"></a>Async&#x2F;Await结合数组解构</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [user, account] = <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>([</span><br><span class="line">  <span class="title function_">fetch</span>(<span class="string">&#x27;/user&#x27;</span>),</span><br><span class="line">  <span class="title function_">fetch</span>(<span class="string">&#x27;/account&#x27;</span>)</span><br><span class="line">])</span><br></pre></td></tr></table></figure><h4 id="获取Object中指定键值"><a href="#获取Object中指定键值" class="headerlink" title="获取Object中指定键值"></a>获取Object中指定键值</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    <span class="attr">a</span>:<span class="number">1</span>,</span><br><span class="line">    <span class="attr">b</span>:<span class="number">2</span>,</span><br><span class="line">    <span class="attr">c</span>:<span class="number">3</span>,</span><br><span class="line">    <span class="attr">d</span>:<span class="number">4</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取obj中a与b的值</span></span><br><span class="line"><span class="keyword">const</span> &#123;a,b&#125; = obj;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以给他们取别名</span></span><br><span class="line"><span class="keyword">const</span> &#123;<span class="attr">a</span>:A, <span class="attr">b</span>:B&#125; = obj;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="排除Object中不需要的键值"><a href="#排除Object中不需要的键值" class="headerlink" title="排除Object中不需要的键值"></a>排除Object中不需要的键值</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const obj = &#123;</span><br><span class="line">    a:1,</span><br><span class="line">    b:2,</span><br><span class="line">    c:3,</span><br><span class="line">    d:4</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 我们想要获取除了a之外的所有属性</span><br><span class="line">const &#123;a, ...other&#125; = obj</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="对象快速求和"><a href="#对象快速求和" class="headerlink" title="对象快速求和"></a>对象快速求和</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> objs = [</span><br><span class="line">&#123;<span class="attr">name</span>:<span class="string">&#x27;lilei&#x27;</span>, <span class="attr">score</span>: <span class="number">98</span>&#125;,</span><br><span class="line">&#123;<span class="attr">name</span>:<span class="string">&#x27;hanmeimei&#x27;</span>, <span class="attr">score</span>: <span class="number">95</span>&#125;,</span><br><span class="line">&#123;<span class="attr">name</span>:<span class="string">&#x27;polo&#x27;</span>, <span class="attr">score</span>: <span class="number">85</span>&#125;,</span><br><span class="line">...</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> scoreTotal = objs.<span class="title function_">reduce</span>( <span class="function">(<span class="params">total, obj</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> obj.<span class="property">score</span> + total;</span><br><span class="line">&#125;, <span class="number">0</span> &#125;<span class="comment">/*第二个参数是total的初始值*/</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="数组过滤"><a href="#数组过滤" class="headerlink" title="数组过滤"></a>数组过滤</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> newarr = [</span><br><span class="line">  &#123; <span class="attr">num</span>: <span class="number">1</span>, <span class="attr">val</span>: <span class="string">&#x27;ceshi&#x27;</span>, <span class="attr">flag</span>: <span class="string">&#x27;aa&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">num</span>: <span class="number">2</span>, <span class="attr">val</span>: <span class="string">&#x27;ceshi2&#x27;</span>, <span class="attr">flag</span>: <span class="string">&#x27;aa2&#x27;</span>  &#125;</span><br><span class="line">]</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(newarr.<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">num</span>===<span class="number">2</span> ))</span><br><span class="line"><span class="comment">//  [&#123;&quot;num&quot;:2,&quot;val&quot;:&quot;ceshi2&quot;,&quot;flag&quot;:&quot;aa2&quot;&#125;]</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="字符串模版"><a href="#字符串模版" class="headerlink" title="字符串模版"></a>字符串模版</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="string">&#x27;小明&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> score = <span class="number">59</span>;</span><br><span class="line"><span class="keyword">const</span> result = <span class="string">`<span class="subst">$&#123;name&#125;</span><span class="subst">$&#123;score &gt; <span class="number">60</span>?<span class="string">&#x27;的考试成绩及格&#x27;</span>:<span class="string">&#x27;的考试成绩不及格&#x27;</span>&#125;</span>`</span>;</span><br></pre></td></tr></table></figure><h4 id="关于if-语句优化"><a href="#关于if-语句优化" class="headerlink" title="关于if 语句优化"></a>关于if 语句优化</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">修改前：</span><br><span class="line">  <span class="keyword">if</span>(</span><br><span class="line">      type == <span class="number">1</span> ||</span><br><span class="line">      type == <span class="number">2</span> ||</span><br><span class="line">      type == <span class="number">3</span> ||</span><br><span class="line">      type == <span class="number">4</span> ||</span><br><span class="line">  )&#123;</span><br><span class="line">     <span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">修改后：</span><br><span class="line">  <span class="keyword">const</span> condition = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>( condition.<span class="title function_">includes</span>(type) )&#123;</span><br><span class="line">     <span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="关于列表搜索优化"><a href="#关于列表搜索优化" class="headerlink" title="关于列表搜索优化"></a>关于列表搜索优化</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">修改前：</span><br><span class="line"><span class="keyword">const</span> a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>];</span><br><span class="line"><span class="keyword">const</span> result = a.<span class="title function_">filter</span>( </span><br><span class="line">    <span class="function"><span class="params">item</span> =&gt;</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> item === <span class="number">3</span></span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">修改后：</span><br><span class="line"><span class="comment">// find方法中找到符合条件的项，就不会继续遍历数组。</span></span><br><span class="line">  <span class="keyword">const</span> a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>];</span><br><span class="line">  <span class="keyword">const</span> result = a.<span class="title function_">find</span>( </span><br><span class="line">    <span class="function"><span class="params">item</span> =&gt;</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> item === <span class="number">3</span></span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="关于获取对象属性值"><a href="#关于获取对象属性值" class="headerlink" title="关于获取对象属性值"></a>关于获取对象属性值</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">修改前：</span><br><span class="line"><span class="keyword">const</span> name = obj &amp;&amp; obj.<span class="property">name</span>;</span><br><span class="line"></span><br><span class="line">修改后：</span><br><span class="line"><span class="comment">// ES6中的可选链操作符会使用</span></span><br><span class="line"><span class="keyword">const</span> name = obj?.<span class="property">name</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="关于添加对象属性"><a href="#关于添加对象属性" class="headerlink" title="关于添加对象属性"></a>关于添加对象属性</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">修改前：</span><br><span class="line"><span class="keyword">let</span> obj = &#123;&#125;;</span><br><span class="line">  <span class="keyword">let</span> index = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">let</span> key = <span class="string">`topic<span class="subst">$&#123;index&#125;</span>`</span>;</span><br><span class="line">  obj[key] = <span class="string">&#x27;话题内容&#x27;</span>;</span><br><span class="line">  </span><br><span class="line">修改后：</span><br><span class="line"> <span class="comment">// ES6中的对象属性名是可以用表达式</span></span><br><span class="line">  <span class="keyword">let</span> obj = &#123;&#125;;</span><br><span class="line">  <span class="keyword">let</span> index = <span class="number">1</span>;</span><br><span class="line">  obj[<span class="string">`topic<span class="subst">$&#123;index&#125;</span>`</span>] = <span class="string">&#x27;话题内容&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="非空判断"><a href="#非空判断" class="headerlink" title="非空判断"></a>非空判断</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">修改前：</span><br><span class="line"><span class="keyword">if</span>(value !== <span class="literal">null</span> &amp;&amp; value !== <span class="literal">undefined</span> &amp;&amp; value !== <span class="string">&#x27;&#x27;</span>)&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">修改后：</span><br><span class="line"> <span class="comment">// ES6中新出的空值合并运算符</span></span><br><span class="line"><span class="keyword">if</span>(value??<span class="string">&#x27;&#x27;</span> !== <span class="string">&#x27;&#x27;</span>)&#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> es6 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> es6 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mysql常用操作</title>
      <link href="/2021/10/14/mysql%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/"/>
      <url>/2021/10/14/mysql%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/</url>
      
        <content type="html"><![CDATA[<img src="/2021/10/14/mysql%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/mysql-4288725.jpeg" class="" title="mysql"><ol><li><pre><code><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2. mysql删除数据 DELETE FROM table_name [WHERE Clause]</span><br><span class="line"></span><br><span class="line">   如：</span><br><span class="line"></span><br></pre></td></tr></table></figure>DELETE FROM table_name WHERE tutorial_id=3;<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">1. mysql link过滤 SELECT field1, field2,…fieldN table_name1, table_name2…WHERE field1 LIKE condition1 [AND [OR]] filed2 = ‘somevalue’</span><br><span class="line"></span><br><span class="line">   可以使用LIKE子句代替等号(=)， 当LIKE连同%符号使用，那么它就会像一个元字符的搜索，可以指定一个以上的条件使用AND或OR运算符，WHERE… LIKE子句可以使用SQL命令的DELETE 或 UPDATE ，也可以指定一个条件</span><br><span class="line"></span><br><span class="line">   如：</span><br><span class="line"></span><br></pre></td></tr></table></figure>SELECT * from table_name WHERE tutorial_author LIKE &#39;%aul&#39;;<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">1. mysql ORDER BY排序 SELECT field1, field2,…fieldN table_name1, table_name2… ORDER BY field1, [field2…] [ASC [DESC]]</span><br><span class="line"></span><br></pre></td></tr></table></figure>SELECT * from table_name ORDER BY tutorial_author ASC;  // ASC 升序    DESC降序<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">1. MySQL Join连表查询</span><br><span class="line"></span><br><span class="line">   如：</span><br><span class="line"></span><br></pre></td></tr></table></figure>SELECT a.tutorial_id, a.tutorial_author, b.tutorial_count    FROM table_name a, table_name b    WHERE a.tutorial_author = b.tutorial_author;<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">1. MySQL NULL值</span><br><span class="line">   - IS NULL: 如果列的值为NULL，运算结果返回 true</span><br><span class="line">   - IS NOT NULL: 如果列的值不为NULL，运算结果返回 true</span><br><span class="line">   - &lt;=&gt;: 运算符比较值，(不同于=运算符)即使两个空值它返回 true</span><br><span class="line"></span><br><span class="line">1. Mysql 索引</span><br><span class="line"></span><br><span class="line">   ### 创建索引</span><br><span class="line"></span><br><span class="line">   这是最基本的索引，它没有任何限制。它有以下几种创建方式：</span><br><span class="line"></span><br></pre></td></tr></table></figure>CREATE INDEX indexName ON mytable(username(length)); <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">如果是CHAR，VARCHAR类型，length可以小于字段实际长度；如果是BLOB和TEXT类型，必须指定 length。</span><br><span class="line"></span><br><span class="line">### 修改表结构(添加索引)</span><br><span class="line"></span><br></pre></td></tr></table></figure>ALTER table tableName ADD INDEX indexName(columnName)<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 创建表的时候直接指定</span><br><span class="line"></span><br></pre></td></tr></table></figure>CREATE TABLE mytable(   ID INT NOT NULL,    username VARCHAR(16) NOT NULL,   INDEX [indexName] (username(length))   );  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 删除索引的语法</span><br><span class="line"></span><br></pre></td></tr></table></figure>DROP INDEX [indexName] ON mytable; <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line">## 唯一索引</span><br><span class="line"></span><br><span class="line">它与前面的普通索引类似，不同的就是：索引列的值必须唯一，但允许有空值。如果是组合索引，则列值的组合必须唯一。它有以下几种创建方式：</span><br><span class="line"></span><br><span class="line">### 创建索引</span><br><span class="line"></span><br></pre></td></tr></table></figure>CREATE UNIQUE INDEX indexName ON mytable(username(length)) <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 修改表结构</span><br><span class="line"></span><br></pre></td></tr></table></figure>ALTER table mytable ADD UNIQUE [indexName] (username(length))<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 创建表的时候直接指定</span><br><span class="line"></span><br></pre></td></tr></table></figure>CREATE TABLE mytable(   ID INT NOT NULL,    username VARCHAR(16) NOT NULL,   UNIQUE [indexName] (username(length))   );  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line">## 使用ALTER 命令添加和删除索引</span><br><span class="line"></span><br><span class="line">有四种方式来添加数据表的索引：</span><br><span class="line"></span><br><span class="line">- ALTER TABLE tbl_name ADD PRIMARY KEY (column_list):</span><br><span class="line"></span><br></pre></td></tr></table></figure></code></pre></li></ol><p>该语句添加一个主键，这意味着索引值必须是唯一的，且不能为NULL。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- **ALTER TABLE tbl_name ADD UNIQUE index_name (column_list):** 这条语句创建索引的值必须是唯一的（除了NULL外，NULL可能会出现多次）。</span><br><span class="line"></span><br><span class="line">- **ALTER TABLE tbl_name ADD INDEX index_name (column_list):** 添加普通索引，索引值可出现多次。</span><br><span class="line"></span><br><span class="line">- **ALTER TABLE tbl_name ADD FULLTEXT index_name (column_list):**该语句指定了索引为 FULLTEXT ，用于全文索引。</span><br><span class="line"></span><br><span class="line">  以下实例为在表中添加索引。</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>  mysql&gt; ALTER TABLE testalter_tbl ADD INDEX (c);<br>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">你还可以在 ALTER 命令中使用 DROP 子句来删除索引。尝试以下实例删除索引:</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>  mysql&gt; ALTER TABLE testalter_tbl DROP INDEX c;<br>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line">## 使用 ALTER 命令添加和删除主键</span><br><span class="line"></span><br><span class="line">主键只能作用于一个列上，添加主键索引时，你需要确保该主键默认不为空（NOT NULL）。实例如下：</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>mysql&gt; ALTER TABLE testalter_tbl MODIFY i INT NOT NULL;<br>mysql&gt; ALTER TABLE testalter_tbl ADD PRIMARY KEY (i);</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">你也可以使用 ALTER 命令删除主键：</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>mysql&gt; ALTER TABLE testalter_tbl DROP PRIMARY KEY;</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">删除主键时只需指定PRIMARY KEY，但在删除索引时，你必须知道索引名。</span><br><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line">## 显示索引信息</span><br><span class="line"></span><br><span class="line">你可以使用 SHOW INDEX 命令来列出表中的相关的索引信息。可以通过添加 \G 来格式化输出信息。</span><br><span class="line"></span><br><span class="line">尝试以下实例:</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>mysql&gt; SHOW INDEX FROM table_name; \G<br>……..</p><pre><code></code></pre>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>css基础温故</title>
      <link href="/2021/10/14/css%E5%9F%BA%E7%A1%80%E6%B8%A9%E6%95%85/"/>
      <url>/2021/10/14/css%E5%9F%BA%E7%A1%80%E6%B8%A9%E6%95%85/</url>
      
        <content type="html"><![CDATA[<h3 id="三栏布局"><a href="#三栏布局" class="headerlink" title="三栏布局"></a>三栏布局</h3><p>题目：假设高度已知，请写出三栏布局，其中左栏、右栏宽度各为 300px，中间自适应。<br>解答：可以有很多种布局方式，这里列出五种：float布局，absolute布局，flex布局，table布局，grid布局，代码如下：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE <span class="selector-tag">html</span>&gt;</span><br><span class="line">&lt;<span class="selector-tag">html</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;utf-<span class="number">8</span>&quot;&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;X-UA-Compatible&quot; <span class="attribute">content</span>=&quot;IE=edge&quot;&gt;</span><br><span class="line">&lt;title&gt;三栏布局&lt;/title&gt;</span><br><span class="line">&lt;link rel=&quot;stylesheet&quot; href=&quot;&quot;&gt;</span><br><span class="line">&lt;style type=&quot;text/css&quot; media=&quot;screen&quot;&gt;</span><br><span class="line"><span class="selector-tag">html</span> *&#123;</span><br><span class="line"><span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line"><span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;<span class="selector-tag">body</span>&gt;</span><br><span class="line">&lt;<span class="selector-tag">section</span> class=&quot;layout <span class="attribute">float</span>&quot;&gt;</span><br><span class="line">&lt;style type=&quot;text/css&quot; media=&quot;screen&quot;&gt;</span><br><span class="line"><span class="selector-class">.layout</span><span class="selector-class">.float</span> <span class="selector-class">.wrapper</span>&gt;<span class="selector-tag">div</span>&#123;</span><br><span class="line"><span class="attribute">min-height</span>: <span class="number">100px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.layout</span><span class="selector-class">.float</span> <span class="selector-class">.left</span>&#123;</span><br><span class="line"><span class="attribute">float</span>: left;</span><br><span class="line"><span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line"><span class="attribute">background</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.layout</span><span class="selector-class">.float</span> <span class="selector-class">.center</span>&#123;</span><br><span class="line"><span class="attribute">background</span>: yellow;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.layout</span><span class="selector-class">.float</span> <span class="selector-class">.right</span>&#123;</span><br><span class="line"><span class="attribute">float</span>: right;</span><br><span class="line"><span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line"><span class="attribute">background</span>: blue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;<span class="selector-tag">article</span> class=&quot;wrapper&quot;&gt;</span><br><span class="line">&lt;<span class="selector-tag">div</span> class=&quot;<span class="attribute">left</span>&quot;&gt;&lt;/<span class="selector-tag">div</span>&gt;</span><br><span class="line">&lt;<span class="selector-tag">div</span> class=&quot;<span class="attribute">right</span>&quot;&gt;&lt;/<span class="selector-tag">div</span>&gt;</span><br><span class="line">&lt;<span class="selector-tag">div</span> class=&quot;center&quot;&gt;</span><br><span class="line">&lt;<span class="selector-tag">h1</span>&gt;<span class="attribute">float</span>布局&lt;/<span class="selector-tag">h1</span>&gt;</span><br><span class="line"><span class="number">1</span>.我是<span class="attribute">float</span>布局的中间部分</span><br><span class="line"><span class="number">2</span>.我是<span class="attribute">float</span>布局的中间部分</span><br><span class="line">&lt;/<span class="selector-tag">div</span>&gt;</span><br><span class="line">&lt;/<span class="selector-tag">article</span>&gt;</span><br><span class="line">&lt;/<span class="selector-tag">section</span>&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;<span class="selector-tag">section</span> class=&quot;layout absolute&quot;&gt;</span><br><span class="line">&lt;style type=&quot;text/css&quot; media=&quot;screen&quot;&gt;</span><br><span class="line"><span class="selector-class">.layout</span><span class="selector-class">.absolute</span> <span class="selector-class">.wrapper</span>&#123;</span><br><span class="line"><span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line"><span class="attribute">margin-top</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.layout</span><span class="selector-class">.absolute</span> <span class="selector-class">.wrapper</span>&gt;<span class="selector-tag">div</span>&#123;</span><br><span class="line"><span class="attribute">min-height</span>: <span class="number">100px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.layout</span><span class="selector-class">.absolute</span> <span class="selector-class">.left</span>&#123;</span><br><span class="line"><span class="attribute">position</span>: absolute;</span><br><span class="line"><span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line"><span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line"><span class="attribute">background</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.layout</span><span class="selector-class">.absolute</span> <span class="selector-class">.center</span>&#123;</span><br><span class="line"><span class="attribute">position</span>: absolute;</span><br><span class="line"><span class="attribute">left</span>: <span class="number">300px</span>;</span><br><span class="line"><span class="attribute">right</span>: <span class="number">300px</span>;</span><br><span class="line"><span class="attribute">background</span>: yellow;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.layout</span><span class="selector-class">.absolute</span> <span class="selector-class">.right</span>&#123;</span><br><span class="line"><span class="attribute">position</span>: absolute;</span><br><span class="line"><span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line"><span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line"><span class="attribute">background</span>: blue;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;<span class="selector-tag">article</span> class=&quot;wrapper&quot;&gt;</span><br><span class="line">&lt;<span class="selector-tag">div</span> class=&quot;<span class="attribute">left</span>&quot;&gt;&lt;/<span class="selector-tag">div</span>&gt;</span><br><span class="line">&lt;<span class="selector-tag">div</span> class=&quot;center&quot;&gt;</span><br><span class="line">&lt;<span class="selector-tag">h1</span>&gt;absolute布局&lt;/<span class="selector-tag">h1</span>&gt;</span><br><span class="line"><span class="number">1</span>.我是absolute布局的中间部分</span><br><span class="line"><span class="number">2</span>.我是absolute布局的中间部分</span><br><span class="line">&lt;/<span class="selector-tag">div</span>&gt;</span><br><span class="line">&lt;<span class="selector-tag">div</span> class=&quot;<span class="attribute">right</span>&quot;&gt;&lt;/<span class="selector-tag">div</span>&gt;</span><br><span class="line">&lt;/<span class="selector-tag">article</span>&gt;</span><br><span class="line">&lt;/<span class="selector-tag">section</span>&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;<span class="selector-tag">section</span> class=&quot;layout <span class="attribute">flex</span>&quot;&gt;</span><br><span class="line">&lt;style type=&quot;text/css&quot; media=&quot;screen&quot;&gt;</span><br><span class="line"><span class="selector-class">.layout</span><span class="selector-class">.flex</span> <span class="selector-class">.wrapper</span>&#123;</span><br><span class="line"><span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line"><span class="attribute">min-height</span>: <span class="number">100px</span>;</span><br><span class="line"><span class="attribute">display</span>: flex;</span><br><span class="line"><span class="attribute">margin-top</span>: <span class="number">140px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.layout</span><span class="selector-class">.flex</span> <span class="selector-class">.left</span>&#123;</span><br><span class="line"><span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line"><span class="attribute">background</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.layout</span><span class="selector-class">.flex</span> <span class="selector-class">.center</span>&#123;</span><br><span class="line"><span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line"><span class="attribute">background</span>: yellow;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.layout</span><span class="selector-class">.flex</span> <span class="selector-class">.right</span>&#123;</span><br><span class="line"><span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line"><span class="attribute">background</span>: blue;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;<span class="selector-tag">article</span> class=&quot;wrapper&quot;&gt;</span><br><span class="line">&lt;<span class="selector-tag">div</span> class=&quot;<span class="attribute">left</span>&quot;&gt;&lt;/<span class="selector-tag">div</span>&gt;</span><br><span class="line">&lt;<span class="selector-tag">div</span> class=&quot;center&quot;&gt;</span><br><span class="line">&lt;<span class="selector-tag">h1</span>&gt;<span class="attribute">flex</span>布局&lt;/<span class="selector-tag">h1</span>&gt;</span><br><span class="line"><span class="number">1</span>.我是<span class="attribute">flex</span>布局的中间部分</span><br><span class="line"><span class="number">2</span>.我是<span class="attribute">flex</span>布局的中间部分</span><br><span class="line">&lt;/<span class="selector-tag">div</span>&gt;</span><br><span class="line">&lt;<span class="selector-tag">div</span> class=&quot;<span class="attribute">right</span>&quot;&gt;&lt;/<span class="selector-tag">div</span>&gt;</span><br><span class="line">&lt;/<span class="selector-tag">article</span>&gt;</span><br><span class="line">&lt;/<span class="selector-tag">section</span>&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;<span class="selector-tag">section</span> class=&quot;layout <span class="selector-tag">table</span>&quot;&gt;</span><br><span class="line">&lt;style type=&quot;text/css&quot; media=&quot;screen&quot;&gt;</span><br><span class="line"><span class="selector-class">.layout</span><span class="selector-class">.table</span> <span class="selector-class">.wrapper</span>&#123;</span><br><span class="line"><span class="attribute">display</span>: table;</span><br><span class="line"><span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line"><span class="attribute">min-height</span>: <span class="number">100px</span>;</span><br><span class="line"><span class="attribute">margin-top</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.layout</span><span class="selector-class">.table</span> <span class="selector-class">.left</span>&#123;</span><br><span class="line"><span class="attribute">display</span>: table-cell;</span><br><span class="line"><span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line"><span class="attribute">background</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.layout</span><span class="selector-class">.table</span> <span class="selector-class">.center</span>&#123;</span><br><span class="line"><span class="attribute">display</span>: table-cell;</span><br><span class="line"><span class="attribute">background</span>: yellow;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.layout</span><span class="selector-class">.table</span> <span class="selector-class">.right</span>&#123;</span><br><span class="line"><span class="attribute">display</span>: table-cell;</span><br><span class="line"><span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line"><span class="attribute">background</span>: blue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;<span class="selector-tag">article</span> class=&quot;wrapper&quot;&gt;</span><br><span class="line">&lt;<span class="selector-tag">div</span> class=&quot;<span class="attribute">left</span>&quot;&gt;&lt;/<span class="selector-tag">div</span>&gt;</span><br><span class="line">&lt;<span class="selector-tag">div</span> class=&quot;center&quot;&gt;</span><br><span class="line">&lt;<span class="selector-tag">h1</span>&gt;<span class="selector-tag">table</span>布局&lt;/<span class="selector-tag">h1</span>&gt;</span><br><span class="line"><span class="number">1</span>.我是<span class="selector-tag">table</span>布局的中间部分</span><br><span class="line"><span class="number">2</span>.我是<span class="selector-tag">table</span>布局的中间部分</span><br><span class="line">&lt;/<span class="selector-tag">div</span>&gt;</span><br><span class="line">&lt;<span class="selector-tag">div</span> class=&quot;<span class="attribute">right</span>&quot;&gt;&lt;/<span class="selector-tag">div</span>&gt;</span><br><span class="line">&lt;/<span class="selector-tag">article</span>&gt;</span><br><span class="line">&lt;/<span class="selector-tag">section</span>&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;<span class="selector-tag">section</span> class=&quot;layout <span class="attribute">grid</span>&quot;&gt;</span><br><span class="line">&lt;style type=&quot;text/css&quot; media=&quot;screen&quot;&gt;</span><br><span class="line"><span class="selector-class">.layout</span><span class="selector-class">.grid</span> <span class="selector-class">.wrapper</span>&#123;</span><br><span class="line"><span class="attribute">display</span>: grid;</span><br><span class="line"><span class="attribute">grid-template-columns</span>: <span class="number">300px</span> auto <span class="number">300px</span>;</span><br><span class="line"><span class="attribute">grid-template-rows</span>: <span class="number">100px</span>;</span><br><span class="line"><span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line"><span class="attribute">margin-top</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.layout</span><span class="selector-class">.grid</span> <span class="selector-class">.left</span>&#123;</span><br><span class="line"><span class="attribute">background</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.layout</span><span class="selector-class">.grid</span> <span class="selector-class">.center</span>&#123;</span><br><span class="line"><span class="attribute">background</span>: yellow;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.layout</span><span class="selector-class">.grid</span> <span class="selector-class">.right</span>&#123;</span><br><span class="line"><span class="attribute">background</span>: blue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;<span class="selector-tag">article</span> class=&quot;wrapper&quot;&gt;</span><br><span class="line">&lt;<span class="selector-tag">div</span> class=&quot;<span class="attribute">left</span>&quot;&gt;&lt;/<span class="selector-tag">div</span>&gt;</span><br><span class="line">&lt;<span class="selector-tag">div</span> class=&quot;center&quot;&gt;</span><br><span class="line">&lt;<span class="selector-tag">h1</span>&gt;<span class="attribute">grid</span>布局&lt;/<span class="selector-tag">h1</span>&gt;</span><br><span class="line"><span class="number">1</span>.我是<span class="attribute">grid</span>布局的中间部分</span><br><span class="line"><span class="number">2</span>.我是<span class="attribute">grid</span>布局的中间部分</span><br><span class="line">&lt;/<span class="selector-tag">div</span>&gt;</span><br><span class="line">&lt;<span class="selector-tag">div</span> class=&quot;<span class="attribute">right</span>&quot;&gt;&lt;/<span class="selector-tag">div</span>&gt;</span><br><span class="line">&lt;/<span class="selector-tag">article</span>&gt;</span><br><span class="line">&lt;/<span class="selector-tag">section</span>&gt;</span><br><span class="line">&lt;/<span class="selector-tag">body</span>&gt;</span><br><span class="line">&lt;/<span class="selector-tag">html</span>&gt;</span><br></pre></td></tr></table></figure><h3 id="每种布局的优缺点"><a href="#每种布局的优缺点" class="headerlink" title="每种布局的优缺点"></a>每种布局的优缺点</h3><h4 id="1-float-布局"><a href="#1-float-布局" class="headerlink" title="1. float 布局"></a>1. float 布局</h4><p>优点： 比较简单，兼容性也比较好。只要清除浮动做的好，是没有什么问题的<br>缺点：浮动元素是脱离文档流，要做清除浮动，这个处理不好的话，会带来很多问题，比如高度塌陷等。</p><h4 id="2-绝对布局"><a href="#2-绝对布局" class="headerlink" title="2. 绝对布局"></a>2. 绝对布局</h4><p>优点：很快捷，设置很方便，而且也不容易出问题<br>缺点：绝对定位是脱离文档流的，意味着下面的所有子元素也会脱离文档流，这就导致了这种方法的有效性和可使用性是比较差的。</p><h4 id="3-flex-布局"><a href="#3-flex-布局" class="headerlink" title="3. flex 布局"></a>3. flex 布局</h4><p>优点：简单快捷<br>缺点：不支持 IE8 及以下</p><h4 id="4-table布局"><a href="#4-table布局" class="headerlink" title="4. table布局"></a>4. table布局</h4><p>优点：实现简单，代码少<br>缺点：当其中一个单元格高度超出的时候，两侧的单元格也是会跟着一起变高的，而有时候这种效果不是我们想要的。</p><h4 id="5-grid布局"><a href="#5-grid布局" class="headerlink" title="5. grid布局"></a>5. grid布局</h4><p>跟 flex 相似。</p><h3 id="水平垂直居中"><a href="#水平垂直居中" class="headerlink" title="水平垂直居中"></a>水平垂直居中</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line">absolute + 负<span class="attribute">margin</span></span><br><span class="line">这种方式比较好理解，兼容性也很好，缺点是需要知道子元素的宽高</span><br><span class="line"></span><br><span class="line">&lt;<span class="selector-tag">div</span> class=&quot;out&quot;&gt;</span><br><span class="line">  &lt;<span class="selector-tag">div</span> class=&quot;inner&quot;&gt;<span class="number">12345</span>&lt;/<span class="selector-tag">div</span>&gt;</span><br><span class="line">&lt;/<span class="selector-tag">div</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">  <span class="selector-class">.out</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">300px</span>;</span><br><span class="line">    <span class="attribute">background</span>: red;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.inner</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">background</span>: yellow;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">margin-left</span>: -<span class="number">50px</span>;</span><br><span class="line">    <span class="attribute">margin-top</span>: -<span class="number">50px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br><span class="line">absolute + auto <span class="attribute">margin</span></span><br><span class="line">这种方法兼容性也很好，缺点是需要知道子元素的宽高</span><br><span class="line"></span><br><span class="line">&lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">  <span class="selector-class">.out</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">300px</span>;</span><br><span class="line">    <span class="attribute">background</span>: red;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.inner</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">background</span>: yellow;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">margin</span>: auto;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br><span class="line">absolute + calc</span><br><span class="line">这种方法的兼容性依赖于 calc，且也需要知道宽高</span><br><span class="line"></span><br><span class="line">&lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">  <span class="selector-class">.out</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">300px</span>;</span><br><span class="line">    <span class="attribute">background</span>: red;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.inner</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">background</span>: yellow;</span><br><span class="line">    <span class="attribute">left</span>: <span class="built_in">calc</span>(<span class="number">50%</span> - <span class="number">50px</span>);</span><br><span class="line">    <span class="attribute">top</span>: <span class="built_in">calc</span>(<span class="number">50%</span> - <span class="number">50px</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br><span class="line">absolute + <span class="attribute">transform</span></span><br><span class="line">兼容性依赖 translate，不需要知道子元素宽高</span><br><span class="line"></span><br><span class="line">&lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">  <span class="selector-class">.out</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">300px</span>;</span><br><span class="line">    <span class="attribute">background</span>: red;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.inner</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">background</span>: yellow;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">50%</span>, -<span class="number">50%</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">table</span></span><br><span class="line">css新增的<span class="selector-tag">table</span>属性，可以让我们把普通元素，变为<span class="selector-tag">table</span>元素的显示效果，通过这个特性也可以实现水平垂直居中。</span><br><span class="line">这种方法兼容性也不错。</span><br><span class="line"></span><br><span class="line">&lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">  <span class="selector-class">.out</span>&#123;</span><br><span class="line">    <span class="attribute">display</span>: table-cell;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">300px</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">    <span class="attribute">background</span>: red;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.inner</span>&#123;</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">    <span class="attribute">background</span>: yellow;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br><span class="line"><span class="attribute">flex</span></span><br><span class="line"><span class="attribute">flex</span> 实现起来比较简单，三行代码即可搞定。可通过父元素指定子元素的对齐方式，也可通过 子元素自己指定自己的对齐方式来实现。第二种方式见 <span class="attribute">grid</span> 布局。</span><br><span class="line"></span><br><span class="line">&lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">  <span class="selector-class">.out</span>&#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">300px</span>;</span><br><span class="line">    <span class="attribute">background</span>: red;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.inner</span>&#123;</span><br><span class="line">    <span class="attribute">background</span>: yellow;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br><span class="line"><span class="attribute">grid</span></span><br><span class="line"><span class="attribute">grid</span> 布局也很强大，大体上属性跟 <span class="attribute">flex</span> 差不多。</span><br><span class="line"></span><br><span class="line">//方法一：父元素指定子元素的对齐方式</span><br><span class="line">&lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">  <span class="selector-class">.out</span>&#123;</span><br><span class="line">    <span class="attribute">display</span>: grid;</span><br><span class="line">    <span class="attribute">align-content</span>: center;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">300px</span>;</span><br><span class="line">    <span class="attribute">background</span>: red;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.inner</span>&#123;</span><br><span class="line">    <span class="attribute">background</span>: yellow;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br><span class="line">//方法二：子元素自己指定自己的对齐方式</span><br><span class="line">&lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">  <span class="selector-class">.out</span>&#123;</span><br><span class="line">    <span class="attribute">display</span>: grid;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">300px</span>;</span><br><span class="line">    <span class="attribute">background</span>: red;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.inner</span>&#123;</span><br><span class="line">    <span class="attribute">background</span>: yellow;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">align-self</span>: center;</span><br><span class="line">    justify-self: center;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> css </category>
          
      </categories>
      
      
        <tags>
            
            <tag> css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mysql连接池的premise封装</title>
      <link href="/2021/10/14/mysql%E8%BF%9E%E6%8E%A5%E6%B1%A0%E7%9A%84premise%E5%B0%81%E8%A3%85/"/>
      <url>/2021/10/14/mysql%E8%BF%9E%E6%8E%A5%E6%B1%A0%E7%9A%84premise%E5%B0%81%E8%A3%85/</url>
      
        <content type="html"><![CDATA[<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">新建db.<span class="property">js</span>， 内容如下：</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;mysql&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建连接池</span></span><br><span class="line"><span class="keyword">const</span> pool = mysql.<span class="title function_">createPool</span>(&#123;</span><br><span class="line">  <span class="attr">connectionLimit</span>: <span class="number">5</span>,</span><br><span class="line">  <span class="attr">host</span>: process.<span class="property">env</span>.<span class="property">dbHost</span>,</span><br><span class="line">  <span class="attr">user</span>: process.<span class="property">env</span>.<span class="property">dbUser</span>,</span><br><span class="line">  <span class="attr">password</span>: process.<span class="property">env</span>.<span class="property">dbPassword</span>,</span><br><span class="line">  <span class="attr">database</span>: process.<span class="property">env</span>.<span class="property">dbDatabase</span>,</span><br><span class="line">  <span class="attr">multipleStatements</span>: <span class="literal">true</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> query = <span class="keyword">function</span> (<span class="params">sql, values</span>) &#123;</span><br><span class="line">  <span class="comment">// 返回一个 Promise</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    pool.<span class="title function_">getConnection</span>(<span class="keyword">function</span> (<span class="params">err, connection</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="title function_">reject</span>(err)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        connection.<span class="title function_">query</span>(sql, values, <span class="function">(<span class="params">err, rows</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="title function_">reject</span>(err)</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(rows)</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">// 结束会话</span></span><br><span class="line">          connection.<span class="title function_">release</span>()</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  query</span><br><span class="line">&#125;</span><br><span class="line">使用</span><br><span class="line"><span class="keyword">const</span> handler = <span class="built_in">require</span>(<span class="string">&#x27;./db.js&#x27;</span>)</span><br><span class="line"></span><br><span class="line">handlder.<span class="title function_">query</span>(&#123;</span><br><span class="line">    <span class="attr">sql</span>: <span class="string">&#x27;select * from table where id = ?&#x27;</span>,</span><br><span class="line">    <span class="attr">params</span>: [id],</span><br><span class="line">    <span class="attr">success</span>: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">error</span>: <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> mysql javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mac小技巧之zip加密解密</title>
      <link href="/2021/10/14/mac%E5%B0%8F%E6%8A%80%E5%B7%A7%E4%B9%8Bzip%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86/"/>
      <url>/2021/10/14/mac%E5%B0%8F%E6%8A%80%E5%B7%A7%E4%B9%8Bzip%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86/</url>
      
        <content type="html"><![CDATA[<div class="note simple"><p>1.加密：</p></div><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">1.进入文件目录</span><br><span class="line"></span><br><span class="line">&gt; cd xxx(文件目录)</span><br><span class="line">只压缩单个文件</span><br><span class="line"></span><br><span class="line">zip -e xxx.zip yyy</span><br><span class="line">压缩文件夹</span><br><span class="line"></span><br><span class="line">zip -e -r xxx.zip yyy</span><br><span class="line"></span><br><span class="line">根据提示输入密码和确认密码即可</span><br><span class="line"></span><br><span class="line">完整的命令行及注释</span><br><span class="line"></span><br><span class="line">zip -q -r -e -m -o xxx.zip yyy</span><br><span class="line">-q 表示不显示压缩进度状态</span><br><span class="line"></span><br><span class="line">-r 表示子目录子文件全部压缩为zip //这部比较重要，不然的话只有something这个文件夹被压缩，里面的没有被压缩进去</span><br><span class="line"></span><br><span class="line">-e 表示你的压缩文件需要加密，终端会提示你输入密码的</span><br><span class="line"></span><br><span class="line">-m 表示压缩完删除原文件</span><br><span class="line"></span><br><span class="line">-o 表示设置所有被压缩文件的最后修改时间为当前压缩时间</span><br><span class="line"></span><br><span class="line">当跨目录的时候是这么操作的</span><br><span class="line"></span><br><span class="line">zip -q -r -e -m -o ‘\user\someone\syyy\xxx.zip’ ‘\users\yyy’</span><br></pre></td></tr></table></figure><div class="note simple"><p>1.解密：</p></div><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip FileName.zip</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Mac linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>原生（Android iOS）webview与js（vue）交互</title>
      <link href="/2021/05/24/%E5%8E%9F%E7%94%9F%EF%BC%88Android-iOS%EF%BC%89webview%E4%B8%8Ejs%EF%BC%88vue%EF%BC%89%E4%BA%A4%E4%BA%92/"/>
      <url>/2021/05/24/%E5%8E%9F%E7%94%9F%EF%BC%88Android-iOS%EF%BC%89webview%E4%B8%8Ejs%EF%BC%88vue%EF%BC%89%E4%BA%A4%E4%BA%92/</url>
      
        <content type="html"><![CDATA[<img src="/2021/05/24/%E5%8E%9F%E7%94%9F%EF%BC%88Android-iOS%EF%BC%89webview%E4%B8%8Ejs%EF%BC%88vue%EF%BC%89%E4%BA%A4%E4%BA%92/vue-4288067.jpeg" class="" title="vue"><h1 id="1-Vue和原生（ios和安卓）的交互（第一种方法）"><a href="#1-Vue和原生（ios和安卓）的交互（第一种方法）" class="headerlink" title="1.Vue和原生（ios和安卓）的交互（第一种方法）"></a>1.Vue和原生（ios和安卓）的交互（第一种方法）</h1><h2 id="一、原生调用Vue方法"><a href="#一、原生调用Vue方法" class="headerlink" title="一、原生调用Vue方法"></a>一、原生调用Vue方法</h2><h2 id="1、Vue"><a href="#1、Vue" class="headerlink" title="1、Vue"></a>1、Vue</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mounted() &#123;</span><br><span class="line">    //将要给原生调用的方法挂载到 window 上面</span><br><span class="line">    window.callJsFunction = this.callJsFunction</span><br><span class="line">&#125;,</span><br><span class="line">data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">    msg: &quot;哈哈&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">methods: &#123;</span><br><span class="line">    callJsFunction(str) &#123;</span><br><span class="line">        this.msg = &quot;我通过原生方法改变了文字&quot; + str</span><br><span class="line">        return &quot;js调用成功&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> 在 <code>methods</code> 中定义一个供 Android 调用的方法 <code>callJsFunction(str)</code> , 并可接收一个参数 <code>str</code>，然后改变页面中的文字。</p><p>如果只是在 <code>methods</code> 中定义方法，原生调用会找不到这个方法。所以要在页面加载的时候将方法挂载在 <code>window</code> 上，这样 <code>WebView</code> 就可以拿到此方法了。注意，这步很重要一定要写！</p><p>注意一个细节，<code>this.callJsFunction</code> 后面不要加括号 <code>()</code>，加括号相当于直接调用了。</p><p>总结起来 <code>Vue</code> 中要做的事情就两步：</p><ol><li>在 <code>methods</code> 中定义方法</li><li>在 <code>mounted</code> 中将方法挂载在 <code>window</code> 上</li></ol><h2 id="2、原生"><a href="#2、原生" class="headerlink" title="2、原生"></a>2、原生</h2><h3 id="安卓"><a href="#安卓" class="headerlink" title="安卓"></a>安卓</h3><p> Android 调用 JS 有两种方式，都是通过 <code>WebView</code> 的方法：</p><ol><li><code>webview.loadUrl()</code></li><li><code>webview.evaluateJavascript()</code></li></ol><blockquote><p>二者区别：</p><ol><li><code>loadUrl()</code> 会刷新页面，<code>evaluateJavascript()</code> 则不会使页面刷新，所以 <code>evaluateJavascript()</code> 的效率更高</li><li><code>loadUrl()</code> 得不到 js 的返回值，<code>evaluateJavascript()</code> 可以获取返回值</li><li><code>evaluateJavascript()</code> 在 Android 4.4 之后才可以使用</li></ol></blockquote><h4 id="1-webview-loadUrl-方式"><a href="#1-webview-loadUrl-方式" class="headerlink" title="1.webview.loadUrl()方式"></a>1.webview.loadUrl()方式</h4><p>需要等页面加载完在 <code>WebView</code> 的 <code>onPageFinished</code> 方法中写调用逻辑，否则不会执行。如果不需要传参数，把参数去掉即可 <code>tbsWebView.loadUrl(&quot;javascript:callJsFunction()&quot;);</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">tbsWebView.setWebViewClient(new WebViewClient() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public boolean shouldOverrideUrlLoading(WebView view, String url) &#123;</span><br><span class="line">                view.loadUrl(url, headerMap);</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public void onPageFinished(WebView webView, String s) &#123;</span><br><span class="line">                super.onPageFinished(webView, s);</span><br><span class="line">                //安卓调用js方法。注意需要在 onPageFinished 回调里调用</span><br><span class="line">                tbsWebView.post(new Runnable() &#123;</span><br><span class="line">                    @Override</span><br><span class="line">                    public void run() &#123;</span><br><span class="line">                        tbsWebView.loadUrl(&quot;javascript:callJsFunction(&#x27;soloname&#x27;)&quot;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="2-webview-evaluateJavascript-方式"><a href="#2-webview-evaluateJavascript-方式" class="headerlink" title="2.webview.evaluateJavascript()方式"></a>2.webview.evaluateJavascript()方式</h4><p>其他地方跟<code>loadUrl()</code>一样，只是把 <code>tbsWebView.loadUrl(&quot;javascript:callJsFunction(&#39;soloname&#39;)&quot;);</code> 替换掉</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public void onPageFinished(WebView webView, String s) &#123;</span><br><span class="line">    super.onPageFinished(webView, s);</span><br><span class="line">    //安卓调用js方法。注意需要在 onPageFinished 回调里调用</span><br><span class="line">    tbsWebView.post(new Runnable() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            tbsWebView.evaluateJavascript(&quot;javascript:callJsFunction(&#x27;soloname&#x27;)&quot;, new ValueCallback&lt;String&gt;() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                public void onReceiveValue(String s) &#123;</span><br><span class="line">                    Logger.d(&quot;js返回的结果： &quot; + s);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="iOS"><a href="#iOS" class="headerlink" title="iOS"></a>iOS</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">NSString *toVueSting = @&quot;soloname&quot;;</span><br><span class="line"> </span><br><span class="line">  NSString *jsStr = [NSString stringWithFormat:@&quot;callJsFunction(&#x27;%@&#x27;)&quot;,toVueSting];</span><br><span class="line"> </span><br><span class="line">  [self-&gt;_wkWebView evaluateJavaScript:jsStr completionHandler:^(id _Nullable d, NSError * _Nullable error) &#123;</span><br><span class="line"> </span><br><span class="line">            NSLog(@&quot;返回---%@&quot;,d);//回调值</span><br><span class="line"> </span><br><span class="line">    &#125;];</span><br></pre></td></tr></table></figure><h2 id="二、Vue-调用原生"><a href="#二、Vue-调用原生" class="headerlink" title="二、Vue 调用原生"></a>二、Vue 调用原生</h2><ol><li><p>对于JS（vue）调用原生代码的方法有2种：</p><ol><li>通过 <code>WebView</code> 的 <code>addJavascriptInterface()</code> 进行对象映射</li><li>通过 <code>WebViewClient</code> 的 <code>shouldOverrideUrlLoading()</code>方法回调拦截 url</li></ol><p>对比： 第一种最简洁，但在 Android 4. 2 以下存在漏洞；第二种使用复杂，但不存在漏洞问题。第二种想了解的可以参考 <a href="https://www.jianshu.com/p/345f4d8a5cfa">这篇文章</a> 。</p></li></ol><h2 id="1、Vue-1"><a href="#1、Vue-1" class="headerlink" title="1、Vue"></a>1、Vue</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//vue调用Android方法，且传值给Android （Android方法名为 showToast）</span><br><span class="line">  $App.showToast(&quot;哈哈，我是js调用的&quot;)；  </span><br><span class="line"> </span><br><span class="line">//vue调用iOS方法，且传值给iOS （iOS 方法名为 showToast）</span><br><span class="line">window.webkit.messageHandlers.showToast.postMessage(&quot;哈哈，我是js调用的&quot;);</span><br></pre></td></tr></table></figure><h2 id="2、原生-1"><a href="#2、原生-1" class="headerlink" title="2、原生"></a>2、原生</h2><h3 id="安卓-1"><a href="#安卓-1" class="headerlink" title="安卓"></a>安卓</h3><p>新建类 <code>JsJavaBridge</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">public class JsJavaBridge &#123;</span><br><span class="line"></span><br><span class="line">    private Activity activity;</span><br><span class="line">    private WebView webView;</span><br><span class="line"></span><br><span class="line">    public JsJavaBridge(Activity activity, WebView webView) &#123;</span><br><span class="line">        this.activity = activity;</span><br><span class="line">        this.webView = webView;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @JavascriptInterface</span><br><span class="line">    public void onFinishActivity() &#123;</span><br><span class="line">        activity.finish();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @JavascriptInterface</span><br><span class="line">    public void showToast(String msg) &#123;</span><br><span class="line">        ToastUtils.show(msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 然后通过 WebView 设置 Android 类与 JS（vue） 代码的映射</span><br><span class="line">tbsWebView.addJavascriptInterface(new JsJavaBridge(this, tbsWebView), &quot;$App&quot;);</span><br></pre></td></tr></table></figure><h3 id="iOS-1"><a href="#iOS-1" class="headerlink" title="iOS"></a>iOS</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark -WKScriptMessageHandler</span><br><span class="line"> </span><br><span class="line">- (void)userContentController:(WKUserContentController*)userContentController didReceiveScriptMessage:(nonnull WKScriptMessage *)message&#123;</span><br><span class="line"> </span><br><span class="line">    if ([message.name isEqualToString:@&quot;showToast&quot;]) &#123;</span><br><span class="line"> </span><br><span class="line">        NSLog(@&quot;是什么？---%@&quot;,message.body);</span><br><span class="line"> </span><br><span class="line">       //做原生操作</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里将类 <code>JsJavaBridge</code> 在 JS 中映射为了 <code>$App</code>，所以在 Vue 中可以这样调用 <code>$App.showToast(&quot;哈哈，我是js调用的&quot;)</code>。</p><p>以上就是 原生 与 JS（vue） 的互相调用。</p>]]></content>
      
      
      <categories>
          
          <category> native </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue android iOS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue中使用svg</title>
      <link href="/2021/05/12/vue%E4%B8%AD%E4%BD%BF%E7%94%A8svg/"/>
      <url>/2021/05/12/vue%E4%B8%AD%E4%BD%BF%E7%94%A8svg/</url>
      
        <content type="html"><![CDATA[<p>先安装svg-sprite-loader</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install svg-sprite-loader --save</span><br></pre></td></tr></table></figure><p>vue.config.js</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">const path = require(&#x27;path&#x27;)</span><br><span class="line">module.exports = &#123;</span><br><span class="line">  chainWebpack: config =&gt; &#123;</span><br><span class="line">    const svgRule = config.module.rule(&#x27;svg&#x27;)</span><br><span class="line">    // 清除已有的所有 loader,否则接下来的 loader 会附加在该规则现有的 loader 之后。</span><br><span class="line">    svgRule.uses.clear()</span><br><span class="line">    svgRule</span><br><span class="line">      .test(/\.svg$/)</span><br><span class="line">      .include.add(path.resolve(__dirname, &#x27;./src/assets/icons&#x27;))// 配置icons的目录  </span><br><span class="line">      .end()</span><br><span class="line">      .use(&#x27;svg-sprite-loader&#x27;)</span><br><span class="line">      .loader(&#x27;svg-sprite-loader&#x27;)</span><br><span class="line">      .options(&#123;</span><br><span class="line">        symbolId: &#x27;icon-[name]&#x27;</span><br><span class="line">      &#125;)</span><br><span class="line">    const fileRule = config.module.rule(&#x27;file&#x27;)</span><br><span class="line">    fileRule.uses.clear()</span><br><span class="line">    fileRule</span><br><span class="line">      .test(/\.svg$/)</span><br><span class="line">      .exclude.add(path.resolve(__dirname, &#x27;./src/assets/icons&#x27;)) // 配置icons的目录</span><br><span class="line">      .end()</span><br><span class="line">      .use(&#x27;file-loader&#x27;)</span><br><span class="line">      .loader(&#x27;file-loader&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>新建一个IconSvg.vue</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;svg class=&quot;svg-icon&quot; aria-hidden=&quot;true&quot; v-on=&quot;$listeners&quot;&gt;</span><br><span class="line">      &lt;use :xlink:href=&quot;iconName&quot; /&gt;</span><br><span class="line">    &lt;/svg&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">   </span><br><span class="line">&lt;script&gt;</span><br><span class="line">  export default &#123;</span><br><span class="line">    name: &quot;icon-svg&quot;,</span><br><span class="line">    props: &#123;</span><br><span class="line">      iconClass: &#123;</span><br><span class="line">        type: String,</span><br><span class="line">        required: true</span><br><span class="line">      &#125;,</span><br><span class="line">      className: &#123;</span><br><span class="line">        type: String,</span><br><span class="line">        default: &quot;&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    computed: &#123;</span><br><span class="line">      iconName() &#123;</span><br><span class="line">        return `#icon-$&#123;this.iconClass&#125;`;</span><br><span class="line">      &#125;,</span><br><span class="line">      svgClass() &#123;</span><br><span class="line">        if (this.className) &#123;</span><br><span class="line">          return &quot;svg-icon &quot; + this.className;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          return &quot;svg-icon&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">   </span><br><span class="line">  &lt;style&gt;</span><br><span class="line">  .svg-icon &#123;</span><br><span class="line">    width: 100%;</span><br><span class="line">    height: 100%; </span><br><span class="line">    fill: currentColor;</span><br><span class="line">    overflow: hidden;</span><br><span class="line">  &#125;</span><br><span class="line">  &lt;/style&gt;</span><br></pre></td></tr></table></figure><p>在main.js中注入svg事件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import Vue from &#x27;vue&#x27;</span><br><span class="line">import App from &#x27;./App.vue&#x27;</span><br><span class="line">import &#x27;./registerServiceWorker&#x27;</span><br><span class="line">import router from &#x27;./router&#x27;</span><br><span class="line">import store from &#x27;./store&#x27;</span><br><span class="line"></span><br><span class="line">//引入svg组件</span><br><span class="line">import IconSvg from &#x27;./components/IconSvg&#x27;</span><br><span class="line"></span><br><span class="line">// //全局注册svg-icon</span><br><span class="line">Vue.component(&#x27;svg-icon&#x27;, IconSvg)</span><br><span class="line"></span><br><span class="line">new Vue(&#123;</span><br><span class="line">  router,</span><br><span class="line">  store,</span><br><span class="line">  render: h =&gt; h(App)</span><br><span class="line">&#125;).$mount(&#x27;#app&#x27;)</span><br></pre></td></tr></table></figure><p>在组件中的使用<br>app.vue</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=&quot;app&quot;&gt;</span><br><span class="line">    &lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">    &lt;footer  v-if=&quot;$route.meta.footShow&quot;&gt;</span><br><span class="line">      &lt;ul&gt;</span><br><span class="line">        &lt;router-link to=&quot;/home&quot;&gt;</span><br><span class="line">          &lt;li :class=&quot;&#123;liactive:$route.path.includes(&#x27;/home&#x27;)&#125;&quot;&gt;</span><br><span class="line">            &lt;span v-if=&quot;$route.path.includes(&#x27;/home&#x27;)&quot;&gt;</span><br><span class="line">              &lt;svg-icon  icon-class=&quot;shuaxin&quot;/&gt;</span><br><span class="line">              刷新</span><br><span class="line">            &lt;/span&gt;</span><br><span class="line">            &lt;span v-else&gt;</span><br><span class="line">              &lt;svg-icon  icon-class=&quot;shouye&quot;/&gt;</span><br><span class="line">              首页</span><br><span class="line">            &lt;/span&gt;            </span><br><span class="line">          &lt;/li&gt;</span><br><span class="line">        &lt;/router-link&gt;</span><br><span class="line">        &lt;router-link to=&quot;/writer&quot;&gt;</span><br><span class="line">          &lt;li&gt;</span><br><span class="line">              &lt;svg-icon   icon-class=&quot;jia&quot;/&gt;</span><br><span class="line">              发布</span><br><span class="line">          &lt;/li&gt;</span><br><span class="line">        &lt;/router-link&gt;</span><br><span class="line">        &lt;router-link to=&quot;/personal&quot;&gt;</span><br><span class="line">          &lt;li :class=&quot;&#123;liactive:$route.path.includes(&#x27;/personal&#x27;)&#125;&quot;&gt;</span><br><span class="line">            &lt;svg-icon v-if=&quot;$route.path.includes(&#x27;/personal&#x27;)&quot;   icon-class=&quot;wode_mian&quot;/&gt;</span><br><span class="line">            &lt;svg-icon v-else  icon-class=&quot;wode&quot;/&gt;</span><br><span class="line">            我的</span><br><span class="line">          &lt;/li&gt;</span><br><span class="line">        &lt;/router-link&gt;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    &lt;/footer&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &quot;@/assets/icons/shouye.svg&quot;</span><br><span class="line">import &quot;@/assets/icons/shuaxin.svg&quot;</span><br><span class="line">import &quot;@/assets/icons/jia.svg&quot;</span><br><span class="line">import &quot;@/assets/icons/wode.svg&quot;</span><br><span class="line">import &quot;@/assets/icons/wode_mian.svg&quot;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;app&#x27;,</span><br><span class="line">  components: &#123;</span><br><span class="line">   </span><br><span class="line">  &#125;,</span><br><span class="line">  methods:&#123;</span><br><span class="line">    //跳转页面</span><br><span class="line">    pageTo:function(index)&#123;</span><br><span class="line">      this.indexPage = index;</span><br><span class="line">        this.$router.replace(index)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>如何更改svg的颜色<br>首先，确保 .svg文件中</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fill=&quot;currentColor&quot;</span><br></pre></td></tr></table></figure><p>然后为&lt;&#x2F;加上class&#x3D;”XXX”</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg-icon class=&quot;xiaoxi-svg&quot; icon-class=&quot;xiaoxi&quot; /&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">.xiaoxi-svg&#123;</span><br><span class="line">width: 26px;</span><br><span class="line">height: 26px;</span><br><span class="line">color: #66b1ff;</span><br><span class="line">vertical-align: top;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>js循环的几种方式</title>
      <link href="/2021/05/12/js%E5%BE%AA%E7%8E%AF%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F/"/>
      <url>/2021/05/12/js%E5%BE%AA%E7%8E%AF%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h4 id="1-普通的for"><a href="#1-普通的for" class="headerlink" title="1.普通的for"></a>1.普通的for</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var arr = [1, 2, 3]</span><br><span class="line">for(let i = 0; i &lt; arr.length; i++) &#123; // 这里的i是代表数组的下标</span><br><span class="line">    console.log(i); // 0, 1, 2</span><br><span class="line">&#125;;</span><br><span class="line">最简单的一种，正常用的话也不会出现什么问题，想中断也可以中断，性能上也还可以 </span><br></pre></td></tr></table></figure><h4 id="2-for…of…遍历-这种遍历支持ES6"><a href="#2-for…of…遍历-这种遍历支持ES6" class="headerlink" title="2.for…of…遍历(这种遍历支持ES6"></a>2.for…of…遍历(这种遍历支持ES6</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var arr = [1, 2, 3]</span><br><span class="line">for(var item of arr) &#123; // item代表数组里面的元素</span><br><span class="line">    console.log(item); // 1, 2, 3</span><br><span class="line">&#125;;　</span><br><span class="line">与forEach()不同的是，它可以正确响应break、continue和return语句</span><br><span class="line">性能要好于forin，但仍然比不上普通for循环</span><br><span class="line">这个方法避开了for-in循环的所有缺陷</span><br></pre></td></tr></table></figure><h4 id="3-forEach"><a href="#3-forEach" class="headerlink" title="3. forEach()"></a>3. forEach()</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var arr = [1, 2, 3];</span><br><span class="line">arr.forEach((item, index, arr) =&gt; &#123; // item为arr的元素，index为下标，arr原数组</span><br><span class="line">    console.log(item); // 1, 2, 3</span><br><span class="line">    console.log(index); // 0, 1, 2</span><br><span class="line">    console.log(arr); // [1, 2, 3]</span><br><span class="line">&#125;);</span><br><span class="line">常用的return false是可以终止代码继续往下执行的，但是在forEach遍历中，并没有终止循环，所以在用forEach的时候，要考虑使用场景了。</span><br></pre></td></tr></table></figure><h4 id="4-some"><a href="#4-some" class="headerlink" title="4.some()"></a>4.some()</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var arr = [1, 2, 3];</span><br><span class="line">arr.some((item, index, arr) =&gt; &#123; // item为数组中的元素，index为下标，arr为目标数组</span><br><span class="line">    console.log(item); // 1, 2, 3</span><br><span class="line">    console.log(index); // 0, 1, 2</span><br><span class="line">    console.log(arr); // [1, 2, 3]  </span><br><span class="line">&#125;)</span><br><span class="line">some作为一个用来检测数组是否满足一些条件的函数存在，同样是可以用作遍历的函数签名同forEach，有区别的是当任一callback返回值匹配为true则会直接返回true，如果所有的callback匹配均为false，则返回false。</span><br><span class="line">some() 方法会依次执行数组的每个元素：</span><br><span class="line">如果有一个元素满足条件，则表达式返回true , 剩余的元素不会再执行检测。</span><br><span class="line">如果没有满足条件的元素，则返回false。</span><br></pre></td></tr></table></figure><h4 id="5-every"><a href="#5-every" class="headerlink" title="5.every()"></a>5.every()</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var arr = [1, 2, 3];</span><br><span class="line">arr.every((item, index, arr) =&gt; &#123; // item为数组中的元素，index为下标，arr为目标数组</span><br><span class="line">    return item &gt; 0; // true</span><br><span class="line">    return index == 0; // false</span><br><span class="line">&#125;)</span><br><span class="line">every() 方法用于检测数组所有元素是否都符合指定条件（通过函数提供）。</span><br><span class="line">every() 方法使用指定函数检测数组中的所有元素：</span><br><span class="line">如果数组中检测到有一个元素不满足，则整个表达式返回 false ，且剩余的元素不会再进行检测。</span><br><span class="line">如果所有元素都满足条件，则返回 true。</span><br></pre></td></tr></table></figure><h4 id="6-for…in…遍历"><a href="#6-for…in…遍历" class="headerlink" title="6.for…in…遍历."></a>6.for…in…遍历.</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var arr = [1, 2, 3]</span><br><span class="line">for(var item in arr) &#123; // item遍历数组时为数组的下标，遍历对象时为对象的key值</span><br><span class="line">    console.log(item); // 0, 1, 2</span><br><span class="line">&#125;;</span><br><span class="line">for...in更多是用来遍历对象，很少用来遍历数组， 不过 item 对应与数组的 key值，建议不要用该方法来遍历数组，因为它的效率是最低的。</span><br></pre></td></tr></table></figure><h4 id="7-filter"><a href="#7-filter" class="headerlink" title="7. filter()"></a>7. filter()</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var arr = [1, 2, 3];</span><br><span class="line">arr.filter(item =&gt; &#123; // item为数组当前的元素</span><br><span class="line">    return item &gt; 1; // [2, 3]</span><br><span class="line">&#125;)</span><br><span class="line">filter() 方法创建一个新的数组，新数组中的元素是通过检查指定数组中符合条件的所有元素。</span><br></pre></td></tr></table></figure><h4 id="8-map"><a href="#8-map" class="headerlink" title="8.map()"></a>8.map()</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var arr = [1, 2, 3];</span><br><span class="line">arr.map(item =&gt; &#123; // item为数组的元素</span><br><span class="line">    console.log(item); // 1, 2, 3</span><br><span class="line">    return item * 2; // 返回一个处理过的新数组[2, 4, 6]</span><br><span class="line">&#125;)</span><br><span class="line">map() 方法返回一个新数组，数组中的元素为原始数组元素调用函数处理后的值。</span><br><span class="line">map() 方法按照原始数组元素顺序依次处理元素。</span><br><span class="line">这种方式也是用的比较广泛的，虽然用起来比较优雅，但实际效率还比不上foreach</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ES6模块</title>
      <link href="/2021/03/30/ES6%E6%A8%A1%E5%9D%97/"/>
      <url>/2021/03/30/ES6%E6%A8%A1%E5%9D%97/</url>
      
        <content type="html"><![CDATA[<h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><p>ES6 的模块自动开启严格模式，不管你有没有在模块头部加上 **use strict;**。</p><p>模块中可以导入和导出各种类型的变量，如函数，对象，字符串，数字，布尔值，类等。</p><p>每个模块都有自己的上下文，每一个模块内声明的变量都是局部变量，不会污染全局作用域。</p><p>每一个模块只加载一次（是单例的）， 若再去加载同目录下同文件，直接从内存中读取。</p><h2 id="export-与-import"><a href="#export-与-import" class="headerlink" title="export 与 import"></a>export 与 import</h2><h3 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h3><p>模块导入导出各种类型的变量，如字符串，数值，函数，类。</p><ul><li>导出的函数声明与类声明必须要有名称（export default 命令另外考虑）。</li><li>不仅能导出声明还能导出引用（例如函数）。</li><li>export 命令可以出现在模块的任何位置，但必需处于模块顶层。</li><li>import 命令会提升到整个模块的头部，首先执行。</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">/*-----export [test.js]-----*/ </span><br><span class="line">let myName = &quot;Tom&quot;; </span><br><span class="line">let myAge = 20; </span><br><span class="line">let myfn = function()&#123;    </span><br><span class="line">return &quot;My name is&quot; + myName + &quot;! I&#x27;m &#x27;&quot; + myAge + &quot;years old.&quot; </span><br><span class="line">&#125; </span><br><span class="line">let myClass =  class myClass &#123;    </span><br><span class="line">static a = &quot;yeah!&quot;; </span><br><span class="line">&#125; </span><br><span class="line">export &#123; myName, myAge, myfn, myClass &#125;  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/*-----import [xxx.js]-----*/ </span><br><span class="line">import &#123; myName, myAge, myfn, myClass &#125; from &quot;./test.js&quot;; </span><br><span class="line"></span><br><span class="line">console.log(myfn());// My name is Tom! I&#x27;m 20 years old. </span><br><span class="line">console.log(myAge);// 20 </span><br><span class="line">console.log(myName);// Tom </span><br><span class="line">console.log(myClass.a );// yeah!</span><br></pre></td></tr></table></figure><p>建议使用大括号指定所要输出的一组变量写在文档尾部，明确导出的接口。</p><p>函数与类都需要有对应的名称，导出文档尾部也避免了无对应名称。</p><h3 id="as-的用法"><a href="#as-的用法" class="headerlink" title="as 的用法"></a>as 的用法</h3><p>export 命令导出的接口名称，须和模块内部的变量有一一对应关系。</p><p>导入的变量名，须和导出的接口名称相同，即顺序可以不一致。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">/*-----export [test.js]-----*/</span><br><span class="line"></span><br><span class="line">let myName = &quot;Tom&quot;;</span><br><span class="line">export &#123; myName as exportName &#125;</span><br><span class="line"> </span><br><span class="line">/*-----import [xxx.js]-----*/</span><br><span class="line">import &#123; exportName &#125; from &quot;./test.js&quot;;</span><br><span class="line">console.log(exportName);// Tom</span><br><span class="line"></span><br><span class="line">使用 as 重新定义导出的接口名称，隐藏模块内部的变量</span><br><span class="line">/*-----export [test1.js]-----*/</span><br><span class="line">let myName = &quot;Tom&quot;;</span><br><span class="line">export &#123; myName &#125;</span><br><span class="line"></span><br><span class="line">/*-----export [test2.js]-----*/</span><br><span class="line">let myName = &quot;Jerry&quot;;</span><br><span class="line">export &#123; myName &#125;</span><br><span class="line"></span><br><span class="line">/*-----import [xxx.js]-----*/</span><br><span class="line">import &#123; myName as name1 &#125; from &quot;./test1.js&quot;;</span><br><span class="line">import &#123; myName as name2 &#125; from &quot;./test2.js&quot;;</span><br><span class="line">console.log(name1);// Tom</span><br><span class="line">console.log(name2);// Jerry</span><br></pre></td></tr></table></figure><p>不同模块导出接口名称命名重复， 使用 as 重新定义变量名。</p><h3 id="import-命令的特点"><a href="#import-命令的特点" class="headerlink" title="import 命令的特点"></a>import 命令的特点</h3><p><strong>只读属性</strong>：不允许在加载模块的脚本里面，改写接口的引用指向，即可以改写 import 变量类型为对象的属性值，不能改写 import 变量类型为基本类型的值。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import &#123;a&#125; from &quot;./xxx.js&quot;</span><br><span class="line">a = &#123;&#125;; // error</span><br><span class="line"> </span><br><span class="line">import &#123;a&#125; from &quot;./xxx.js&quot;</span><br><span class="line">a.foo = &quot;hello&quot;; // a = &#123; foo : &#x27;hello&#x27; &#125;</span><br></pre></td></tr></table></figure><p><strong>单例模式</strong>：多次重复执行同一句 import 语句，那么只会执行一次，而不会执行多次。import 同一模块，声明不同接口引用，会声明对应变量，但只执行一次 import 。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import &#123; a &#125; &quot;./xxx.js&quot;;</span><br><span class="line">import &#123; a &#125; &quot;./xxx.js&quot;;</span><br><span class="line">// 相当于 import &#123; a &#125; &quot;./xxx.js&quot;;</span><br><span class="line"> </span><br><span class="line">import &#123; a &#125; from &quot;./xxx.js&quot;;</span><br><span class="line">import &#123; b &#125; from &quot;./xxx.js&quot;;</span><br><span class="line">// 相当于 import &#123; a, b &#125; from &quot;./xxx.js&quot;;</span><br></pre></td></tr></table></figure><p>静态执行特性：import 是静态执行，所以不能使用表达式和变量。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import &#123; &quot;f&quot; + &quot;oo&quot; &#125; from &quot;methods&quot;; // error</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">let module = &quot;methods&quot;;</span><br><span class="line">import &#123; foo &#125; from module;// error</span><br><span class="line"></span><br><span class="line">if (true) &#123; // error</span><br><span class="line">  import &#123; foo &#125; from &quot;method1&quot;;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">  import &#123; foo &#125; from &quot;method2&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="export-default-命令"><a href="#export-default-命令" class="headerlink" title="export default 命令"></a>export default 命令</h3><ul><li>在一个文件或模块中，export、import 可以有多个，export default 仅有一个。</li><li>export default 中的 default 是对应的导出接口变量。</li><li>通过 export 方式导出，在导入时要加{ }，export default 则不需要。</li><li>export default 向外暴露的成员，可以使用任意变量来接收。</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var a = &quot;My name is Tom!&quot;;</span><br><span class="line">export default a; // 仅有一个</span><br><span class="line">export default var c = &quot;error&quot;; </span><br><span class="line">// error，default 已经是对应的导出变量，不能跟着变量声明语句</span><br><span class="line"> </span><br><span class="line">import b from &quot;./xxx.js&quot;; // 不需要加&#123;&#125;， 使用任意变量接收</span><br></pre></td></tr></table></figure><h2 id="复合使用"><a href="#复合使用" class="headerlink" title="复合使用"></a>复合使用</h2><blockquote><p><strong>注</strong>：import() 是提案，这边暂时不延伸讲解。</p></blockquote><p>export 与 import 可以在同一模块使用，使用特点：</p><ul><li>可以将导出接口改名，包括 default。</li><li>复合使用 export 与 import ，也可以导出全部，当前模块导出的接口会覆盖继承导出的。</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">export &#123; foo, bar &#125; from &quot;methods&quot;;</span><br><span class="line"> </span><br><span class="line">// 约等于下面两段语句，不过上面导入导出方式该模块没有导入 foo 与 bar</span><br><span class="line">import &#123; foo, bar &#125; from &quot;methods&quot;;</span><br><span class="line">export &#123; foo, bar &#125;;</span><br><span class="line"> </span><br><span class="line">/* ------- 特点 1 --------*/</span><br><span class="line">// 普通改名</span><br><span class="line">export &#123; foo as bar &#125; from &quot;methods&quot;;</span><br><span class="line"></span><br><span class="line">// 将 foo 转导成 default</span><br><span class="line">export &#123; foo as default &#125; from &quot;methods&quot;;</span><br><span class="line"></span><br><span class="line">// 将 default 转导成 foo</span><br><span class="line">export &#123; default as foo &#125; from &quot;methods&quot;;</span><br><span class="line"> </span><br><span class="line">/* ------- 特点 2 --------*/</span><br><span class="line">export * from &quot;methods&quot;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> es6 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> es6 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>js之var let及const区别</title>
      <link href="/2021/03/26/js%E4%B9%8Bvar-let%E5%8F%8Aconst%E5%8C%BA%E5%88%AB/"/>
      <url>/2021/03/26/js%E4%B9%8Bvar-let%E5%8F%8Aconst%E5%8C%BA%E5%88%AB/</url>
      
        <content type="html"><![CDATA[<p>对于这个问题，我们应该先来了解提升（hoisting）这个概念</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">console.log(a) // undefined</span><br><span class="line">var a = 1</span><br></pre></td></tr></table></figure><p>从上述代码中我们可以发现，虽然变量还没有被声明，但是我们却可以使用这个未被声明的变量，这种情况就叫做提<br>升，并且提升的是声明。</p><p>我们已经了解了 var 声明的变量会发生提升的情况，其实不仅变量会提升函数也会被提升。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">console.log(a) // ƒ a() &#123;&#125;</span><br><span class="line">function a() &#123;&#125;</span><br><span class="line">var a = 1</span><br></pre></td></tr></table></figure><p>对于上述代码，打印结果会是 ƒ a() {} ，即使变量声明在函数之后，这也说明了函数会被提升，并且优先于变量提<br>升。<br>说完了这些，想必大家也知道 var 存在的问题了，使用 var 声明的变量会被提升到作用域的顶部，接下来我们再<br>来看 let 和 const 。</p><p>我们先来看一个例子：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">var a = 1</span><br><span class="line">let b = 1</span><br><span class="line">const c = 1</span><br><span class="line"></span><br><span class="line">console.log(window.b) // undefined</span><br><span class="line">console.log(window. c) // undefined</span><br><span class="line"></span><br><span class="line">function test()&#123;</span><br><span class="line">console.log(a)</span><br><span class="line">let a</span><br><span class="line">&#125;</span><br><span class="line">test()</span><br></pre></td></tr></table></figure><p>首先在全局作用域下使用 let 和 const 声明变量，变量并不会被挂载到 window 上，这一点就和 var 声明有了区别。<br>再者当我们在声明 a 之前如果使用了 a ，就会出现报错的情况</p><p>你可能会认为这里也出现了提升的情况，但是因为某些原因导致不能访问。<br>首先报错的原因是因为存在暂时性死区，我们不能在声明前就使用变量，这也是 let 和 const 优于 var 的一点。</p><p>然后这里你认为的提升和 var 的提升是有区别的，虽然变量在编译的环节中被告知在这块作用域中可以访问，但是访问是受限制的。</p><p>那么到这里，想必大家也都明白 var 、 let 及 const 区别了，不知道你是否会有这么一个疑问，为什么要存在提升这个事情呢，其实提升存在的根本原因就是为了解决函数间互相调用的情况</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function test1() &#123;</span><br><span class="line">test2()</span><br><span class="line">&#125;</span><br><span class="line">function test2() &#123;</span><br><span class="line">test1()</span><br><span class="line">&#125;</span><br><span class="line">test1()</span><br></pre></td></tr></table></figure><p>假如不存在提升这个情况，那么就实现不了上述的代码，因为不可能存在 test1 在 test2 前面然后 test2 又在test1 前面。</p><h3 id="const：声明常量时，是只读且不可修改的"><a href="#const：声明常量时，是只读且不可修改的" class="headerlink" title="const：声明常量时，是只读且不可修改的"></a>const：声明常量时，是只读且不可修改的</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const a = 3;</span><br><span class="line">console.log(a);//3</span><br><span class="line">a = 5;//Uncaught TypeError: Assignment to constant variable(未捕获的TypeError:常量变量赋值)</span><br><span class="line">console.log(a);</span><br></pre></td></tr></table></figure><p>下面再来看一个列子：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const obj = &#123;&#125;;</span><br><span class="line">    obj.a = 3;</span><br><span class="line">    console.log(obj);//&#123;a: 3&#125;</span><br></pre></td></tr></table></figure><p>看到这里是不是疑惑为什么可以修改了？？？，<strong>const声明的变量只是保证了变量指向的地址不变，如果这个对象是引用类型的话，它的值是可以被修改的。</strong></p><p>那么最后我们总结下这个部分的内容：</p><p><strong>函数提升优先于变量提升，函数提升会把整个函数挪到作用域顶部，变量提升只会把声明挪到作用域顶部</strong></p><p><strong>var 存在提升，我们能在声明之前使用。 let 、 const 因为暂时性死区的原因，不能在声明前使用</strong></p><p><strong>var 在全局作用域下声明变量会导致变量挂载在 window 上，其他两者不会</strong></p><p><strong>let 声明的变量只在 let 命令所在的代码块内有效。</strong></p><p><strong>const 声明一个只读的常量，一旦声明，常量的值就不能改变。</strong></p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>js判断数据类型方法</title>
      <link href="/2021/03/26/js%E5%88%A4%E6%96%AD%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E6%96%B9%E6%B3%95/"/>
      <url>/2021/03/26/js%E5%88%A4%E6%96%AD%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E6%96%B9%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<p>判断js中的数据类型有一下几种方法：typeof、instanceof、 constructor、 prototype、 $.type()&#x2F;jquery.type(),接下来主要比较一下这几种方法的异同。</p><p>先举几个例子：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var a = &quot;helloworld&quot;;</span><br><span class="line">var b = 222;</span><br><span class="line">var c= [1,2,3];</span><br><span class="line">var d = new Date();</span><br><span class="line">var e = function()&#123;alert(111);&#125;;</span><br><span class="line">var f = function()&#123;this.name=&quot;22&quot;;&#125;;</span><br></pre></td></tr></table></figure><h3 id="1、最常见的判断方法：typeof"><a href="#1、最常见的判断方法：typeof" class="headerlink" title="1、最常见的判断方法：typeof"></a>1、最常见的判断方法：typeof</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">alert(typeof a)   ------------&gt; string</span><br><span class="line">alert(typeof b)   ------------&gt; number</span><br><span class="line">alert(typeof c)   ------------&gt; object</span><br><span class="line">alert(typeof d)   ------------&gt; object</span><br><span class="line">alert(typeof e)   ------------&gt; function</span><br><span class="line">alert(typeof f)   ------------&gt; function</span><br><span class="line">alert(typeof NaN)   ------------&gt; number //NaN是一种特殊的number,NaN与任何值都不相等,与自己也不相等</span><br><span class="line">alert(typeof null)   ------------&gt; object</span><br><span class="line"></span><br><span class="line">其中typeof返回的类型都是字符串形式，需注意，例如：</span><br><span class="line">alert(typeof a == &quot;string&quot;) -------------&gt; true</span><br><span class="line">alert(typeof a == String) ---------------&gt; false</span><br><span class="line"></span><br><span class="line">但是在判断引用类型的值时，常常会遇到一个问题：无论引用的是什么类型的对象，都会返回 &quot;object&quot;(当然还有 &quot;function&quot;) 。有时候我们需要知道这个引用对象的类型是数组还是一个包装对象，这个时候 instanceof 就可以派上用场了。</span><br></pre></td></tr></table></figure><h3 id="2、判断已知对象类型的方法：-instanceof"><a href="#2、判断已知对象类型的方法：-instanceof" class="headerlink" title="2、判断已知对象类型的方法： instanceof"></a>2、判断已知对象类型的方法： instanceof</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">alert(c instanceof Array) ---------------&gt; true</span><br><span class="line">alert(d instanceof Date) </span><br><span class="line">alert(f instanceof Function) ------------&gt; true</span><br><span class="line">alert(f instanceof function) ------------&gt; false</span><br><span class="line"></span><br><span class="line">instanceof 的内部机制是通过判断对象的原型链中是不是能找到类型的 prototype。</span><br><span class="line">注意：instanceof 后面一定要是对象类型，并且大小写不能错，该方法适合一些条件选择或分支。</span><br></pre></td></tr></table></figure><h3 id="3、根据对象的constructor判断：-constructor"><a href="#3、根据对象的constructor判断：-constructor" class="headerlink" title="3、根据对象的constructor判断： constructor"></a>3、根据对象的constructor判断： constructor</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">alert(c.constructor === Array) ----------&gt; true</span><br><span class="line">alert(d.constructor === Date) -----------&gt; true</span><br><span class="line">alert(e.constructor === Function) -------&gt; true</span><br><span class="line">注意： constructor 在类继承时会出错</span><br><span class="line">eg：</span><br><span class="line">      function A()&#123;&#125;;</span><br><span class="line">      function B()&#123;&#125;;</span><br><span class="line">      A.prototype = new B(); //A继承自B</span><br><span class="line">      var aObj = new A();</span><br><span class="line">      alert(aobj.constructor === B) -----------&gt; true;</span><br><span class="line"></span><br><span class="line">      alert(aobj.constructor === A) -----------&gt; false;</span><br><span class="line"></span><br><span class="line">而instanceof方法不会出现该问题，对象直接继承和间接继承的都会报true：</span><br><span class="line">      alert(aobj instanceof B) ----------------&gt; true;</span><br><span class="line">      </span><br><span class="line">      alert(aobj instanceof B) ----------------&gt; true;</span><br><span class="line"></span><br><span class="line">言归正传，解决construtor的问题通常是让对象的constructor手动指向自己：</span><br><span class="line"></span><br><span class="line">      aobj.constructor = A; //将自己的类赋值给对象的constructor属性</span><br><span class="line">      alert(aobj.constructor === A) -----------&gt; true;</span><br><span class="line">      </span><br><span class="line">      alert(aobj.constructor === B) -----------&gt; false; //基类不会报true了;</span><br></pre></td></tr></table></figure><h3 id="4、通用但很繁琐的方法：-prototype"><a href="#4、通用但很繁琐的方法：-prototype" class="headerlink" title="4、通用但很繁琐的方法： prototype"></a>4、通用但很繁琐的方法： prototype</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">alert(Object.prototype.toString.call(a) === ‘[object String]’) -------&gt; true;</span><br><span class="line"></span><br><span class="line">alert(Object.prototype.toString.call(b) === ‘[object Number]’) -------&gt; true;</span><br><span class="line"></span><br><span class="line">alert(Object.prototype.toString.call(c) === ‘[object Array]’) -------&gt; true;</span><br><span class="line"></span><br><span class="line">alert(Object.prototype.toString.call(d) === ‘[object Date]’) -------&gt; true;</span><br><span class="line"></span><br><span class="line">alert(Object.prototype.toString.call(e) === ‘[object Function]’) -------&gt; true;</span><br><span class="line"></span><br><span class="line">alert(Object.prototype.toString.call(f) === ‘[object Function]’) -------&gt; true;</span><br><span class="line"></span><br><span class="line">大小写不能写错，比较麻烦，但胜在通用。</span><br></pre></td></tr></table></figure><h3 id="5、无敌万能的方法：jquery-type"><a href="#5、无敌万能的方法：jquery-type" class="headerlink" title="5、无敌万能的方法：jquery.type()"></a>5、无敌万能的方法：jquery.type()</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">如果对象是undefined或null，则返回相应的“undefined”或“null”。</span><br><span class="line"></span><br><span class="line">jQuery.type( undefined ) === &quot;undefined&quot;</span><br><span class="line"></span><br><span class="line">jQuery.type() === &quot;undefined&quot;</span><br><span class="line"></span><br><span class="line">jQuery.type( window.notDefined ) === &quot;undefined&quot;</span><br><span class="line"></span><br><span class="line">jQuery.type( null ) === &quot;null&quot;</span><br><span class="line"></span><br><span class="line">如果对象有一个内部的[[Class]]和一个浏览器的内置对象的 [[Class]] 相同，我们返回相应的 [[Class]] 名字。 (有关此技术的更多细节。 )</span><br><span class="line"></span><br><span class="line">jQuery.type( true ) === &quot;boolean&quot;</span><br><span class="line"></span><br><span class="line">jQuery.type( 3 ) === &quot;number&quot;</span><br><span class="line"></span><br><span class="line">jQuery.type( &quot;test&quot; ) === &quot;string&quot;</span><br><span class="line"></span><br><span class="line">jQuery.type( function()&#123;&#125; ) === &quot;function&quot;</span><br><span class="line"></span><br><span class="line">jQuery.type( [] ) === &quot;array&quot;</span><br><span class="line"></span><br><span class="line">jQuery.type( new Date() ) === &quot;date&quot;</span><br><span class="line"></span><br><span class="line">jQuery.type( new Error() ) === &quot;error&quot; // as of jQuery 1.9</span><br><span class="line"></span><br><span class="line">jQuery.type( /test/ ) === &quot;regexp&quot;</span><br><span class="line"></span><br><span class="line">其他一切都将返回它的类型“object”。</span><br></pre></td></tr></table></figure><p>通常情况下用typeof 判断就可以了，遇到预知Object类型的情况可以选用instanceof或constructor方法,实在没辙就使用$.type()方法。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>js 基本类型和引用类型区别</title>
      <link href="/2021/03/26/js-%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B%E5%92%8C%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B%E5%8C%BA%E5%88%AB/"/>
      <url>/2021/03/26/js-%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B%E5%92%8C%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B%E5%8C%BA%E5%88%AB/</url>
      
        <content type="html"><![CDATA[<h2 id="一、JavaScript全部数据类型"><a href="#一、JavaScript全部数据类型" class="headerlink" title="一、JavaScript全部数据类型"></a>一、JavaScript全部数据类型</h2><ul><li>内置类型</li><li><ul><li>空值 null</li><li>未定义 undefined</li><li>布尔值 boolean</li><li>数字 number</li><li>字符串 string</li><li>对象 object</li><li>符号 symbol</li><li>长整型 bigInt</li></ul></li><li>1.基本数据类型</li></ul><blockquote><p>undefined null number boolean string symbol(ES新增) bigint(ES10新增)</p></blockquote><p>基本数据类型是按值访问的，就是说我们可以操作保存在变量中的实际的值</p><ul><li>1.1基本数据类型的值是不可变的</li><li>1.2基本数据类型不可以添加属性和方法</li><li>1.3基本数据类型的赋值是简单赋值</li><li>1.4基本数据类型的比较是值的比较</li><li>1.5基本数据类型是存放在栈区的</li><li>2.引用类型</li></ul><blockquote><p>JS中除了上面的基本类型之外就是引用类型了，也可以说是object 对象，比如：object array function data等</p></blockquote><ul><li>2.1引用类型的值是可以改变</li><li>2.2引用类型可以添加属性和方法</li><li>2.3引用类型的赋值是对象引用</li><li>2.4引用类型的标胶是引用的比较</li><li>2.5引用类型是同时存在栈区和堆区的</li></ul><h2 id="二、基本数据类型和引用数据类型的区别"><a href="#二、基本数据类型和引用数据类型的区别" class="headerlink" title="二、基本数据类型和引用数据类型的区别"></a>二、基本数据类型和引用数据类型的区别</h2><ul><li>1.声明变量时不同的内存分配</li></ul><p><code>原始值：</code>存储在栈(stack)中的简单数据段，也就是说，它们的值直接存储在变量访问的位置。是因为这些原始类型占据的空间是固定的，所以可以将它们存储在较小的内存区域—栈中，这样存储便于迅速查询变量的值</p><p><code>引用值：</code>存储在堆(heap)中的对象。也就是说，存储在变量处的值是一个指针(point)，指向存储对象的内存地址。是因为引用值的大小会改变，所以不能把它放在栈中，否则会降低变量查询的速度。相反，放在变量的栈空间中的值是该对象存储在堆中的地址。地址的大小是固定的，所以把它存储在栈中对变量性能无任何负面影响。</p><ul><li>2.不同的内存分配机制也带来了不同的访问机制</li></ul><p>在js中是不允许直接访问保存在堆内存中的对象的，所以在访问一个对象时，首先得到的是这个对象在堆内存中的地址，然后再按照这个地址去获得这个对象中的值，这就是传说中的按引用访问。而原始类型的值是可以直接访问到的。</p><ul><li>3.复制变量时的不同</li></ul><p><code>原始值：</code>在将一个保存着原始值的变量复制给另一个变量时，会将原始值的副本赋值给新变量，此后这两个变量是完全独立的，它们只是拥有相同的value而已</p><p><code>引用值：</code>在将一个保存着对象内存地址的变量复制给另一个变量时，会把这个内存地址赋值给新变量，也就是说这两个变量都指向了堆内存中同一个对象，他们中任何一个做出的改变都会反映在另一个身上。(需要理解的一点是：复制对象时并不会在堆内存中新生成一个一模一样的对象，只是多了一个保存指向这个对象指针的变量罢了)</p><ul><li>4.参数传递的不同(把实参复制给形参的过程)</li></ul><p>首先我们应该明确的一点是：ESCMAScript中所有函数的参数都是按值来传递的。 但是为什么涉及到原始类型与引用类型的值时仍然有区别呢？这就是因为内存分配时的差别。</p><p><code>原始值：</code>只是把变量里的值传递给参数，之后参数和这个变量互不影响</p><p><code>引用值：</code>对象变量里面的值是这个对象在堆内存中的内存地址，这一点很重要！因此它传递的值也就是这个内存地址，这也就是为什么函数内部对这个参数的修改会体现在外部的原因，因为它们都指向同一个对象。</p><h3 id="Symbol"><a href="#Symbol" class="headerlink" title="Symbol"></a>Symbol</h3><p>Symbol 指的是独一无二的值。每个通过 Symbol() 生成的值都是唯一的。</p><p>symbol 是一种基本数据类型（primitive data type） 。Symbol()函数会返回symbol类型的值，该类型具有静态属性和静态方法。它的静态属性会暴露几个内建的成员对象；它的静态方法会暴露全局的symbol注册，且类似于内建对象类，但作为构造函数来说它并不完整，因为它不支持语法：“new Symbol()”。</p><p>每个从Symbol()返回的symbol值都是唯一的。一个symbol值能作为对象属性的标识符；这是该数据类型仅有的目的。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">let var_symbol = Symbol();</span><br><span class="line">let other_symbol = Symbol();</span><br><span class="line">console.log(var_symbol === other_symbol);</span><br><span class="line">// false</span><br><span class="line">console.log(typeof var_symbol);</span><br><span class="line">// symbol</span><br><span class="line">console.log(var_symbol.constructor === Symbol)</span><br><span class="line">// true</span><br></pre></td></tr></table></figure><p>那么，如何使用 Symbol 创建两个可以相等的变量呢？</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">alet var_symbol = Symbol.for(&#x27;symbol&#x27;);</span><br><span class="line">let other_symbol = Symbol.for(&#x27;symbol&#x27;);</span><br><span class="line">console.log(var_symbol === other_symbol)</span><br><span class="line">// true</span><br></pre></td></tr></table></figure><p>Symbol.for(key) 方法会根据给定的键 key(字符串)，来从运行时的 symbol 注册表中找到对应的 symbol，如果找到了，则返回它，否则，新建一个与该键关联的 symbol，并放入全局 symbol 注册表中。<br>————————————————————————————————————————————<br>和 Symbol() 不同的是，用 Symbol.for() 方法创建的的 symbol 会被放入一个全局 symbol 注册表中。Symbol.for() 并不是每次都会创建一个新的 symbol，它会首先检查给定的 key 是否已经在注册表中了。假如是，则会直接返回上次存储的那个。否则，它会再新建一个。</p><h3 id="BigInt"><a href="#BigInt" class="headerlink" title="BigInt"></a>BigInt</h3><p>BigInt 是一种数字类型的数据，它可以表示任意精度格式的整数。而在其他编程语言中，可以存在不同的数字类型，例如:整数、浮点数、双精度数或大斐波数。</p><p>JavaScript 所有数字都保存成 64 位浮点数，这给数值的表示带来了两大限制。一是数值的精度只能到 53 个二进制位（相当于 16 个十进制位），大于这个范围的整数，JavaScript 是无法精确表示的，这使得 JavaScript 不适合进行科学和金融方面的精确计算。二是大于或等于2的1024次方的数值，JavaScript 无法表示，会返回Infinity。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 超过 53 个二进制位的数值，无法保持精度</span><br><span class="line">Math.pow(2, 53) === Math.pow(2, 53) + 1 // true</span><br><span class="line"></span><br><span class="line">// 超过 2 的 1024 次方的数值，无法表示</span><br><span class="line">Math.pow(2, 1024) // Infinity</span><br></pre></td></tr></table></figure><p>ES2020 引入了一种新的数据类型 BigInt，来解决这个问题。BigInt 只用来表示整数，没有位数的限制，任何位数的整数都可以精确表示。</p><p>为了与 Number 类型进行区分，BigInt 类型的数据必须添加后缀n。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">12 // 普通Number</span><br><span class="line">12n // BigInt</span><br><span class="line"></span><br><span class="line">// BigInt 的运算</span><br><span class="line">1n + 2n // 3n</span><br><span class="line"></span><br><span class="line">// 与Number 类型进行运算</span><br><span class="line">1 + 1n // Uncaught TypeError</span><br><span class="line"></span><br><span class="line">BigInt 与普通整数是两种值，它们之间并不相等。</span><br><span class="line"></span><br><span class="line">12n === 12 // false</span><br></pre></td></tr></table></figure><p>由于 BigInt 与 Number 完全属于两种类型,并且不会进行隐式转换，所以没有办法进行混合运算。想要运算的话，必须将两种数据类型转换为同一张后，方可进行计算：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BigInt(number) // 将一个 Number 转换为 BigInt</span><br><span class="line">Number(bigint) // 将一个 BigInt 转换为 Number</span><br></pre></td></tr></table></figure><p>typeof 运算符对于 BigInt 类型的数据返回 bigint。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typeof 12n // &#x27;bigint&#x27;</span><br></pre></td></tr></table></figure><p>由于 BigInt 并不是一个构造函数，所以，不能使用 new BigInt() 的方式来构建实例</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">new BigInt() </span><br><span class="line">// Uncaught TypeError: BigInt is not a constructor at new BigInt</span><br></pre></td></tr></table></figure><p>另外，当你创建一个 BigInt 的时候，参数必须为整数，否则或报错</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BigInt(1.2) </span><br><span class="line">// Uncaught RangeError: The number 1.2 cannot be converted to a BigInt because it is not an integer</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>js之闭包</title>
      <link href="/2021/03/26/js%E4%B9%8B%E9%97%AD%E5%8C%85/"/>
      <url>/2021/03/26/js%E4%B9%8B%E9%97%AD%E5%8C%85/</url>
      
        <content type="html"><![CDATA[<h3 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h3><h4 id="定义：函数-和-函数内部能访问到的变量-就是一个闭包"><a href="#定义：函数-和-函数内部能访问到的变量-就是一个闭包" class="headerlink" title="定义：函数 和 函数内部能访问到的变量 就是一个闭包"></a>定义：函数 和 函数内部能访问到的变量 就是一个闭包</h4><p>常用方式示例：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">  function foo() &#123;</span><br><span class="line">          var num  = 10;</span><br><span class="line">          return function () &#123;</span><br><span class="line">              var age= 20;</span><br><span class="line">              console.log(++num);</span><br><span class="line">              console.log(++age);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">var f = foo();</span><br><span class="line">  f(); //11 21</span><br><span class="line">  f(); //12 21</span><br></pre></td></tr></table></figure><p> 通过闭包就可以让外部作用域访问函数内部作用域的变量，我们知道当函数执行完以后，会立即销毁，但 foo 函数内的 num 属性被内部的匿名函数引用着，而内部函数又被外部变量 f 引用着，所以函数 foo 在执行完以后虽然会立即销毁，但它内部的匿名函数在创建的时候就会随之创建一个特殊的容器，用于保存 上层作用域 中 变量 的引用，所以foo 函数中的 num 并不会销毁，当执行第一次 f() 时，会创建 f() 对应的作用域，其中num 会从之前创建的特殊的容器中取出上层作用域中变量的值，而 age 会立即声明一个，当函数执行完毕后，就会销毁对应的作用域，此时 age 也会随之销毁，但变量 f 对应的指针地址不会变，当再次执行 f() 时，又会再创建一个 f() 对应的作用域，num 还是会从上层作用域中拿，但 age 还是会重新声明，使用完后还是会被销毁。<br>很显然这样会一直持有对 num 的引用，无法进行回收，造成内存占用，所以当不使用时，可以把 f 置为null，来让垃圾回收器进行回收。</p><h3 id="闭包优点和缺点"><a href="#闭包优点和缺点" class="headerlink" title="闭包优点和缺点"></a>闭包优点和缺点</h3><h4 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h4><p><strong>减少全局变量的使用，保证了内部变量的安全，同时外部函数也可以访问内部函数的变量</strong><br><strong>在内存中维持一个变量，也可以用作缓存</strong></p><h4 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h4><p><strong>被引用的内部变量不能被销毁，增大了内存消耗，使用不当易造成内存泄露，解决办法可以在内部变量不使用时，把外部的引用置为 null</strong><br><strong>闭包就是函数间的跨作用域访问，会导致性能损失</strong></p><h3 id="经典面试题"><a href="#经典面试题" class="headerlink" title="经典面试题"></a>经典面试题</h3><hr><h5 id="1-请问一下代码会输出？"><a href="#1-请问一下代码会输出？" class="headerlink" title="1.请问一下代码会输出？"></a>1.请问一下代码会输出？</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">for(var i = 0; i &lt; 5; i++)&#123;</span><br><span class="line">    setTimeout(function () &#123;</span><br><span class="line">               console.log(i);</span><br><span class="line">              &#125;, 1000);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">答：会输出6个5，首先先输出最下边的那个5，因为for完成后 i 的值为5，然后过1秒钟再同时输出5个5，因为for设置了5的定时器，几乎会同时输出</span><br></pre></td></tr></table></figure><h5 id="2-问如果想输出-5-0-1-2-3-4"><a href="#2-问如果想输出-5-0-1-2-3-4" class="headerlink" title="2.问如果想输出 5 0 1 2 3 4"></a>2.<strong>问如果想输出 5 0 1 2 3 4</strong></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">for (var i = 0; i &lt; 5; i++) &#123;</span><br><span class="line">      output(i)</span><br><span class="line"> &#125;</span><br><span class="line"> console.log(i);</span><br><span class="line"></span><br><span class="line"> function output(i) &#123;</span><br><span class="line">      setTimeout(function () &#123;</span><br><span class="line">          console.log(i);</span><br><span class="line">      &#125;, 1000);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">或者使用立即执行函数：</span><br><span class="line"> for (var i = 0; i &lt; 5; i++) &#123;</span><br><span class="line">       (function (i) &#123;</span><br><span class="line">           setTimeout(function () &#123;</span><br><span class="line">               console.log(i);</span><br><span class="line">           &#125;, 1000);</span><br><span class="line">       &#125;)(i);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   console.log(i);</span><br><span class="line">   </span><br><span class="line">   答：第一个5很好输出，因为for循环以后i就会变成5，剩下的我们可以使用立即执行函数来做，首先 JS中调用函数传递参数都是值传递 ，所以当立即执行函数执行时，首先会把参数i的值复制一份，然后再创建函数作用域来执行函数，循环5次就会创建5个作用域，所以1秒后几乎会同时输出0 1 2 3 4</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>apply call bind 区别</title>
      <link href="/2021/03/25/apply-call-bind-%E5%8C%BA%E5%88%AB/"/>
      <url>/2021/03/25/apply-call-bind-%E5%8C%BA%E5%88%AB/</url>
      
        <content type="html"><![CDATA[<h2 id="this-的指向"><a href="#this-的指向" class="headerlink" title="this 的指向"></a>this 的指向</h2><p>在 ES5 中，其实 this 的指向，始终坚持一个原理：<strong>this 永远指向最后调用它的那个对象</strong>，记住这句话，this 你已经了解一半了。</p><p>下面我们来看一个最简单的例子：<br>例 1：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">    var name = &quot;windowsName&quot;;</span><br><span class="line">    function a() &#123;</span><br><span class="line">        var name = &quot;Cherry&quot;;</span><br><span class="line">        console.log(this.name);          // windowsName</span><br><span class="line">        console.log(&quot;inner:&quot; + this);    // inner: Window</span><br><span class="line">    &#125;</span><br><span class="line">    a();</span><br><span class="line">    console.log(&quot;outer:&quot; + this)         // outer: Window</span><br><span class="line">12345678</span><br></pre></td></tr></table></figure><p>这个相信大家都知道为什么 log 的是 windowsName，因为根据刚刚的那句话“<strong>this 永远指向最后调用它的那个对象</strong>”，我们看最后调用 a 的地方 a();，前面没有调用的对象那么就是全局对象 window，这就相当于是 window.a()；注意，这里我们没有使用严格模式，如果使用严格模式的话，全局对象就是 undefined，那么就会报错 Uncaught TypeError: Cannot read property ‘name’ of undefined。</p><p>再看下这个例子：<br>例 2：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var name = &quot;windowsName&quot;;</span><br><span class="line">var a = &#123;</span><br><span class="line">    name: &quot;Cherry&quot;,</span><br><span class="line">    fn : function () &#123;</span><br><span class="line">        console.log(this.name);      // Cherry</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">a.fn();</span><br></pre></td></tr></table></figure><p>在这个例子中，函数 fn 是对象 a 调用的，所以打印的值就是 a 中的 name 的值。是不是有一点清晰了呢~</p><p>我们做一个小小的改动：<br>例 3：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var name = &quot;windowsName&quot;;</span><br><span class="line">    var a = &#123;</span><br><span class="line">        name: &quot;Cherry&quot;,</span><br><span class="line">        fn : function () &#123;</span><br><span class="line">            console.log(this.name);      // Cherry</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    window.a.fn();</span><br></pre></td></tr></table></figure><p>这里打印 Cherry 的原因也是因为刚刚那句话“<strong>this 永远指向最后调用它的那个对象</strong>”，最后调用它的对象仍然是对象 a。</p><p>我们再来看一下这个例子：<br>例 4：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var name = &quot;windowsName&quot;;</span><br><span class="line">var a = &#123;</span><br><span class="line">    // name: &quot;Cherry&quot;,</span><br><span class="line">    fn : function () &#123;</span><br><span class="line">        console.log(this.name);      // undefined</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">window.a.fn();</span><br></pre></td></tr></table></figure><p>这里为什么会打印 undefined 呢？这是因为正如刚刚所描述的那样，调用 fn 的是 a 对象，也就是说 fn 的内部的 this 是对象 a，而对象 a 中并没有对 name 进行定义，所以 log 的 this.name 的值是 undefined。</p><p>这个例子还是说明了：<strong>this 永远指向最后调用它的那个对象</strong>，因为最后调用 fn 的对象是 a，所以就算 a 中没有 name 这个属性，也不会继续向上一个对象寻找 this.name，而是直接输出 undefined。</p><p>再来看一个比较坑的例子：<br>例 5：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">var name = &quot;windowsName&quot;;</span><br><span class="line">var a = &#123;</span><br><span class="line">    name : null,</span><br><span class="line">    // name: &quot;Cherry&quot;,</span><br><span class="line">    fn : function () &#123;</span><br><span class="line">        console.log(this.name);      // windowsName</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var f = a.fn;</span><br><span class="line">f();</span><br></pre></td></tr></table></figure><p>这里你可能会有疑问，为什么不是 Cherry，这是因为虽然将 a 对象的 fn 方法赋值给变量 f 了，但是没有调用，再接着跟我念这一句话：“<strong>this 永远指向最后调用它的那个对象</strong>”，由于刚刚的 f 并没有调用，所以 fn() 最后仍然是被 window 调用的。所以 this 指向的也就是 window。</p><p>由以上五个例子我们可以看出，this 的指向并不是在创建的时候就可以确定的，在 es5 中，永远是<strong>this 永远指向最后调用它的那个对象</strong>。</p><h1 id="怎么改变-this-的指向？"><a href="#怎么改变-this-的指向？" class="headerlink" title="怎么改变 this 的指向？"></a>怎么改变 this 的指向？</h1><p>改变 this 的指向我总结有以下几种方法：</p><ul><li>使用 ES6 的箭头函数</li><li>在函数内部使用 _this &#x3D; this</li><li>使用 apply、call、bind</li></ul><p>例 6：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">var name = &quot;windowsName&quot;;</span><br><span class="line"></span><br><span class="line">var a = &#123;</span><br><span class="line">    name : &quot;Cherry&quot;,</span><br><span class="line"></span><br><span class="line">    func1: function () &#123;</span><br><span class="line">        console.log(this.name)     </span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    func2: function () &#123;</span><br><span class="line">        setTimeout(  function () &#123;</span><br><span class="line">            this.func1()</span><br><span class="line">        &#125;,100);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">a.func2()     // this.func1 is not a function</span><br></pre></td></tr></table></figure><p>在不使用箭头函数的情况下，是会报错的，因为最后调用 setTimeout 的对象是 window，但是在 window 中并没有 func1 函数。</p><h2 id="箭头函数"><a href="#箭头函数" class="headerlink" title="箭头函数"></a>箭头函数</h2><p>众所周知，ES6 的箭头函数是可以避免 ES5 中使用 this 的坑的。<strong>箭头函数的 this 始终指向函数定义时的 this，而非执行时</strong>。，箭头函数需要记着这句话：“箭头函数中没有 this 绑定，必须通过查找作用域链来决定其值，如果箭头函数被非箭头函数包含，则 this 绑定的是最近一层非箭头函数的 this，否则，this 为 undefined”。</p><p>例 8 ：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">var name = &quot;windowsName&quot;;</span><br><span class="line"></span><br><span class="line">var a = &#123;</span><br><span class="line">    name : &quot;Cherry&quot;,</span><br><span class="line">    func1: function () &#123;</span><br><span class="line">        console.log(this.name)     </span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    func2: function () &#123;</span><br><span class="line">        setTimeout( () =&gt; &#123;</span><br><span class="line">            this.func1()</span><br><span class="line">        &#125;,100);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">a.func2()     // Cherry</span><br></pre></td></tr></table></figure><h2 id="在函数内部使用-this-this"><a href="#在函数内部使用-this-this" class="headerlink" title="在函数内部使用 _this &#x3D; this"></a>在函数内部使用 _this &#x3D; this</h2><p>如果不使用 ES6，那么这种方式应该是最简单的不会出错的方式了，我们是先将调用这个函数的对象保存在变量 _this 中，然后在函数中都使用这个 _this，这样 _this 就不会改变了。<br>例 9：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">var name = &quot;windowsName&quot;;</span><br><span class="line"></span><br><span class="line">var a = &#123;</span><br><span class="line"></span><br><span class="line">    name : &quot;Cherry&quot;,</span><br><span class="line"></span><br><span class="line">    func1: function () &#123;</span><br><span class="line">        console.log(this.name)     </span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    func2: function () &#123;</span><br><span class="line">        var _this = this;</span><br><span class="line">        setTimeout( function() &#123;</span><br><span class="line">            _this.func1()</span><br><span class="line">        &#125;,100);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">a.func2()       // Cherry</span><br></pre></td></tr></table></figure><p>这个例子中，在 func2 中，首先设置 var _this &#x3D; this;，这里的 this 是调用 func2 的对象 a，为了防止在 func2 中的 setTimeout 被 window 调用而导致的在 setTimeout 中的 this 为 window。我们将 this(指向变量 a) 赋值给一个变量 _this，这样，在 func2 中我们使用 _this 就是指向对象 a 了。</p><h2 id="使用-apply、call、bind"><a href="#使用-apply、call、bind" class="headerlink" title="使用 apply、call、bind"></a>使用 apply、call、bind</h2><p>使用 apply、call、bind 函数也是可以改变 this 的指向的，原理稍后再讲，我们先来看一下是怎么实现的：</p><p>例 10：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">var a = &#123;</span><br><span class="line">  name: &#x27;小张&#x27;,</span><br><span class="line">  age: 20,</span><br><span class="line">  fn: function (from = &#x27;这里&#x27;, to = &#x27;那里&#x27;) &#123;</span><br><span class="line">    console.log(this.name + &#x27;年龄&#x27; + this.age, &#x27;来自&#x27; + from + &#x27;去往&#x27; + to)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var b = &#123;</span><br><span class="line">  name: &#x27;小明&#x27;,</span><br><span class="line">  age: 10,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">a.fn() //小张年龄20 来自这里去往那里</span><br><span class="line">a.fn.call(b, &#x27;武汉&#x27;, &#x27;上海&#x27;)  // 小明年龄10 来自武汉去往上海</span><br><span class="line">a.fn.apply(b,[&#x27;武汉&#x27;,&#x27;上海&#x27;]) // 小明年龄10 来自武汉去往上海</span><br><span class="line">a.fn.bind(b,&#x27;武汉&#x27;,&#x27;上海&#x27;)()  // 小明年龄10 来自武汉去往上海</span><br></pre></td></tr></table></figure><p>call 、bind 、 apply 这三个函数的第一个参数都是 this 的指向对象，第二个参数差别就来了：</p><p>call 的参数是直接放进去的，第二第三第 n 个参数全都用逗号分隔，直接放到后面 **a.fn.call(b,’武汉’, … ,’string’ )**。</p><p>apply 的所有参数都必须放在一个数组里面传进去 **a.fn.apply(b,[‘武汉’, …, ‘string’ ])**。</p><p>bind 除了返回是函数以外，它 的参数和 call 一样。</p><p>当然，三者的参数不限定是 string 类型，允许是各种类型，包括函数 、 object 等等！</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>防抖与节流</title>
      <link href="/2021/03/24/%E9%98%B2%E6%8A%96%E4%B8%8E%E8%8A%82%E6%B5%81/"/>
      <url>/2021/03/24/%E9%98%B2%E6%8A%96%E4%B8%8E%E8%8A%82%E6%B5%81/</url>
      
        <content type="html"><![CDATA[<h2 id="一、应用场景"><a href="#一、应用场景" class="headerlink" title="一、应用场景"></a>一、应用场景</h2><ul><li>input输入框，用户频繁操作输入框内容匹配关键词或者请求接口。</li><li>窗口<code>resize</code>或者页面<code>scroll</code>滚动调整后需要回调做的事情，例如图片懒加载、页面组件大小变动等。</li><li><code>socket</code>推送数据，例如股票买卖盘口数据，并不是后台推送啥就完全展示啥，适当的漏掉一部分也是合理的。例如100ms内后台推送了几百条数据，实时操作DOM不仅会带来性能上的浪费，造成页面卡顿、假死，而且对用户感官上来说200ms渲染一次跟实时渲染，区别不是很大。</li><li><code>mousedown</code>、<code>mousemove</code>、<code>keyup</code>、<code>keydown</code>等频繁的鼠标操作。</li><li>其他需要限制频率，不需要实时操作的场景。</li></ul><p>防抖与节流的共同特点是用于高频次触发的场景，将<code>高频</code>降为<code>低频</code>达到性能优化的目的。</p><p>防抖:就是指触发事件后在 n 秒内函数只能执行一次，如果在 n 秒内又触发了事件，则会重新计算函数执行时间。</p><p>节流:就是指连续触发事件但是在 n 秒中只执行一次函数。节流会稀释函数的执行频率</p><p>区别是前者用一定手段将<code>最后一次</code>操作落地执行，后者是间隔<code>300ms</code>时间内最多执行一次。</p><h2 id="二、什么是防抖"><a href="#二、什么是防抖" class="headerlink" title="二、什么是防抖"></a>二、什么是防抖</h2><p>以<code>input</code>输入框输入内容并请求http接口为例。用户输入<code>123456789</code>，若不做其他处理，实时监听<code>input</code>输入内容，变动一次就请求一次接口，这个时候会产生9次请求。若同时有10W个用户在线同时操作，对后台同学的压力可想而知，而且有很多请求都是浪费的，同时还有可能产生第一次请求接口返回的数据要晚于第五次请求返回的情况。这个时候就需要做<code>防抖</code>的优化：实时监听输入数据变化，只要有300ms时间没有变化，则请求接口。也就是300ms没变动，则认为用户要搜索的关键词就是当前内容。这个时候你大概就能了解什么是防抖了：在一定时间内，没有再进行频繁操作，目的是尽量确保频繁操作的最后一次才实际执行回调，其他的视为<code>无效</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//一个简单版的防抖</span><br><span class="line">var timer = null;</span><br><span class="line">function debounce()&#123;</span><br><span class="line">  if(timer) clearTimeout(timer);</span><br><span class="line">  timer = setTimeout(function()&#123;</span><br><span class="line">    console.log(&#x27;窗口大小变化啦&#x27;)</span><br><span class="line">  &#125;,300)</span><br><span class="line">&#125;</span><br><span class="line">window.addEventListener(&#x27;resize&#x27;,debounce);</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>以上代码的意思是当你在放大或者缩小浏览器窗口大小的时候，只有停止操作后300ms之后，才会真正的执行相关操作，这样在很大程度上避免不必要的浪费。<br>上面的写法可以很形象的帮助理解<code>防抖</code>，但需要实际封装一下，毕竟这么<code>low</code>的代码体现不出高端的水平，更不适合页面多个地方调用，利用<code>闭包</code>适当封装一下，方便多处地方随意调用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function debounce(fn,delay)&#123;</span><br><span class="line">  var timer = null;</span><br><span class="line">  return function()&#123;</span><br><span class="line">    if(timer) clearTimeout(timer);</span><br><span class="line">    timer = setTimeout(function()&#123;</span><br><span class="line">      fn.apply(this)</span><br><span class="line">    &#125;,delay)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">window.addEventListener(&#x27;resize&#x27;,debounce(function()&#123;</span><br><span class="line">  console.log(&#x27;窗口大小变化啦&#x27;)</span><br><span class="line">&#125;,300));</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>上面例子中，实际<code>this</code>值总是指向<code>window</code>(浏览器端)，若要根据实际场景，并指向执行环境且能够传参的话，再做适当的修改</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function debounce(fn,delay)&#123;</span><br><span class="line">  var timer = null;</span><br><span class="line">  return function()&#123;</span><br><span class="line">    if(timer) clearTimeout(timer);</span><br><span class="line">    var self = this,args = arguments;</span><br><span class="line">    timer = setTimeout(function()&#123;</span><br><span class="line">      fn.apply(self,args)</span><br><span class="line">    &#125;,delay)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">window.addEventListener(&#x27;resize&#x27;,debounce(function(e)&#123;</span><br><span class="line">  console.log(this)</span><br><span class="line">  console.log(e)</span><br><span class="line">&#125;,300));</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>这里有的同学可能会有一个疑问：为何是<code>fn.call(self,args)</code>，而不是直接<code>fn(args)</code>？其实关键在于第一个参数，确保上下文为当前的<code>this</code>。</p><h3 id="思考一：如何控制防抖函数，在一开始的时候也执行一次？"><a href="#思考一：如何控制防抖函数，在一开始的时候也执行一次？" class="headerlink" title="思考一：如何控制防抖函数，在一开始的时候也执行一次？"></a>思考一：如何控制<code>防抖</code>函数，在一开始的时候也执行一次？</h3><p>什么意思呢？就是再增加一个开关，我们知道<code>防抖</code>是执行的频繁操作的最后一次，但是我想频繁操作的第一次和最后一次都执行。这个想法没毛病的，比如频繁操作了5秒才能看到结果，这5秒内等于是空白的，用户也许看到的是一个空白的东西，如果刚开始就执行一次，呈现内容出来，好过一直空白的好。<br>实现思路：增加一个开关，若需要立即执行且开关是允许的时候则立即执行，不再延时，同时立马关闭开关。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">function debounce(fn,delay,immediate)&#123;</span><br><span class="line">  var timer = null;</span><br><span class="line">  var isImmediate = false;</span><br><span class="line">  return function()&#123;</span><br><span class="line">    if(!isImmediate &amp;&amp; immediate)&#123;</span><br><span class="line">      isImmediate = immediate;</span><br><span class="line">      fn.apply(this,arguments)</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">      if(timer) clearTimeout(timer);</span><br><span class="line">      var self = this,args = arguments;</span><br><span class="line">      timer = setTimeout(function()&#123;</span><br><span class="line">        fn.apply(self,args)</span><br><span class="line">      &#125;,delay)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">window.addEventListener(&#x27;resize&#x27;,debounce(function(e)&#123;</span><br><span class="line">  console.log(this)</span><br><span class="line">  console.log(e)</span><br><span class="line">&#125;,300,true));</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h3 id="思考二：如何取消延时执行？"><a href="#思考二：如何取消延时执行？" class="headerlink" title="思考二：如何取消延时执行？"></a>思考二：如何取消延时执行？</h3><p>我们知道<code>防抖</code>是在最后一次事件操作后延迟N秒执行的，假如我们设置的延时时间为5秒，那么频繁操作结束后我们要等待5秒才会执行，因一些特殊情况，比如有另外一个按钮触发一下则取消延时以及后续操作，这个如何实现呢？在上面的基础上我们继续</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">function debounce(fn,delay,immediate)&#123;</span><br><span class="line">  var timer = null;</span><br><span class="line">  var isImmediate = false;</span><br><span class="line">  var de = function()&#123;</span><br><span class="line">    if(!isImmediate &amp;&amp; immediate)&#123;</span><br><span class="line">      isImmediate = immediate;</span><br><span class="line">      fn.apply(this,arguments)</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">      if(timer) clearTimeout(timer);</span><br><span class="line">      var self = this,args = arguments;</span><br><span class="line">      timer = setTimeout(function()&#123;</span><br><span class="line">        fn.apply(self,args)</span><br><span class="line">      &#125;,delay)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  de.cancel = function()&#123;</span><br><span class="line">    clearTimeout(timer);</span><br><span class="line">    timer = null;</span><br><span class="line">    console.log(&#x27;已经取消啦&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">  return de</span><br><span class="line">&#125;</span><br><span class="line">var resizeFn = debounce(function(e)&#123;</span><br><span class="line">  console.log(e)</span><br><span class="line">&#125;,5000,true)</span><br><span class="line">window.addEventListener(&#x27;resize&#x27;,resizeFn);</span><br><span class="line">//取消操作</span><br><span class="line">document.querySelector(&#x27;.calcenButton&#x27;).addEventListener(&#x27;click&#x27;,function()&#123;</span><br><span class="line">  resizeFn.cancel();</span><br><span class="line">&#125;)</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h2 id="三、什么是节流"><a href="#三、什么是节流" class="headerlink" title="三、什么是节流"></a>三、什么是节流</h2><p>以股票中<code>socket</code>推送买卖盘口为例，假设后台1s内推送了1w次数据，我们若把这1w次都渲染到页面，想必页面会假死掉，同时也会大量耗费浏览器性能。若修改为每隔300ms获取一次数据源并渲染到页面，1s内最多也就渲染三次，性能大大降低，这就是<code>节流</code>。用大白话描述就是：事件你尽管执行，我只间隔一段时间执行一次。说到这里，感觉已经可以写出<code>节流</code>函数了：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function throttle(fn,wait)&#123;</span><br><span class="line">  var pre = 0;</span><br><span class="line">  return function()&#123;</span><br><span class="line">    var self = this,args = arguments;</span><br><span class="line">    var now = +new Date();</span><br><span class="line">    if(now - pre &gt; wait)&#123;</span><br><span class="line">      pre = now;</span><br><span class="line">      fn.apply(self,args)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">window.addEventListener(&#x27;resize&#x27;,throttle(function()&#123;</span><br><span class="line">  console.log(&#x27;窗口大小变化啦&#x27;)</span><br><span class="line">&#125;,1000));</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>以上是使用时间戳，配合事件操作驱动的<code>节流</code>，下面我们换一个定时器实现的方式。实现的思路是：设定一个定时器，每次执行的时候若定时器存在则忽略，若不存在则再设置一个定时器，定时器若执行了，则将定时器清空后重新定时。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function throttle(fn,wait)&#123;</span><br><span class="line">  var timer = null;</span><br><span class="line">  return function()&#123;</span><br><span class="line">    var self = this,args = arguments;</span><br><span class="line">    if(!timer)&#123;</span><br><span class="line">      timer = setTimeout(function()&#123;</span><br><span class="line">        timer = null;</span><br><span class="line">        fn.apply(self,args)</span><br><span class="line">      &#125;,wait)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">window.addEventListener(&#x27;resize&#x27;,throttle(function()&#123;</span><br><span class="line">  console.log(&#x27;窗口大小变化啦&#x27;)</span><br><span class="line">&#125;,1000));</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>以上是常见的两种实现<code>节流</code>的方式，区别在于<code>时间戳节流</code>会立即触发执行，后续超过<code>wait</code>倍数部分若停止事件，则会被<code>忽略</code>。而<code>定时器节流</code>总是会延迟<code>wait</code>时间执行，若停止事件操作，则还有可能会延迟一定时间再执行一次。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>js深浅拷贝</title>
      <link href="/2021/03/24/js%E6%B7%B1%E6%B5%85%E6%8B%B7%E8%B4%9D/"/>
      <url>/2021/03/24/js%E6%B7%B1%E6%B5%85%E6%8B%B7%E8%B4%9D/</url>
      
        <content type="html"><![CDATA[<h1 id="js深浅拷贝解析"><a href="#js深浅拷贝解析" class="headerlink" title="js深浅拷贝解析"></a>js深浅拷贝解析</h1><h3 id="一-赋值"><a href="#一-赋值" class="headerlink" title="一. 赋值"></a>一. 赋值</h3><p><strong>原理</strong>: 当原对象&#x2F;数组自身赋值给新对象&#x2F;数组时, 只是将自身在堆内存中引用地址赋值给新对象&#x2F;数组 , 当原对象&#x2F;数组或新对象&#x2F;数组改变自身一级乃至多级属性时,会相互影响并改变对方的属性</p><p>赋值是将某一<strong>数值或对象</strong>赋给某个<strong>变量</strong>的过程，分为：</p><h4 id="1、基本数据类型"><a href="#1、基本数据类型" class="headerlink" title="1、基本数据类型"></a>1、基本数据类型</h4><p>( <strong>Number</strong>数值、<strong>String</strong>字符串、<strong>Boolean</strong>布尔值、<strong>Null</strong>空值、 <strong>Undefined</strong>未定义、<strong>Symbol</strong>（ES6）(原始数据类型,<code>Symbol()</code>函数会返回<strong>symbol</strong>类型的值，该类型具有静态属性和静态方法) ) ：</p><p>赋值，赋值之后两个变量互不影响 , 基本数据类型是指存放在<strong>栈</strong>中的<em>*简单数据段，数据大小确定，内存空间大小可以分配，**它们是直接按值存放的，所以可以直接**按值访问</em>*</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">//对基本类型进行赋值操作，两个变量互不影响。</span><br><span class="line">let a = &quot;saucxs&quot;;</span><br><span class="line">let b = a;</span><br><span class="line">console.log(b);  // saucxs</span><br><span class="line"></span><br><span class="line">//改变a的值,并不会影响b的值</span><br><span class="line">a = &quot;change&quot;;</span><br><span class="line">console.log(a);   // change</span><br><span class="line">console.log(b);    // saucxs</span><br><span class="line"></span><br><span class="line">//改变b的值,并不会影响a的值</span><br><span class="line">b = &quot;kevin&quot;;</span><br><span class="line">console.log(a);   // change</span><br><span class="line">console.log(b);    // kevin</span><br><span class="line">复制代码</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h4 id="2、引用数据类型"><a href="#2、引用数据类型" class="headerlink" title="2、引用数据类型"></a>2、引用数据类型</h4><p>( <strong>Object</strong>对象、<strong>Array</strong>数组、<strong>RegExp</strong>对象(正则表达式)、<strong>Date</strong>时间对象、<strong>Function</strong>函数)：<strong>赋值在堆里的地址</strong>，两个变量具有相同的引用，指针指向同一个对象，相互之间有影响</p><p>引用类型是存放在<strong>堆内存中的对象</strong>，<strong>变量</strong>其实是保存的在栈内存中的一个指针（<strong>保存的是堆内存中的引用地址</strong>），这个指针指向<strong>堆内存</strong>。</p><p>引用类型数据在栈内存中保存的实际上是对象在堆内存中的引用地址。通过这个引用地址可以快速查找到保存中堆内存中的对象</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">//对引用类型进行赋值操作，两个变量指向同一个对象，改变变量 a 之后会影响变量 b，哪怕改变的只是对象 a 中的基本类型数据。</span><br><span class="line">let a = &#123;</span><br><span class="line">    name: &quot;saucxs&quot;,</span><br><span class="line">    book: &#123;</span><br><span class="line">        title: &quot;You Don&#x27;t Know JS&quot;,</span><br><span class="line">        price: &quot;45&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">let b = a;</span><br><span class="line">console.log(b);</span><br><span class="line">// &#123;</span><br><span class="line">//  name: &quot;saucxs&quot;,</span><br><span class="line">//  book: &#123;title: &quot;You Don&#x27;t Know JS&quot;, price: &quot;45&quot;&#125;</span><br><span class="line">// &#125; </span><br><span class="line"></span><br><span class="line">//改变变量 a 之后会影响变量 b</span><br><span class="line">a.name = &quot;change&quot;;</span><br><span class="line">a.book.price = &quot;55&quot;;</span><br><span class="line">console.log(a);</span><br><span class="line">// &#123;</span><br><span class="line">//  name: &quot;change&quot;,</span><br><span class="line">//  book: &#123;title: &quot;You Don&#x27;t Know JS&quot;, price: &quot;55&quot;&#125;</span><br><span class="line">// &#125; </span><br><span class="line">console.log(b);</span><br><span class="line">// &#123;</span><br><span class="line">//  name: &quot;change&quot;,</span><br><span class="line">//  book: &#123;title: &quot;You Don&#x27;t Know JS&quot;, price: &quot;55&quot;&#125;</span><br><span class="line">// &#125;）</span><br><span class="line"></span><br><span class="line">//改变变量 b 之后会影响变量 a</span><br><span class="line">b.name = &quot;kevin&quot;;</span><br><span class="line">b.book.price = &quot;20&quot;;</span><br><span class="line">console.log(a);</span><br><span class="line">// &#123;</span><br><span class="line">//  name: &quot;kevin&quot;,</span><br><span class="line">//  book: &#123;title: &quot;You Don&#x27;t Know JS&quot;, price: &quot;20&quot;&#125;</span><br><span class="line">// &#125; </span><br><span class="line">console.log(b);</span><br><span class="line">// &#123;</span><br><span class="line">//  name: &quot;kevin&quot;,</span><br><span class="line">//  book: &#123;title: &quot;You Don&#x27;t Know JS&quot;, price: &quot;20&quot;&#125;</span><br><span class="line">// &#125;）</span><br><span class="line">复制代码</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h4 id="3-赋值原理图"><a href="#3-赋值原理图" class="headerlink" title="3.赋值原理图"></a>3.赋值原理图</h4><p><strong>原理</strong>: 当原对象&#x2F;数组自身赋值给新对象&#x2F;数组时, 只是将自身在堆内存中引用地址赋值给新对象&#x2F;数组 , 当原对象&#x2F;数组或新对象&#x2F;数组改变自身一级乃至多级属性时,会相互影响并改变对方的属性</p><p><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" alt="img"></p><p><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" alt="img"></p><h3 id="二-浅拷贝"><a href="#二-浅拷贝" class="headerlink" title="二. 浅拷贝"></a>二. 浅拷贝</h3><p><strong>浅拷贝</strong>: 只是拷贝了基本类型的数据，对于引用的类型数据，复制后也是会发生引用，这种拷贝就叫做浅拷贝</p><p>只针对<strong>object</strong>和<strong>Array</strong>这样的复杂的对象 <strong>只拷贝一层</strong>,也就是只拷贝<strong>一级属性</strong>中<strong>基本类型的数据</strong></p><p><strong>原理</strong>: <strong>浅拷贝</strong>会在堆里面重新开辟一个内存中间, 会将<strong>原对象&#x2F;数组</strong>拷贝一份在自己的内存空间中, 只能将<strong>一级属性</strong>拷贝过来,如果<strong>原对象&#x2F;数组</strong>中有<strong>二级属性或者多级属性</strong>(即原对象中含有<strong>对象&#x2F;数组</strong>), 只能拷贝<strong>二级属性及多级属性</strong>在<strong>堆内存中的地址</strong>. <strong>原对象&#x2F;数组</strong>跟<strong>拷贝对象&#x2F;数组</strong>更改<strong>自身一级属性</strong>时,<strong>互不影响对方</strong>. 当<strong>原对象&#x2F;数组</strong>跟<strong>拷贝对象&#x2F;数组</strong>更改<strong>自身二级及多级属性</strong>时,<strong>会相互影响并改变对方的属性</strong></p><h4 id="1-Object-assign-方法"><a href="#1-Object-assign-方法" class="headerlink" title="1. Object.assign() 方法"></a>1. Object.assign() 方法</h4><p>当对象中只有一级属性，没有二级属性的时候，此方法为<strong>深拷贝</strong>，但是对象中有对象的时候，此方法，在二级属性以后就是<strong>浅拷贝</strong>。</p><p><code>Object.assign()</code> 方法用于将所有可枚举属性的值从一个或多个源对象复制到目标对象。它将返回目标对象。是ES6的新函数</p><p><strong>语法</strong>: Object.assign(target, …sources)</p><p><strong>参数</strong> ：target：目标对象。 sources：任意多个源对象。 返回值：目标对象会被返回。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">//下面代码改变对象 a 之后，对象 b 的基本属性保持不变。但是当改变对象 a 中的对象 `book` 时，对象 b 相应的位置也发生了变化。</span><br><span class="line">let a = &#123;</span><br><span class="line">    name: &quot;saucxs&quot;,   //一级属性</span><br><span class="line">    book: &#123;      //二级属性</span><br><span class="line">        title: &quot;You Don&#x27;t Know JS&quot;,</span><br><span class="line">        price: &quot;45&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">let b = Object.assign(&#123;&#125;, a);</span><br><span class="line">console.log(b);</span><br><span class="line">// &#123;</span><br><span class="line">//  name: &quot;saucxs&quot;,</span><br><span class="line">//  book: &#123;title: &quot;You Don&#x27;t Know JS&quot;, price: &quot;45&quot;&#125;</span><br><span class="line">// &#125; </span><br><span class="line"></span><br><span class="line">//改变对象a的的数据,对象 b 的基本属性保持不变。但是当改变对象 a 中的对象 `book` 时，对象 b 相应的book也发生了变化。</span><br><span class="line">a.name = &quot;change&quot;;</span><br><span class="line">a.book.price = &quot;55&quot;;</span><br><span class="line">console.log(a);</span><br><span class="line">// &#123;</span><br><span class="line">//  name: &quot;change&quot;,</span><br><span class="line">//  book: &#123;title: &quot;You Don&#x27;t Know JS&quot;, price: &quot;55&quot;&#125;</span><br><span class="line">// &#125; </span><br><span class="line">console.log(b);</span><br><span class="line">// &#123;</span><br><span class="line">//  name: &quot;saucxs&quot;,</span><br><span class="line">//  book: &#123;title: &quot;You Don&#x27;t Know JS&quot;, price: &quot;55&quot;&#125;</span><br><span class="line">// &#125;</span><br><span class="line"></span><br><span class="line">//同样改变对象b的的数据,对象 a 的基本属性保持不变。但是当改变对象 b 中的对象 `book` 时，对象 a 相应的book也发生了变化。</span><br><span class="line">b.name = &quot;kevin&quot;;</span><br><span class="line">b.book.price = &quot;40&quot;;</span><br><span class="line">console.log(a);</span><br><span class="line">// &#123;</span><br><span class="line">//  name: &quot;change&quot;,</span><br><span class="line">//  book: &#123;title: &quot;You Don&#x27;t Know JS&quot;, price: &quot;40&quot;&#125;</span><br><span class="line">// &#125; </span><br><span class="line">console.log(b);</span><br><span class="line">// &#123;</span><br><span class="line">//  name: &quot;kevin&quot;,</span><br><span class="line">//  book: &#123;title: &quot;You Don&#x27;t Know JS&quot;, price: &quot;40&quot;&#125;</span><br><span class="line">// &#125;）</span><br><span class="line">复制代码</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h4 id="2-展开语法-扩展运算符"><a href="#2-展开语法-扩展运算符" class="headerlink" title="2. 展开语法 (扩展运算符)"></a>2. 展开语法 (扩展运算符)</h4><p><strong>语法</strong>: …对象&#x2F;数组名 es6新语法</p><p><strong>注意</strong>：用扩展运算符对数组或者对象进行拷贝时，<strong>只能扩展和深拷贝第一层的值</strong>，对于第二层极其以后的值，扩展运算符将不能对其进行打散扩展，也不能对其进行深拷贝，即<strong>拷贝后和拷贝前第二层中的对象或者数组仍然引用的是同一个地址</strong>，其中一方改变，另一方也跟着改变。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">let a = &#123;</span><br><span class="line">    name: &quot;saucxs&quot;,   //一级属性</span><br><span class="line">    book: &#123;      //二级属性</span><br><span class="line">        title: &quot;You Don&#x27;t Know JS&quot;,</span><br><span class="line">        price: &quot;45&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">let b = &#123;...a&#125;;    //将a对象的数据展开赋值给b对象</span><br><span class="line">console.log(b);</span><br><span class="line">// &#123;</span><br><span class="line">//  name: &quot;saucxs&quot;,</span><br><span class="line">//  book: &#123;title: &quot;You Don&#x27;t Know JS&quot;, price: &quot;45&quot;&#125;</span><br><span class="line">// &#125; </span><br><span class="line"></span><br><span class="line">//改变对象a的的数据,对象 b 的基本属性保持不变。但是当改变对象 a 中的对象 `book` 时，对象 b 相应的book也发生了变化。</span><br><span class="line">a.name = &quot;change&quot;;</span><br><span class="line">a.book.price = &quot;55&quot;;</span><br><span class="line">console.log(a);</span><br><span class="line">// &#123;</span><br><span class="line">//  name: &quot;change&quot;,</span><br><span class="line">//  book: &#123;title: &quot;You Don&#x27;t Know JS&quot;, price: &quot;55&quot;&#125;</span><br><span class="line">// &#125; </span><br><span class="line">console.log(b);</span><br><span class="line">// &#123;</span><br><span class="line">//  name: &quot;saucxs&quot;,  </span><br><span class="line">//  book: &#123;title: &quot;You Don&#x27;t Know JS&quot;, price: &quot;55&quot;&#125;</span><br><span class="line">// &#125;</span><br><span class="line"></span><br><span class="line">//同样改变对象b的的数据,对象 a 的基本属性保持不变。但是当改变对象 b 中的对象 `book` 时，对象 a 相应的book也发生了变化。</span><br><span class="line">b.name = &quot;kevin&quot;;</span><br><span class="line">b.book.price = &quot;40&quot;;</span><br><span class="line">console.log(a);</span><br><span class="line">// &#123;</span><br><span class="line">//  name: &quot;change&quot;,</span><br><span class="line">//  book: &#123;title: &quot;You Don&#x27;t Know JS&quot;, price: &quot;40&quot;&#125;</span><br><span class="line">// &#125; </span><br><span class="line">console.log(b);</span><br><span class="line">// &#123;</span><br><span class="line">//  name: &quot;kevin&quot;,</span><br><span class="line">//  book: &#123;title: &quot;You Don&#x27;t Know JS&quot;, price: &quot;40&quot;&#125;</span><br><span class="line">// &#125;）</span><br><span class="line">复制代码</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h4 id="3-Array-prototype-slice方法"><a href="#3-Array-prototype-slice方法" class="headerlink" title="3. Array.prototype.slice方法"></a>3. Array.prototype.slice方法</h4><p>slice不会改变原数组，<code>slice()</code> 方法返回一个新的数组对象</p><p><strong>slice</strong>: 截取数组指定元素 slice (&#x2F;slaɪs&#x2F;)<br>​ arr.slice(start,end) 返回数组 范围 start &lt;&#x3D; 范围 &lt; end​ 将 数组中 start 下标 (索引)的元素 一直查询到 end 下标(索引)的元素，并返回 截取的新数组</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">let a = [0, &quot;1&quot;, [2, 3]];    //0 , &quot;1&quot;   是一级属性    [2,3] 是二级属性</span><br><span class="line">let b = a.slice(1); //截取旧数组从下标1开始到最后</span><br><span class="line">console.log(b); // [&quot;1&quot;, [2, 3]]</span><br><span class="line"></span><br><span class="line">//改变 a[1] 之后 b[0] 的值并没有发生变化，但改变 a[2][0] 之后，相应的 b[1][0] 的值也发生变化。</span><br><span class="line">a[1] = &quot;99&quot;;  </span><br><span class="line">a[2][0] = 4;</span><br><span class="line">console.log(a);  // [0, &quot;99&quot;, [4, 3]]</span><br><span class="line">console.log(b);  //  [&quot;1&quot;, [4, 3]]</span><br><span class="line"></span><br><span class="line">//改变 b[0] 之后 a[1] 的值并没有发生变化，但改变 b[1][1] 之后，相应的 a[2][1] 的值也发生变化。</span><br><span class="line">b[0] = &quot;3&quot;;</span><br><span class="line">b[1][1] = 6;</span><br><span class="line">console.log(a);  // [0, &quot;99&quot;, [4, 6]]</span><br><span class="line">console.log(b);  //  [&quot;3&quot;, [4, 6]]</span><br><span class="line">复制代码</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h4 id="4-Array-prototype-concat-方法"><a href="#4-Array-prototype-concat-方法" class="headerlink" title="4.Array.prototype.concat()方法"></a>4.Array.prototype.concat()方法</h4><p><strong>concat()</strong>: 用于连接整个数组，将连接后的数组返回，不会影响当前数组并且可以连接字符串 concat([kɑːnkæt])</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">let b=[]</span><br><span class="line">let a = [0, &quot;1&quot;, [2, 3]];  //0 , &quot;1&quot;   是一级属性    [2,3] 是二级属性</span><br><span class="line"> b = b.concat(a);   //将两个数组拼接返回新的数组,将新数组赋值给b</span><br><span class="line">console.log(b);   // [0, &quot;1&quot;, [2, 3]]</span><br><span class="line"></span><br><span class="line">//改变 a[1] 之后 b[1] 的值并没有发生变化，但改变 a[2][0] 之后，相应的 b[2][0] 的值也发生变化。</span><br><span class="line">a[1] = &quot;99&quot;;  </span><br><span class="line">a[2][0] = 4;</span><br><span class="line">console.log(a);  // [0, &quot;99&quot;, [4, 3]]</span><br><span class="line">console.log(b);  //  [0, &quot;1&quot;, [4, 3]]</span><br><span class="line"></span><br><span class="line">//改变 b[0] 之后 a[0] 的值并没有发生变化，但改变 b[2][1] 之后，相应的 a[2][1] 的值也发生变化。</span><br><span class="line">b[0] = &quot;3&quot;;</span><br><span class="line">b[2][1] = 6;</span><br><span class="line">console.log(a); // [0, &quot;1&quot;, [4, 6]]</span><br><span class="line">console.log(b); //  [&quot;3&quot;, &quot;1&quot;, [4, 6]]</span><br><span class="line">复制代码</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h4 id="5-各种for循环…以及更多"><a href="#5-各种for循环…以及更多" class="headerlink" title="5.各种for循环…以及更多"></a>5.各种for循环…以及更多</h4><p><strong>代表</strong> : forEach() ES6方法</p><p><strong>语法</strong>: 数组名.forEach((item,index) &#x3D;&gt; { return item });</p><p><strong>参数</strong> : item:数组的每一个元素 index:数组的每个元素下标</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">let b=[]</span><br><span class="line">let a = [0, &quot;1&quot;, [2, 3]];   //0 , &quot;1&quot;   是一级属性    [2,3] 是二级属性</span><br><span class="line">a.forEach((item,index) =&gt; &#123;      //forEcah语法遍历a数组,将每个元素复制一份给b数组</span><br><span class="line">    return  b[index]=item</span><br><span class="line">&#125;);</span><br><span class="line">console.log(b);   // [0, &quot;1&quot;, [2, 3]]</span><br><span class="line"></span><br><span class="line">//改变 a[1] 之后 b[1] 的值并没有发生变化，但改变 a[2][0] 之后，相应的 b[2][0] 的值也发生变化。</span><br><span class="line">a[1] = &quot;99&quot;;  </span><br><span class="line">a[2][0] = 4;</span><br><span class="line">console.log(a);  // [0, &quot;99&quot;, [4, 3]]</span><br><span class="line">console.log(b);  //  [0, &quot;1&quot;, [4, 3]]</span><br><span class="line"></span><br><span class="line">//改变 b[0] 之后 a[0] 的值并没有发生变化，但改变 b[2][1] 之后，相应的 a[2][1] 的值也发生变化。</span><br><span class="line">b[0] = &quot;3&quot;;</span><br><span class="line">b[2][1] = 6;</span><br><span class="line">console.log(a); // [0, &quot;99&quot;, [4, 6]]</span><br><span class="line">console.log(b); //  [&quot;3&quot;, &quot;1&quot;, [4, 6]]</span><br><span class="line">复制代码</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h4 id="6-浅拷贝原理图"><a href="#6-浅拷贝原理图" class="headerlink" title="6.浅拷贝原理图"></a>6.浅拷贝原理图</h4><p><strong>原理</strong>: <strong>浅拷贝</strong>会在堆里面重新开辟一个内存中间, 会将<strong>原对象&#x2F;数组</strong>拷贝一份在自己的内存空间中, 只能将<strong>一级属性</strong>拷贝过来,如果<strong>原对象&#x2F;数组</strong>中有<strong>二级属性或者多级属性</strong>(即原对象中含有<strong>对象&#x2F;数组</strong>), 只能拷贝<strong>二级属性及多级属性</strong>在<strong>堆内存中的地址</strong>. <strong>原对象&#x2F;数组</strong>跟<strong>拷贝对象&#x2F;数组</strong>更改<strong>自身一级属性</strong>时,<strong>互不影响对方</strong>. 当<strong>原对象&#x2F;数组</strong>跟<strong>拷贝对象&#x2F;数组</strong>更改<strong>自身二级及多级属性</strong>时,<strong>会相互影响并改变对方的属性</strong></p><p><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" alt="img"></p><h3 id="三-深拷贝"><a href="#三-深拷贝" class="headerlink" title="三.深拷贝"></a>三.深拷贝</h3><p><strong>深拷贝</strong>: 要求要复制一个复杂的对象，将原对象的各个属性逐个复制出去，而且将原对象各个属性所包含的对象也依次采用深复制的方法递归复制到新对象上</p><p>只针对<strong>object</strong>和<strong>Array</strong>这样的复杂的对象 <strong>拷贝多层</strong>,也就是能将<strong>二级及多级属性</strong>中<strong>所有数据</strong>拷贝 ,</p><p><strong>原理</strong>: <strong>深拷贝</strong>会在堆里面重新开辟一个内存中间,会将<strong>原对象&#x2F;数组</strong>中<em>*所有的属性(一级乃至多级属性)**完整的拷贝一份在自己的内存空间中,<strong>原对象&#x2F;数组</strong>跟**拷贝对象&#x2F;数组</em>*更改自身属性时,<strong>互不影响也不会改变对方的属性</strong></p><h4 id="1-JSON-parse-JSON-stringify-object-方法"><a href="#1-JSON-parse-JSON-stringify-object-方法" class="headerlink" title="1. JSON.parse(JSON.stringify(object)) 方法"></a>1. JSON.parse(JSON.stringify(object)) 方法</h4><p><strong>JSON.stringify ( )</strong> : 将对象,数组等所有数据转化为字符串</p><p><strong>JSON.parse ( )</strong> : 将对象,数组等所有数据从字符串转化为对象,数组等原来的数据类型</p><p><strong>注意</strong> : 拷贝的数据里面不能有函数，因为JSON.stringify()，JSON.parse()处理不了函数。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">let a = &#123;</span><br><span class="line">    name: &quot;saucxs&quot;,    //一级属性</span><br><span class="line">    book: &#123;             //二级属性</span><br><span class="line">        title: &quot;You Don&#x27;t Know JS&quot;,</span><br><span class="line">        price: &quot;45&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">let b = JSON.parse(JSON.stringify(a));  </span><br><span class="line">console.log(b);</span><br><span class="line">// &#123;</span><br><span class="line">//  name: &quot;saucxs&quot;,</span><br><span class="line">//  book: &#123;title: &quot;You Don&#x27;t Know JS&quot;, price: &quot;45&quot;&#125;</span><br><span class="line">// &#125; </span><br><span class="line"></span><br><span class="line">//改变对象a的的数据,对象 b 的所有数据保持不变。</span><br><span class="line">a.name = &quot;change&quot;;</span><br><span class="line">a.book.price = &quot;55&quot;;</span><br><span class="line">console.log(a);</span><br><span class="line">// &#123;</span><br><span class="line">//  name: &quot;change&quot;,</span><br><span class="line">//  book: &#123;title: &quot;You Don&#x27;t Know JS&quot;, price: &quot;55&quot;&#125;</span><br><span class="line">// &#125; </span><br><span class="line">console.log(b);</span><br><span class="line">// &#123;</span><br><span class="line">//  name: &quot;saucxs&quot;,</span><br><span class="line">//  book: &#123;title: &quot;You Don&#x27;t Know JS&quot;, price: &quot;45&quot;&#125;</span><br><span class="line">// &#125;</span><br><span class="line"></span><br><span class="line">//同样改变对象b的的数据,对象 a 的所有保持不变</span><br><span class="line">b.name = &quot;kevin&quot;;</span><br><span class="line">b.book.price = &quot;40&quot;;</span><br><span class="line">console.log(a);</span><br><span class="line">// &#123;</span><br><span class="line">//  name: &quot;change&quot;,</span><br><span class="line">//  book: &#123;title: &quot;You Don&#x27;t Know JS&quot;, price: &quot;55&quot;&#125;</span><br><span class="line">// &#125; </span><br><span class="line">console.log(b);</span><br><span class="line">// &#123;</span><br><span class="line">//  name: &quot;kevin&quot;,</span><br><span class="line">//  book: &#123;title: &quot;You Don&#x27;t Know JS&quot;, price: &quot;40&quot;&#125;</span><br><span class="line">// &#125;）</span><br><span class="line">复制代码</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h5 id="1-对数组深拷贝。"><a href="#1-对数组深拷贝。" class="headerlink" title="(1). 对数组深拷贝。"></a>(1). 对数组深拷贝。</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">let a = [0, &quot;1&quot;, [2, 3]];</span><br><span class="line">let b = JSON.parse(JSON.stringify( a.slice(1) ));</span><br><span class="line">console.log(b);// [&quot;1&quot;, [2, 3]]</span><br><span class="line"></span><br><span class="line">//改变数组a的的数据,数组 b 的所有数据保持不变。</span><br><span class="line">a[1] = &quot;99&quot;;</span><br><span class="line">a[2][0] = 4;</span><br><span class="line">console.log(a);// [0, &quot;99&quot;, [4, 3]]</span><br><span class="line">console.log(b);//  [&quot;1&quot;, [2, 3]]</span><br><span class="line"></span><br><span class="line">//改变数组b的的数据,数组 a 的所有数据保持不变。</span><br><span class="line">b[0] = &quot;3&quot;;</span><br><span class="line">b[1][1] = 6;</span><br><span class="line">console.log(a); // [0, &quot;99&quot;, [4, 3]]</span><br><span class="line">console.log(b); //  [&quot;3&quot;, [2, 6]]</span><br><span class="line">复制代码</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h5 id="2-该方法有以下几个问题"><a href="#2-该方法有以下几个问题" class="headerlink" title="(2). 该方法有以下几个问题"></a>(2). 该方法有以下几个问题</h5><p><strong>A . 会忽略 <code>undefined</code> 会忽略 <code>symbol</code> 不能序列化函数 (对象&#x2F;数组中不能有函数)</strong></p><p><strong>遇到 <code>undefined</code>、<code>symbol</code> 和函数这三种情况，会直接忽略。</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">let obj = &#123;</span><br><span class="line">    name: &#x27;saucxs&#x27;,</span><br><span class="line">    a: undefined,</span><br><span class="line">    b: Symbol(&#x27;saucxs&#x27;),</span><br><span class="line">    c: function() &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">console.log(obj);</span><br><span class="line">// &#123;</span><br><span class="line">//  name: &quot;saucxs&quot;, </span><br><span class="line">//  a: undefined, </span><br><span class="line">//  b: Symbol(saucxs), </span><br><span class="line">//  c: ƒ ()</span><br><span class="line">// &#125;</span><br><span class="line">let b = JSON.parse(JSON.stringify(obj));</span><br><span class="line">console.log(b);  // &#123;name: &quot;saucxs&quot;&#125;    只能打印出name</span><br><span class="line">复制代码</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p><strong>B. 不能解决循环引用的对象</strong></p><p><strong>循环引用会报错</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">let obj = &#123;</span><br><span class="line">    a: 1,</span><br><span class="line">    b: &#123;</span><br><span class="line">        c: 2,</span><br><span class="line">        d: 3</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">obj.a = obj.b;</span><br><span class="line">obj.b.c = obj.a;</span><br><span class="line"></span><br><span class="line">let b = JSON.parse(JSON.stringify(obj));// Uncaught TypeError: Converting circular structure to JSON</span><br><span class="line">复制代码</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p><strong>C . 不能正确处理<code>new Date()</code></strong></p><p><strong><code>new Date</code> 情况下，转换结果不正确</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//new Date 情况下，转换结果不正确</span><br><span class="line">new Date(); // Mon Dec 24 2018 10:59:14 GMT+0800 (China Standard Time)</span><br><span class="line">JSON.stringify(new Date());  // &quot;&quot;2018-12-24T02:59:25.776Z&quot;&quot;</span><br><span class="line">JSON.parse(JSON.stringify(new Date()));// &quot;2018-12-24T02:59:41.523Z&quot;</span><br><span class="line"></span><br><span class="line">//解决方法转成字符串或者时间戳就好了。</span><br><span class="line">let date = (new Date()).valueOf();// 1545620645915</span><br><span class="line">JSON.stringify(date);// &quot;1545620673267&quot;</span><br><span class="line">JSON.parse(JSON.stringify(date));// 1545620658688</span><br><span class="line">复制代码</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p><strong>D. 不能处理正则</strong></p><p><strong>正则情况下只会拷贝一个空对象</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">let obj = &#123;</span><br><span class="line">    name: &quot;saucxs&quot;,</span><br><span class="line">    a: /&#x27;123&#x27;/</span><br><span class="line">&#125;</span><br><span class="line">console.log(obj);// &#123;name: &quot;saucxs&quot;, a: /&#x27;123&#x27;/&#125;</span><br><span class="line">let b = JSON.parse(JSON.stringify(obj));</span><br><span class="line">console.log(b);  // &#123;name: &quot;saucxs&quot;, a: &#123;&#125;&#125;   // 属性a中的正则无法拷贝,会拷贝出空对象</span><br><span class="line">复制代码</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h4 id="2-使用递归的方式实现深拷贝"><a href="#2-使用递归的方式实现深拷贝" class="headerlink" title="2.使用递归的方式实现深拷贝"></a>2.使用递归的方式实现深拷贝</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">//使用递归的方式实现数组、对象的深拷贝function deepClone(obj)&#123;</span><br><span class="line">function deepClone(obj)&#123;</span><br><span class="line">    //判断拷贝的要进行深拷贝的是数组还是对象，是数组的话进行数组拷贝，对象的话进行对象拷贝</span><br><span class="line">    let objClone = Array.isArray(obj)?[]:&#123;&#125;;</span><br><span class="line">    //进行深拷贝的不能为空，并且是对象或者是</span><br><span class="line">    if(obj &amp;&amp; typeof obj===&quot;object&quot;)&#123;</span><br><span class="line">        for(key in obj)&#123;</span><br><span class="line">            if(obj.hasOwnProperty(key))&#123;</span><br><span class="line">                //判断ojb子元素是否为对象，如果是，递归复制</span><br><span class="line">                if(obj[key]&amp;&amp;typeof obj[key] ===&quot;object&quot;)&#123;</span><br><span class="line">                    objClone[key] = deepClone(obj[key]);</span><br><span class="line">                &#125;else&#123;</span><br><span class="line">                    //如果不是，简单复制</span><br><span class="line">                    objClone[key] = obj[key];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return objClone;</span><br><span class="line">&#125;    </span><br><span class="line">let a=[1,2,3,4],</span><br><span class="line">    b=deepClone(a); //调用deepClone方法并传入实参,并将返回值赋值给b</span><br><span class="line">console.log(b); //[1,2,3,4]</span><br><span class="line"></span><br><span class="line">//改变a数组下标为0的属性值,b数组下标为0的属性值并不会改变</span><br><span class="line">a[0]=2;   </span><br><span class="line">console.log(a);  //[2,2,3,4]</span><br><span class="line">console.log(b); //[1,2,3,4]</span><br><span class="line">复制代码</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h4 id="3、jQuery的extend方法"><a href="#3、jQuery的extend方法" class="headerlink" title="3、jQuery的extend方法"></a>3、jQuery的extend方法</h4><p><strong>语法</strong> : $.extend( [deep ], target, object1 [, objectN ] )</p><p><strong>参数</strong>: <strong>deep</strong> : 表示是否深拷贝，为true为深拷贝，为false，则为浅拷贝</p><p><strong>target</strong> : 类型 目标对象，其他对象的成员属性将被附加到该对象上。</p><p><strong>object1 , objectN</strong>可选。 Object类型 第一个以及第N个被合并的对象。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">let a=[0,1,[2,3],4],</span><br><span class="line">    b=$.extend(true,[],a);</span><br><span class="line">console.log(b); //[0,1,[2,3],4]</span><br><span class="line"></span><br><span class="line">//更改a数组中的一级属性和二级属性,b数组的属性并没有发生任何改变</span><br><span class="line">a[0]=1;</span><br><span class="line">a[2][0]=1;</span><br><span class="line">console.log(a);   //[1,1,[1,3],4]</span><br><span class="line">console.log(b); // [0,1,[2,3],4]</span><br><span class="line">复制代码</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h4 id="4、lodash函数库"><a href="#4、lodash函数库" class="headerlink" title="4、lodash函数库"></a>4、lodash函数库</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lodash很热门的函数库，提供了 lodash.cloneDeep()实现深拷贝</span><br><span class="line">复制代码</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h4 id="5-深拷贝原理图"><a href="#5-深拷贝原理图" class="headerlink" title="5.深拷贝原理图"></a>5.深拷贝原理图</h4><p><strong>原理</strong>: <strong>深拷贝</strong>会在堆里面重新开辟一个内存中间,会将<strong>原对象&#x2F;数组</strong>中<em>*所有的属性(一级乃至多级属性)**完整的拷贝一份在自己的内存空间中,<strong>原对象&#x2F;数组</strong>跟**拷贝对象&#x2F;数组</em>*更改自身属性时,<strong>互不影响也不会改变对方的属性</strong></p><p><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" alt="img"></p><h3 id="总结表格"><a href="#总结表格" class="headerlink" title="总结表格"></a>总结表格</h3><table><thead><tr><th></th><th>和原数据是否指向同一对象</th><th>第一层数据为基本数据类型</th><th>原数据中包含子对象</th></tr></thead><tbody><tr><td>赋值</td><td>是</td><td>改变会使原数据一起改变</td><td>改变会使原数据一起改变</td></tr><tr><td>浅拷贝</td><td>否</td><td>改变不会使原数据一起改变</td><td>改变会使原数据一起改变</td></tr><tr><td>深拷贝</td><td>否</td><td>改变不会使原数据一起改变</td><td>改变不会使原数据一起改变</td></tr></tbody></table><h3 id="重点"><a href="#重点" class="headerlink" title="重点"></a>重点</h3><p>通常在开发中并不希望改变变量 a 之后会影响到变量 b，这时就需要用到浅拷贝和深拷贝。</p><p>当对象中只有一级属性，没有二级属性的时候，此方法为<strong>深拷贝</strong>，但是对象中有对象的时候，此方法，在二级属性以后就是<strong>浅拷贝</strong>。</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ES6 知识点汇总</title>
      <link href="/2020/11/30/ES6-%E7%9F%A5%E8%AF%86%E7%82%B9%E6%B1%87%E6%80%BB/"/>
      <url>/2020/11/30/ES6-%E7%9F%A5%E8%AF%86%E7%82%B9%E6%B1%87%E6%80%BB/</url>
      
        <content type="html"><![CDATA[<h2 id="ES6-知识点汇总"><a href="#ES6-知识点汇总" class="headerlink" title="ES6 知识点汇总"></a>ES6 知识点汇总</h2><h4 id="1-let"><a href="#1-let" class="headerlink" title="1.let"></a>1.let</h4><p>代码块内有效<br>不能重复声明<br>不存在变量提升</p><h4 id="2-const"><a href="#2-const" class="headerlink" title="2.const"></a>2.const</h4><p>声明一个只读变量，声明之后不允许改变</p><h4 id="3-解构赋值"><a href="#3-解构赋值" class="headerlink" title="3.解构赋值"></a>3.解构赋值</h4><p>a. 数组模型解构<br>i. 基本<br>\1) let [ a , b , c ] &#x3D; [ 1 , 2 , 3 ]<br>ii. 可嵌套<br>\1) let [ a , [ [ b ] , c ] ] &#x3D; [ 1 , [ [ 2 ] , 3 ] ]<br>iii. 可忽略<br>\1) let [ a , , c ] &#x3D; [ 1 , 2 , 3 ]<br>iv. 不完全解构<br>\1) let [ a &#x3D; 1 , b ] &#x3D; [ ] &#x2F;&#x2F; a &#x3D; 1 , b &#x3D; undefiend<br>v. 剩余运算符<br>\1) let [ a , b , c , d , e ] &#x3D; ‘hello’ &#x2F;&#x2F; a &#x3D; ‘h’ , b &#x3D; ‘e’ 等等<br>vi. 解构默认值<br>\1) let [ a &#x3D; 2 ] &#x3D; [ undefiend ] &#x2F;&#x2F; a &#x3D; 2<br>b. 对象模型解构<br>i. 基本<br>\1) let { foo , bar } &#x3D; { foo : ‘aaa’ , bar : ‘bbb’ }<br>\2) let { baz : foo } &#x3D; { baz : ‘ddd’ }<br>ii. 可嵌套可忽略<br>\1) let obj &#x3D; { p : [ ‘hello’ , { y : ‘world } ] } let { p : [ x , { y } ] } &#x3D; obj<br>\2) let obj &#x3D; { p : [ ‘hello’ , { y : ‘world } ] } let { p : [ x , { } ] } &#x3D; obj<br>iii. 不完全解构<br>\1) let obj &#x3D; { p : [ { y : ‘world’ } ] } let { p : [ { y } , x ] } &#x3D; obj<br>iv. 剩余运算符<br>\1) let { a , b , … rest } &#x3D; { a : 10 , b : 20 , c : 30 , d : 40 }<br>v. 解构默认值<br>\1) let { a &#x3D; 10 , b &#x3D; 5 } &#x3D; { a : 3}<br>\2) let { a : aa &#x3D; 10 , b : bb &#x3D; 5 } &#x3D; { a : 3</p><h4 id="4-symbol（表示独一无二的值，最大用法是用来定义对象的唯一属性名）"><a href="#4-symbol（表示独一无二的值，最大用法是用来定义对象的唯一属性名）" class="headerlink" title="4.symbol（表示独一无二的值，最大用法是用来定义对象的唯一属性名）"></a>4.symbol（表示独一无二的值，最大用法是用来定义对象的唯一属性名）</h4><p>a.基本用法</p><p>let sy &#x3D; Symbol (‘kk’)<br>console.log ( sy ) &#x2F;&#x2F;Symbol ( kk )<br>type of ( sy ) &#x2F;&#x2F; ‘ symbol ‘<br>&#x2F;&#x2F;相同参数Symbol()返回的值不相等<br>let sy1 &#x3D; Symbol (‘kk’)<br>sy &#x3D;&#x3D;&#x3D; sy1 &#x2F;&#x2F;false</p><p>b. 作为属性名（Symbol 作为对象的属性名，可以保证属性不重名）</p><p>let sy &#x3D; Symbol(‘key1’)</p><p>&#x2F;&#x2F;写法一<br>let syObject &#x3D; {}<br>syObiect<a href="%E2%80%99kk%E2%80%99">sy</a> &#x3D; ‘kk’<br>console.log(syObject) &#x2F;&#x2F; {Symbol(key1):’kk’}</p><p>&#x2F;&#x2F;写法二<br>let syObject &#x3D; {</p><p>}</p><p>&#x2F;&#x2F;写法三<br>let syObject &#x3D; {}<br>Object.defineProperty(syObject,sy,{vaule:’kk’})</p><p>&#x2F;&#x2F;注意<br>Symbol作为对象属性名时，不能用 . 运算符。要使用[]<br>let syObject &#x3D; {}<br>syObject<a href="%E2%80%99kk%E2%80%99">sy</a> &#x3D; ‘kk’<br>syObject<a href="%E2%80%99kk%E2%80%99">sy</a> &#x2F;&#x2F;‘kk’<br>syObject.sy &#x2F;&#x2F;undefined</p><h4 id="5-Map-和-Set"><a href="#5-Map-和-Set" class="headerlink" title="5.Map 和 Set"></a>5.Map 和 Set</h4><p>a. key是字符串<br>var myMap &#x3D; new Map()<br>var keyString &#x3D; ‘a string’<br>myMap.set(keyString,”和键’a string’ 关联的值”)<br>myMap.get(keyString) &#x2F;&#x2F;和键’a string’ 关联的值<br>myMap.get(‘a,string’) &#x2F;&#x2F;和键’a string’ 关联的值</p><p>b. key是对象<br>var myMap &#x3D; new Map()<br>var keyString &#x3D; ‘a string’<br>myMap.set(keyString,”和键’a string’ 关联的值”)<br>myMap.get(keyString) &#x2F;&#x2F;和键’a string’ 关联的值<br>myMap.get({}) &#x2F;&#x2F;undefiend</p><p>c.key是函数<br>var myMap &#x3D; new Map()<br>var keyFun &#x3D; function(){}<br>myMap.set(keyFun,’和键keyFun关联的值’)<br>myMap.get(keyFun) &#x2F;&#x2F;和键keyFun关联的值<br>myMap.get(function(){}) &#x2F;&#x2F;undefiend</p><p>d. key是NaN<br>var myMap &#x3D; new Map()<br>myMap.set(NaN,’not a number’)<br>myMap.get(NaN) &#x2F;&#x2F;not a number<br>var otherNaN &#x3D; Number(‘foo’)<br>myMap.get(otherNaN) &#x2F;&#x2F;not a number</p><h5 id="Map迭代"><a href="#Map迭代" class="headerlink" title="Map迭代"></a>Map迭代</h5><p>a. for…of<br>var myMap &#x3D; new Map()<br>myMap.set(0,’zero’)<br>myMap.set(1,’one’)</p><p>for(var [key,vaule] of myMap){<br>console.log(key + “&#x3D;” + vaule)<br>&#x2F;&#x2F; 0 &#x3D; zero; 1 &#x3D; one<br>}<br>for (var [key,vaule] of myMap.entries()){<br>console.log(key + “&#x3D;” + vaule)<br>&#x2F;&#x2F; 0 &#x3D; zero; 1 &#x3D; one<br>}</p><p>&#x2F;&#x2F;entries方法返回一个新的Iterator 对象，它按插入顺序包含了Map对象中每个元素的[key,vaule]数组</p><p>b. forEach()<br>var myMap &#x3D; new Map()<br>myMap.set(0,’zero’)<br>myMap.set(1,’one’)<br>myMap.forEach(function(vaule,key){<br>console.log(key+”&#x3D;”+vaule)<br>&#x2F;&#x2F; 0 &#x3D; zero; 1 &#x3D; one<br>})</p><h5 id="Map对象的操作"><a href="#Map对象的操作" class="headerlink" title="Map对象的操作"></a>Map对象的操作</h5><p>a. Map 与 Array 的转换<br>var kvArry &#x3D; [[‘key1’,’vaule1’],[‘key2’,’vaule2’]]<br>&#x2F;&#x2F;将一个 二维 键值对数组转换成一个 Map 对象<br>var myMap &#x3D; new Map(kvArry)<br>&#x2F;&#x2F;将一个 Map 对象转换成一个二维键值对数组<br>var outArry &#x3D; Array.from(myMap)</p><p>b. Map的克隆<br>var myMap1 &#x3D; new Map([[‘key1’,’vaule1’],[‘key2’,’vaule2’]])<br>var myMap2 &#x3D; new Map(myMap1)</p><p>c. Map的合并<br>var first &#x3D; new Map([[1,’one’],[2,’two’],[3,’three’],])<br>var second &#x3D; new Map([[1.’uno’],[2,’dos’])<br>&#x2F;&#x2F;uno，dos， three<br>var merged &#x3D; new Map([…first,…second])</p><h5 id="set对象（set对象允许你储存任何类型的唯一值，无论是原始值还是对象引用）"><a href="#set对象（set对象允许你储存任何类型的唯一值，无论是原始值还是对象引用）" class="headerlink" title="set对象（set对象允许你储存任何类型的唯一值，无论是原始值还是对象引用）"></a>set对象（set对象允许你储存任何类型的唯一值，无论是原始值还是对象引用）</h5><p>set中的特殊值(set对象储存的值总是唯一的，所以需要判断两个值是否恒等。有几个特殊值需要特殊对待)</p><ol><li>+0与-0在储存判断唯一值性的时候是恒等的，所以不重复</li><li>undefined和undefined是恒等的，所以不重复</li><li>NaN与NaN是不恒等的，但是在set中只能存一个，不重复</li></ol><p>let mySet &#x3D; new Set()<br>mySet.add(1); &#x2F;&#x2F; Set(1) {1}<br>mySet.add(5); &#x2F;&#x2F; Set(2) {1, 5}<br>mySet.add(5); &#x2F;&#x2F; Set(2) {1, 5} 这里体现了值的唯一性<br>mySet.add(“some text”);<br>&#x2F;&#x2F; Set(3) {1, 5, “some text”} 这里体现了类型的多样性<br>var o &#x3D; {a: 1, b: 2};<br>mySet.add(o);<br>mySet.add({a: 1, b: 2});<br>&#x2F;&#x2F; Set(5) {1, 5, “some text”, {…}, {…}}<br>&#x2F;&#x2F; 这里体现了对象之间引用不同不恒等，即使值相同，Set 也能存储</p><h5 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h5><p>&#x2F;&#x2F;Array转Set<br>var mySet &#x3D; new Set([‘vaule1’,’vaule2’,’vuale3’])<br>var myArray &#x3D; […mySet]</p><p>&#x2F;&#x2F;String转Set<br>var mySet &#x3D; new Set(‘hello’)<br>&#x2F;&#x2F; 注：Set 中 toString 方法是不能将 Set 转换成 String</p><h5 id="Set-对象作用"><a href="#Set-对象作用" class="headerlink" title="Set 对象作用"></a>Set 对象作用</h5><p>a. 数组去重<br>var mySet &#x3D; new Set([1,2,3,4,4])<br>[…mySet]<br>b. 并集<br>var a &#x3D; new Set([1,2,3])<br>var b &#x3D; new Set([4,3,2])<br>var union &#x3D; new Set([]…a,…b) &#x2F;&#x2F;{1,2,3,4}<br>c. 交集<br>var a &#x3D; new Set([1,2,3])<br>var b &#x3D; new Set([4,3,2])<br>var intersect &#x3D; new Set([…a].filter(x &#x3D;&gt; b.has(x))) &#x2F;&#x2F;{2,3}<br>d. 差集<br>var a &#x3D; new Set([1, 2, 3]);<br>var b &#x3D; new Set([4, 3, 2]);<br>var difference &#x3D; new Set([…a].filter(x &#x3D;&gt; !b.has(x))); &#x2F;&#x2F; {1}</p>]]></content>
      
      
      <categories>
          
          <category> es6 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> es6 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOS 6.10部署nodejs express项目</title>
      <link href="/2020/08/20/CentOS-6-10%E9%83%A8%E7%BD%B2nodejs-express%E9%A1%B9%E7%9B%AE/"/>
      <url>/2020/08/20/CentOS-6-10%E9%83%A8%E7%BD%B2nodejs-express%E9%A1%B9%E7%9B%AE/</url>
      
        <content type="html"><![CDATA[<h4 id="CentOS："><a href="#CentOS：" class="headerlink" title="CentOS："></a>CentOS：</h4><p> 最近用 node写的服务端基本完工，公司让我部署到线上 ….. 对于没有玩过Linux的我 ，真的是一脸懵逼 无从下手，但是难不到有心人的。办法总比困难多 ，话不多说 开整…..</p><ol><li>服务器系统版本：centos 6.10</li><li>window系统可用xshell工具登陆root用户 ，mac系统可用过命令ssh root@服务器ip 登陆 （本人用的finalshell 还是比较好用 哈哈）</li></ol><h4 id="安装nodejs-nom-cnpm"><a href="#安装nodejs-nom-cnpm" class="headerlink" title="安装nodejs nom&#x2F;cnpm"></a>安装nodejs nom&#x2F;cnpm</h4><h5 id="方式一："><a href="#方式一：" class="headerlink" title="方式一："></a>方式一：</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum install -y nodejs  //安装nodejs</span><br><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org //安装cnpm 淘宝镜像</span><br><span class="line">cnpm install -g n </span><br><span class="line">n stable // 更新node版本 （慢的一批 不推荐）</span><br></pre></td></tr></table></figure><p>方式二：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">wget https://nodejs.org/dist/v6.9.5/node-v6.9.5-linux-x64.tar.xz //下载node安装包 具体版本官网找连接替换</span><br><span class="line">tar xvf node-v6.9.5-linux-x64.tar.xz //解压node压缩包文件</span><br><span class="line"></span><br><span class="line">创建软链接，就可以在任意目录下使用node和npm命令</span><br><span class="line">ln -s /root/node-v6.9.5-linux-x64/bin/node /usr/local/bin/node</span><br><span class="line">ln -s /root/node-v6.9.5-linux-x64/bin/npm /usr/local/bin/npm</span><br><span class="line"></span><br><span class="line">查看node  npm版本</span><br><span class="line">node -v</span><br><span class="line">npm -v</span><br><span class="line"></span><br><span class="line">至此，Node.js环境已安装完毕。软件默认安装在/root/node-v6.9.5-linux-x64/目录下。</span><br></pre></td></tr></table></figure><h4 id="安装mysql"><a href="#安装mysql" class="headerlink" title="安装mysql"></a>安装mysql</h4><ol><li><p>卸载mysql （大多数centos 6 都自带mysql5.1）</p></li><li><p>查看mysql 命令 rpm -qa|grep mysql</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@lxxxx ~]# rpm -qa|grep mysql</span><br><span class="line">mysql-libs-5.1.73-7.el6.i686</span><br></pre></td></tr></table></figure></li><li><p>卸载mysql 命令 rpm -e –nodeps xxxx 如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -e --nodeps mysql-libs</span><br></pre></td></tr></table></figure></li><li><p>下载自己需要的mysql 版本</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">wget -c  http://dev.mysql.com/get/mysql57-community-release-el6-10.noarch.rpm</span><br><span class="line">yum localinstall mysql57-community-release-el6-10.noarch.rpm //安装rpm包</span><br><span class="line"></span><br><span class="line">yum repolist enabled |grep mysql //查看可用的安装包</span><br><span class="line">yum install gcc* //安装前装gcc所有包，防止报错</span><br><span class="line"></span><br><span class="line">service mysqld start //启动mysql</span><br><span class="line">service mysqld status //查看状态</span><br><span class="line">chkconfig mysqld on // 加入开机启动</span><br><span class="line">service mysqld restart //重启数据库</span><br><span class="line">grep &#x27;temporary password&#x27; /var/log/mysqld.log //查看初始密码 root@localhost：xxxxxx </span><br><span class="line">mysql -u root -p  //输入查询到的密码 进入数据库</span><br><span class="line">alter user &#x27;root&#x27;@&#x27;localhost&#x27; identified by &#x27;123456&#x27;; //修改root账号的密码为123456</span><br><span class="line">flush privileges;// 刷新权限</span><br><span class="line"></span><br><span class="line">修改密码复杂度权限：</span><br><span class="line">set global validate_password_policy=0; //修改validate_password_policy参数的值</span><br><span class="line">set global validate_password_length=1; //validate_password_length(密码长度)参数默认为8，我们修改为1</span><br><span class="line"></span><br><span class="line"> 授权远程访问（navicat）：</span><br><span class="line">grant all privileges on *.* to &#x27;root&#x27;@&#x27;%&#x27; identified by &#x27;123456&#x27; with grant option; </span><br></pre></td></tr></table></figure></li></ol><h4 id="安装nginx"><a href="#安装nginx" class="headerlink" title="安装nginx"></a>安装nginx</h4><ol><li><p>安装</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yum install -y nginx //安装</span><br><span class="line">service nginx start //启动</span><br><span class="line">service nginx stop //停止</span><br><span class="line">nginx -s stop //快速停止nginx。</span><br><span class="line">service nginx restart  //重启</span><br><span class="line">bainginx -s reload  //修改配置后 重新加载生效。</span><br><span class="line">nginx -s reopen //重新打开日志文件。</span><br><span class="line">nginx -t -c /path/to/nginx.conf //测试nginx配置文件是否正确。</span><br></pre></td></tr></table></figure></li><li><p>配置nginx</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Nginx配置文件(/etc/nginx/nginx.conf)</span><br><span class="line"></span><br><span class="line">upstream app_nodejs &#123;</span><br><span class="line">server 127.0.0.1:3000</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server&#123;</span><br><span class="line">listen 80 default; //监听端口</span><br><span class="line">server_name www.xxx.com ;//访问的域名</span><br><span class="line">if ($host ~ &quot;\d+\.\d+\.\d+\.\d&quot;) &#123;  #如果访问的是ip，则直接返回404，此处只允许通过域名访问</span><br><span class="line">    return 404;</span><br><span class="line">&#125;</span><br><span class="line">location / &#123;</span><br><span class="line">proxy_pass http://app_nodejs;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h4 id="安装pm2"><a href="#安装pm2" class="headerlink" title="安装pm2"></a>安装pm2</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g pm2 //安装pm2</span><br></pre></td></tr></table></figure><p>安装完成执行命令：pm2 list 会出现：-bash: pm2: command not found 说明没有配制到全局 所以我们需要创建一个linux下的软连接</p><p>创建软连接：<br>找到全局环境的path路径 输入命令：echo $PATH 会出现：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin</span><br></pre></td></tr></table></figure><p>你可以选择任何一个以：隔开的路径做为系统环境路径，我通常会选&#x2F;usr&#x2F;local&#x2F;bin</p><p>pm2安装路径如下：</p><p><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" alt="img"></p><p>创建软连接命令：ln -s &#x2F;usr&#x2F;local&#x2F;nodejs&#x2F;bin&#x2F;pm2 &#x2F;usr&#x2F;local&#x2F;bin&#x2F;</p><p>OK，搞定 验证一下：</p><p><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" alt="img"></p><h4 id="启动项目"><a href="#启动项目" class="headerlink" title="启动项目"></a>启动项目</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">到项目目录下：</span><br><span class="line">pm2 start xxx.json  //xxx.js是pm2的配置文件 </span><br></pre></td></tr></table></figure><h5 id="加油！！-越努力越幸运！！！"><a href="#加油！！-越努力越幸运！！！" class="headerlink" title="加油！！ 越努力越幸运！！！"></a>加油！！ 越努力越幸运！！！</h5>]]></content>
      
      
      <categories>
          
          <category> centos express </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos express </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOS 6.10部署vue项目</title>
      <link href="/2020/08/17/CentOS-6-10%E9%83%A8%E7%BD%B2vue%E9%A1%B9%E7%9B%AE/"/>
      <url>/2020/08/17/CentOS-6-10%E9%83%A8%E7%BD%B2vue%E9%A1%B9%E7%9B%AE/</url>
      
        <content type="html"><![CDATA[<h4 id="打包-上传"><a href="#打包-上传" class="headerlink" title="打包 上传"></a>打包 上传</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. 在本地使用以下命令，打包</span><br><span class="line">npm run build </span><br><span class="line">2. 打包之后本地会出现dist文件夹。将dist文件夹以及package.json 文件上传到centos服务器上，此处随便什么位置，新建个文件夹就能放。</span><br></pre></td></tr></table></figure><h4 id="增加app-js文件"><a href="#增加app-js文件" class="headerlink" title="增加app.js文件"></a>增加app.js文件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//定义目录</span><br><span class="line">const fs = require(&#x27;fs&#x27;);</span><br><span class="line">const path = require(&#x27;path&#x27;);</span><br><span class="line">const express = require(&#x27;express&#x27;);</span><br><span class="line">const app = express();</span><br><span class="line">//vue目录</span><br><span class="line">app.use(express.static(path.resolve(__dirname, &#x27;./dist&#x27;)))</span><br><span class="line"></span><br><span class="line">app.get(&#x27;*&#x27;, function(req, res) &#123;</span><br><span class="line">    const html = fs.readFileSync(path.resolve(__dirname, &#x27;./dist/index.html&#x27;), &#x27;utf-8&#x27;)</span><br><span class="line">    res.send(html)</span><br><span class="line">&#125;)</span><br><span class="line">//定义启动的端口号</span><br><span class="line">app.listen(8080);</span><br></pre></td></tr></table></figure><h4 id="安装模块"><a href="#安装模块" class="headerlink" title="安装模块"></a>安装模块</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#安装依赖包,如果系统中没有安装node，npm命令会找不到</span><br><span class="line">npm install </span><br><span class="line">#启动vue项目（pm2命令也需要单独安装，安装之后再执行下面命令）</span><br><span class="line">pm2 start app.js</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> centos vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>noden module.exports和exprots的区别和使用</title>
      <link href="/2020/08/07/node-module-exports%E5%92%8Cexprots%E7%9A%84%E5%8C%BA%E5%88%AB%E5%92%8C%E4%BD%BF%E7%94%A8/"/>
      <url>/2020/08/07/node-module-exports%E5%92%8Cexprots%E7%9A%84%E5%8C%BA%E5%88%AB%E5%92%8C%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p><strong>exports &#x3D; *<em>module.exports &#x3D; {};</em></strong>*</p><p><strong><code>所以module.exports</code>和<code>exports</code>的区别就是<code>var a=&#123;&#125;; var b=a;</code>，a和b的区别</strong></p><h1 id="module"><a href="#module" class="headerlink" title="module"></a>module</h1><p>首先要明确的一点，module是一个<strong>对象</strong> <code>&#123;Object&#125;</code>。<br>当你新建一个文件，比如mo.js，文件内容如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console.log(module); </span><br></pre></td></tr></table></figure><p>然后在CMD里执行这个文件<code>node mo.js</code>，就能看到module其实是一个Module实例，你可以这么理解，NodeJS中定义了一个Module类，这个类中有很多属性和方法，exports是其中的一个属性：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">function Module &#123;  id : &#x27;blabla&#x27;,  exports : &#123;&#125;,  blabla... &#125; </span><br></pre></td></tr></table></figure><p>当每个js文件在执行或被require的时候，NodeJS其实创建了一个新的实例<code>var module = new Module()</code>，这个实例名叫<code>module</code>。<br><strong>这也就是为什么你并没有定义<code>module</code>这个变量，却能console.log出来而不会报错的原因</strong>。</p><h1 id="module-exports"><a href="#module-exports" class="headerlink" title="module.exports"></a>module.exports</h1><p>假设我有一个JS文件内容如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">console.log(module); //你会看到Module中的exports为空对象&#123;&#125;</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">  print : function()&#123;console.log(12345)&#125;</span><br><span class="line">&#125;</span><br><span class="line">console.log(module); //你会看到Module中的exports对象已经有了print()方法</span><br></pre></td></tr></table></figure><p>有了上面的基础，很容易理解<code>module.export</code>其实是<strong>给Module实例中的exports对象中添加方法&#x2F;属性</strong>。</p><h1 id="exports"><a href="#exports" class="headerlink" title="exports"></a>exports</h1><p>通常使用exports的时候，是这么用的：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exports.print = function()&#123;console.log(12345)&#125;</span><br></pre></td></tr></table></figure><p>假设我有一个JS文件内容如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">console.log(module); //你会看到Module中的exports为空对象&#123;&#125;</span><br><span class="line"></span><br><span class="line">console.log(exports); //你会看到Module中的exports为空对象&#123;&#125;</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line"></span><br><span class="line">  print : function()&#123;console.log(12345)&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">console.log(module); //你会看到Module中的exports对象有了print()方法</span><br><span class="line"></span><br><span class="line">exports.name = &#x27;小白妹妹&#x27;;</span><br><span class="line"></span><br><span class="line">console.log(module); //你会看到Module中的exports对象不仅有了print()方法，还有了name属性</span><br></pre></td></tr></table></figure><p>由此也能看出，传说中的**<code>exports</code>其实是<code>module.exports</code>的引用<strong>，你可以这么理解，NodeJS在你的代码</strong>之前**悄悄的加了以下代码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var module = new Module();</span><br><span class="line"></span><br><span class="line">var exports = module.exports;</span><br></pre></td></tr></table></figure><p><strong>这也就是为什么你并没有定义<code>exports</code>这个变量，却能console.log出来而不会报错的原因</strong>。</p><h1 id="require"><a href="#require" class="headerlink" title="require"></a>require</h1><p>当你从外部调用某个模块，require其实是在require什么？<a href="https://nodejs.org/dist/latest-v4.x/docs/api/modules.html#modules_module_require_id">^2</a><br>require的时候NodeJS会<del>到处</del>去找有没有这个模块，如果有，return的就是module.exports里的东东。</p><h1 id="DOs-DONTs"><a href="#DOs-DONTs" class="headerlink" title="DOs &amp; DONTs"></a>DOs &amp; DONTs</h1><ul><li><p>√你可以这样：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">module.exports.name = &#x27;小白妹妹&#x27;;</span><br><span class="line"></span><br><span class="line">exports.age = 10;</span><br><span class="line"></span><br><span class="line">module.exports.print = function()&#123;console.log(12345)&#125;;</span><br></pre></td></tr></table></figure><p>如果只是使用.来添加属性和方法，module.exports和exprots混用是完全可以的，这种情况下，感觉exports就是给懒人用的…毕竟能少写几个7个字符呢！</p></li><li><p>√也可以这样：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">name = &#x27;小白妹妹&#x27;;</span><br><span class="line">&#125;;</span><br><span class="line">exports.age = 10;</span><br><span class="line">module.exports.print = function()&#123;console.log(12345)&#125;;</span><br></pre></td></tr></table></figure></li><li><p>×但不可以这样：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">name = &#x27;小白妹妹&#x27;;</span><br><span class="line">&#125;;</span><br><span class="line">exports = &#123;age:10&#125;; // exports现在是&#123;age:10&#125;这个对象的引用，不再是module.exports的引用了</span><br><span class="line"></span><br><span class="line">console.log(module); //你会看到Module的exports中只有name属性！！！</span><br></pre></td></tr></table></figure></li><li><p>×也不可以这样：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">exports.age = 10; </span><br><span class="line">console.log(module); //你会看到Module的exports中多了age属性</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">name = &#x27;小白妹妹&#x27;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">console.log(module); //你会看到Module的exports中还是只有name属性！！！</span><br></pre></td></tr></table></figure><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>还是那一句话，module.exports和exports的区别就是var a&#x3D;{}; var b&#x3D;a;，a和b的区别</p><blockquote><ul><li>改变<code>exports</code>的指向后所添加的<code>exports.xxx</code>都是无效的。因为require返回的只会是<code>module.exports</code></li></ul></blockquote></li><li><p>不能在使用了<code>exports.xxx</code>之后，改变<code>module.exports</code>的指向。因为<code>exports.xxx</code>添加的属性和方法并不存在于<code>module.exports</code>所指向的新对象中。</p></li><li><p>对于要导出的属性，可以简单直接挂到<code>exports</code>对象上</p></li><li><p>对于类，为了直接使导出的内容作为类的构造器可以让调用者使用new操作符创建实例对象，应该把构造函数挂到<code>module.exports</code>对象上，不要和导出属性值混在一起</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> nodes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nodes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mysql根据查询多个值返回结果</title>
      <link href="/2020/07/31/mysql%E6%A0%B9%E6%8D%AE%E6%9F%A5%E8%AF%A2%E5%A4%9A%E4%B8%AA%E5%80%BC%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C/"/>
      <url>/2020/07/31/mysql%E6%A0%B9%E6%8D%AE%E6%9F%A5%E8%AF%A2%E5%A4%9A%E4%B8%AA%E5%80%BC%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C/</url>
      
        <content type="html"><![CDATA[<h5 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h5><p>需要根据查找id为数组元素的所有数据。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">正常情况需要查询的语句：</span><br><span class="line">select *from temp where id in (&#x27;1&#x27;,&#x27;2&#x27;,&#x27;3&#x27;,&#x27;4&#x27;,&#x27;5&#x27;)</span><br></pre></td></tr></table></figure><p>在实际过程中发现一直查不出数据，实际上能够查出数据，弄得一直很郁闷，找不出原因。<br>通过各终尝试，最后在项目中通过断点找出原因。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">在进行查询时in中自动添加了单引号，如：</span><br><span class="line">select *from temp where id in (&#x27;1,2,3,4,5&#x27;)</span><br><span class="line">这个sql肯定就不会查出数据。</span><br></pre></td></tr></table></figure><p>刚开始想到的解决方法是，通过</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=id.replace(&quot;,&quot;, &quot;&#x27;,&#x27;&quot;)；</span><br></pre></td></tr></table></figure><p>进行替换，达到想要的查询语句。问题还是没有就解决。通过断点发现sql变为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select *from temp where id in (&#x27;1\&#x27;,&#x27;2\&#x27;,&#x27;3\&#x27;,&#x27;4\&#x27;,\&#x27;5&#x27;)</span><br></pre></td></tr></table></figure><p>此方法行不通，最会找到下边的解决方案解决问题。</p><p>解决方案：<br>此时 FIND_IN_SET 就能解决我们这个棘手的问题了。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select *from temp where FIND_IN_SET（id，&#x27;1,2,3,4,5&#x27;)</span><br></pre></td></tr></table></figure><p><strong>find_in_set()和in的区别：</strong></p><p>弄个测试表来说明两者的区别</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `tb_test` (</span><br><span class="line">  `id` int(8) NOT NULL auto_increment,</span><br><span class="line">  `name` varchar(255) NOT NULL,</span><br><span class="line">  `list` varchar(255) NOT NULL,</span><br><span class="line">  PRIMARY KEY  (`id`)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">INSERT INTO `tb_test` VALUES (1, &#x27;name&#x27;, &#x27;daodao,xiaohu,xiaoqin&#x27;);</span><br><span class="line">INSERT INTO `tb_test` VALUES (2, &#x27;name2&#x27;, &#x27;xiaohu,daodao,xiaoqin&#x27;);</span><br><span class="line">INSERT INTO `tb_test` VALUES (3, &#x27;name3&#x27;, &#x27;xiaoqin,daodao,xiaohu&#x27;);</span><br></pre></td></tr></table></figure><p>原来以为mysql可以进行这样的查询：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT id,name,list from tb_test WHERE &#x27;daodao&#x27; IN(list); -- (一) </span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" alt="img"></p><p>实际上这样是不行的，这样只有当list字段的值等于’daodao’时（和IN前面的字符串完全匹配），查询才有效，否则都得不到结果，即使’daodao’真的在list中。</p><p>再来看看这个：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT id,name,list from tb_test WHERE &#x27;daodao&#x27; IN (&#x27;libk&#x27;, &#x27;zyfon&#x27;, &#x27;daodao&#x27;); -- (二)</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" alt="img"></p><p>这样是可以的。</p><p>这两条到底有什么区别呢？为什么第一条不能取得正确的结果，而第二条却能取得结果。原因其实是（一）中 (list) list是变量， 而（二）中 (‘libk’, ‘zyfon’, ‘daodao’)是常量。<br>所以如果要让（一）能正确工作，需要用find_in_set():</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT id,name,list from tb_test WHERE FIND_IN_SET(&#x27;daodao&#x27;,list); -- (一)的改进版</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" alt="img"></p><p><strong>总结：</strong><br>所以如果list是常量，则可以直接用IN， 否则要用find_in_set()函数。</p>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>element-ui之dialog组件封装</title>
      <link href="/2020/05/09/element-ui%E4%B9%8Bdialog%E7%BB%84%E4%BB%B6%E5%B0%81%E8%A3%85/"/>
      <url>/2020/05/09/element-ui%E4%B9%8Bdialog%E7%BB%84%E4%BB%B6%E5%B0%81%E8%A3%85/</url>
      
        <content type="html"><![CDATA[<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">组件封装：</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;resetPass&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;openDialog&quot;</span>&gt;</span>修改密码<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-dialog</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:visible.sync</span>=<span class="string">&quot;DialogVisible&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:close-on-click-modal</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:destroy-on-close</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">title</span>=<span class="string">&quot;修改密码&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">width</span>=<span class="string">&quot;30%&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">append-to-body</span></span></span><br><span class="line"><span class="tag">      <span class="attr">center</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">close</span>=<span class="string">&quot;resetForm(&#x27;ruleForm&#x27;)&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span>&gt;</span>this is a dialog<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">slot</span>=<span class="string">&quot;footer&quot;</span> <span class="attr">class</span>=<span class="string">&quot;dialog-footer&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;submitForm(&#x27;ruleForm&#x27;)&quot;</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click</span>=<span class="string">&quot;resetForm(&#x27;ruleForm&#x27;)&quot;</span>&gt;</span>重置<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-dialog</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&#x27;ResetPassword&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="title class_">DialogVisible</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">submitForm</span>(<span class="params">formName</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> that = <span class="variable language_">this</span></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">$refs</span>[formName].<span class="title function_">validate</span>(<span class="function">(<span class="params">valid</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (valid) &#123;</span></span><br><span class="line"><span class="language-javascript">          </span></span><br><span class="line"><span class="language-javascript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;)</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">resetForm</span>(<span class="params">formName</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">$refs</span>[formName].<span class="title function_">resetFields</span>()</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">openDialog</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">DialogVisible</span> = <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">组件使用：</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">reset-Password</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">ResetPassword</span> <span class="keyword">from</span> <span class="string">&#x27;../../components/dialog/resetPassword&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&#x27;AppMain&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">components</span>: &#123;<span class="title class_">ResetPassword</span>&#125;,</span></span><br><span class="line"><span class="language-javascript">  data () &#123;</span></span><br><span class="line"><span class="language-javascript">       <span class="keyword">return</span> &#123;&#125;;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">methods</span>: &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">   &#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> element vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>js封装websocket</title>
      <link href="/2020/05/09/js%E5%B0%81%E8%A3%85websocket/"/>
      <url>/2020/05/09/js%E5%B0%81%E8%A3%85websocket/</url>
      
        <content type="html"><![CDATA[<h4 id="1-创建websocket-js"><a href="#1-创建websocket-js" class="headerlink" title="1.创建websocket.js"></a>1.创建websocket.js</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">WSS_URL</span> = <span class="string">`wss://wss.xxxx.com/ws?appid=xxx`</span></span><br><span class="line"><span class="keyword">let</span> <span class="title class_">Socket</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">let</span> setIntervalWesocketPush = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**建立连接 */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">createSocket</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="title class_">Socket</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;建立websocket连接&#x27;</span>)</span><br><span class="line">    <span class="title class_">Socket</span> = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(<span class="variable constant_">WSS_URL</span>)</span><br><span class="line">    <span class="title class_">Socket</span>.<span class="property">onopen</span> = onopenWS</span><br><span class="line">    <span class="title class_">Socket</span>.<span class="property">onmessage</span> = onmessageWS</span><br><span class="line">    <span class="title class_">Socket</span>.<span class="property">onerror</span> = onerrorWS</span><br><span class="line">    <span class="title class_">Socket</span>.<span class="property">onclose</span> = oncloseWS</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;websocket已连接&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**打开WS之后发送心跳 */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">onopenWS</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">sendPing</span>() <span class="comment">//发送心跳</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**连接失败重连 */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">onerrorWS</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="built_in">clearInterval</span>(setIntervalWesocketPush)</span><br><span class="line">  <span class="title class_">Socket</span>.<span class="title function_">close</span>()</span><br><span class="line">  <span class="title function_">createSocket</span>() <span class="comment">//重连</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**WS数据接收统一处理 */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">onmessageWS</span>(<span class="params">e</span>) &#123;</span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">dispatchEvent</span>(<span class="keyword">new</span> <span class="title class_">CustomEvent</span>(<span class="string">&#x27;onmessageWS&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">detail</span>: &#123;</span><br><span class="line">      <span class="attr">data</span>: e</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;))</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**发送数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">eventType</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">sendWSPush</span>(<span class="params">eventTypeArr</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> obj = &#123;</span><br><span class="line">    <span class="attr">appId</span>: <span class="string">&#x27;airShip&#x27;</span>,</span><br><span class="line">    <span class="attr">cover</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">event</span>: eventTypeArr</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Socket</span> !== <span class="literal">null</span> &amp;&amp; <span class="title class_">Socket</span>.<span class="property">readyState</span> === <span class="number">3</span>) &#123;</span><br><span class="line">    <span class="title class_">Socket</span>.<span class="title function_">close</span>()</span><br><span class="line">    <span class="title function_">createSocket</span>() <span class="comment">//重连</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title class_">Socket</span>.<span class="property">readyState</span> === <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="title class_">Socket</span>.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj))</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title class_">Socket</span>.<span class="property">readyState</span> === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title class_">Socket</span>.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj))</span><br><span class="line">    &#125;, <span class="number">3000</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**关闭WS */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">oncloseWS</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="built_in">clearInterval</span>(setIntervalWesocketPush)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;websocket已断开&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**发送心跳 */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">sendPing</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title class_">Socket</span>.<span class="title function_">send</span>(<span class="string">&#x27;ping&#x27;</span>)</span><br><span class="line">  setIntervalWesocketPush = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title class_">Socket</span>.<span class="title function_">send</span>(<span class="string">&#x27;ping&#x27;</span>)</span><br><span class="line">  &#125;, <span class="number">5000</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-调用方式"><a href="#2-调用方式" class="headerlink" title="2.调用方式"></a>2.调用方式</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createSocket, sendWSPush &#125; <span class="keyword">from</span> <span class="string">&#x27;./api/websocket&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">createSocket</span>() <span class="comment">//创建</span></span><br><span class="line"><span class="title function_">sendWSPush</span>(<span class="number">11111</span>) <span class="comment">//发送数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//监听ws数据响应</span></span><br><span class="line"><span class="keyword">const</span> getDataFunc = <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">detail</span>.<span class="property">data</span>)</span><br><span class="line">&#125; </span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;onmessageWS&#x27;</span>, getDataFunc)</span><br><span class="line"></span><br><span class="line"><span class="comment">//根据需要，销毁事件监听</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;onmessageWS&#x27;</span>, getDataFunc)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> websocket </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript websocket </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue中使用websocket正确的方式</title>
      <link href="/2020/04/07/vue%E4%B8%AD%E4%BD%BF%E7%94%A8websocket%E6%AD%A3%E7%A1%AE%E7%9A%84%E6%96%B9%E5%BC%8F/"/>
      <url>/2020/04/07/vue%E4%B8%AD%E4%BD%BF%E7%94%A8websocket%E6%AD%A3%E7%A1%AE%E7%9A%84%E6%96%B9%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;test&quot;&gt;</span><br><span class="line">    // ...do</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  export default &#123;</span><br><span class="line">    name : &#x27;test&#x27;,</span><br><span class="line">    data() &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        websock: null,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    created() &#123;</span><br><span class="line">      this.initWebSocket();</span><br><span class="line">    &#125;,</span><br><span class="line">    destroyed() &#123;</span><br><span class="line">      this.websock.close() //离开路由之后断开websocket连接</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      initWebSocket()&#123; //初始化weosocket</span><br><span class="line">        const wsuri = &quot;ws://127.0.0.1:8080&quot;;</span><br><span class="line">        this.websock = new WebSocket(wsuri);</span><br><span class="line">        this.websock.onmessage = this.websocketonmessage;</span><br><span class="line">        this.websock.onopen = this.websocketonopen;</span><br><span class="line">        this.websock.onerror = this.websocketonerror;</span><br><span class="line">        this.websock.onclose = this.websocketclose;</span><br><span class="line">      &#125;,</span><br><span class="line">      websocketonopen()&#123; //连接建立之后执行send方法发送数据</span><br><span class="line">        let actions = &#123;&quot;test&quot;:&quot;12345&quot;&#125;;</span><br><span class="line">        this.websocketsend(JSON.stringify(actions));</span><br><span class="line">      &#125;,</span><br><span class="line">      websocketonerror()&#123;//连接建立失败重连</span><br><span class="line">        this.initWebSocket();</span><br><span class="line">      &#125;,</span><br><span class="line">      websocketonmessage(e)&#123; //数据接收</span><br><span class="line">        const redata = JSON.parse(e.data);</span><br><span class="line">      &#125;,</span><br><span class="line">      websocketsend(Data)&#123;//数据发送</span><br><span class="line">        this.websock.send(Data);</span><br><span class="line">      &#125;,</span><br><span class="line">      websocketclose(e)&#123;  //关闭</span><br><span class="line">        console.log(&#x27;断开连接&#x27;,e);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style lang=&#x27;less&#x27;&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> websocket vue </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
